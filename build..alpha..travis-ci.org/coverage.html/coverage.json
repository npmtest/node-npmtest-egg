{"/home/travis/build/npmtest/node-npmtest-egg/test.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/test.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":1,"12":1,"13":1,"14":1,"15":2,"16":2,"17":2,"18":2,"19":1,"20":1,"21":2,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":2,"40":2,"41":1,"42":2,"43":2,"44":1,"45":2,"46":2,"47":1,"48":2,"49":2,"50":1,"51":1,"52":1,"53":1,"54":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[1,1],"5":[1,1],"6":[1,1],"7":[1,1],"8":[1,1],"9":[1,1],"10":[1,1,1],"11":[1,1],"12":[1,1],"13":[1,1],"14":[1,1],"15":[1,1],"16":[1,1],"17":[1,1]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":1,"7":1,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}},"4":{"name":"(anonymous_4)","line":61,"loc":{"start":{"line":61,"column":5},"end":{"line":61,"column":17}}},"5":{"name":"(anonymous_5)","line":82,"loc":{"start":{"line":82,"column":5},"end":{"line":82,"column":17}}},"6":{"name":"(anonymous_6)","line":91,"loc":{"start":{"line":91,"column":77},"end":{"line":94,"column":10}}},"7":{"name":"(anonymous_7)","line":112,"loc":{"start":{"line":112,"column":83},"end":{"line":115,"column":10}},"skip":true},"8":{"name":"(anonymous_8)","line":123,"loc":{"start":{"line":123,"column":77},"end":{"line":126,"column":10}},"skip":true},"9":{"name":"(anonymous_9)","line":139,"loc":{"start":{"line":139,"column":12},"end":{"line":139,"column":40}},"skip":true},"10":{"name":"(anonymous_10)","line":147,"loc":{"start":{"line":147,"column":77},"end":{"line":150,"column":10}},"skip":true},"11":{"name":"(anonymous_11)","line":158,"loc":{"start":{"line":158,"column":83},"end":{"line":161,"column":10}},"skip":true},"12":{"name":"(anonymous_12)","line":169,"loc":{"start":{"line":169,"column":79},"end":{"line":172,"column":10}},"skip":true},"13":{"name":"(anonymous_13)","line":180,"loc":{"start":{"line":180,"column":75},"end":{"line":183,"column":10}},"skip":true}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":195,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":56,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":40,"column":8},"end":{"line":53,"column":9}},"11":{"start":{"line":43,"column":12},"end":{"line":46,"column":14}},"12":{"start":{"line":47,"column":12},"end":{"line":47,"column":18}},"13":{"start":{"line":50,"column":12},"end":{"line":51,"column":33}},"14":{"start":{"line":52,"column":12},"end":{"line":52,"column":18}},"15":{"start":{"line":55,"column":8},"end":{"line":55,"column":35}},"16":{"start":{"line":61,"column":4},"end":{"line":63,"column":9}},"17":{"start":{"line":62,"column":8},"end":{"line":62,"column":15}},"18":{"start":{"line":64,"column":4},"end":{"line":77,"column":5}},"19":{"start":{"line":70,"column":8},"end":{"line":70,"column":14}},"20":{"start":{"line":76,"column":8},"end":{"line":76,"column":14}},"21":{"start":{"line":82,"column":4},"end":{"line":84,"column":9}},"22":{"start":{"line":83,"column":8},"end":{"line":83,"column":15}},"23":{"start":{"line":85,"column":4},"end":{"line":194,"column":5}},"24":{"start":{"line":91,"column":8},"end":{"line":99,"column":10}},"25":{"start":{"line":98,"column":12},"end":{"line":98,"column":35}},"26":{"start":{"line":102,"column":8},"end":{"line":104,"column":63}},"27":{"start":{"line":105,"column":8},"end":{"line":105,"column":14}},"28":{"start":{"line":112,"column":8},"end":{"line":121,"column":10},"skip":true},"29":{"start":{"line":119,"column":12},"end":{"line":119,"column":55},"skip":true},"30":{"start":{"line":120,"column":12},"end":{"line":120,"column":48},"skip":true},"31":{"start":{"line":123,"column":8},"end":{"line":136,"column":10},"skip":true},"32":{"start":{"line":130,"column":12},"end":{"line":130,"column":76},"skip":true},"33":{"start":{"line":131,"column":12},"end":{"line":131,"column":73},"skip":true},"34":{"start":{"line":132,"column":12},"end":{"line":132,"column":74},"skip":true},"35":{"start":{"line":133,"column":12},"end":{"line":133,"column":79},"skip":true},"36":{"start":{"line":134,"column":12},"end":{"line":134,"column":25},"skip":true},"37":{"start":{"line":135,"column":12},"end":{"line":135,"column":45},"skip":true},"38":{"start":{"line":138,"column":8},"end":{"line":145,"column":14},"skip":true},"39":{"start":{"line":143,"column":16},"end":{"line":143,"column":29},"skip":true},"40":{"start":{"line":144,"column":16},"end":{"line":144,"column":55},"skip":true},"41":{"start":{"line":147,"column":8},"end":{"line":156,"column":10},"skip":true},"42":{"start":{"line":154,"column":12},"end":{"line":154,"column":25},"skip":true},"43":{"start":{"line":155,"column":12},"end":{"line":155,"column":45},"skip":true},"44":{"start":{"line":158,"column":8},"end":{"line":167,"column":10},"skip":true},"45":{"start":{"line":165,"column":12},"end":{"line":165,"column":25},"skip":true},"46":{"start":{"line":166,"column":12},"end":{"line":166,"column":48},"skip":true},"47":{"start":{"line":169,"column":8},"end":{"line":178,"column":10},"skip":true},"48":{"start":{"line":176,"column":12},"end":{"line":176,"column":25},"skip":true},"49":{"start":{"line":177,"column":12},"end":{"line":177,"column":46},"skip":true},"50":{"start":{"line":180,"column":8},"end":{"line":189,"column":10},"skip":true},"51":{"start":{"line":187,"column":12},"end":{"line":187,"column":94},"skip":true},"52":{"start":{"line":188,"column":12},"end":{"line":188,"column":48},"skip":true},"53":{"start":{"line":192,"column":8},"end":{"line":192,"column":35},"skip":true},"54":{"start":{"line":193,"column":8},"end":{"line":193,"column":14},"skip":true}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":40,"type":"switch","locations":[{"start":{"line":42,"column":8},"end":{"line":47,"column":18}},{"start":{"line":49,"column":8},"end":{"line":52,"column":18}}]},"5":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":16},"end":{"line":44,"column":44}},{"start":{"line":44,"column":48},"end":{"line":44,"column":66}}]},"6":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":21},"end":{"line":50,"column":49}},{"start":{"line":50,"column":53},"end":{"line":50,"column":72}}]},"7":{"line":64,"type":"switch","locations":[{"start":{"line":69,"column":4},"end":{"line":70,"column":14}},{"start":{"line":75,"column":4},"end":{"line":76,"column":14}}]},"8":{"line":85,"type":"switch","locations":[{"start":{"line":90,"column":4},"end":{"line":105,"column":14}},{"start":{"line":111,"column":4},"end":{"line":193,"column":14},"skip":true}]},"9":{"line":91,"type":"binary-expr","locations":[{"start":{"line":91,"column":42},"end":{"line":91,"column":73}},{"start":{"line":91,"column":77},"end":{"line":99,"column":9}}]},"10":{"line":102,"type":"binary-expr","locations":[{"start":{"line":102,"column":18},"end":{"line":102,"column":32}},{"start":{"line":103,"column":12},"end":{"line":103,"column":53}},{"start":{"line":104,"column":12},"end":{"line":104,"column":61}}]},"11":{"line":112,"type":"binary-expr","locations":[{"start":{"line":112,"column":45},"end":{"line":112,"column":79},"skip":true},{"start":{"line":112,"column":83},"end":{"line":121,"column":9},"skip":true}]},"12":{"line":123,"type":"binary-expr","locations":[{"start":{"line":123,"column":42},"end":{"line":123,"column":73},"skip":true},{"start":{"line":123,"column":77},"end":{"line":136,"column":9},"skip":true}]},"13":{"line":138,"type":"binary-expr","locations":[{"start":{"line":138,"column":48},"end":{"line":138,"column":85},"skip":true},{"start":{"line":139,"column":12},"end":{"line":145,"column":13},"skip":true}]},"14":{"line":147,"type":"binary-expr","locations":[{"start":{"line":147,"column":42},"end":{"line":147,"column":73},"skip":true},{"start":{"line":147,"column":77},"end":{"line":156,"column":9},"skip":true}]},"15":{"line":158,"type":"binary-expr","locations":[{"start":{"line":158,"column":45},"end":{"line":158,"column":79},"skip":true},{"start":{"line":158,"column":83},"end":{"line":167,"column":9},"skip":true}]},"16":{"line":169,"type":"binary-expr","locations":[{"start":{"line":169,"column":43},"end":{"line":169,"column":75},"skip":true},{"start":{"line":169,"column":79},"end":{"line":178,"column":9},"skip":true}]},"17":{"line":180,"type":"binary-expr","locations":[{"start":{"line":180,"column":41},"end":{"line":180,"column":71},"skip":true},{"start":{"line":180,"column":75},"end":{"line":189,"column":9},"skip":true}]}},"code":["/* istanbul instrument in package npmtest_egg */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - init-before","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        switch (local.modeJs) {","        // re-init local from window.local","        case 'browser':","            local = local.global.utility2.objectSetDefault(","                local.global.utility2_rollup || local.global.local,","                local.global.utility2","            );","            break;","        // re-init local from example.js","        case 'node':","            local = (local.global.utility2_rollup || require('utility2'))","                .requireReadme();","            break;","        }","        // export local","        local.global.local = local;","    }());","","","","    // run shared js-env code - function","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - function","    case 'browser':","        break;","","","","    // run node js-env code - function","    case 'node':","        break;","    }","","","","    // run shared js-env code - init-after","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - init-after","    case 'browser':","        local.testCase_browser_nullCase = local.testCase_browser_nullCase || function (","            options,","            onError","        ) {","        /*","         * this function will test browsers's null-case handling-behavior-behavior","         */","            onError(null, options);","        };","","        // run tests","        local.nop(local.modeTest &&","            document.querySelector('#testRunButton1') &&","            document.querySelector('#testRunButton1').click());","        break;","","","","    // run node js-env code - init-after","    /* istanbul ignore next */","    case 'node':","        local.testCase_buildApidoc_default = local.testCase_buildApidoc_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApidoc's default handling-behavior-behavior","         */","            options = { modulePathList: module.paths };","            local.buildApidoc(options, onError);","        };","","        local.testCase_buildApp_default = local.testCase_buildApp_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApp's default handling-behavior-behavior","         */","            local.testCase_buildReadme_default(options, local.onErrorThrow);","            local.testCase_buildLib_default(options, local.onErrorThrow);","            local.testCase_buildTest_default(options, local.onErrorThrow);","            local.testCase_buildCustomOrg_default(options, local.onErrorThrow);","            options = [];","            local.buildApp(options, onError);","        };","","        local.testCase_buildCustomOrg_default = local.testCase_buildCustomOrg_default ||","            function (options, onError) {","            /*","             * this function will test buildCustomOrg's default handling-behavior","             */","                options = {};","                local.buildCustomOrg(options, onError);","            };","","        local.testCase_buildLib_default = local.testCase_buildLib_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildLib's default handling-behavior","         */","            options = {};","            local.buildLib(options, onError);","        };","","        local.testCase_buildReadme_default = local.testCase_buildReadme_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildReadme's default handling-behavior-behavior","         */","            options = {};","            local.buildReadme(options, onError);","        };","","        local.testCase_buildTest_default = local.testCase_buildTest_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildTest's default handling-behavior","         */","            options = {};","            local.buildTest(options, onError);","        };","","        local.testCase_webpage_default = local.testCase_webpage_default || function (","            options,","            onError","        ) {","        /*","         * this function will test webpage's default handling-behavior","         */","            options = { modeCoverageMerge: true, url: local.serverLocalHost + '?modeTest=1' };","            local.browserTest(options, onError);","        };","","        // run test-server","        local.testRunServer(local);","        break;","    }","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"40":2,"43":1,"47":1,"50":1,"52":1,"55":2,"61":2,"62":2,"64":2,"70":1,"76":1,"82":2,"83":2,"85":2,"91":1,"98":1,"102":1,"105":1,"112":1,"119":1,"120":1,"123":1,"130":1,"131":1,"132":1,"133":1,"134":1,"135":1,"138":1,"143":2,"144":2,"147":1,"154":2,"155":2,"158":1,"165":2,"166":2,"169":1,"176":2,"177":2,"180":1,"187":1,"188":1,"192":1,"193":1}},"/home/travis/build/npmtest/node-npmtest-egg/lib.npmtest_egg.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/lib.npmtest_egg.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":1,"15":1,"16":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1]},"f":{"1":2,"2":2,"3":2},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":53,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":52,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":41,"column":8},"end":{"line":41,"column":54}},"11":{"start":{"line":43,"column":8},"end":{"line":43,"column":48}},"12":{"start":{"line":45,"column":8},"end":{"line":51,"column":9}},"13":{"start":{"line":46,"column":12},"end":{"line":46,"column":54}},"14":{"start":{"line":48,"column":12},"end":{"line":48,"column":35}},"15":{"start":{"line":49,"column":12},"end":{"line":49,"column":49}},"16":{"start":{"line":50,"column":12},"end":{"line":50,"column":43}}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":16},"end":{"line":41,"column":44}},{"start":{"line":41,"column":48},"end":{"line":41,"column":53}}]},"5":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":45,"column":8}},{"start":{"line":45,"column":8},"end":{"line":45,"column":8}}]}},"code":["/* istanbul instrument in package npmtest_egg */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - init-before","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || local;","        // init lib","        local.local = local.npmtest_egg = local;","        // init exports","        if (local.modeJs === 'browser') {","            local.global.utility2_npmtest_egg = local;","        } else {","            module.exports = local;","            module.exports.__dirname = __dirname;","            module.exports.module = module;","        }","    }());","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"41":2,"43":2,"45":2,"46":1,"48":1,"49":1,"50":1}},"/home/travis/build/npmtest/node-npmtest-egg/example.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/example.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":2,"15":2,"16":2,"17":2,"18":2,"19":0,"20":2,"21":1,"22":1,"23":1,"24":1,"25":1,"26":0,"27":0,"28":1,"29":1,"30":2,"31":0,"32":0,"33":0,"34":1,"35":2,"36":2,"37":3,"38":3,"39":3,"40":3,"41":0,"42":3,"43":3,"44":3,"45":1,"46":3,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":0,"58":1,"59":6,"60":6,"61":1,"62":2,"63":0,"64":2,"65":1,"66":1,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1],"6":[1,1],"7":[2,0],"8":[2,1,1,1,1,1],"9":[0,2,0],"10":[1,1],"11":[2,1,1],"12":[1,0],"13":[0,2],"14":[2,0,0,0,0,0,0],"15":[0,3],"16":[3,0],"17":[1,1],"18":[0,1],"19":[1,2,0,2],"20":[1,0],"21":[1,1],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":3,"8":3,"9":3,"10":1,"11":6,"12":0},"fnMap":{"1":{"name":"(anonymous_1)","line":26,"loc":{"start":{"line":26,"column":1},"end":{"line":26,"column":13}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":5},"end":{"line":33,"column":17}}},"3":{"name":"(anonymous_3)","line":37,"loc":{"start":{"line":37,"column":24},"end":{"line":37,"column":36}}},"4":{"name":"(anonymous_4)","line":69,"loc":{"start":{"line":69,"column":31},"end":{"line":69,"column":48}},"skip":true},"5":{"name":"(anonymous_5)","line":78,"loc":{"start":{"line":78,"column":26},"end":{"line":78,"column":45}},"skip":true},"6":{"name":"(anonymous_6)","line":123,"loc":{"start":{"line":123,"column":33},"end":{"line":123,"column":48}},"skip":true},"7":{"name":"(anonymous_7)","line":125,"loc":{"start":{"line":125,"column":27},"end":{"line":125,"column":39}},"skip":true},"8":{"name":"(anonymous_8)","line":133,"loc":{"start":{"line":133,"column":59},"end":{"line":133,"column":74}},"skip":true},"9":{"name":"(anonymous_9)","line":143,"loc":{"start":{"line":143,"column":45},"end":{"line":143,"column":62}},"skip":true},"10":{"name":"(anonymous_10)","line":144,"loc":{"start":{"line":144,"column":73},"end":{"line":144,"column":92}},"skip":true},"11":{"name":"(anonymous_11)","line":272,"loc":{"start":{"line":272,"column":51},"end":{"line":272,"column":77}},"skip":true},"12":{"name":"(anonymous_12)","line":315,"loc":{"start":{"line":315,"column":32},"end":{"line":315,"column":61}},"skip":true}},"statementMap":{"1":{"start":{"line":26,"column":0},"end":{"line":326,"column":5}},"2":{"start":{"line":28,"column":4},"end":{"line":28,"column":14}},"3":{"start":{"line":33,"column":4},"end":{"line":60,"column":9}},"4":{"start":{"line":35,"column":8},"end":{"line":35,"column":19}},"5":{"start":{"line":37,"column":8},"end":{"line":49,"column":13}},"6":{"start":{"line":38,"column":12},"end":{"line":48,"column":13}},"7":{"start":{"line":39,"column":16},"end":{"line":42,"column":30}},"8":{"start":{"line":44,"column":16},"end":{"line":47,"column":27}},"9":{"start":{"line":51,"column":8},"end":{"line":53,"column":21}},"10":{"start":{"line":55,"column":8},"end":{"line":57,"column":45}},"11":{"start":{"line":59,"column":8},"end":{"line":59,"column":35}},"12":{"start":{"line":61,"column":4},"end":{"line":325,"column":5}},"13":{"start":{"line":69,"column":8},"end":{"line":121,"column":10},"skip":true},"14":{"start":{"line":70,"column":12},"end":{"line":88,"column":13},"skip":true},"15":{"start":{"line":76,"column":16},"end":{"line":87,"column":19},"skip":true},"16":{"start":{"line":79,"column":20},"end":{"line":86,"column":21},"skip":true},"17":{"start":{"line":82,"column":24},"end":{"line":82,"column":43},"skip":true},"18":{"start":{"line":83,"column":24},"end":{"line":83,"column":30},"skip":true},"19":{"start":{"line":85,"column":24},"end":{"line":85,"column":49},"skip":true},"20":{"start":{"line":89,"column":12},"end":{"line":107,"column":13},"skip":true},"21":{"start":{"line":92,"column":16},"end":{"line":102,"column":17},"skip":true},"22":{"start":{"line":93,"column":20},"end":{"line":93,"column":86},"skip":true},"23":{"start":{"line":94,"column":20},"end":{"line":95,"column":45},"skip":true},"24":{"start":{"line":96,"column":20},"end":{"line":96,"column":42},"skip":true},"25":{"start":{"line":97,"column":20},"end":{"line":97,"column":48},"skip":true},"26":{"start":{"line":100,"column":20},"end":{"line":100,"column":85},"skip":true},"27":{"start":{"line":101,"column":20},"end":{"line":101,"column":96},"skip":true},"28":{"start":{"line":103,"column":16},"end":{"line":103,"column":22},"skip":true},"29":{"start":{"line":106,"column":16},"end":{"line":106,"column":22},"skip":true},"30":{"start":{"line":108,"column":12},"end":{"line":120,"column":13},"skip":true},"31":{"start":{"line":114,"column":16},"end":{"line":119,"column":17},"skip":true},"32":{"start":{"line":116,"column":20},"end":{"line":116,"column":78},"skip":true},"33":{"start":{"line":118,"column":20},"end":{"line":118,"column":47},"skip":true},"34":{"start":{"line":123,"column":8},"end":{"line":141,"column":11},"skip":true},"35":{"start":{"line":124,"column":12},"end":{"line":124,"column":54},"skip":true},"36":{"start":{"line":125,"column":12},"end":{"line":140,"column":14},"skip":true},"37":{"start":{"line":126,"column":16},"end":{"line":126,"column":28},"skip":true},"38":{"start":{"line":127,"column":16},"end":{"line":127,"column":69},"skip":true},"39":{"start":{"line":128,"column":16},"end":{"line":128,"column":75},"skip":true},"40":{"start":{"line":129,"column":16},"end":{"line":131,"column":17},"skip":true},"41":{"start":{"line":130,"column":20},"end":{"line":130,"column":27},"skip":true},"42":{"start":{"line":133,"column":16},"end":{"line":137,"column":36},"skip":true},"43":{"start":{"line":134,"column":20},"end":{"line":136,"column":55},"skip":true},"44":{"start":{"line":139,"column":16},"end":{"line":139,"column":57},"skip":true},"45":{"start":{"line":143,"column":8},"end":{"line":147,"column":11},"skip":true},"46":{"start":{"line":144,"column":12},"end":{"line":146,"column":15},"skip":true},"47":{"start":{"line":145,"column":16},"end":{"line":145,"column":70},"skip":true},"48":{"start":{"line":149,"column":8},"end":{"line":149,"column":31},"skip":true},"49":{"start":{"line":150,"column":8},"end":{"line":150,"column":14},"skip":true},"50":{"start":{"line":158,"column":8},"end":{"line":158,"column":31},"skip":true},"51":{"start":{"line":160,"column":8},"end":{"line":160,"column":33},"skip":true},"52":{"start":{"line":161,"column":8},"end":{"line":161,"column":37},"skip":true},"53":{"start":{"line":162,"column":8},"end":{"line":162,"column":35},"skip":true},"54":{"start":{"line":164,"column":8},"end":{"line":164,"column":50},"skip":true},"55":{"start":{"line":166,"column":8},"end":{"line":256,"column":2},"skip":true},"56":{"start":{"line":258,"column":8},"end":{"line":286,"column":9},"skip":true},"57":{"start":{"line":259,"column":12},"end":{"line":269,"column":14},"skip":true},"58":{"start":{"line":271,"column":12},"end":{"line":285,"column":19},"skip":true},"59":{"start":{"line":274,"column":20},"end":{"line":274,"column":35},"skip":true},"60":{"start":{"line":275,"column":20},"end":{"line":284,"column":21},"skip":true},"61":{"start":{"line":277,"column":24},"end":{"line":277,"column":64},"skip":true},"62":{"start":{"line":279,"column":24},"end":{"line":279,"column":40},"skip":true},"63":{"start":{"line":281,"column":24},"end":{"line":281,"column":40},"skip":true},"64":{"start":{"line":283,"column":24},"end":{"line":283,"column":39},"skip":true},"65":{"start":{"line":288,"column":8},"end":{"line":290,"column":9},"skip":true},"66":{"start":{"line":289,"column":12},"end":{"line":289,"column":18},"skip":true},"67":{"start":{"line":291,"column":8},"end":{"line":293,"column":54},"skip":true},"68":{"start":{"line":296,"column":8},"end":{"line":301,"column":37},"skip":true},"69":{"start":{"line":303,"column":8},"end":{"line":303,"column":82},"skip":true},"70":{"start":{"line":306,"column":8},"end":{"line":308,"column":9},"skip":true},"71":{"start":{"line":307,"column":12},"end":{"line":307,"column":82},"skip":true},"72":{"start":{"line":310,"column":8},"end":{"line":312,"column":9},"skip":true},"73":{"start":{"line":311,"column":12},"end":{"line":311,"column":18},"skip":true},"74":{"start":{"line":313,"column":8},"end":{"line":313,"column":54},"skip":true},"75":{"start":{"line":314,"column":8},"end":{"line":314,"column":69},"skip":true},"76":{"start":{"line":315,"column":8},"end":{"line":323,"column":36},"skip":true},"77":{"start":{"line":316,"column":12},"end":{"line":316,"column":61},"skip":true},"78":{"start":{"line":317,"column":12},"end":{"line":320,"column":13},"skip":true},"79":{"start":{"line":318,"column":16},"end":{"line":318,"column":75},"skip":true},"80":{"start":{"line":319,"column":16},"end":{"line":319,"column":23},"skip":true},"81":{"start":{"line":321,"column":12},"end":{"line":321,"column":38},"skip":true},"82":{"start":{"line":322,"column":12},"end":{"line":322,"column":27},"skip":true},"83":{"start":{"line":324,"column":8},"end":{"line":324,"column":14},"skip":true}},"branchMap":{"1":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":23},"end":{"line":39,"column":62}},{"start":{"line":40,"column":20},"end":{"line":40,"column":70}},{"start":{"line":41,"column":20},"end":{"line":41,"column":71}},{"start":{"line":42,"column":20},"end":{"line":42,"column":29}}]},"2":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":23},"end":{"line":44,"column":37}},{"start":{"line":45,"column":20},"end":{"line":45,"column":61}},{"start":{"line":46,"column":20},"end":{"line":46,"column":70}},{"start":{"line":47,"column":20},"end":{"line":47,"column":26}}]},"3":{"line":51,"type":"cond-expr","locations":[{"start":{"line":52,"column":14},"end":{"line":52,"column":20}},{"start":{"line":53,"column":14},"end":{"line":53,"column":20}}]},"4":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":16},"end":{"line":55,"column":44}},{"start":{"line":55,"column":49},"end":{"line":57,"column":43}}]},"5":{"line":55,"type":"cond-expr","locations":[{"start":{"line":56,"column":14},"end":{"line":56,"column":47}},{"start":{"line":57,"column":14},"end":{"line":57,"column":43}}]},"6":{"line":61,"type":"switch","locations":[{"start":{"line":68,"column":4},"end":{"line":150,"column":14},"skip":true},{"start":{"line":156,"column":4},"end":{"line":324,"column":14},"skip":true}]},"7":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true},{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true}]},"8":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":16},"end":{"line":70,"column":22},"skip":true},{"start":{"line":70,"column":27},"end":{"line":70,"column":32},"skip":true},{"start":{"line":71,"column":20},"end":{"line":71,"column":39},"skip":true},{"start":{"line":72,"column":20},"end":{"line":72,"column":49},"skip":true},{"start":{"line":73,"column":20},"end":{"line":73,"column":58},"skip":true},{"start":{"line":74,"column":20},"end":{"line":74,"column":69},"skip":true}]},"9":{"line":79,"type":"switch","locations":[{"start":{"line":80,"column":20},"end":{"line":80,"column":33},"skip":true},{"start":{"line":81,"column":20},"end":{"line":83,"column":30},"skip":true},{"start":{"line":84,"column":20},"end":{"line":85,"column":49},"skip":true}]},"10":{"line":89,"type":"switch","locations":[{"start":{"line":90,"column":12},"end":{"line":103,"column":22},"skip":true},{"start":{"line":105,"column":12},"end":{"line":106,"column":22},"skip":true}]},"11":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":20},"end":{"line":89,"column":25},"skip":true},{"start":{"line":89,"column":29},"end":{"line":89,"column":48},"skip":true},{"start":{"line":89,"column":52},"end":{"line":89,"column":74},"skip":true}]},"12":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true},{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true}]},"13":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true},{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true}]},"14":{"line":108,"type":"binary-expr","locations":[{"start":{"line":108,"column":16},"end":{"line":108,"column":61},"skip":true},{"start":{"line":108,"column":66},"end":{"line":108,"column":72},"skip":true},{"start":{"line":108,"column":77},"end":{"line":108,"column":82},"skip":true},{"start":{"line":109,"column":20},"end":{"line":109,"column":39},"skip":true},{"start":{"line":110,"column":20},"end":{"line":110,"column":49},"skip":true},{"start":{"line":111,"column":20},"end":{"line":111,"column":58},"skip":true},{"start":{"line":112,"column":20},"end":{"line":112,"column":68},"skip":true}]},"15":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true},{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true}]},"16":{"line":134,"type":"cond-expr","locations":[{"start":{"line":135,"column":26},"end":{"line":135,"column":29},"skip":true},{"start":{"line":136,"column":26},"end":{"line":136,"column":54},"skip":true}]},"17":{"line":164,"type":"binary-expr","locations":[{"start":{"line":164,"column":27},"end":{"line":164,"column":43},"skip":true},{"start":{"line":164,"column":47},"end":{"line":164,"column":49},"skip":true}]},"18":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true},{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true}]},"19":{"line":275,"type":"switch","locations":[{"start":{"line":276,"column":20},"end":{"line":277,"column":64},"skip":true},{"start":{"line":278,"column":20},"end":{"line":279,"column":40},"skip":true},{"start":{"line":280,"column":20},"end":{"line":281,"column":40},"skip":true},{"start":{"line":282,"column":20},"end":{"line":283,"column":39},"skip":true}]},"20":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true},{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true}]},"21":{"line":288,"type":"binary-expr","locations":[{"start":{"line":288,"column":12},"end":{"line":288,"column":40},"skip":true},{"start":{"line":288,"column":44},"end":{"line":288,"column":67},"skip":true}]},"22":{"line":292,"type":"binary-expr","locations":[{"start":{"line":292,"column":12},"end":{"line":292,"column":50},"skip":true},{"start":{"line":293,"column":12},"end":{"line":293,"column":53},"skip":true}]},"23":{"line":297,"type":"binary-expr","locations":[{"start":{"line":297,"column":12},"end":{"line":297,"column":61},"skip":true},{"start":{"line":298,"column":12},"end":{"line":301,"column":36},"skip":true}]},"24":{"line":303,"type":"binary-expr","locations":[{"start":{"line":303,"column":43},"end":{"line":303,"column":75},"skip":true},{"start":{"line":303,"column":79},"end":{"line":303,"column":81},"skip":true}]},"25":{"line":306,"type":"if","locations":[{"start":{"line":306,"column":8},"end":{"line":306,"column":8},"skip":true},{"start":{"line":306,"column":8},"end":{"line":306,"column":8},"skip":true}]},"26":{"line":310,"type":"if","locations":[{"start":{"line":310,"column":8},"end":{"line":310,"column":8},"skip":true},{"start":{"line":310,"column":8},"end":{"line":310,"column":8},"skip":true}]},"27":{"line":313,"type":"binary-expr","locations":[{"start":{"line":313,"column":27},"end":{"line":313,"column":43},"skip":true},{"start":{"line":313,"column":47},"end":{"line":313,"column":53},"skip":true}]},"28":{"line":317,"type":"if","locations":[{"start":{"line":317,"column":12},"end":{"line":317,"column":12},"skip":true},{"start":{"line":317,"column":12},"end":{"line":317,"column":12},"skip":true}]}},"code":["/*","example.js","","quickstart example","","instruction","    1. save this script as example.js","    2. run the shell command:","        $ npm install npmtest-egg && PORT=8081 node example.js","    3. play with the browser-demo on http://127.0.0.1:8081","*/","","","","/* istanbul instrument in package npmtest_egg */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - init-before","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || (local.modeJs === 'browser'","            ? local.global.utility2_npmtest_egg","            : global.utility2_moduleExports);","        // export local","        local.global.local = local;","    }());","    switch (local.modeJs) {","","","","    // init-after","    // run browser js-env code - init-after","    /* istanbul ignore next */","    case 'browser':","        local.testRunBrowser = function (event) {","            if (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('onreset'))) {","                // reset output","                Array.from(","                    document.querySelectorAll('body > .resettable')","                ).forEach(function (element) {","                    switch (element.tagName) {","                    case 'INPUT':","                    case 'TEXTAREA':","                        element.value = '';","                        break;","                    default:","                        element.textContent = '';","                    }","                });","            }","            switch (event && event.currentTarget && event.currentTarget.id) {","            case 'testRunButton1':","                // show tests","                if (document.querySelector('#testReportDiv1').style.display === 'none') {","                    document.querySelector('#testReportDiv1').style.display = 'block';","                    document.querySelector('#testRunButton1').textContent =","                        'hide internal test';","                    local.modeTest = true;","                    local.testRunDefault(local);","                // hide tests","                } else {","                    document.querySelector('#testReportDiv1').style.display = 'none';","                    document.querySelector('#testRunButton1').textContent = 'run internal test';","                }","                break;","            // custom-case","            default:","                break;","            }","            if (document.querySelector('#inputTextareaEval1') && (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('oneval')))) {","                // try to eval input-code","                try {","                    /*jslint evil: true*/","                    eval(document.querySelector('#inputTextareaEval1').value);","                } catch (errorCaught) {","                    console.error(errorCaught);","                }","            }","        };","        // log stderr and stdout to #outputTextareaStdout1","        ['error', 'log'].forEach(function (key) {","            console[key + '_original'] = console[key];","            console[key] = function () {","                var element;","                console[key + '_original'].apply(console, arguments);","                element = document.querySelector('#outputTextareaStdout1');","                if (!element) {","                    return;","                }","                // append text to #outputTextareaStdout1","                element.value += Array.from(arguments).map(function (arg) {","                    return typeof arg === 'string'","                        ? arg","                        : JSON.stringify(arg, null, 4);","                }).join(' ') + '\\n';","                // scroll textarea to bottom","                element.scrollTop = element.scrollHeight;","            };","        });","        // init event-handling","        ['change', 'click', 'keyup'].forEach(function (event) {","            Array.from(document.querySelectorAll('.on' + event)).forEach(function (element) {","                element.addEventListener(event, local.testRunBrowser);","            });","        });","        // run tests","        local.testRunBrowser();","        break;","","","","    // run node js-env code - init-after","    /* istanbul ignore next */","    case 'node':","        // export local","        module.exports = local;","        // require modules","        local.fs = require('fs');","        local.http = require('http');","        local.url = require('url');","        // init assets","        local.assetsDict = local.assetsDict || {};","        /* jslint-ignore-begin */","        local.assetsDict['/assets.index.template.html'] = '\\","<!doctype html>\\n\\","<html lang=\"en\">\\n\\","<head>\\n\\","<meta charset=\"UTF-8\">\\n\\","<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\","<title>{{env.npm_package_name}} (v{{env.npm_package_version}})</title>\\n\\","<style>\\n\\","/*csslint\\n\\","    box-sizing: false,\\n\\","    universal-selector: false\\n\\","*/\\n\\","* {\\n\\","    box-sizing: border-box;\\n\\","}\\n\\","body {\\n\\","    background: #dde;\\n\\","    font-family: Arial, Helvetica, sans-serif;\\n\\","    margin: 2rem;\\n\\","}\\n\\","body > * {\\n\\","    margin-bottom: 1rem;\\n\\","}\\n\\",".utility2FooterDiv {\\n\\","    margin-top: 20px;\\n\\","    text-align: center;\\n\\","}\\n\\","</style>\\n\\","<style>\\n\\","/*csslint\\n\\","*/\\n\\","textarea {\\n\\","    font-family: monospace;\\n\\","    height: 10rem;\\n\\","    width: 100%;\\n\\","}\\n\\","textarea[readonly] {\\n\\","    background: #ddd;\\n\\","}\\n\\","</style>\\n\\","</head>\\n\\","<body>\\n\\","<!-- utility2-comment\\n\\","<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 0.5s, width 1.5s; width: 25%;\"></div>\\n\\","utility2-comment -->\\n\\","<h1>\\n\\","<!-- utility2-comment\\n\\","    <a\\n\\","        {{#if env.npm_package_homepage}}\\n\\","        href=\"{{env.npm_package_homepage}}\"\\n\\","        {{/if env.npm_package_homepage}}\\n\\","        target=\"_blank\"\\n\\","    >\\n\\","utility2-comment -->\\n\\","        {{env.npm_package_name}} (v{{env.npm_package_version}})\\n\\","<!-- utility2-comment\\n\\","    </a>\\n\\","utility2-comment -->\\n\\","</h1>\\n\\","<h3>{{env.npm_package_description}}</h3>\\n\\","<!-- utility2-comment\\n\\","<h4><a download href=\"assets.app.js\">download standalone app</a></h4>\\n\\","<button class=\"onclick onreset\" id=\"testRunButton1\">run internal test</button><br>\\n\\","<div id=\"testReportDiv1\" style=\"display: none;\"></div>\\n\\","utility2-comment -->\\n\\","\\n\\","\\n\\","\\n\\","<label>stderr and stdout</label>\\n\\","<textarea class=\"resettable\" id=\"outputTextareaStdout1\" readonly></textarea>\\n\\","<!-- utility2-comment\\n\\","{{#if isRollup}}\\n\\","<script src=\"assets.app.js\"></script>\\n\\","{{#unless isRollup}}\\n\\","utility2-comment -->\\n\\","<script src=\"assets.utility2.rollup.js\"></script>\\n\\","<script src=\"jsonp.utility2._stateInit?callback=window.utility2._stateInit\"></script>\\n\\","<script src=\"assets.npmtest_egg.rollup.js\"></script>\\n\\","<script src=\"assets.example.js\"></script>\\n\\","<script src=\"assets.test.js\"></script>\\n\\","<!-- utility2-comment\\n\\","{{/if isRollup}}\\n\\","utility2-comment -->\\n\\","<div class=\"utility2FooterDiv\">\\n\\","    [ this app was created with\\n\\","    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\","    ]\\n\\","</div>\\n\\","</body>\\n\\","</html>\\n\\","';","        /* jslint-ignore-end */","        if (local.templateRender) {","            local.assetsDict['/'] = local.templateRender(","                local.assetsDict['/assets.index.template.html'],","                {","                    env: local.objectSetDefault(local.env, {","                        npm_package_description: 'the greatest app in the world!',","                        npm_package_name: 'my-app',","                        npm_package_nameAlias: 'my_app',","                        npm_package_version: '0.0.1'","                    })","                }","            );","        } else {","            local.assetsDict['/'] = local.assetsDict['/assets.index.template.html']","                .replace((/\\{\\{env\\.(\\w+?)\\}\\}/g), function (match0, match1) {","                    // jslint-hack","                    String(match0);","                    switch (match1) {","                    case 'npm_package_description':","                        return 'the greatest app in the world!';","                    case 'npm_package_name':","                        return 'my-app';","                    case 'npm_package_nameAlias':","                        return 'my_app';","                    case 'npm_package_version':","                        return '0.0.1';","                    }","                });","        }","        // run the cli","        if (local.global.utility2_rollup || module !== require.main) {","            break;","        }","        local.assetsDict['/assets.example.js'] =","            local.assetsDict['/assets.example.js'] ||","            local.fs.readFileSync(__filename, 'utf8');","        // bug-workaround - long $npm_package_buildCustomOrg","        /* jslint-ignore-begin */","        local.assetsDict['/assets.npmtest_egg.rollup.js'] =","            local.assetsDict['/assets.npmtest_egg.rollup.js'] ||","            local.fs.readFileSync(","                local.npmtest_egg.__dirname + '/lib.npmtest_egg.js',","                'utf8'","            ).replace((/^#!/), '//');","        /* jslint-ignore-end */","        local.assetsDict['/favicon.ico'] = local.assetsDict['/favicon.ico'] || '';","        // if $npm_config_timeout_exit exists,","        // then exit this process after $npm_config_timeout_exit ms","        if (Number(process.env.npm_config_timeout_exit)) {","            setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));","        }","        // start server","        if (local.global.utility2_serverHttp1) {","            break;","        }","        process.env.PORT = process.env.PORT || '8081';","        console.error('server starting on port ' + process.env.PORT);","        local.http.createServer(function (request, response) {","            request.urlParsed = local.url.parse(request.url);","            if (local.assetsDict[request.urlParsed.pathname] !== undefined) {","                response.end(local.assetsDict[request.urlParsed.pathname]);","                return;","            }","            response.statusCode = 404;","            response.end();","        }).listen(process.env.PORT);","        break;","    }","}());",""],"l":{"26":2,"28":2,"33":2,"35":2,"37":2,"38":2,"39":2,"44":1,"51":2,"55":2,"59":2,"61":2,"69":1,"70":2,"76":2,"79":2,"82":2,"83":2,"85":1,"89":2,"92":1,"93":1,"94":1,"96":1,"97":1,"100":1,"101":1,"103":1,"106":1,"108":2,"114":1,"116":1,"118":1,"123":1,"124":2,"125":2,"126":3,"127":3,"128":3,"129":3,"130":1,"133":3,"134":3,"139":3,"143":1,"144":3,"145":1,"149":1,"150":1,"158":1,"160":1,"161":1,"162":1,"164":1,"166":1,"258":1,"259":1,"271":1,"274":6,"275":6,"277":1,"279":2,"281":1,"283":2,"288":1,"289":1,"291":1,"296":1,"303":1,"306":1,"307":1,"310":1,"311":1,"313":1,"314":1,"315":1,"316":1,"317":1,"318":1,"319":1,"321":1,"322":1,"324":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":11,"column":0},"end":{"line":11,"column":59}},"2":{"start":{"line":17,"column":0},"end":{"line":17,"column":51}},"3":{"start":{"line":23,"column":0},"end":{"line":23,"column":39}},"4":{"start":{"line":29,"column":0},"end":{"line":29,"column":66}},"5":{"start":{"line":35,"column":0},"end":{"line":35,"column":70}},"6":{"start":{"line":41,"column":0},"end":{"line":41,"column":58}},"7":{"start":{"line":47,"column":0},"end":{"line":47,"column":55}}},"branchMap":{},"code":["'use strict';","","/**"," * @namespace Egg"," */","","/**"," * Start egg application with cluster mode"," * @since 1.0.0"," */","exports.startCluster = require('egg-cluster').startCluster;","","/**"," * @member {Application} Egg#Application"," * @since 1.0.0"," */","exports.Application = require('./lib/application');","","/**"," * @member {Agent} Egg#Agent"," * @since 1.0.0"," */","exports.Agent = require('./lib/agent');","","/**"," * @member {AppWorkerLoader} Egg#AppWorkerLoader"," * @since 1.0.0"," */","exports.AppWorkerLoader = require('./lib/loader').AppWorkerLoader;","","/**"," * @member {AgentWorkerLoader} Egg#AgentWorkerLoader"," * @since 1.0.0"," */","exports.AgentWorkerLoader = require('./lib/loader').AgentWorkerLoader;","","/**"," * @member {Controller} Egg#Controller"," * @since 1.1.0"," */","exports.Controller = require('egg-core').BaseContextClass;","","/**"," * @member {Service} Egg#Service"," * @since 1.1.0"," */","exports.Service = require('egg-core').BaseContextClass;",""],"l":{"11":1,"17":1,"23":1,"29":1,"35":1,"41":1,"47":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cluster/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cluster/index.js","s":{"1":1,"2":1,"3":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":19,"loc":{"start":{"line":19,"column":23},"end":{"line":19,"column":51}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":39}},"2":{"start":{"line":19,"column":0},"end":{"line":21,"column":2}},"3":{"start":{"line":20,"column":2},"end":{"line":20,"column":38}}},"branchMap":{},"code":["'use strict';","","const Master = require('./lib/master');","","/**"," * cluster start flow:"," *"," * [startCluster] -> master -> agent_worker -> new [Agent]       -> agentWorkerLoader"," *                         `-> app_worker   -> new [Application] -> appWorkerLoader"," *"," */","","/**"," * start egg app"," * @method Egg#startCluster"," * @param {Object} options {@link Master}"," * @param {Function} callback start success callback"," */","exports.startCluster = function(options, callback) {","  new Master(options).ready(callback);","};",""],"l":{"3":1,"19":1,"20":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cluster/lib/master.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cluster/lib/master.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":1,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":1,"170":1,"171":0,"172":0,"173":0,"174":0,"175":0,"176":1,"177":0,"178":0,"179":0,"180":0,"181":1,"182":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},"fnMap":{"1":{"name":"(anonymous_1)","line":34,"loc":{"start":{"line":34,"column":13},"end":{"line":34,"column":23}}},"2":{"name":"(anonymous_2)","line":95,"loc":{"start":{"line":95,"column":25},"end":{"line":95,"column":30}}},"3":{"name":"(anonymous_3)","line":106,"loc":{"start":{"line":106,"column":14},"end":{"line":106,"column":19}}},"4":{"name":"(anonymous_4)","line":121,"loc":{"start":{"line":121,"column":17},"end":{"line":121,"column":20}}},"5":{"name":"(anonymous_5)","line":157,"loc":{"start":{"line":157,"column":16},"end":{"line":157,"column":19}}},"6":{"name":"(anonymous_6)","line":213,"loc":{"start":{"line":213,"column":17},"end":{"line":213,"column":20}}},"7":{"name":"(anonymous_7)","line":228,"loc":{"start":{"line":228,"column":13},"end":{"line":228,"column":20}}},"8":{"name":"(anonymous_8)","line":255,"loc":{"start":{"line":255,"column":14},"end":{"line":255,"column":17}}},"9":{"name":"(anonymous_9)","line":269,"loc":{"start":{"line":269,"column":11},"end":{"line":269,"column":18}}},"10":{"name":"(anonymous_10)","line":316,"loc":{"start":{"line":316,"column":12},"end":{"line":316,"column":19}}},"11":{"name":"(anonymous_11)","line":353,"loc":{"start":{"line":353,"column":8},"end":{"line":353,"column":11}}},"12":{"name":"receiveSig","line":371,"loc":{"start":{"line":371,"column":4},"end":{"line":371,"column":29}}},"13":{"name":"(anonymous_13)","line":380,"loc":{"start":{"line":380,"column":10},"end":{"line":380,"column":13}}},"14":{"name":"getListeningWorker","line":392,"loc":{"start":{"line":392,"column":0},"end":{"line":392,"column":37}}},"15":{"name":"isProduction","line":402,"loc":{"start":{"line":402,"column":0},"end":{"line":402,"column":24}}},"16":{"name":"isDebug","line":410,"loc":{"start":{"line":410,"column":0},"end":{"line":410,"column":19}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":39}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":46}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":31}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":35}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":46}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":42}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":61}},"11":{"start":{"line":14,"column":0},"end":{"line":14,"column":48}},"12":{"start":{"line":15,"column":0},"end":{"line":15,"column":47}},"13":{"start":{"line":17,"column":0},"end":{"line":17,"column":64}},"14":{"start":{"line":18,"column":0},"end":{"line":18,"column":60}},"15":{"start":{"line":35,"column":4},"end":{"line":35,"column":12}},"16":{"start":{"line":36,"column":4},"end":{"line":36,"column":41}},"17":{"start":{"line":37,"column":4},"end":{"line":37,"column":41}},"18":{"start":{"line":39,"column":4},"end":{"line":39,"column":22}},"19":{"start":{"line":41,"column":4},"end":{"line":41,"column":39}},"20":{"start":{"line":42,"column":4},"end":{"line":42,"column":29}},"21":{"start":{"line":45,"column":4},"end":{"line":45,"column":27}},"22":{"start":{"line":46,"column":4},"end":{"line":46,"column":55}},"23":{"start":{"line":49,"column":4},"end":{"line":49,"column":49}},"24":{"start":{"line":50,"column":4},"end":{"line":50,"column":75}},"25":{"start":{"line":52,"column":4},"end":{"line":52,"column":102}},"26":{"start":{"line":53,"column":4},"end":{"line":53,"column":86}},"27":{"start":{"line":54,"column":4},"end":{"line":54,"column":70}},"28":{"start":{"line":55,"column":4},"end":{"line":55,"column":192}},"29":{"start":{"line":57,"column":4},"end":{"line":57,"column":33}},"30":{"start":{"line":59,"column":4},"end":{"line":69,"column":7}},"31":{"start":{"line":60,"column":6},"end":{"line":60,"column":28}},"32":{"start":{"line":61,"column":6},"end":{"line":61,"column":72}},"33":{"start":{"line":62,"column":6},"end":{"line":63,"column":120}},"34":{"start":{"line":65,"column":6},"end":{"line":65,"column":33}},"35":{"start":{"line":66,"column":6},"end":{"line":66,"column":52}},"36":{"start":{"line":67,"column":6},"end":{"line":67,"column":69}},"37":{"start":{"line":68,"column":6},"end":{"line":68,"column":71}},"38":{"start":{"line":71,"column":4},"end":{"line":71,"column":55}},"39":{"start":{"line":72,"column":4},"end":{"line":72,"column":57}},"40":{"start":{"line":73,"column":4},"end":{"line":73,"column":51}},"41":{"start":{"line":74,"column":4},"end":{"line":74,"column":53}},"42":{"start":{"line":75,"column":4},"end":{"line":75,"column":55}},"43":{"start":{"line":78,"column":4},"end":{"line":78,"column":61}},"44":{"start":{"line":80,"column":4},"end":{"line":80,"column":18}},"45":{"start":{"line":82,"column":4},"end":{"line":92,"column":7}},"46":{"start":{"line":84,"column":6},"end":{"line":89,"column":7}},"47":{"start":{"line":85,"column":8},"end":{"line":85,"column":46},"skip":true},"48":{"start":{"line":86,"column":8},"end":{"line":86,"column":73},"skip":true},"49":{"start":{"line":87,"column":8},"end":{"line":87,"column":31},"skip":true},"50":{"start":{"line":88,"column":8},"end":{"line":88,"column":15},"skip":true},"51":{"start":{"line":90,"column":6},"end":{"line":90,"column":38}},"52":{"start":{"line":91,"column":6},"end":{"line":91,"column":29}},"53":{"start":{"line":97,"column":4},"end":{"line":103,"column":37}},"54":{"start":{"line":101,"column":6},"end":{"line":101,"column":65}},"55":{"start":{"line":102,"column":6},"end":{"line":102,"column":59}},"56":{"start":{"line":107,"column":4},"end":{"line":107,"column":47}},"57":{"start":{"line":108,"column":4},"end":{"line":108,"column":47}},"58":{"start":{"line":110,"column":4},"end":{"line":110,"column":15}},"59":{"start":{"line":111,"column":4},"end":{"line":115,"column":5}},"60":{"start":{"line":112,"column":6},"end":{"line":114,"column":7}},"61":{"start":{"line":113,"column":8},"end":{"line":113,"column":19}},"62":{"start":{"line":116,"column":4},"end":{"line":116,"column":18}},"63":{"start":{"line":117,"column":4},"end":{"line":117,"column":38}},"64":{"start":{"line":118,"column":4},"end":{"line":118,"column":33}},"65":{"start":{"line":122,"column":4},"end":{"line":122,"column":37}},"66":{"start":{"line":124,"column":4},"end":{"line":124,"column":50}},"67":{"start":{"line":131,"column":4},"end":{"line":131,"column":79}},"68":{"start":{"line":132,"column":4},"end":{"line":132,"column":89}},"69":{"start":{"line":133,"column":4},"end":{"line":133,"column":86}},"70":{"start":{"line":136,"column":4},"end":{"line":140,"column":7}},"71":{"start":{"line":137,"column":6},"end":{"line":137,"column":68}},"72":{"start":{"line":137,"column":35},"end":{"line":137,"column":68}},"73":{"start":{"line":138,"column":6},"end":{"line":138,"column":25}},"74":{"start":{"line":139,"column":6},"end":{"line":139,"column":31}},"75":{"start":{"line":141,"column":4},"end":{"line":144,"column":7}},"76":{"start":{"line":142,"column":6},"end":{"line":142,"column":36}},"77":{"start":{"line":143,"column":6},"end":{"line":143,"column":29}},"78":{"start":{"line":146,"column":4},"end":{"line":153,"column":7}},"79":{"start":{"line":147,"column":6},"end":{"line":152,"column":9}},"80":{"start":{"line":158,"column":4},"end":{"line":158,"column":35}},"81":{"start":{"line":159,"column":4},"end":{"line":159,"column":39}},"82":{"start":{"line":160,"column":4},"end":{"line":160,"column":31}},"83":{"start":{"line":162,"column":4},"end":{"line":162,"column":29}},"84":{"start":{"line":164,"column":4},"end":{"line":164,"column":50}},"85":{"start":{"line":165,"column":4},"end":{"line":165,"column":48}},"86":{"start":{"line":166,"column":4},"end":{"line":173,"column":7}},"87":{"start":{"line":175,"column":4},"end":{"line":184,"column":7}},"88":{"start":{"line":176,"column":6},"end":{"line":176,"column":51}},"89":{"start":{"line":177,"column":6},"end":{"line":181,"column":9}},"90":{"start":{"line":178,"column":8},"end":{"line":178,"column":70}},"91":{"start":{"line":178,"column":37},"end":{"line":178,"column":70}},"92":{"start":{"line":179,"column":8},"end":{"line":179,"column":25}},"93":{"start":{"line":180,"column":8},"end":{"line":180,"column":33}},"94":{"start":{"line":182,"column":6},"end":{"line":183,"column":83}},"95":{"start":{"line":185,"column":4},"end":{"line":188,"column":7}},"96":{"start":{"line":186,"column":6},"end":{"line":187,"column":99}},"97":{"start":{"line":189,"column":4},"end":{"line":196,"column":7}},"98":{"start":{"line":190,"column":6},"end":{"line":195,"column":9}},"99":{"start":{"line":197,"column":4},"end":{"line":204,"column":7}},"100":{"start":{"line":198,"column":6},"end":{"line":203,"column":9}},"101":{"start":{"line":214,"column":4},"end":{"line":218,"column":5}},"102":{"start":{"line":215,"column":6},"end":{"line":215,"column":53}},"103":{"start":{"line":216,"column":6},"end":{"line":216,"column":44}},"104":{"start":{"line":217,"column":6},"end":{"line":217,"column":39}},"105":{"start":{"line":229,"column":4},"end":{"line":229,"column":69}},"106":{"start":{"line":231,"column":4},"end":{"line":232,"column":53}},"107":{"start":{"line":233,"column":4},"end":{"line":233,"column":38}},"108":{"start":{"line":234,"column":4},"end":{"line":234,"column":27}},"109":{"start":{"line":237,"column":4},"end":{"line":237,"column":42}},"110":{"start":{"line":238,"column":4},"end":{"line":238,"column":28}},"111":{"start":{"line":240,"column":4},"end":{"line":252,"column":5}},"112":{"start":{"line":241,"column":6},"end":{"line":244,"column":15}},"113":{"start":{"line":242,"column":8},"end":{"line":242,"column":61}},"114":{"start":{"line":243,"column":8},"end":{"line":243,"column":31}},"115":{"start":{"line":245,"column":6},"end":{"line":248,"column":9}},"116":{"start":{"line":250,"column":6},"end":{"line":250,"column":63}},"117":{"start":{"line":251,"column":6},"end":{"line":251,"column":22}},"118":{"start":{"line":256,"column":4},"end":{"line":256,"column":91}},"119":{"start":{"line":257,"column":4},"end":{"line":257,"column":62}},"120":{"start":{"line":258,"column":4},"end":{"line":259,"column":40}},"121":{"start":{"line":270,"column":4},"end":{"line":270,"column":52}},"122":{"start":{"line":272,"column":4},"end":{"line":283,"column":5}},"123":{"start":{"line":273,"column":6},"end":{"line":273,"column":31}},"124":{"start":{"line":274,"column":6},"end":{"line":279,"column":8}},"125":{"start":{"line":280,"column":6},"end":{"line":280,"column":37}},"126":{"start":{"line":281,"column":6},"end":{"line":281,"column":38}},"127":{"start":{"line":282,"column":6},"end":{"line":282,"column":29}},"128":{"start":{"line":286,"column":4},"end":{"line":286,"column":32}},"129":{"start":{"line":287,"column":4},"end":{"line":287,"column":40}},"130":{"start":{"line":289,"column":4},"end":{"line":289,"column":101}},"131":{"start":{"line":291,"column":4},"end":{"line":307,"column":5}},"132":{"start":{"line":293,"column":6},"end":{"line":296,"column":9}},"133":{"start":{"line":298,"column":6},"end":{"line":302,"column":7}},"134":{"start":{"line":300,"column":8},"end":{"line":300,"column":65}},"135":{"start":{"line":301,"column":8},"end":{"line":301,"column":24}},"136":{"start":{"line":305,"column":6},"end":{"line":305,"column":64}},"137":{"start":{"line":306,"column":6},"end":{"line":306,"column":22}},"138":{"start":{"line":317,"column":4},"end":{"line":317,"column":52}},"139":{"start":{"line":318,"column":4},"end":{"line":318,"column":33}},"140":{"start":{"line":321,"column":4},"end":{"line":323,"column":5}},"141":{"start":{"line":322,"column":6},"end":{"line":322,"column":13}},"142":{"start":{"line":326,"column":4},"end":{"line":326,"column":101}},"143":{"start":{"line":328,"column":4},"end":{"line":328,"column":29}},"144":{"start":{"line":330,"column":4},"end":{"line":330,"column":98}},"145":{"start":{"line":331,"column":4},"end":{"line":332,"column":87}},"146":{"start":{"line":334,"column":4},"end":{"line":336,"column":5}},"147":{"start":{"line":335,"column":6},"end":{"line":335,"column":13}},"148":{"start":{"line":338,"column":4},"end":{"line":338,"column":38}},"149":{"start":{"line":340,"column":4},"end":{"line":347,"column":5}},"150":{"start":{"line":341,"column":6},"end":{"line":344,"column":9}},"151":{"start":{"line":342,"column":8},"end":{"line":342,"column":40}},"152":{"start":{"line":342,"column":17},"end":{"line":342,"column":40}},"153":{"start":{"line":343,"column":8},"end":{"line":343,"column":25}},"154":{"start":{"line":346,"column":6},"end":{"line":346,"column":23}},"155":{"start":{"line":355,"column":4},"end":{"line":360,"column":7}},"156":{"start":{"line":358,"column":6},"end":{"line":358,"column":29}},"157":{"start":{"line":359,"column":6},"end":{"line":359,"column":60}},"158":{"start":{"line":365,"column":4},"end":{"line":365,"column":60}},"159":{"start":{"line":367,"column":4},"end":{"line":367,"column":62}},"160":{"start":{"line":369,"column":4},"end":{"line":369,"column":62}},"161":{"start":{"line":371,"column":4},"end":{"line":374,"column":5}},"162":{"start":{"line":372,"column":6},"end":{"line":372,"column":77}},"163":{"start":{"line":373,"column":6},"end":{"line":373,"column":22}},"164":{"start":{"line":381,"column":4},"end":{"line":381,"column":51}},"165":{"start":{"line":382,"column":4},"end":{"line":385,"column":5}},"166":{"start":{"line":383,"column":6},"end":{"line":383,"column":41}},"167":{"start":{"line":384,"column":6},"end":{"line":384,"column":32}},"168":{"start":{"line":386,"column":4},"end":{"line":386,"column":52}},"169":{"start":{"line":390,"column":0},"end":{"line":390,"column":24}},"170":{"start":{"line":392,"column":0},"end":{"line":400,"column":1}},"171":{"start":{"line":393,"column":2},"end":{"line":393,"column":18}},"172":{"start":{"line":394,"column":2},"end":{"line":398,"column":3}},"173":{"start":{"line":395,"column":4},"end":{"line":397,"column":5}},"174":{"start":{"line":396,"column":6},"end":{"line":396,"column":20}},"175":{"start":{"line":399,"column":2},"end":{"line":399,"column":14}},"176":{"start":{"line":402,"column":0},"end":{"line":408,"column":1}},"177":{"start":{"line":403,"column":2},"end":{"line":403,"column":47}},"178":{"start":{"line":404,"column":2},"end":{"line":406,"column":3}},"179":{"start":{"line":405,"column":4},"end":{"line":405,"column":61}},"180":{"start":{"line":407,"column":2},"end":{"line":407,"column":47}},"181":{"start":{"line":410,"column":0},"end":{"line":412,"column":1}},"182":{"start":{"line":411,"column":2},"end":{"line":411,"column":86}}},"branchMap":{"1":{"line":61,"type":"cond-expr","locations":[{"start":{"line":61,"column":46},"end":{"line":61,"column":66}},{"start":{"line":61,"column":69},"end":{"line":61,"column":71}}]},"2":{"line":63,"type":"cond-expr","locations":[{"start":{"line":63,"column":48},"end":{"line":63,"column":55}},{"start":{"line":63,"column":58},"end":{"line":63,"column":64}}]},"3":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":6},"end":{"line":84,"column":6},"skip":true},{"start":{"line":84,"column":6},"end":{"line":84,"column":6}}]},"4":{"line":112,"type":"if","locations":[{"start":{"line":112,"column":6},"end":{"line":112,"column":6}},{"start":{"line":112,"column":6},"end":{"line":112,"column":6}}]},"5":{"line":137,"type":"if","locations":[{"start":{"line":137,"column":6},"end":{"line":137,"column":6}},{"start":{"line":137,"column":6},"end":{"line":137,"column":6}}]},"6":{"line":178,"type":"if","locations":[{"start":{"line":178,"column":8},"end":{"line":178,"column":8}},{"start":{"line":178,"column":8},"end":{"line":178,"column":8}}]},"7":{"line":214,"type":"if","locations":[{"start":{"line":214,"column":4},"end":{"line":214,"column":4}},{"start":{"line":214,"column":4},"end":{"line":214,"column":4}}]},"8":{"line":240,"type":"if","locations":[{"start":{"line":240,"column":4},"end":{"line":240,"column":4}},{"start":{"line":240,"column":4},"end":{"line":240,"column":4}}]},"9":{"line":272,"type":"if","locations":[{"start":{"line":272,"column":4},"end":{"line":272,"column":4}},{"start":{"line":272,"column":4},"end":{"line":272,"column":4}}]},"10":{"line":291,"type":"if","locations":[{"start":{"line":291,"column":4},"end":{"line":291,"column":4}},{"start":{"line":291,"column":4},"end":{"line":291,"column":4}}]},"11":{"line":298,"type":"if","locations":[{"start":{"line":298,"column":6},"end":{"line":298,"column":6}},{"start":{"line":298,"column":6},"end":{"line":298,"column":6}}]},"12":{"line":298,"type":"binary-expr","locations":[{"start":{"line":298,"column":10},"end":{"line":298,"column":22}},{"start":{"line":298,"column":26},"end":{"line":298,"column":45}}]},"13":{"line":321,"type":"if","locations":[{"start":{"line":321,"column":4},"end":{"line":321,"column":4}},{"start":{"line":321,"column":4},"end":{"line":321,"column":4}}]},"14":{"line":321,"type":"binary-expr","locations":[{"start":{"line":321,"column":8},"end":{"line":321,"column":28}},{"start":{"line":321,"column":33},"end":{"line":321,"column":83}}]},"15":{"line":330,"type":"cond-expr","locations":[{"start":{"line":330,"column":48},"end":{"line":330,"column":49}},{"start":{"line":330,"column":52},"end":{"line":330,"column":97}}]},"16":{"line":334,"type":"if","locations":[{"start":{"line":334,"column":4},"end":{"line":334,"column":4}},{"start":{"line":334,"column":4},"end":{"line":334,"column":4}}]},"17":{"line":334,"type":"binary-expr","locations":[{"start":{"line":334,"column":8},"end":{"line":334,"column":34}},{"start":{"line":334,"column":38},"end":{"line":334,"column":83}}]},"18":{"line":340,"type":"if","locations":[{"start":{"line":340,"column":4},"end":{"line":340,"column":4}},{"start":{"line":340,"column":4},"end":{"line":340,"column":4}}]},"19":{"line":342,"type":"if","locations":[{"start":{"line":342,"column":8},"end":{"line":342,"column":8}},{"start":{"line":342,"column":8},"end":{"line":342,"column":8}}]},"20":{"line":395,"type":"if","locations":[{"start":{"line":395,"column":4},"end":{"line":395,"column":4}},{"start":{"line":395,"column":4},"end":{"line":395,"column":4}}]},"21":{"line":404,"type":"if","locations":[{"start":{"line":404,"column":2},"end":{"line":404,"column":2}},{"start":{"line":404,"column":2},"end":{"line":404,"column":2}}]},"22":{"line":405,"type":"binary-expr","locations":[{"start":{"line":405,"column":11},"end":{"line":405,"column":32}},{"start":{"line":405,"column":36},"end":{"line":405,"column":60}}]},"23":{"line":411,"type":"binary-expr","locations":[{"start":{"line":411,"column":9},"end":{"line":411,"column":51}},{"start":{"line":411,"column":55},"end":{"line":411,"column":85}}]}},"code":["'use strict';","","const util = require('util');","const path = require('path');","const cluster = require('cluster');","const EventEmitter = require('events');","const childprocess = require('child_process');","const cfork = require('cfork');","const ready = require('get-ready');","const debug = require('debug')('egg-cluster');","const detectPort = require('detect-port');","const ConsoleLogger = require('egg-logger').EggConsoleLogger;","","const parseOptions = require('./utils/options');","const Messenger = require('./utils/messenger');","","const agentWorkerFile = path.join(__dirname, 'agent_worker.js');","const appWorkerFile = path.join(__dirname, 'app_worker.js');","","class Master extends EventEmitter {","","  /**","   * @constructor","   * @param {Object} options","   *  - {String} [framework] - specify framework that can be absolute path or npm package","   *  - {String} [baseDir] directory of application, default to `process.cwd()`","   *  - {Object} [plugins] - customized plugins, for unittest","   *  - {Number} [workers] numbers of app workers, default to `os.cpus().length`","   *  - {Number} [port] listening port, default to 7001(http) or 8443(https)","   *  - {Boolean} [https] https or not","   *  - {String} [key] ssl key","   *  - {String} [cert] ssl cert","   */","  constructor(options) {","    super();","    this.options = parseOptions(options);","    this.messenger = new Messenger(this);","","    ready.mixin(this);","","    this.isProduction = isProduction();","    this.isDebug = isDebug();","","    // app started or not","    this.isStarted = false;","    this.logger = new ConsoleLogger({ level: 'INFO' });","","    // get the real framework info","    const frameworkPath = this.options.framework;","    const frameworkPkg = require(path.join(frameworkPath, 'package.json'));","","    this.logger.info(`[master] =================== ${frameworkPkg.name} start =====================`);","    this.logger.info(`[master] ${frameworkPkg.name} version ${frameworkPkg.version}`);","    this.logger.info('[master] start with options: %j', this.options);","    this.logger.info(`[master] start with env: isProduction: ${this.isProduction}, isDebug: ${this.isDebug}, EGG_SERVER_ENV: ${process.env.EGG_SERVER_ENV}, NODE_ENV: ${process.env.NODE_ENV}`);","","    const startTime = Date.now();","","    this.ready(() => {","      this.isStarted = true;","      const stickyMsg = this.options.sticky ? ' with STICKY MODE!' : '';","      this.logger.info('[master] %s started on %s://127.0.0.1:%s (%sms)%s',","        frameworkPkg.name, this.options.https ? 'https' : 'http', this.options.port, Date.now() - startTime, stickyMsg);","","      const action = 'egg-ready';","      this.messenger.send({ action, to: 'parent' });","      this.messenger.send({ action, to: 'app', data: this.options });","      this.messenger.send({ action, to: 'agent', data: this.options });","    });","","    this.on('agent-exit', this.onAgentExit.bind(this));","    this.on('agent-start', this.onAgentStart.bind(this));","    this.on('app-exit', this.onAppExit.bind(this));","    this.on('app-start', this.onAppStart.bind(this));","    this.on('reload-worker', this.onReload.bind(this));","","    // fork app workers after agent started","    this.once('agent-start', this.forkAppWorkers.bind(this));","","    this.onExit();","","    detectPort((err, port) => {","      /* istanbul ignore if */","      if (err) {","        err.name = 'ClusterPortConflictError';","        err.message = '[master] try get free port error, ' + err.message;","        this.logger.error(err);","        return;","      }","      this.options.clusterPort = port;","      this.forkAgentWorker();","    });","  }","","  startMasterSocketServer(cb) {","    // Create the outside facing server listening on our port.","    require('net').createServer({ pauseOnConnect: true }, connection => {","      // We received a connection and need to pass it to the appropriate","      // worker. Get the worker for this connection's source IP and pass","      // it the connection.","      const worker = this.stickyWorker(connection.remoteAddress);","      worker.send('sticky-session:connection', connection);","    }).listen(this.options.port, cb);","  }","","  stickyWorker(ip) {","    const workerNumbers = this.options.workers;","    const ws = Array.from(this.workers.keys());","","    let s = '';","    for (let i = 0; i < ip.length; i++) {","      if (!isNaN(ip[i])) {","        s += ip[i];","      }","    }","    s = Number(s);","    const pid = ws[s % workerNumbers];","    return this.workers.get(pid);","  }","","  forkAgentWorker() {","    this.agentStartTime = Date.now();","","    const args = [ JSON.stringify(this.options) ];","    // debug port:","    // agent_worker: 5856","    // master: 5857","    // app_worker0: 5858","    // app_worker1: 5859","    // ...","    const opt = { execArgv: process.execArgv.concat([ '--debug-port=5856' ]) };","    const agentWorker = this.agentWorker = childprocess.fork(agentWorkerFile, args, opt);","    this.logger.info('[master] Agent Worker:%s start with %j', agentWorker.pid, args);","","    // forwarding agent' message to messenger","    agentWorker.on('message', msg => {","      if (typeof msg === 'string') msg = { action: msg, data: msg };","      msg.from = 'agent';","      this.messenger.send(msg);","    });","    agentWorker.on('error', err => {","      err.name = 'AgentWorkerError';","      this.logger.error(err);","    });","    // agent exit message","    agentWorker.once('exit', (code, signal) => {","      this.messenger.send({","        action: 'agent-exit',","        data: { code, signal },","        to: 'master',","        from: 'agent',","      });","    });","  }","","","  forkAppWorkers() {","    this.appStartTime = Date.now();","    this.isAllAppWorkerStarted = false;","    this.startSuccessCount = 0;","","    this.workers = new Map();","","    const args = [ JSON.stringify(this.options) ];","    debug('Start appWorker with args %j', args);","    cfork({","      exec: appWorkerFile,","      args,","      silent: false,","      count: this.options.workers,","      // don't refork in local env","      refork: this.isProduction,","    });","","    cluster.on('fork', worker => {","      this.workers.set(worker.process.pid, worker);","      worker.on('message', msg => {","        if (typeof msg === 'string') msg = { action: msg, data: msg };","        msg.from = 'app';","        this.messenger.send(msg);","      });","      this.logger.info('[master] App Worker#%s:%s start, state: %s, current workers: %j',","        worker.id, worker.process.pid, worker.state, Object.keys(cluster.workers));","    });","    cluster.on('disconnect', worker => {","      this.logger.info('[master] App Worker#%s:%s disconnect, suicide: %s, state: %s, current workers: %j',","        worker.id, worker.process.pid, worker.suicide, worker.state, Object.keys(cluster.workers));","    });","    cluster.on('exit', (worker, code, signal) => {","      this.messenger.send({","        action: 'app-exit',","        data: { workerPid: worker.process.pid, code, signal },","        to: 'master',","        from: 'app',","      });","    });","    cluster.on('listening', (worker, address) => {","      this.messenger.send({","        action: 'app-start',","        data: { workerPid: worker.process.pid, address },","        to: 'master',","        from: 'app',","      });","    });","  }","","  /**","   * close agent worker, App Worker will closed by cluster","   *","   * https://www.exratione.com/2013/05/die-child-process-die/","   * make sure Agent Worker exit before master exit","   */","  killAgentWorker() {","    if (this.agentWorker) {","      debug('kill agent worker with signal SIGTERM');","      this.agentWorker.removeAllListeners();","      this.agentWorker.kill('SIGTERM');","    }","  }","","  /**","   * Agent Worker exit handler","   * Will exit during startup, and refork during running.","   * @param {Object} data","   *  - {Number} code   exit code","   *  - {String} signal received signal","   */","  onAgentExit(data) {","    this.messenger.send({ action: 'egg-pids', to: 'app', data: [] });","","    const err = new Error(util.format('[master] Agent Worker %s died (code: %s, signal: %s)',","      this.agentWorker.pid, data.code, data.signal));","    err.name = 'AgentWorkerDiedError';","    this.logger.error(err);","","    // remove all listeners to avoid memory leak","    this.agentWorker.removeAllListeners();","    this.agentWorker = null;","","    if (this.isStarted) {","      setTimeout(() => {","        this.logger.info('[master] Agent Worker restarting');","        this.forkAgentWorker();","      }, 1000);","      this.messenger.send({","        action: 'agent-worker-died',","        to: 'parent',","      });","    } else {","      this.logger.error('[master] agent start fail, exit now');","      process.exit(1);","    }","  }","","  onAgentStart() {","    this.messenger.send({ action: 'egg-pids', to: 'app', data: [ this.agentWorker.pid ] });","    this.messenger.send({ action: 'agent-start', to: 'app' });","    this.logger.info('[master] Agent Worker started (%sms)',","      Date.now() - this.agentStartTime);","  }","","  /**","   * App Worker exit handler","   * @param {Object} data","   *  - {String} workerPid - worker id","   *  - {Number} code - exit code","   *  - {String} signal - received signal","   */","  onAppExit(data) {","    const worker = this.workers.get(data.workerPid);","","    if (!worker.isDevReload) {","      const signal = data.code;","      const message = util.format(","        '[master] App Worker#%s:%s died (code: %s, signal: %s, suicide: %s, state: %s), current workers: %j',","        worker.id, worker.process.pid, worker.process.exitCode, signal,","        worker.suicide, worker.state,","        Object.keys(cluster.workers)","      );","      const err = new Error(message);","      err.name = 'AppWorkerDiedError';","      this.logger.error(err);","    }","","    // remove all listeners to avoid memory leak","    worker.removeAllListeners();","    this.workers.delete(data.workerPid);","    // send message to agent with alive workers","    this.messenger.send({ action: 'egg-pids', to: 'agent', data: getListeningWorker(this.workers) });","","    if (this.isAllAppWorkerStarted) {","      // cfork will only refork at production mode","      this.messenger.send({","        action: 'app-worker-died',","        to: 'parent',","      });","","      if (this.isDebug && !worker.isDevReload) {","        // exit if died during debug","        this.logger.error('[master] kill by debugger, exit now');","        process.exit(0);","      }","    } else {","      // exit if died during startup","      this.logger.error('[master] worker start fail, exit now');","      process.exit(1);","    }","  }","","  /**","   * after app worker","   * @param {Object} data","   *  - {String} workerPid - worker id","   *  - {Object} address - server address","   */","  onAppStart(data) {","    const worker = this.workers.get(data.workerPid);","    const address = data.address;","","    // ignore unspecified port","    if (!this.options.sticky && (String(address.port) !== String(this.options.port))) {","      return;","    }","","    // send message to agent with alive workers","    this.messenger.send({ action: 'egg-pids', to: 'agent', data: getListeningWorker(this.workers) });","","    this.startSuccessCount++;","","    const remain = this.isAllAppWorkerStarted ? 0 : this.options.workers - this.startSuccessCount;","    this.logger.warn('[master] App Worker#%s:%s started at %s, remain %s (%sms)',","      worker.id, data.workerPid, address.port, remain, Date.now() - this.appStartTime);","","    if (this.isAllAppWorkerStarted || this.startSuccessCount < this.options.workers) {","      return;","    }","","    this.isAllAppWorkerStarted = true;","","    if (this.options.sticky) {","      this.startMasterSocketServer(err => {","        if (err) return this.ready(err);","        this.ready(true);","      });","    } else {","      this.ready(true);","    }","  }","","  /**","   * master exit handler","   */","  onExit() {","    // kill agent worker","    process.once('exit', code => {","      // istanbul can't cover here","      // https://github.com/gotwarlost/istanbul/issues/567","      this.killAgentWorker();","      this.logger.info('[master] exit with code: %s', code);","    });","","    // https://nodejs.org/api/process.html#process_signal_events","    // https://en.wikipedia.org/wiki/Unix_signal","    // kill(2) Ctrl-C","    process.once('SIGINT', receiveSig.bind(null, 'SIGINT'));","    // kill(3) Ctrl-\\","    process.once('SIGQUIT', receiveSig.bind(null, 'SIGQUIT'));","    // kill(15) default","    process.once('SIGTERM', receiveSig.bind(null, 'SIGTERM'));","","    function receiveSig(sig) {","      debug('receive signal %s, exit with code 0, pid %s', sig, process.pid);","      process.exit(0);","    }","  }","","  /**","   * reload workers, for develop purpose","   */","  onReload() {","    this.logger.info('[master] reload workers...');","    for (const id in cluster.workers) {","      const worker = cluster.workers[id];","      worker.isDevReload = true;","    }","    require('cluster-reload')(this.options.workers);","  }","}","","module.exports = Master;","","function getListeningWorker(workers) {","  const keys = [];","  for (const id of workers.keys()) {","    if (workers.get(id).state === 'listening') {","      keys.push(id);","    }","  }","  return keys;","}","","function isProduction() {","  const serverEnv = process.env.EGG_SERVER_ENV;","  if (serverEnv) {","    return serverEnv !== 'local' && serverEnv !== 'unittest';","  }","  return process.env.NODE_ENV === 'production';","}","","function isDebug() {","  return process.execArgv.indexOf('--debug') !== -1 || typeof v8debug !== 'undefined';","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"14":1,"15":1,"17":1,"18":1,"35":0,"36":0,"37":0,"39":0,"41":0,"42":0,"45":0,"46":0,"49":0,"50":0,"52":0,"53":0,"54":0,"55":0,"57":0,"59":0,"60":0,"61":0,"62":0,"65":0,"66":0,"67":0,"68":0,"71":0,"72":0,"73":0,"74":0,"75":0,"78":0,"80":0,"82":0,"84":0,"85":1,"86":1,"87":1,"88":1,"90":0,"91":0,"97":0,"101":0,"102":0,"107":0,"108":0,"110":0,"111":0,"112":0,"113":0,"116":0,"117":0,"118":0,"122":0,"124":0,"131":0,"132":0,"133":0,"136":0,"137":0,"138":0,"139":0,"141":0,"142":0,"143":0,"146":0,"147":0,"158":0,"159":0,"160":0,"162":0,"164":0,"165":0,"166":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"182":0,"185":0,"186":0,"189":0,"190":0,"197":0,"198":0,"214":0,"215":0,"216":0,"217":0,"229":0,"231":0,"233":0,"234":0,"237":0,"238":0,"240":0,"241":0,"242":0,"243":0,"245":0,"250":0,"251":0,"256":0,"257":0,"258":0,"270":0,"272":0,"273":0,"274":0,"280":0,"281":0,"282":0,"286":0,"287":0,"289":0,"291":0,"293":0,"298":0,"300":0,"301":0,"305":0,"306":0,"317":0,"318":0,"321":0,"322":0,"326":0,"328":0,"330":0,"331":0,"334":0,"335":0,"338":0,"340":0,"341":0,"342":0,"343":0,"346":0,"355":0,"358":0,"359":0,"365":0,"367":0,"369":0,"371":1,"372":0,"373":0,"381":0,"382":0,"383":0,"384":0,"386":0,"390":1,"392":1,"393":0,"394":0,"395":0,"396":0,"399":0,"402":1,"403":0,"404":0,"405":0,"407":0,"410":1,"411":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":48}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":65}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":77}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":64}},"5":{"start":{"line":8,"column":0},"end":{"line":8,"column":70}},"6":{"start":{"line":10,"column":0},"end":{"line":10,"column":55}},"7":{"start":{"line":11,"column":0},"end":{"line":11,"column":66}},"8":{"start":{"line":12,"column":0},"end":{"line":12,"column":70}},"9":{"start":{"line":13,"column":0},"end":{"line":13,"column":68}},"10":{"start":{"line":14,"column":0},"end":{"line":14,"column":70}},"11":{"start":{"line":15,"column":0},"end":{"line":15,"column":57}},"12":{"start":{"line":17,"column":0},"end":{"line":17,"column":47}},"13":{"start":{"line":18,"column":0},"end":{"line":18,"column":53}}},"branchMap":{},"code":["'use strict';","","module.exports.Logger = require('./lib/logger');","","module.exports.Transport = require('./lib/transports/transport');","module.exports.FileBufferTransport = require('./lib/transports/file_buffer');","module.exports.FileTransport = require('./lib/transports/file');","module.exports.ConsoleTransport = require('./lib/transports/console');","","module.exports.EggLogger = require('./lib/egg/logger');","module.exports.EggErrorLogger = require('./lib/egg/error_logger');","module.exports.EggConsoleLogger = require('./lib/egg/console_logger');","module.exports.EggCustomLogger = require('./lib/egg/custom_logger');","module.exports.EggContextLogger = require('./lib/egg/context_logger');","module.exports.EggLoggers = require('./lib/egg/loggers');","","module.exports.levels = require('./lib/level');","Object.assign(module.exports, module.exports.levels);",""],"l":{"3":1,"5":1,"6":1,"7":1,"8":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"17":1,"18":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/logger.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/logger.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":1,"37":4,"38":4,"39":0,"40":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},"fnMap":{"1":{"name":"(anonymous_1)","line":31,"loc":{"start":{"line":31,"column":13},"end":{"line":31,"column":23}}},"2":{"name":"(anonymous_2)","line":43,"loc":{"start":{"line":43,"column":9},"end":{"line":43,"column":16}}},"3":{"name":"(anonymous_3)","line":52,"loc":{"start":{"line":52,"column":8},"end":{"line":52,"column":15}}},"4":{"name":"(anonymous_4)","line":64,"loc":{"start":{"line":64,"column":5},"end":{"line":64,"column":25}}},"5":{"name":"(anonymous_5)","line":82,"loc":{"start":{"line":82,"column":7},"end":{"line":82,"column":13}}},"6":{"name":"(anonymous_6)","line":94,"loc":{"start":{"line":94,"column":10},"end":{"line":94,"column":26}}},"7":{"name":"(anonymous_7)","line":105,"loc":{"start":{"line":105,"column":12},"end":{"line":105,"column":20}}},"8":{"name":"(anonymous_8)","line":113,"loc":{"start":{"line":113,"column":8},"end":{"line":113,"column":11}}},"9":{"name":"(anonymous_9)","line":122,"loc":{"start":{"line":122,"column":7},"end":{"line":122,"column":10}}},"10":{"name":"(anonymous_10)","line":131,"loc":{"start":{"line":131,"column":5},"end":{"line":131,"column":8}}},"11":{"name":"(anonymous_11)","line":140,"loc":{"start":{"line":140,"column":28},"end":{"line":140,"column":39}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":43}},"4":{"start":{"line":32,"column":4},"end":{"line":32,"column":12}},"5":{"start":{"line":33,"column":4},"end":{"line":33,"column":56}},"6":{"start":{"line":34,"column":4},"end":{"line":34,"column":25}},"7":{"start":{"line":35,"column":4},"end":{"line":35,"column":38}},"8":{"start":{"line":36,"column":4},"end":{"line":36,"column":37}},"9":{"start":{"line":44,"column":4},"end":{"line":44,"column":37}},"10":{"start":{"line":45,"column":4},"end":{"line":45,"column":39}},"11":{"start":{"line":45,"column":19},"end":{"line":45,"column":39}},"12":{"start":{"line":53,"column":4},"end":{"line":53,"column":37}},"13":{"start":{"line":54,"column":4},"end":{"line":54,"column":38}},"14":{"start":{"line":54,"column":19},"end":{"line":54,"column":38}},"15":{"start":{"line":65,"column":4},"end":{"line":65,"column":59}},"16":{"start":{"line":66,"column":4},"end":{"line":69,"column":5}},"17":{"start":{"line":67,"column":6},"end":{"line":67,"column":44}},"18":{"start":{"line":68,"column":6},"end":{"line":68,"column":13}},"19":{"start":{"line":71,"column":4},"end":{"line":75,"column":5}},"20":{"start":{"line":72,"column":6},"end":{"line":74,"column":7}},"21":{"start":{"line":73,"column":8},"end":{"line":73,"column":41}},"22":{"start":{"line":84,"column":4},"end":{"line":84,"column":71}},"23":{"start":{"line":84,"column":30},"end":{"line":84,"column":71}},"24":{"start":{"line":86,"column":4},"end":{"line":86,"column":45}},"25":{"start":{"line":95,"column":4},"end":{"line":95,"column":32}},"26":{"start":{"line":96,"column":4},"end":{"line":98,"column":5}},"27":{"start":{"line":97,"column":6},"end":{"line":97,"column":46}},"28":{"start":{"line":106,"column":4},"end":{"line":106,"column":32}},"29":{"start":{"line":107,"column":4},"end":{"line":107,"column":39}},"30":{"start":{"line":114,"column":4},"end":{"line":116,"column":5}},"31":{"start":{"line":115,"column":6},"end":{"line":115,"column":25}},"32":{"start":{"line":123,"column":4},"end":{"line":125,"column":5}},"33":{"start":{"line":124,"column":6},"end":{"line":124,"column":24}},"34":{"start":{"line":132,"column":4},"end":{"line":132,"column":59}},"35":{"start":{"line":133,"column":4},"end":{"line":133,"column":17}},"36":{"start":{"line":138,"column":0},"end":{"line":143,"column":3}},"37":{"start":{"line":139,"column":2},"end":{"line":139,"column":36}},"38":{"start":{"line":140,"column":2},"end":{"line":142,"column":4}},"39":{"start":{"line":141,"column":4},"end":{"line":141,"column":31}},"40":{"start":{"line":145,"column":0},"end":{"line":145,"column":24}}},"branchMap":{"1":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":45,"column":4}},{"start":{"line":45,"column":4},"end":{"line":45,"column":4}}]},"2":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":54,"column":4}},{"start":{"line":54,"column":4},"end":{"line":54,"column":4}}]},"3":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":4},"end":{"line":66,"column":4}},{"start":{"line":66,"column":4},"end":{"line":66,"column":4}}]},"4":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":6},"end":{"line":72,"column":6}},{"start":{"line":72,"column":6},"end":{"line":72,"column":6}}]},"5":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":4},"end":{"line":84,"column":4}},{"start":{"line":84,"column":4},"end":{"line":84,"column":4}}]},"6":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":4},"end":{"line":96,"column":4}},{"start":{"line":96,"column":4},"end":{"line":96,"column":4}}]},"7":{"line":96,"type":"binary-expr","locations":[{"start":{"line":96,"column":8},"end":{"line":96,"column":40}},{"start":{"line":96,"column":44},"end":{"line":96,"column":68}}]}},"code":["'use strict';","","const util = require('util');","const utils = require('./utils');","const depd = require('depd')('egg-logger');","","","/**"," * Base class for all sub Logger class."," * It extends Map, and can contains multi {@link Transport}"," *"," * @example"," * ```js"," * const logger = new Logger();"," * logger.set('file', new FileTransport({"," *   file: '/path/to/log',"," *   level: 'INFO',"," * }));"," * logger.set('console', new ConsoleTransport({"," *   level: 'INFO',"," * }));"," * logger.info('foo');"," * ```"," */","class Logger extends Map {","","  /**","   * @constructor","   * @param {Object} options - assign with `defaults` propery","   */","  constructor(options) {","    super();","    this.options = utils.assign(this.defaults, options);","    this.transports = {};","    this.name = this.constructor.name;","    this.redirectLoggers = new Map();","  }","","  /**","   * disable a transport","   * @param {String} name - transport name","   */","  disable(name) {","    const transport = this.get(name);","    if (transport) transport.disable();","  }","","  /**","   * enable a transport","   * @param {String} name - transport name","   */","  enable(name) {","    const transport = this.get(name);","    if (transport) transport.enable();","  }","","  /**","   * Send log to all transports.","   * It's proxy to {@link Transport}'s log method.'","   * @param {String} level - log level","   * @param {Array} args - log arguments","   * @param {Object} meta - log meta","   */","  log(level, args, meta) {","    const redirectLogger = this.redirectLoggers.get(level);","    if (redirectLogger) {","      redirectLogger.log(level, args, meta);","      return;","    }","","    for (const transport of this.values()) {","      if (transport.shouldLog(level)) {","        transport.log(level, args, meta);","      }","    }","  }","","  /**","   * write raw log to all transports","   * @param {String} msg - log message","   */","  write(msg) {","    // support util.format","    if (arguments.length > 1) msg = util.format.apply(util, arguments);","    // `NONE` is the top level","    this.log('NONE', [ msg ], { raw: true });","  }","","  /**","   * Redirect specify level log to the other logger","   * @param {String} level - log level","   * @param {Logger} logger - target logger instance","   */","  redirect(level, logger) {","    level = level.toUpperCase();","    if (!this.redirectLoggers.has(level) && logger instanceof Logger) {","      this.redirectLoggers.set(level, logger);","    }","  }","","  /**","   * Un-redirect specify level log","   * @param {String} level - log level","   */","  unredirect(level) {","    level = level.toUpperCase();","    this.redirectLoggers.delete(level);","  }","","  /**","   * Reload all transports","   */","  reload() {","    for (const transport of this.values()) {","      transport.reload();","    }","  }","","  /**","   * End all transports","   */","  close() {","    for (const transport of this.values()) {","      transport.close();","    }","  }","","  /**","   * @deprecated","   */","  end() {","    depd('logger.end() is deprecated, use logger.close()');","    this.close();","  }","","}","","[ 'error', 'warn', 'info', 'debug' ].forEach(level => {","  const LEVEL = level.toUpperCase();","  Logger.prototype[level] = function() {","    this.log(LEVEL, arguments);","  };","});","","module.exports = Logger;",""],"l":{"3":1,"4":1,"5":1,"32":1,"33":1,"34":1,"35":1,"36":1,"44":0,"45":0,"53":0,"54":0,"65":0,"66":0,"67":0,"68":0,"71":0,"72":0,"73":0,"84":0,"86":0,"95":0,"96":0,"97":0,"106":0,"107":0,"114":0,"115":0,"123":0,"124":0,"132":0,"133":0,"138":1,"139":4,"140":4,"141":0,"145":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/utils.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/utils.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":2,"13":0,"14":2,"15":2,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":3,"50":1,"51":2,"52":2,"53":2,"54":2,"55":0,"56":2,"57":2,"58":3,"59":3,"60":3,"61":2,"62":1,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":1,"73":0,"74":0,"75":0,"76":0},"b":{"1":[0,2],"2":[2,0],"3":[2,2],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[1,2],"17":[0,2],"18":[3,0],"19":[3,3],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0]},"f":{"1":2,"2":0,"3":0,"4":0,"5":3,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":21,"loc":{"start":{"line":21,"column":16},"end":{"line":21,"column":24}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":18},"end":{"line":33,"column":25}}},"3":{"name":"(anonymous_3)","line":38,"loc":{"start":{"line":38,"column":18},"end":{"line":38,"column":25}}},"4":{"name":"(anonymous_4)","line":78,"loc":{"start":{"line":78,"column":8},"end":{"line":78,"column":37}}},"5":{"name":"(anonymous_5)","line":112,"loc":{"start":{"line":112,"column":8},"end":{"line":112,"column":17}}},"6":{"name":"formatError","line":134,"loc":{"start":{"line":134,"column":0},"end":{"line":134,"column":26}}},"7":{"name":"inspect","line":156,"loc":{"start":{"line":156,"column":0},"end":{"line":156,"column":29}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":31}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":36}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":34}},"7":{"start":{"line":10,"column":0},"end":{"line":10,"column":31}},"8":{"start":{"line":11,"column":0},"end":{"line":11,"column":37}},"9":{"start":{"line":13,"column":0},"end":{"line":13,"column":43}},"10":{"start":{"line":14,"column":0},"end":{"line":14,"column":61}},"11":{"start":{"line":19,"column":0},"end":{"line":132,"column":2}},"12":{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},"13":{"start":{"line":23,"column":6},"end":{"line":23,"column":19}},"14":{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},"15":{"start":{"line":28,"column":6},"end":{"line":28,"column":41}},"16":{"start":{"line":34,"column":4},"end":{"line":34,"column":78}},"17":{"start":{"line":39,"column":4},"end":{"line":39,"column":81}},"18":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"19":{"start":{"line":41,"column":6},"end":{"line":41,"column":17}},"20":{"start":{"line":44,"column":4},"end":{"line":48,"column":5}},"21":{"start":{"line":45,"column":6},"end":{"line":45,"column":28}},"22":{"start":{"line":46,"column":11},"end":{"line":48,"column":5}},"23":{"start":{"line":47,"column":6},"end":{"line":47,"column":31}},"24":{"start":{"line":50,"column":4},"end":{"line":50,"column":57}},"25":{"start":{"line":51,"column":4},"end":{"line":51,"column":56}},"26":{"start":{"line":52,"column":4},"end":{"line":52,"column":59}},"27":{"start":{"line":53,"column":4},"end":{"line":53,"column":15}},"28":{"start":{"line":79,"column":4},"end":{"line":79,"column":22}},"29":{"start":{"line":80,"column":4},"end":{"line":80,"column":16}},"30":{"start":{"line":81,"column":4},"end":{"line":81,"column":15}},"31":{"start":{"line":82,"column":4},"end":{"line":82,"column":58}},"32":{"start":{"line":84,"column":4},"end":{"line":88,"column":5}},"33":{"start":{"line":85,"column":6},"end":{"line":85,"column":37}},"34":{"start":{"line":87,"column":6},"end":{"line":87,"column":46}},"35":{"start":{"line":90,"column":4},"end":{"line":101,"column":5}},"36":{"start":{"line":91,"column":6},"end":{"line":91,"column":23}},"37":{"start":{"line":92,"column":11},"end":{"line":101,"column":5}},"38":{"start":{"line":93,"column":6},"end":{"line":93,"column":25}},"39":{"start":{"line":94,"column":6},"end":{"line":94,"column":39}},"40":{"start":{"line":95,"column":6},"end":{"line":95,"column":29}},"41":{"start":{"line":96,"column":6},"end":{"line":96,"column":31}},"42":{"start":{"line":97,"column":6},"end":{"line":97,"column":29}},"43":{"start":{"line":98,"column":6},"end":{"line":98,"column":78}},"44":{"start":{"line":100,"column":6},"end":{"line":100,"column":23}},"45":{"start":{"line":103,"column":4},"end":{"line":103,"column":39}},"46":{"start":{"line":103,"column":17},"end":{"line":103,"column":39}},"47":{"start":{"line":105,"column":4},"end":{"line":105,"column":26}},"48":{"start":{"line":108,"column":4},"end":{"line":108,"column":89}},"49":{"start":{"line":113,"column":4},"end":{"line":115,"column":5}},"50":{"start":{"line":114,"column":6},"end":{"line":114,"column":16}},"51":{"start":{"line":116,"column":4},"end":{"line":116,"column":61}},"52":{"start":{"line":117,"column":4},"end":{"line":127,"column":5}},"53":{"start":{"line":118,"column":6},"end":{"line":118,"column":32}},"54":{"start":{"line":119,"column":6},"end":{"line":119,"column":28}},"55":{"start":{"line":119,"column":19},"end":{"line":119,"column":28}},"56":{"start":{"line":120,"column":6},"end":{"line":120,"column":39}},"57":{"start":{"line":121,"column":6},"end":{"line":126,"column":7}},"58":{"start":{"line":122,"column":8},"end":{"line":122,"column":28}},"59":{"start":{"line":123,"column":8},"end":{"line":125,"column":9}},"60":{"start":{"line":124,"column":10},"end":{"line":124,"column":36}},"61":{"start":{"line":128,"column":4},"end":{"line":128,"column":18}},"62":{"start":{"line":134,"column":0},"end":{"line":154,"column":1}},"63":{"start":{"line":135,"column":2},"end":{"line":137,"column":3}},"64":{"start":{"line":136,"column":4},"end":{"line":136,"column":35}},"65":{"start":{"line":139,"column":2},"end":{"line":141,"column":3}},"66":{"start":{"line":140,"column":4},"end":{"line":140,"column":36}},"67":{"start":{"line":142,"column":2},"end":{"line":142,"column":38}},"68":{"start":{"line":144,"column":2},"end":{"line":144,"column":29}},"69":{"start":{"line":145,"column":2},"end":{"line":145,"column":87}},"70":{"start":{"line":145,"column":52},"end":{"line":145,"column":74}},"71":{"start":{"line":146,"column":2},"end":{"line":153,"column":4}},"72":{"start":{"line":156,"column":0},"end":{"line":166,"column":1}},"73":{"start":{"line":157,"column":2},"end":{"line":164,"column":3}},"74":{"start":{"line":159,"column":4},"end":{"line":161,"column":27}},"75":{"start":{"line":163,"column":4},"end":{"line":163,"column":32}},"76":{"start":{"line":165,"column":2},"end":{"line":165,"column":28}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":4},"end":{"line":22,"column":4}},{"start":{"line":22,"column":4},"end":{"line":22,"column":4}}]},"2":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":4},"end":{"line":27,"column":4}},{"start":{"line":27,"column":4},"end":{"line":27,"column":4}}]},"3":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":8},"end":{"line":27,"column":33}},{"start":{"line":27,"column":37},"end":{"line":27,"column":42}}]},"4":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":40,"column":4}},{"start":{"line":40,"column":4},"end":{"line":40,"column":4}}]},"5":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":44,"column":4}},{"start":{"line":44,"column":4},"end":{"line":44,"column":4}}]},"6":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":11},"end":{"line":46,"column":11}},{"start":{"line":46,"column":11},"end":{"line":46,"column":11}}]},"7":{"line":79,"type":"binary-expr","locations":[{"start":{"line":79,"column":11},"end":{"line":79,"column":15}},{"start":{"line":79,"column":19},"end":{"line":79,"column":21}}]},"8":{"line":82,"type":"binary-expr","locations":[{"start":{"line":82,"column":22},"end":{"line":82,"column":36}},{"start":{"line":82,"column":40},"end":{"line":82,"column":57}}]},"9":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":4},"end":{"line":84,"column":4}},{"start":{"line":84,"column":4},"end":{"line":84,"column":4}}]},"10":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":4},"end":{"line":90,"column":4}},{"start":{"line":90,"column":4},"end":{"line":90,"column":4}}]},"11":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":11},"end":{"line":92,"column":11}},{"start":{"line":92,"column":11},"end":{"line":92,"column":11}}]},"12":{"line":92,"type":"binary-expr","locations":[{"start":{"line":92,"column":15},"end":{"line":92,"column":36}},{"start":{"line":92,"column":40},"end":{"line":92,"column":49}}]},"13":{"line":98,"type":"cond-expr","locations":[{"start":{"line":98,"column":39},"end":{"line":98,"column":59}},{"start":{"line":98,"column":62},"end":{"line":98,"column":77}}]},"14":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":4},"end":{"line":103,"column":4}},{"start":{"line":103,"column":4},"end":{"line":103,"column":4}}]},"15":{"line":108,"type":"cond-expr","locations":[{"start":{"line":108,"column":41},"end":{"line":108,"column":47}},{"start":{"line":108,"column":50},"end":{"line":108,"column":88}}]},"16":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":4},"end":{"line":113,"column":4}},{"start":{"line":113,"column":4},"end":{"line":113,"column":4}}]},"17":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":6},"end":{"line":119,"column":6}},{"start":{"line":119,"column":6},"end":{"line":119,"column":6}}]},"18":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":8},"end":{"line":123,"column":8}},{"start":{"line":123,"column":8},"end":{"line":123,"column":8}}]},"19":{"line":123,"type":"binary-expr","locations":[{"start":{"line":123,"column":12},"end":{"line":123,"column":37}},{"start":{"line":123,"column":41},"end":{"line":123,"column":61}}]},"20":{"line":135,"type":"if","locations":[{"start":{"line":135,"column":2},"end":{"line":135,"column":2}},{"start":{"line":135,"column":2},"end":{"line":135,"column":2}}]},"21":{"line":135,"type":"binary-expr","locations":[{"start":{"line":135,"column":6},"end":{"line":135,"column":26}},{"start":{"line":135,"column":30},"end":{"line":135,"column":58}}]},"22":{"line":139,"type":"if","locations":[{"start":{"line":139,"column":2},"end":{"line":139,"column":2}},{"start":{"line":139,"column":2},"end":{"line":139,"column":2}}]},"23":{"line":142,"type":"binary-expr","locations":[{"start":{"line":142,"column":14},"end":{"line":142,"column":23}},{"start":{"line":142,"column":27},"end":{"line":142,"column":37}}]},"24":{"line":157,"type":"if","locations":[{"start":{"line":157,"column":2},"end":{"line":157,"column":2}},{"start":{"line":157,"column":2},"end":{"line":157,"column":2}}]},"25":{"line":157,"type":"binary-expr","locations":[{"start":{"line":157,"column":6},"end":{"line":157,"column":11}},{"start":{"line":157,"column":15},"end":{"line":157,"column":40}}]}},"code":["'use strict';","","const os = require('os');","const util = require('util');","const chalk = require('chalk');","const utility = require('utility');","const iconv = require('iconv-lite');","const levels = require('./level');","","const hostname = os.hostname();","const duartionRegexp = /([0-9]+ms)/g;","// eslint-disable-next-line no-useless-escape","const categoryRegexp = /(\\[[\\w\\-_.:]+\\])/g;","const httpMethodRegexp = /(GET|POST|PUT|PATH|HEAD|DELETE) /g;","","/**"," * @class LoggerUtils"," */","module.exports = {","","  normalizeLevel(level) {","    if (typeof level === 'number') {","      return level;","    }","","    // 'WARN' => level.warn","    if (typeof level === 'string' && level) {","      return levels[level.toUpperCase()];","    }","  },","","  // default format","  defaultFormatter(meta) {","    return meta.date + ' ' + meta.level + ' ' + meta.pid + ' ' + meta.message;","  },","","  // output to Terminal format","  consoleFormatter(meta) {","    let msg = meta.date + ' ' + meta.level + ' ' + meta.pid + ' ' + meta.message;","    if (!chalk.supportsColor) {","      return msg;","    }","","    if (meta.level === 'ERROR') {","      return chalk.red(msg);","    } else if (meta.level === 'WARN') {","      return chalk.yellow(msg);","    }","","    msg = msg.replace(duartionRegexp, chalk.green('$1'));","    msg = msg.replace(categoryRegexp, chalk.blue('$1'));","    msg = msg.replace(httpMethodRegexp, chalk.cyan('$1 '));","    return msg;","  },","","  /**","   * Get final formated log string buffer","   *","   * Invoke linke: {@Link Logger#log} -> {@link Transport#log} -> LoggerUtils.format","   * @method LoggerUtils#format","   * @param {String} level - log level","   * @param {Array} args - format arguments","   * @param {Object} meta - loging behaviour meta infomation","   *  - {String} level","   *  - {Boolean} raw","   *  - {Function} formatter","   *  - {Error} error","   *  - {String} message","   *  - {Number} pid","   *  - {String} hostname","   *  - {String} date","   * @param {Object} options - {@link Transport}'s options","   *  - {String} encoding","   *  - {Boolean} json","   *  - {Function} formatter","   * @return {Buffer} formated log string buffer","   */","  format(level, args, meta, options) {","    meta = meta || {};","    let message;","    let output;","    const formatter = meta.formatter || options.formatter;","","    if (args[0] instanceof Error) {","      message = formatError(args[0]);","    } else {","      message = util.format.apply(util, args);","    }","","    if (meta.raw === true) {","      output = message;","    } else if (options.json === true || formatter) {","      meta.level = level;","      meta.date = utility.logDate(',');","      meta.pid = process.pid;","      meta.hostname = hostname;","      meta.message = message;","      output = options.json === true ? JSON.stringify(meta) : formatter(meta);","    } else {","      output = message;","    }","","    if (!output) return new Buffer('');","","    output += options.eol;","","    // convert string to buffer when encoding is not utf8","    return options.encoding === 'utf8' ? output : iconv.encode(output, options.encoding);","  },","","  // Like `Object.assign`, but don't copy `undefined` value","  assign(target) {","    if (!target) {","      return {};","    }","    const sources = Array.prototype.slice.call(arguments, 1);","    for (let i = 0; i < sources.length; i++) {","      const source = sources[i];","      if (!source) continue;","      const keys = Object.keys(source);","      for (let j = 0; j < keys.length; j++) {","        const key = keys[j];","        if (source[key] !== undefined && source[key] !== null) {","          target[key] = source[key];","        }","      }","    }","    return target;","  },","","  formatError,","};","","function formatError(err) {","  if (err.name === 'Error' && typeof err.code === 'string') {","    err.name = err.code + err.name;","  }","","  if (err.host) {","    err.message += ` (${err.host})`;","  }","  err.stack = err.stack || 'no_stack';","  // name and stack could not be change on node 0.11+","  const errStack = err.stack;","  const errProperties = Object.keys(err).map(key => inspect(key, err[key])).join('\\n');","  return util.format('nodejs.%s: %s\\n%s\\n%s\\npid: %s\\nhostname: %s\\n',","    err.name,","    err.message,","    errStack.substring(errStack.indexOf('\\n') + 1),","    errProperties,","    process.pid,","    hostname","  );","}","","function inspect(key, value) {","  if (value && typeof value === 'object') {","    // force in one line","    value = util.inspect(value)","      .replace(/^\\s+/mg, '')","      .replace(/\\n/g, ' ');","  } else {","    value = util.inspect(value);","  }","  return key + ': ' + value;","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"10":1,"11":1,"13":1,"14":1,"19":1,"22":2,"23":0,"27":2,"28":2,"34":0,"39":0,"40":0,"41":0,"44":0,"45":0,"46":0,"47":0,"50":0,"51":0,"52":0,"53":0,"79":0,"80":0,"81":0,"82":0,"84":0,"85":0,"87":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"100":0,"103":0,"105":0,"108":0,"113":3,"114":1,"116":2,"117":2,"118":2,"119":2,"120":2,"121":2,"122":3,"123":3,"124":3,"128":2,"134":1,"135":0,"136":0,"139":0,"140":0,"142":0,"144":0,"145":0,"146":0,"156":1,"157":0,"159":0,"163":0,"165":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/level.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/level.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":24}},"2":{"start":{"line":11,"column":0},"end":{"line":11,"column":18}},"3":{"start":{"line":18,"column":0},"end":{"line":18,"column":17}},"4":{"start":{"line":25,"column":0},"end":{"line":25,"column":17}},"5":{"start":{"line":32,"column":0},"end":{"line":32,"column":18}},"6":{"start":{"line":34,"column":0},"end":{"line":34,"column":24}}},"branchMap":{},"code":["'use strict';","","exports.ALL = -Infinity;","","/**"," * Debug log for execute tracing"," *"," * @method Logger#debug"," * @param {String} msg - log message"," */","exports.DEBUG = 0;","","/**"," * Normal infomaction loging"," * @method Logger#info"," * @param {String} msg - log message"," */","exports.INFO = 1;","","/**"," * Warning information loging"," * @method Logger#warn"," * @param {String} msg - log message"," */","exports.WARN = 2;","","/**"," * Error or exception loging"," * @method Logger#error"," * @param {String|Error} msg - log message or error instance"," */","exports.ERROR = 3;","","exports.NONE = Infinity;",""],"l":{"3":1,"11":1,"18":1,"25":1,"32":1,"34":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/transports/transport.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/transports/transport.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":1,"9":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":1},"b":{"1":[0,1],"2":[0,0],"3":[0,0]},"f":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"(anonymous_1)","line":25,"loc":{"start":{"line":25,"column":13},"end":{"line":25,"column":23}}},"2":{"name":"(anonymous_2)","line":34,"loc":{"start":{"line":34,"column":14},"end":{"line":34,"column":17}}},"3":{"name":"(anonymous_3)","line":48,"loc":{"start":{"line":48,"column":13},"end":{"line":48,"column":16}}},"4":{"name":"(anonymous_4)","line":55,"loc":{"start":{"line":55,"column":8},"end":{"line":55,"column":11}}},"5":{"name":"(anonymous_5)","line":62,"loc":{"start":{"line":62,"column":9},"end":{"line":62,"column":12}}},"6":{"name":"(anonymous_6)","line":71,"loc":{"start":{"line":71,"column":11},"end":{"line":71,"column":19}}},"7":{"name":"(anonymous_7)","line":91,"loc":{"start":{"line":91,"column":5},"end":{"line":91,"column":25}}},"8":{"name":"(anonymous_8)","line":98,"loc":{"start":{"line":98,"column":8},"end":{"line":98,"column":11}}},"9":{"name":"(anonymous_9)","line":103,"loc":{"start":{"line":103,"column":7},"end":{"line":103,"column":10}}},"10":{"name":"(anonymous_10)","line":104,"loc":{"start":{"line":104,"column":5},"end":{"line":104,"column":8}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":34}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":44}},"5":{"start":{"line":26,"column":4},"end":{"line":26,"column":56}},"6":{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},"7":{"start":{"line":28,"column":6},"end":{"line":28,"column":37}},"8":{"start":{"line":30,"column":4},"end":{"line":30,"column":66}},"9":{"start":{"line":31,"column":4},"end":{"line":31,"column":25}},"10":{"start":{"line":35,"column":4},"end":{"line":41,"column":6}},"11":{"start":{"line":49,"column":4},"end":{"line":49,"column":25}},"12":{"start":{"line":56,"column":4},"end":{"line":56,"column":25}},"13":{"start":{"line":63,"column":4},"end":{"line":63,"column":26}},"14":{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},"15":{"start":{"line":73,"column":6},"end":{"line":73,"column":19}},"16":{"start":{"line":77,"column":4},"end":{"line":79,"column":5}},"17":{"start":{"line":78,"column":6},"end":{"line":78,"column":19}},"18":{"start":{"line":81,"column":4},"end":{"line":81,"column":47}},"19":{"start":{"line":92,"column":4},"end":{"line":92,"column":57}},"20":{"start":{"line":107,"column":0},"end":{"line":107,"column":27}}},"branchMap":{"1":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":4},"end":{"line":27,"column":4}},{"start":{"line":27,"column":4},"end":{"line":27,"column":4}}]},"2":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":72,"column":4}},{"start":{"line":72,"column":4},"end":{"line":72,"column":4}}]},"3":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":4},"end":{"line":77,"column":4}},{"start":{"line":77,"column":4},"end":{"line":77,"column":4}}]}},"code":["'use strict';","","const os = require('os');","const utils = require('../utils');","const levels = require('../level');","","const ENABLED = Symbol('Transport#enabled');","","","/**"," * Transport 是日志的一种输出通道，可以输出到文件，终端或服务等。"," * 一个 {@link Logger} 可以配置多个 Transport 来满足各种复杂的需求"," */","class Transport {","","  /**","   * @constructor","   * @param  {Object} options","   * - {String} [level = NONE] - 日志打印级别，打印的方法必须高于此配置方法。如配置了 info，debug 不会打印。","   * - {Function} formatter - 格式化函数","   * - {Boolean} [json = false] - 日志内容是否为 json 格式","   * - {String} [encoding = utf8] - 文件编码，可选编码 {@link https://github.com/ashtuchkin/iconv-lite#supported-encodings}","   * - {String} [eol = os.EOL] - 换行符","   */","  constructor(options) {","    this.options = utils.assign(this.defaults, options);","    if (this.options.encoding === 'utf-8') {","      this.options.encoding = 'utf8';","    }","    this.options.level = utils.normalizeLevel(this.options.level);","    this[ENABLED] = true;","  }","","  get defaults() {","    return {","      level: 'NONE',","      formatter: null,","      json: false,","      encoding: 'utf8',","      eol: os.EOL,","    };","  }","","  /**","   * 是否开启，如果关闭则不会输出日志","   * @return {[type]} [description]","   */","  get enabled() {","    return this[ENABLED];","  }","","  /**","   * 开启 transport","   */","  enable() {","    this[ENABLED] = true;","  }","","  /**","   * 关闭 transport，关闭后不会写入日志","   */","  disable() {","    this[ENABLED] = false;","  }","","  /**","   * 是否应该打印日志","   * @param  {String} level 日志级别，必须大写","   * @return {Boolean} 返回打印状态","   */","  shouldLog(level) {","    if (!this[ENABLED]) {","      return false;","    }","","    // 如果指定了 NONE 就不打印","    if (this.options.level === levels['NONE']) {","      return false;","    }","","    return this.options.level <= levels[level];","  }","","  /**","   * Transport 统一的记录日志的方法，会根据配置输出不同格式","   * @param  {String} level - 日志级别","   * @param  {Array} args - 所有的参数","   * @param  {Object} meta - 元信息","   * @return {Buffer|String} 日志信息 - 如果无内容会返回空字符串, utf8编码返回 String, 其他编码返回 Buffer","   */","  log(level, args, meta) {","    return utils.format(level, args, meta, this.options);","  }","","  /**","   * 重载 Transport，无特殊情况可不覆盖","   */","  reload() {}","","  /**","   * 关闭 Transport，无特殊情况可不覆盖","   */","  close() {}","  end() {}","}","","module.exports = Transport;",""],"l":{"3":1,"4":1,"5":1,"7":1,"26":1,"27":1,"28":0,"30":1,"31":1,"35":1,"49":0,"56":0,"63":0,"72":0,"73":0,"77":0,"78":0,"81":0,"92":0,"107":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/transports/file_buffer.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/transports/file_buffer.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"fnMap":{"1":{"name":"(anonymous_1)","line":20,"loc":{"start":{"line":20,"column":13},"end":{"line":20,"column":23}}},"2":{"name":"(anonymous_2)","line":28,"loc":{"start":{"line":28,"column":14},"end":{"line":28,"column":17}}},"3":{"name":"(anonymous_3)","line":38,"loc":{"start":{"line":38,"column":7},"end":{"line":38,"column":10}}},"4":{"name":"(anonymous_4)","line":46,"loc":{"start":{"line":46,"column":5},"end":{"line":46,"column":8}}},"5":{"name":"(anonymous_5)","line":54,"loc":{"start":{"line":54,"column":7},"end":{"line":54,"column":10}}},"6":{"name":"(anonymous_6)","line":70,"loc":{"start":{"line":70,"column":14},"end":{"line":70,"column":17}}},"7":{"name":"(anonymous_7)","line":83,"loc":{"start":{"line":83,"column":8},"end":{"line":83,"column":14}}},"8":{"name":"(anonymous_8)","line":96,"loc":{"start":{"line":96,"column":17},"end":{"line":96,"column":20}}},"9":{"name":"(anonymous_9)","line":104,"loc":{"start":{"line":104,"column":16},"end":{"line":104,"column":19}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":43}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":40}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":34}},"4":{"start":{"line":21,"column":4},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":4},"end":{"line":23,"column":22}},"6":{"start":{"line":24,"column":4},"end":{"line":24,"column":19}},"7":{"start":{"line":25,"column":4},"end":{"line":25,"column":41}},"8":{"start":{"line":29,"column":4},"end":{"line":32,"column":7}},"9":{"start":{"line":39,"column":4},"end":{"line":39,"column":26}},"10":{"start":{"line":40,"column":4},"end":{"line":40,"column":18}},"11":{"start":{"line":47,"column":4},"end":{"line":47,"column":65}},"12":{"start":{"line":48,"column":4},"end":{"line":48,"column":17}},"13":{"start":{"line":55,"column":4},"end":{"line":63,"column":5}},"14":{"start":{"line":56,"column":6},"end":{"line":60,"column":7}},"15":{"start":{"line":57,"column":8},"end":{"line":57,"column":47}},"16":{"start":{"line":59,"column":8},"end":{"line":59,"column":68}},"17":{"start":{"line":61,"column":6},"end":{"line":61,"column":21}},"18":{"start":{"line":62,"column":6},"end":{"line":62,"column":24}},"19":{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},"20":{"start":{"line":73,"column":6},"end":{"line":73,"column":19}},"21":{"start":{"line":75,"column":4},"end":{"line":75,"column":25}},"22":{"start":{"line":84,"column":4},"end":{"line":84,"column":32}},"23":{"start":{"line":85,"column":4},"end":{"line":85,"column":24}},"24":{"start":{"line":86,"column":4},"end":{"line":88,"column":5}},"25":{"start":{"line":87,"column":6},"end":{"line":87,"column":19}},"26":{"start":{"line":97,"column":4},"end":{"line":97,"column":71}},"27":{"start":{"line":97,"column":29},"end":{"line":97,"column":41}},"28":{"start":{"line":105,"column":4},"end":{"line":108,"column":5}},"29":{"start":{"line":106,"column":6},"end":{"line":106,"column":33}},"30":{"start":{"line":107,"column":6},"end":{"line":107,"column":25}},"31":{"start":{"line":112,"column":0},"end":{"line":112,"column":37}}},"branchMap":{"1":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":55,"column":4}},{"start":{"line":55,"column":4},"end":{"line":55,"column":4}}]},"2":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":6},"end":{"line":56,"column":6}},{"start":{"line":56,"column":6},"end":{"line":56,"column":6}}]},"3":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":72,"column":4}},{"start":{"line":72,"column":4},"end":{"line":72,"column":4}}]},"4":{"line":72,"type":"binary-expr","locations":[{"start":{"line":72,"column":8},"end":{"line":72,"column":17}},{"start":{"line":72,"column":21},"end":{"line":72,"column":41}}]},"5":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":4},"end":{"line":86,"column":4}},{"start":{"line":86,"column":4},"end":{"line":86,"column":4}}]},"6":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":4},"end":{"line":105,"column":4}},{"start":{"line":105,"column":4},"end":{"line":105,"column":4}}]}},"code":["'use strict';","","const depd = require('depd')('egg-logger');","const FileTransport = require('./file');","const utils = require('../utils');","","/**"," * 继承自 {@link FileTransport}，将日志写入内存中，一定时间内统一写入文件来提高性能"," */","class FileBufferTransport extends FileTransport {","","  /**","   * @constructor","   * @param {Object} options","   * - {String} file - 日志的文件路径","   * - {Number} [flushInterval = 1000] - 日志写入频率，一定时间后写入文件","   * - {Number} [maxBufferLength = 1000] - 日志写入缓存队列最大长度","   * - {String} [level = INFO] - 日志级别","   */","  constructor(options) {","    super(options);","","    this._bufSize = 0;","    this._buf = [];","    this._timer = this._createInterval();","  }","","  get defaults() {","    return utils.assign(super.defaults, {","      flushInterval: 1000,","      maxBufferLength: 1000,","    });","  }","","  /**","   * 关闭 stream 和定时器","   */","  close() {","    this._closeInterval();","    super.close();","  }","","  /**","   * @deprecated","   */","  end() {","    depd('transport.end() is deprecated, use transport.close()');","    this.close();","  }","","  /**","   * 将内存中的字符写入文件中","   */","  flush() {","    if (this._buf.length > 0) {","      if (this.options.encoding === 'utf8') {","        this._stream.write(this._buf.join(''));","      } else {","        this._stream.write(Buffer.concat(this._buf, this._bufSize));","      }","      this._buf = [];","      this._bufSize = 0;","    }","  }","","  /**","   * 覆盖父类，在关闭 stream 之前先 flush 下","   * @private","   */","  _closeStream() {","    // FileTransport 在初始化时会 reload，这时 _buf 还未初始化","    if (this._buf && this._buf.length > 0) {","      this.flush();","    }","    super._closeStream();","  }","","  /**","   * 覆盖父类，写入内存","   * @param {Buffer} buf - 日志内容","   * @private","   */","  _write(buf) {","    this._bufSize += buf.length;","    this._buf.push(buf);","    if (this._buf.length > this.options.maxBufferLength) {","      this.flush();","    }","  }","","  /**","   * 创建定时器，一定时间内写入文件","   * @return {Interval} 定时器","   * @private","   */","  _createInterval() {","    return setInterval(() => this.flush(), this.options.flushInterval);","  }","","  /**","   * 关闭定时器","   * @private","   */","  _closeInterval() {","    if (this._timer) {","      clearInterval(this._timer);","      this._timer = null;","    }","  }","}","","module.exports = FileBufferTransport;",""],"l":{"3":1,"4":1,"5":1,"21":0,"23":0,"24":0,"25":0,"29":0,"39":0,"40":0,"47":0,"48":0,"55":0,"56":0,"57":0,"59":0,"61":0,"62":0,"72":0,"73":0,"75":0,"84":0,"85":0,"86":0,"87":0,"97":0,"105":0,"106":0,"107":0,"112":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/transports/file.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/transports/file.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":1,"36":1,"37":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"(anonymous_1)","line":24,"loc":{"start":{"line":24,"column":13},"end":{"line":24,"column":23}}},"2":{"name":"(anonymous_2)","line":32,"loc":{"start":{"line":32,"column":14},"end":{"line":32,"column":17}}},"3":{"name":"(anonymous_3)","line":42,"loc":{"start":{"line":42,"column":8},"end":{"line":42,"column":11}}},"4":{"name":"(anonymous_4)","line":55,"loc":{"start":{"line":55,"column":5},"end":{"line":55,"column":25}}},"5":{"name":"(anonymous_5)","line":70,"loc":{"start":{"line":70,"column":7},"end":{"line":70,"column":10}}},"6":{"name":"(anonymous_6)","line":77,"loc":{"start":{"line":77,"column":5},"end":{"line":77,"column":8}}},"7":{"name":"(anonymous_7)","line":87,"loc":{"start":{"line":87,"column":8},"end":{"line":87,"column":14}}},"8":{"name":"(anonymous_8)","line":96,"loc":{"start":{"line":96,"column":15},"end":{"line":96,"column":18}}},"9":{"name":"(anonymous_9)","line":107,"loc":{"start":{"line":107,"column":14},"end":{"line":107,"column":17}}},"10":{"name":"onError","line":119,"loc":{"start":{"line":119,"column":0},"end":{"line":119,"column":22}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":33}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":33}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":35}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":43}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":41}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":34}},"9":{"start":{"line":25,"column":4},"end":{"line":25,"column":19}},"10":{"start":{"line":26,"column":4},"end":{"line":26,"column":58}},"11":{"start":{"line":28,"column":4},"end":{"line":28,"column":24}},"12":{"start":{"line":29,"column":4},"end":{"line":29,"column":18}},"13":{"start":{"line":33,"column":4},"end":{"line":36,"column":7}},"14":{"start":{"line":44,"column":4},"end":{"line":44,"column":24}},"15":{"start":{"line":46,"column":4},"end":{"line":46,"column":40}},"16":{"start":{"line":56,"column":4},"end":{"line":60,"column":5}},"17":{"start":{"line":57,"column":6},"end":{"line":57,"column":79}},"18":{"start":{"line":58,"column":6},"end":{"line":58,"column":31}},"19":{"start":{"line":59,"column":6},"end":{"line":59,"column":13}},"20":{"start":{"line":61,"column":4},"end":{"line":61,"column":45}},"21":{"start":{"line":62,"column":4},"end":{"line":64,"column":5}},"22":{"start":{"line":63,"column":6},"end":{"line":63,"column":23}},"23":{"start":{"line":71,"column":4},"end":{"line":71,"column":24}},"24":{"start":{"line":78,"column":4},"end":{"line":78,"column":65}},"25":{"start":{"line":79,"column":4},"end":{"line":79,"column":17}},"26":{"start":{"line":88,"column":4},"end":{"line":88,"column":28}},"27":{"start":{"line":97,"column":4},"end":{"line":97,"column":49}},"28":{"start":{"line":98,"column":4},"end":{"line":98,"column":75}},"29":{"start":{"line":99,"column":4},"end":{"line":99,"column":32}},"30":{"start":{"line":100,"column":4},"end":{"line":100,"column":18}},"31":{"start":{"line":108,"column":4},"end":{"line":112,"column":5}},"32":{"start":{"line":109,"column":6},"end":{"line":109,"column":25}},"33":{"start":{"line":110,"column":6},"end":{"line":110,"column":52}},"34":{"start":{"line":111,"column":6},"end":{"line":111,"column":26}},"35":{"start":{"line":117,"column":0},"end":{"line":117,"column":31}},"36":{"start":{"line":119,"column":0},"end":{"line":122,"column":1}},"37":{"start":{"line":120,"column":2},"end":{"line":121,"column":73}}},"branchMap":{"1":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":4},"end":{"line":56,"column":4}},{"start":{"line":56,"column":4},"end":{"line":56,"column":4}}]},"2":{"line":62,"type":"if","locations":[{"start":{"line":62,"column":4},"end":{"line":62,"column":4}},{"start":{"line":62,"column":4},"end":{"line":62,"column":4}}]},"3":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":4},"end":{"line":108,"column":4}},{"start":{"line":108,"column":4},"end":{"line":108,"column":4}}]}},"code":["'use strict';","","const fs = require('fs');","const path = require('path');","const assert = require('assert');","const mkdirp = require('mkdirp');","const utility = require('utility');","const depd = require('depd')('egg-logger');","const Transport = require('./transport');","const utils = require('../utils');","","","/**"," * 将日志输出到文件的 {@link Transport}。"," */","class FileTransport extends Transport {","","  /**","   * @constructor","   * @param {Object} options","   * - {String} file - 日志的文件路径","   * - {String} [level = INFO] - 日志级别","   */","  constructor(options) {","    super(options);","    assert(this.options.file, 'should pass options.file');","","    this._stream = null;","    this.reload();","  }","","  get defaults() {","    return utils.assign(super.defaults, {","      file: null,","      level: 'INFO',","    });","  }","","  /**","   * 重新载入日志文件","   */","  reload() {","    // 关闭原来的 stream","    this._closeStream();","    // 新创建一个 stream","    this._stream = this._createStream();","  }","","  /**","   * 输出日志，见 {@link Transport#log}","   * @param  {String} level - 日志级别","   * @param  {Array} args - 所有的参数","   * @param  {Object} meta - 元信息","   */","  log(level, args, meta) {","    if (!this._stream) {","      const err = new Error(`${this.options.file} log stream had been closed`);","      console.error(err.stack);","      return;","    }","    const buf = super.log(level, args, meta);","    if (buf.length) {","      this._write(buf);","    }","  }","","  /**","   * 关闭 stream","   */","  close() {","    this._closeStream();","  }","","  /**","   * @deprecated","   */","  end() {","    depd('transport.end() is deprecated, use transport.close()');","    this.close();","  }","","  /**","   * 直接写入 stream","   * @param {Buffer|String} buf - 日志内容","   * @private","   */","  _write(buf) {","    this._stream.write(buf);","  }","","  /**","   * 创建一个 stream","   * @return {Stream} 返回一个 writeStream","   * @private","   */","  _createStream() {","    mkdirp.sync(path.dirname(this.options.file));","    const stream = fs.createWriteStream(this.options.file, { flags: 'a' });","    stream.on('error', onError);","    return stream;","  }","","  /**","   * 关闭 stream","   * @private","   */","  _closeStream() {","    if (this._stream) {","      this._stream.end();","      this._stream.removeListener('error', onError);","      this._stream = null;","    }","  }","","}","","module.exports = FileTransport;","","function onError(err) {","  console.error('%s ERROR %s [chair-logger:buffer_write_stream] %s: %s\\n%s',","    utility.logDate(','), process.pid, err.name, err.message, err.stack);","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"25":0,"26":0,"28":0,"29":0,"33":0,"44":0,"46":0,"56":0,"57":0,"58":0,"59":0,"61":0,"62":0,"63":0,"71":0,"78":0,"79":0,"88":0,"97":0,"98":0,"99":0,"100":0,"108":0,"109":0,"110":0,"111":0,"117":1,"119":1,"120":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/transports/console.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/transports/console.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":1,"9":0,"10":0,"11":0,"12":0,"13":1},"b":{"1":[0,1],"2":[0,0],"3":[0,0]},"f":{"1":1,"2":1,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":19,"loc":{"start":{"line":19,"column":13},"end":{"line":19,"column":23}}},"2":{"name":"(anonymous_2)","line":28,"loc":{"start":{"line":28,"column":14},"end":{"line":28,"column":17}}},"3":{"name":"(anonymous_3)","line":40,"loc":{"start":{"line":40,"column":5},"end":{"line":40,"column":25}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":41}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":34}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"4":{"start":{"line":20,"column":4},"end":{"line":20,"column":19}},"5":{"start":{"line":21,"column":4},"end":{"line":21,"column":78}},"6":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"7":{"start":{"line":24,"column":6},"end":{"line":24,"column":69}},"8":{"start":{"line":29,"column":4},"end":{"line":31,"column":7}},"9":{"start":{"line":41,"column":4},"end":{"line":41,"column":45}},"10":{"start":{"line":42,"column":4},"end":{"line":46,"column":5}},"11":{"start":{"line":43,"column":6},"end":{"line":43,"column":32}},"12":{"start":{"line":45,"column":6},"end":{"line":45,"column":32}},"13":{"start":{"line":51,"column":0},"end":{"line":51,"column":34}}},"branchMap":{"1":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":23,"column":4}},{"start":{"line":23,"column":4},"end":{"line":23,"column":4}}]},"2":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":4},"end":{"line":42,"column":4}},{"start":{"line":42,"column":4},"end":{"line":42,"column":4}}]},"3":{"line":42,"type":"binary-expr","locations":[{"start":{"line":42,"column":8},"end":{"line":42,"column":49}},{"start":{"line":42,"column":53},"end":{"line":42,"column":83}}]}},"code":["'use strict';","","const Transport = require('./transport');","const utils = require('../utils');","const levels = require('../level');","","","/**"," * 将日志输出到终端的 {@link Transport}。"," * 如果指定 EGG_LOG 则是优先级最高的 level。"," */","class ConsoleTransport extends Transport {","","  /**","   * @constructor","   * @param {Object} options","   * - {Array} [stderrLevel = ERROR] - 输出到 stderr 的打印级别，必须高于 level","   */","  constructor(options) {","    super(options);","    this.options.stderrLevel = utils.normalizeLevel(this.options.stderrLevel);","    // EGG_LOG 优先级最高","    if (process.env.EGG_LOG) {","      this.options.level = utils.normalizeLevel(process.env.EGG_LOG);","    }","  }","","  get defaults() {","    return utils.assign(super.defaults, {","      stderrLevel: 'ERROR',","    });","  }","","  /**","   * 输出日志，见 {@link Transport#log}，如果指定了 stderrLevel 会将日志转到 stderr","   * @param  {String} level - 日志级别，必须大写","   * @param  {Array} args - 所有的参数","   * @param  {Object} meta - 元信息","   */","  log(level, args, meta) {","    const msg = super.log(level, args, meta);","    if (levels[level] >= this.options.stderrLevel && levels[level] < levels['NONE']) {","      process.stderr.write(msg);","    } else {","      process.stdout.write(msg);","    }","  }","","}","","module.exports = ConsoleTransport;",""],"l":{"3":1,"4":1,"5":1,"20":1,"21":1,"23":1,"24":0,"29":1,"41":0,"42":0,"43":0,"45":0,"51":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/logger.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/logger.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":27,"loc":{"start":{"line":27,"column":13},"end":{"line":27,"column":23}}},"2":{"name":"(anonymous_2)","line":66,"loc":{"start":{"line":66,"column":14},"end":{"line":66,"column":17}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":36}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":34}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":52}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":65}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":58}},"6":{"start":{"line":28,"column":4},"end":{"line":28,"column":19}},"7":{"start":{"line":30,"column":4},"end":{"line":32,"column":5}},"8":{"start":{"line":31,"column":6},"end":{"line":31,"column":79}},"9":{"start":{"line":34,"column":4},"end":{"line":34,"column":96}},"10":{"start":{"line":36,"column":4},"end":{"line":43,"column":7}},"11":{"start":{"line":44,"column":4},"end":{"line":44,"column":36}},"12":{"start":{"line":46,"column":4},"end":{"line":56,"column":5}},"13":{"start":{"line":47,"column":6},"end":{"line":54,"column":9}},"14":{"start":{"line":55,"column":6},"end":{"line":55,"column":46}},"15":{"start":{"line":58,"column":4},"end":{"line":62,"column":7}},"16":{"start":{"line":63,"column":4},"end":{"line":63,"column":42}},"17":{"start":{"line":67,"column":4},"end":{"line":76,"column":6}},"18":{"start":{"line":80,"column":0},"end":{"line":80,"column":27}}},"branchMap":{"1":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":4},"end":{"line":30,"column":4}},{"start":{"line":30,"column":4},"end":{"line":30,"column":4}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":8},"end":{"line":30,"column":40}},{"start":{"line":30,"column":44},"end":{"line":30,"column":61}}]},"3":{"line":34,"type":"cond-expr","locations":[{"start":{"line":34,"column":60},"end":{"line":34,"column":79}},{"start":{"line":34,"column":82},"end":{"line":34,"column":95}}]},"4":{"line":38,"type":"binary-expr","locations":[{"start":{"line":38,"column":13},"end":{"line":38,"column":31}},{"start":{"line":38,"column":35},"end":{"line":38,"column":41}}]},"5":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":46,"column":4}},{"start":{"line":46,"column":4},"end":{"line":46,"column":4}}]}},"code":["'use strict';","","const Logger = require('../logger');","const utils = require('../utils');","const FileTransport = require('../transports/file');","const FileBufferTransport = require('../transports/file_buffer');","const ConsoleTransport = require('../transports/console');","","/**"," * Support three transports: Console, File and JSON File"," */","","class EggLogger extends Logger {","  /**","   * @constructor","   * @param {Object} options","   *  - {String} file - log file","   *  - {String} [encoding = utf8] - log string encoding","   *  - {String} [level = INFO] - file log level","   *  - {String} [consoleLevel = NONE] - console log level","   *  - {Function} [formatter] - log format function","   *  - {String} [jsonFile] - JSON log file","   *  - {Boolean} [outputJSON = false] - send JSON log or not","   *  - {Boolean} [buffer] - use {@link FileBufferTransport} or not","   *  - {String} [eol] - end of line char","   */","  constructor(options) {","    super(options);","","    if (this.options.outputJSON === true && this.options.file) {","      this.options.jsonFile = this.options.file.replace(/\\.log$/, '.json.log');","    }","","    const EggFileTransport = this.options.buffer === true ? FileBufferTransport : FileTransport;","","    const fileTransport = new EggFileTransport({","      file: this.options.file,","      level: this.options.level || 'INFO',","      encoding: this.options.encoding,","      formatter: this.options.formatter,","      flushInterval: this.options.flushInterval,","      eol: this.options.eol,","    });","    this.set('file', fileTransport);","","    if (this.options.jsonFile) {","      const jsonFileTransport = new EggFileTransport({","        file: this.options.jsonFile,","        level: this.options.level,","        encoding: this.options.encoding,","        flushInterval: this.options.flushInterval,","        json: true,","        eol: this.options.eol,","      });","      this.set('jsonFile', jsonFileTransport);","    }","","    const consoleTransport = new ConsoleTransport({","      level: this.options.consoleLevel,","      formatter: utils.consoleFormatter,","      eol: this.options.eol,","    });","    this.set('console', consoleTransport);","  }","","  get defaults() {","    return {","      file: null,","      encoding: 'utf8',","      level: 'INFO',","      consoleLevel: 'NONE',","      formatter: utils.defaultFormatter,","      buffer: true,","      outputJSON: false,","      jsonFile: '',","    };","  }","}","","module.exports = EggLogger;",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"28":0,"30":0,"31":0,"34":0,"36":0,"44":0,"46":0,"47":0,"55":0,"58":0,"63":0,"67":0,"80":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/error_logger.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/error_logger.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":13,"loc":{"start":{"line":13,"column":13},"end":{"line":13,"column":23}}},"2":{"name":"getDefaultLevel","line":23,"loc":{"start":{"line":23,"column":0},"end":{"line":23,"column":32}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":35}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":35}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":34}},"4":{"start":{"line":14,"column":4},"end":{"line":14,"column":28}},"5":{"start":{"line":15,"column":4},"end":{"line":15,"column":51}},"6":{"start":{"line":16,"column":4},"end":{"line":16,"column":65}},"7":{"start":{"line":17,"column":4},"end":{"line":17,"column":19}},"8":{"start":{"line":21,"column":0},"end":{"line":21,"column":29}},"9":{"start":{"line":23,"column":0},"end":{"line":31,"column":1}},"10":{"start":{"line":24,"column":2},"end":{"line":24,"column":38}},"11":{"start":{"line":26,"column":2},"end":{"line":28,"column":3}},"12":{"start":{"line":27,"column":4},"end":{"line":27,"column":24}},"13":{"start":{"line":30,"column":2},"end":{"line":30,"column":53}}},"branchMap":{"1":{"line":14,"type":"binary-expr","locations":[{"start":{"line":14,"column":14},"end":{"line":14,"column":21}},{"start":{"line":14,"column":25},"end":{"line":14,"column":27}}]},"2":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":2}},{"start":{"line":26,"column":2},"end":{"line":26,"column":2}}]},"3":{"line":30,"type":"cond-expr","locations":[{"start":{"line":30,"column":32},"end":{"line":30,"column":37}},{"start":{"line":30,"column":40},"end":{"line":30,"column":52}}]}},"code":["'use strict';","","const Logger = require('./logger');","const levels = require('../level');","const utils = require('../utils');","","","/**"," * Error Logger, only print `ERROR` level log."," * level and consoleLevel should >= `ERROR` level."," */","class ErrorLogger extends Logger {","  constructor(options) {","    options = options || {};","    options.level = getDefaultLevel(options.level);","    options.consoleLevel = getDefaultLevel(options.consoleLevel);","    super(options);","  }","}","","module.exports = ErrorLogger;","","function getDefaultLevel(level) {","  level = utils.normalizeLevel(level);","","  if (level === undefined) {","    return levels.ERROR;","  }","","  return level > levels.ERROR ? level : levels.ERROR;","}",""],"l":{"3":1,"4":1,"5":1,"14":0,"15":0,"16":0,"17":0,"21":1,"23":1,"24":0,"26":0,"27":0,"30":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/console_logger.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/console_logger.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":1},"b":{"1":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":17,"loc":{"start":{"line":17,"column":13},"end":{"line":17,"column":23}}},"2":{"name":"(anonymous_2)","line":26,"loc":{"start":{"line":26,"column":14},"end":{"line":26,"column":17}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":36}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":58}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":34}},"4":{"start":{"line":18,"column":4},"end":{"line":18,"column":19}},"5":{"start":{"line":20,"column":4},"end":{"line":23,"column":8}},"6":{"start":{"line":27,"column":4},"end":{"line":30,"column":6}},"7":{"start":{"line":35,"column":0},"end":{"line":35,"column":31}}},"branchMap":{"1":{"line":29,"type":"cond-expr","locations":[{"start":{"line":29,"column":53},"end":{"line":29,"column":59}},{"start":{"line":29,"column":62},"end":{"line":29,"column":68}}]}},"code":["'use strict';","","const Logger = require('../logger');","const ConsoleTransport = require('../transports/console');","const utils = require('../utils');","","/**"," * Terminal Logger, send log to console."," */","class ConsoleLogger extends Logger {","","  /**","   * @constructor","   * @param {Object} options","   * - {String} [encoding] - log string encoding, default is 'utf8'","   */","  constructor(options) {","    super(options);","","    this.set('console', new ConsoleTransport({","      level: this.options.level,","      formatter: utils.consoleFormatter,","    }));","  }","","  get defaults() {","    return {","      encoding: 'utf8',","      level: process.env.NODE_ENV === 'production' ? 'INFO' : 'WARN',","    };","  }","","}","","module.exports = ConsoleLogger;",""],"l":{"3":1,"4":1,"5":1,"18":0,"20":0,"27":0,"35":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/custom_logger.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/custom_logger.js","s":{"1":1,"2":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":35}},"2":{"start":{"line":10,"column":0},"end":{"line":10,"column":30}}},"branchMap":{},"code":["'use strict';","","const Logger = require('./logger');","","/**"," * Custom Logger"," */","class CustomLogger extends Logger {}","","module.exports = CustomLogger;",""],"l":{"3":1,"10":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/context_logger.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/context_logger.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":1,"10":4,"11":4,"12":0,"13":0,"14":1,"15":1,"16":0},"b":{"1":[0,0],"2":[0,0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"(anonymous_1)","line":13,"loc":{"start":{"line":13,"column":13},"end":{"line":13,"column":27}}},"2":{"name":"(anonymous_2)","line":18,"loc":{"start":{"line":18,"column":20},"end":{"line":18,"column":23}}},"3":{"name":"(anonymous_3)","line":36,"loc":{"start":{"line":36,"column":7},"end":{"line":36,"column":13}}},"4":{"name":"(anonymous_4)","line":43,"loc":{"start":{"line":43,"column":35},"end":{"line":43,"column":46}}},"5":{"name":"contextFormatter","line":54,"loc":{"start":{"line":54,"column":0},"end":{"line":54,"column":32}}}},"statementMap":{"1":{"start":{"line":14,"column":4},"end":{"line":14,"column":19}},"2":{"start":{"line":15,"column":4},"end":{"line":15,"column":26}},"3":{"start":{"line":19,"column":4},"end":{"line":19,"column":25}},"4":{"start":{"line":23,"column":4},"end":{"line":23,"column":37}},"5":{"start":{"line":24,"column":4},"end":{"line":24,"column":60}},"6":{"start":{"line":25,"column":4},"end":{"line":25,"column":63}},"7":{"start":{"line":26,"column":4},"end":{"line":33,"column":8}},"8":{"start":{"line":37,"column":4},"end":{"line":37,"column":28}},"9":{"start":{"line":41,"column":0},"end":{"line":50,"column":3}},"10":{"start":{"line":42,"column":2},"end":{"line":42,"column":36}},"11":{"start":{"line":43,"column":2},"end":{"line":49,"column":4}},"12":{"start":{"line":44,"column":4},"end":{"line":47,"column":6}},"13":{"start":{"line":48,"column":4},"end":{"line":48,"column":45}},"14":{"start":{"line":52,"column":0},"end":{"line":52,"column":31}},"15":{"start":{"line":54,"column":0},"end":{"line":56,"column":1}},"16":{"start":{"line":55,"column":2},"end":{"line":55,"column":104}}},"branchMap":{"1":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":19},"end":{"line":23,"column":29}},{"start":{"line":23,"column":33},"end":{"line":23,"column":36}}]},"2":{"line":24,"type":"binary-expr","locations":[{"start":{"line":24,"column":20},"end":{"line":24,"column":30}},{"start":{"line":24,"column":34},"end":{"line":24,"column":52}},{"start":{"line":24,"column":56},"end":{"line":24,"column":59}}]},"3":{"line":25,"type":"cond-expr","locations":[{"start":{"line":25,"column":32},"end":{"line":25,"column":58}},{"start":{"line":25,"column":61},"end":{"line":25,"column":62}}]}},"code":["'use strict';","","/**"," * Request context Logger, itself isn't a {@link Logger}."," */","class ContextLogger {","","  /**","   * @constructor","   * @param {Context} ctx - egg Context instance","   * @param {Logger} logger - Logger instance","   */","  constructor(ctx, logger) {","    this.ctx = ctx;","    this._logger = logger;","  }","","  get paddingMessage() {","    const ctx = this.ctx;","","    // Auto record necessary request context infomation, e.g.: user id, request spend time","    // format: '[$userId/$ip/$traceId/$use_ms $method $url]'","    const userId = ctx.userId || '-';","    const traceId = ctx.tracer && ctx.tracer.traceId || '-';","    const use = ctx.starttime ? Date.now() - ctx.starttime : 0;","    return '[' +","      userId + '/' +","      ctx.ip + '/' +","      traceId + '/' +","      use + 'ms ' +","      ctx.method + ' ' +","      ctx.url +","    ']';","  }","","  write(msg) {","    this._logger.write(msg);","  }","}","","[ 'error', 'warn', 'info', 'debug' ].forEach(level => {","  const LEVEL = level.toUpperCase();","  ContextLogger.prototype[level] = function() {","    const meta = {","      formatter: contextFormatter,","      paddingMessage: this.paddingMessage,","    };","    this._logger.log(LEVEL, arguments, meta);","  };","});","","module.exports = ContextLogger;","","function contextFormatter(meta) {","  return meta.date + ' ' + meta.level + ' ' + meta.pid + ' ' + meta.paddingMessage + ' ' + meta.message;","}",""],"l":{"14":0,"15":0,"19":0,"23":0,"24":0,"25":0,"26":0,"37":0,"41":1,"42":4,"43":4,"44":0,"48":0,"52":1,"54":1,"55":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/loggers.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-logger/lib/egg/loggers.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"(anonymous_1)","line":52,"loc":{"start":{"line":52,"column":13},"end":{"line":52,"column":22}}},"2":{"name":"(anonymous_2)","line":102,"loc":{"start":{"line":102,"column":16},"end":{"line":102,"column":19}}},"3":{"name":"(anonymous_3)","line":108,"loc":{"start":{"line":108,"column":8},"end":{"line":108,"column":11}}},"4":{"name":"(anonymous_4)","line":119,"loc":{"start":{"line":119,"column":5},"end":{"line":119,"column":20}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":45}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":34}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":35}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":46}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":48}},"8":{"start":{"line":12,"column":0},"end":{"line":25,"column":2}},"9":{"start":{"line":53,"column":4},"end":{"line":53,"column":12}},"10":{"start":{"line":55,"column":4},"end":{"line":55,"column":67}},"11":{"start":{"line":56,"column":4},"end":{"line":56,"column":51}},"12":{"start":{"line":58,"column":4},"end":{"line":58,"column":56}},"13":{"start":{"line":59,"column":4},"end":{"line":59,"column":64}},"14":{"start":{"line":60,"column":4},"end":{"line":60,"column":62}},"15":{"start":{"line":61,"column":4},"end":{"line":61,"column":76}},"16":{"start":{"line":62,"column":4},"end":{"line":62,"column":78}},"17":{"start":{"line":63,"column":4},"end":{"line":63,"column":80}},"18":{"start":{"line":64,"column":4},"end":{"line":64,"column":80}},"19":{"start":{"line":66,"column":4},"end":{"line":68,"column":8}},"20":{"start":{"line":69,"column":4},"end":{"line":69,"column":41}},"21":{"start":{"line":71,"column":4},"end":{"line":91,"column":5}},"22":{"start":{"line":72,"column":6},"end":{"line":74,"column":10}},"23":{"start":{"line":75,"column":6},"end":{"line":75,"column":33}},"24":{"start":{"line":77,"column":6},"end":{"line":79,"column":10}},"25":{"start":{"line":80,"column":6},"end":{"line":80,"column":41}},"26":{"start":{"line":82,"column":6},"end":{"line":84,"column":10}},"27":{"start":{"line":85,"column":6},"end":{"line":85,"column":33}},"28":{"start":{"line":87,"column":6},"end":{"line":89,"column":10}},"29":{"start":{"line":90,"column":6},"end":{"line":90,"column":41}},"30":{"start":{"line":93,"column":4},"end":{"line":96,"column":5}},"31":{"start":{"line":94,"column":6},"end":{"line":94,"column":96}},"32":{"start":{"line":95,"column":6},"end":{"line":95,"column":29}},"33":{"start":{"line":103,"column":4},"end":{"line":105,"column":5}},"34":{"start":{"line":104,"column":6},"end":{"line":104,"column":32}},"35":{"start":{"line":109,"column":4},"end":{"line":111,"column":5}},"36":{"start":{"line":110,"column":6},"end":{"line":110,"column":22}},"37":{"start":{"line":120,"column":4},"end":{"line":122,"column":5}},"38":{"start":{"line":121,"column":6},"end":{"line":121,"column":13}},"39":{"start":{"line":125,"column":4},"end":{"line":127,"column":5}},"40":{"start":{"line":126,"column":6},"end":{"line":126,"column":49}},"41":{"start":{"line":128,"column":4},"end":{"line":128,"column":24}},"42":{"start":{"line":129,"column":4},"end":{"line":129,"column":28}},"43":{"start":{"line":134,"column":0},"end":{"line":134,"column":25}}},"branchMap":{"1":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":71,"column":4}},{"start":{"line":71,"column":4},"end":{"line":71,"column":4}}]},"2":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":4},"end":{"line":120,"column":4}},{"start":{"line":120,"column":4},"end":{"line":120,"column":4}}]},"3":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":4},"end":{"line":125,"column":4}},{"start":{"line":125,"column":4},"end":{"line":125,"column":4}}]}},"code":["'use strict';","","const path = require('path');","const assert = require('assert');","const debug = require('debug')('egg:logger');","const utils = require('../utils');","const Logger = require('./logger');","const ErrorLogger = require('./error_logger');","const CustomLogger = require('./custom_logger');","","","const defaults = {","  env: 'default',","  type: '',","  dir: '',","  encoding: 'utf8',","  level: 'INFO',","  consoleLevel: 'NONE',","  outputJSON: false,","  buffer: true,","  appLogName: '',","  coreLogName: '',","  agentLogName: '',","  errorLogName: '',","};","","/**"," * Logger Manager, accord config to create multi loggers."," */","","class Loggers extends Map {","","  /**","   * @constructor","   * @param  {Object} config - egg app config","   * - logger","   *   - {String} env - egg app runtime env string, detail please see `app.config.env`","   *   - {String} type - current process type, `application` or `agent`","   *   - {String} dir - log file dir","   *   - {String} [encoding = utf8] - log string encoding","   *   - {String} [level = INFO] - file log level","   *   - {String} [consoleLevel = NONE] - console log level","   *   - {Boolean} [outputJSON = false] - send JSON log or not","   *   - {Boolean} [buffer = true] - use {@link FileBufferTransport} or not","   *   - {String} appLogName - egg app file logger name","   *   - {String} coreLogName - egg core file logger name","   *   - {String} agentLogName - egg agent file logger name","   *   - {String} errorLogName - err common error logger name","   *   - {String} eol - end of line char","   * - customLogger","   */","  constructor(config) {","    super();","","    const loggerConfig = utils.assign({}, defaults, config.logger);","    const customLoggerConfig = config.customLogger;","","    debug('Init loggers with options %j', loggerConfig);","    assert(loggerConfig.type, 'should pass config.logger.type');","    assert(loggerConfig.dir, 'should pass config.logger.dir');","    assert(loggerConfig.appLogName, 'should pass config.logger.appLogName');","    assert(loggerConfig.coreLogName, 'should pass config.logger.coreLogName');","    assert(loggerConfig.agentLogName, 'should pass config.logger.agentLogName');","    assert(loggerConfig.errorLogName, 'should pass config.logger.errorLogName');","","    const errorLogger = new ErrorLogger(utils.assign({}, loggerConfig, {","      file: path.join(loggerConfig.dir, loggerConfig.errorLogName),","    }));","    this.set('errorLogger', errorLogger);","","    if (loggerConfig.type === 'agent') {","      const logger = new Logger(utils.assign({}, loggerConfig, {","        file: path.join(loggerConfig.dir, loggerConfig.agentLogName),","      }));","      this.set('logger', logger);","","      const coreLogger = new Logger(utils.assign({}, loggerConfig, loggerConfig.coreLogger, {","        file: path.join(loggerConfig.dir, loggerConfig.agentLogName),","      }));","      this.set('coreLogger', coreLogger);","    } else {","      const logger = new Logger(utils.assign({}, loggerConfig, {","        file: path.join(loggerConfig.dir, loggerConfig.appLogName),","      }));","      this.set('logger', logger);","","      const coreLogger = new Logger(utils.assign({}, loggerConfig, loggerConfig.coreLogger, {","        file: path.join(loggerConfig.dir, loggerConfig.coreLogName),","      }));","      this.set('coreLogger', coreLogger);","    }","","    for (const name in customLoggerConfig) {","      const logger = new CustomLogger(utils.assign({}, loggerConfig, customLoggerConfig[name]));","      this.set(name, logger);","    }","  }","","  /**","   * Disable console logger","   */","  disableConsole() {","    for (const logger of this.values()) {","      logger.disable('console');","    }","  }","","  reload() {","    for (const logger of this.values()) {","      logger.reload();","    }","  }","","  /**","   * Add a logger","   * @param {String} name - logger name","   * @param {Logger} logger - Logger instance","   */","  set(name, logger) {","    if (this.has(name)) {","      return;","    }","","    // redirect ERROR log to errorLogger, except errorLogger itself","    if (name !== 'errorLogger') {","      logger.redirect('error', this.errorLogger);","    }","    this[name] = logger;","    super.set(name, logger);","  }","","}","","module.exports = Loggers;",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"12":1,"53":0,"55":0,"56":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"66":0,"69":0,"71":0,"72":0,"75":0,"77":0,"80":0,"82":0,"85":0,"87":0,"90":0,"93":0,"94":0,"95":0,"103":0,"104":0,"109":0,"110":0,"120":0,"121":0,"125":0,"126":0,"128":0,"129":0,"134":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cluster/lib/utils/options.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cluster/lib/utils/options.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":10,"loc":{"start":{"line":10,"column":17},"end":{"line":10,"column":35}}},"2":{"name":"extend","line":56,"loc":{"start":{"line":56,"column":0},"end":{"line":56,"column":29}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":25}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":29}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":33}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":35}},"6":{"start":{"line":10,"column":0},"end":{"line":54,"column":2}},"7":{"start":{"line":11,"column":2},"end":{"line":20,"column":4}},"8":{"start":{"line":21,"column":2},"end":{"line":21,"column":38}},"9":{"start":{"line":22,"column":2},"end":{"line":24,"column":3}},"10":{"start":{"line":23,"column":4},"end":{"line":23,"column":39}},"11":{"start":{"line":26,"column":2},"end":{"line":26,"column":61}},"12":{"start":{"line":27,"column":2},"end":{"line":27,"column":60}},"13":{"start":{"line":29,"column":2},"end":{"line":33,"column":5}},"14":{"start":{"line":35,"column":2},"end":{"line":35,"column":41}},"15":{"start":{"line":36,"column":2},"end":{"line":36,"column":79}},"16":{"start":{"line":37,"column":2},"end":{"line":37,"column":67}},"17":{"start":{"line":39,"column":2},"end":{"line":42,"column":3}},"18":{"start":{"line":40,"column":4},"end":{"line":40,"column":83}},"19":{"start":{"line":41,"column":4},"end":{"line":41,"column":86}},"20":{"start":{"line":44,"column":2},"end":{"line":44,"column":44}},"21":{"start":{"line":45,"column":2},"end":{"line":45,"column":50}},"22":{"start":{"line":49,"column":2},"end":{"line":51,"column":3}},"23":{"start":{"line":50,"column":4},"end":{"line":50,"column":37}},"24":{"start":{"line":53,"column":2},"end":{"line":53,"column":17}},"25":{"start":{"line":56,"column":0},"end":{"line":64,"column":1}},"26":{"start":{"line":57,"column":2},"end":{"line":57,"column":32}},"27":{"start":{"line":58,"column":2},"end":{"line":62,"column":3}},"28":{"start":{"line":59,"column":4},"end":{"line":61,"column":5}},"29":{"start":{"line":60,"column":6},"end":{"line":60,"column":29}},"30":{"start":{"line":63,"column":2},"end":{"line":63,"column":16}}},"branchMap":{"1":{"line":14,"type":"cond-expr","locations":[{"start":{"line":14,"column":26},"end":{"line":14,"column":30}},{"start":{"line":14,"column":33},"end":{"line":14,"column":37}}]},"2":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":2},"end":{"line":22,"column":2}},{"start":{"line":22,"column":2},"end":{"line":22,"column":2}}]},"3":{"line":32,"type":"binary-expr","locations":[{"start":{"line":32,"column":15},"end":{"line":32,"column":32}},{"start":{"line":32,"column":36},"end":{"line":32,"column":53}}]},"4":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":2},"end":{"line":39,"column":2}},{"start":{"line":39,"column":2},"end":{"line":39,"column":2}}]},"5":{"line":40,"type":"binary-expr","locations":[{"start":{"line":40,"column":11},"end":{"line":40,"column":22}},{"start":{"line":40,"column":26},"end":{"line":40,"column":52}}]},"6":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":11},"end":{"line":41,"column":23}},{"start":{"line":41,"column":27},"end":{"line":41,"column":54}}]},"7":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":2},"end":{"line":49,"column":2}},{"start":{"line":49,"column":2},"end":{"line":49,"column":2}}]},"8":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":4},"end":{"line":59,"column":4}},{"start":{"line":59,"column":4},"end":{"line":59,"column":4}}]}},"code":["'use strict';","","const os = require('os');","const fs = require('fs');","const path = require('path');","const assert = require('assert');","const utils = require('egg-utils');","","","module.exports = function(options) {","  const defaults = {","    framework: '',","    baseDir: process.cwd(),","    port: options.https ? 8443 : 7001,","    workers: null,","    plugins: null,","    https: false,","    key: '',","    cert: '',","  };","  options = extend(defaults, options);","  if (!options.workers) {","    options.workers = os.cpus().length;","  }","","  const pkgPath = path.join(options.baseDir, 'package.json');","  assert(fs.existsSync(pkgPath), `${pkgPath} should exist`);","","  options.framework = utils.getFrameworkPath({","    baseDir: options.baseDir,","    // compatible customEgg only when call startCluster directly without framework","    framework: options.framework || options.customEgg,","  });","","  const egg = require(options.framework);","  assert(egg.Application, `should define Application in ${options.framework}`);","  assert(egg.Agent, `should define Agent in ${options.framework}`);","","  if (options.https) {","    assert(options.key && fs.existsSync(options.key), 'options.key should exists');","    assert(options.cert && fs.existsSync(options.cert), 'options.cert should exists');","  }","","  options.port = parseInt(options.port, 10);","  options.workers = parseInt(options.workers, 10);","","  // don't print depd message in production env.","  // it will print to stderr.","  if (process.env.NODE_ENV === 'production') {","    process.env.NO_DEPRECATION = '*';","  }","","  return options;","};","","function extend(target, src) {","  const keys = Object.keys(src);","  for (const key of keys) {","    if (src[key] != null) {","      target[key] = src[key];","    }","  }","  return target;","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"10":1,"11":0,"21":0,"22":0,"23":0,"26":0,"27":0,"29":0,"35":0,"36":0,"37":0,"39":0,"40":0,"41":0,"44":0,"45":0,"49":0,"50":0,"53":0,"56":1,"57":0,"58":0,"59":0,"60":0,"63":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-utils/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-utils/index.js","s":{"1":1,"2":1,"3":1,"4":2,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"getFrameworkOrEggPath","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":46}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":6,"column":0},"end":{"line":10,"column":45}},"4":{"start":{"line":10,"column":16},"end":{"line":10,"column":43}},"5":{"start":{"line":21,"column":0},"end":{"line":65,"column":1}},"6":{"start":{"line":22,"column":2},"end":{"line":22,"column":35}},"7":{"start":{"line":23,"column":2},"end":{"line":23,"column":51}},"8":{"start":{"line":24,"column":2},"end":{"line":26,"column":3}},"9":{"start":{"line":25,"column":4},"end":{"line":25,"column":14}},"10":{"start":{"line":31,"column":2},"end":{"line":31,"column":49}},"11":{"start":{"line":32,"column":2},"end":{"line":37,"column":3}},"12":{"start":{"line":33,"column":4},"end":{"line":33,"column":33}},"13":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"14":{"start":{"line":35,"column":6},"end":{"line":35,"column":53}},"15":{"start":{"line":40,"column":2},"end":{"line":40,"column":42}},"16":{"start":{"line":41,"column":2},"end":{"line":54,"column":3}},"17":{"start":{"line":42,"column":4},"end":{"line":42,"column":63}},"18":{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},"19":{"start":{"line":44,"column":6},"end":{"line":44,"column":15}},"20":{"start":{"line":46,"column":4},"end":{"line":46,"column":33}},"21":{"start":{"line":47,"column":4},"end":{"line":53,"column":5}},"22":{"start":{"line":48,"column":6},"end":{"line":52,"column":7}},"23":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"24":{"start":{"line":50,"column":10},"end":{"line":50,"column":44}},"25":{"start":{"line":57,"column":2},"end":{"line":62,"column":3}},"26":{"start":{"line":58,"column":4},"end":{"line":58,"column":66}},"27":{"start":{"line":59,"column":4},"end":{"line":61,"column":5}},"28":{"start":{"line":60,"column":6},"end":{"line":60,"column":43}},"29":{"start":{"line":64,"column":2},"end":{"line":64,"column":12}}},"branchMap":{"1":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":13},"end":{"line":22,"column":21}},{"start":{"line":22,"column":25},"end":{"line":22,"column":34}}]},"2":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":24,"column":2}},{"start":{"line":24,"column":2},"end":{"line":24,"column":2}}]},"3":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":32,"column":2}},{"start":{"line":32,"column":2},"end":{"line":32,"column":2}}]},"4":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":34,"column":4}},{"start":{"line":34,"column":4},"end":{"line":34,"column":4}}]},"5":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":8},"end":{"line":34,"column":15}},{"start":{"line":34,"column":19},"end":{"line":34,"column":36}}]},"6":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":4}},{"start":{"line":43,"column":4},"end":{"line":43,"column":4}}]},"7":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":47,"column":4}},{"start":{"line":47,"column":4},"end":{"line":47,"column":4}}]},"8":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":8}},{"start":{"line":49,"column":8},"end":{"line":49,"column":8}}]},"9":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":4},"end":{"line":59,"column":4}},{"start":{"line":59,"column":4},"end":{"line":59,"column":4}}]}},"code":["'use strict';","","const fs = require('fs');","const path = require('path');","","[","  require('./lib/framework'),","  { getFrameworkOrEggPath },","]",".forEach(obj => Object.assign(exports, obj));","","/**"," * Try to get framework dir path"," * If can't find any framework, try to find egg dir path"," *"," * @param {String} cwd - current work path"," * @param {Array} [eggNames] - egg names, default is ['egg']"," * @return {String} framework or egg dir path"," * @deprecated"," */","function getFrameworkOrEggPath(cwd, eggNames) {","  eggNames = eggNames || [ 'egg' ];","  const moduleDir = path.join(cwd, 'node_modules');","  if (!fs.existsSync(moduleDir)) {","    return '';","  }","","  // try to get framework","","  // 1. try to read egg.framework property on package.json","  const pkgFile = path.join(cwd, 'package.json');","  if (fs.existsSync(pkgFile)) {","    const pkg = require(pkgFile);","    if (pkg.egg && pkg.egg.framework) {","      return path.join(moduleDir, pkg.egg.framework);","    }","  }","","  // 2. try the module dependencies includes eggNames","  const names = fs.readdirSync(moduleDir);","  for (const name of names) {","    const pkgfile = path.join(moduleDir, name, 'package.json');","    if (!fs.existsSync(pkgfile)) {","      continue;","    }","    const pkg = require(pkgfile);","    if (pkg.dependencies) {","      for (const eggName of eggNames) {","        if (pkg.dependencies[eggName]) {","          return path.join(moduleDir, name);","        }","      }","    }","  }","","  // try to get egg","  for (const eggName of eggNames) {","    const pkgfile = path.join(moduleDir, eggName, 'package.json');","    if (fs.existsSync(pkgfile)) {","      return path.join(moduleDir, eggName);","    }","  }","","  return '';","}",""],"l":{"3":1,"4":1,"6":1,"10":2,"21":1,"22":0,"23":0,"24":0,"25":0,"31":0,"32":0,"33":0,"34":0,"35":0,"40":0,"41":0,"42":0,"43":0,"44":0,"46":0,"47":0,"48":0,"49":0,"50":0,"57":0,"58":0,"59":0,"60":0,"64":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-utils/lib/framework.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-utils/lib/framework.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"getFrameworkPath","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":50}}},"2":{"name":"assertAndReturn","line":51,"loc":{"start":{"line":51,"column":0},"end":{"line":51,"column":51}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":25}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":30}},"5":{"start":{"line":9,"column":0},"end":{"line":9,"column":38}},"6":{"start":{"line":21,"column":0},"end":{"line":49,"column":1}},"7":{"start":{"line":22,"column":2},"end":{"line":22,"column":53}},"8":{"start":{"line":23,"column":2},"end":{"line":23,"column":60}},"9":{"start":{"line":25,"column":2},"end":{"line":25,"column":55}},"10":{"start":{"line":26,"column":2},"end":{"line":26,"column":31}},"11":{"start":{"line":29,"column":2},"end":{"line":39,"column":3}},"12":{"start":{"line":32,"column":4},"end":{"line":35,"column":5}},"13":{"start":{"line":33,"column":6},"end":{"line":33,"column":68}},"14":{"start":{"line":34,"column":6},"end":{"line":34,"column":23}},"15":{"start":{"line":38,"column":4},"end":{"line":38,"column":49}},"16":{"start":{"line":43,"column":2},"end":{"line":45,"column":3}},"17":{"start":{"line":44,"column":4},"end":{"line":44,"column":57}},"18":{"start":{"line":48,"column":2},"end":{"line":48,"column":43}},"19":{"start":{"line":51,"column":0},"end":{"line":66,"column":1}},"20":{"start":{"line":52,"column":2},"end":{"line":60,"column":5}},"21":{"start":{"line":61,"column":2},"end":{"line":64,"column":3}},"22":{"start":{"line":62,"column":4},"end":{"line":62,"column":62}},"23":{"start":{"line":63,"column":4},"end":{"line":63,"column":59}},"24":{"start":{"line":63,"column":38},"end":{"line":63,"column":59}},"25":{"start":{"line":65,"column":2},"end":{"line":65,"column":80}}},"branchMap":{"1":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":2},"end":{"line":29,"column":2}},{"start":{"line":29,"column":2},"end":{"line":29,"column":2}}]},"2":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":4},"end":{"line":32,"column":4}},{"start":{"line":32,"column":4},"end":{"line":32,"column":4}}]},"3":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":2}},{"start":{"line":43,"column":2},"end":{"line":43,"column":2}}]},"4":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":6},"end":{"line":43,"column":13}},{"start":{"line":43,"column":17},"end":{"line":43,"column":34}}]},"5":{"line":63,"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":63,"column":4}},{"start":{"line":63,"column":4},"end":{"line":63,"column":4}}]}},"code":["'use strict';","","const path = require('path');","const assert = require('assert');","const fs = require('fs');","","const initCwd = process.cwd();","","module.exports = { getFrameworkPath };","","/**"," * Find the framework directory, lookup order"," * - specify framework path"," * - get framework name from"," * - use egg by default"," * @param {Object} options - options"," * @param  {String} options.baseDir - the current directory of application"," * @param  {String} [options.framework] - the directory of framework"," * @return {String} frameworkPath"," */","function getFrameworkPath({ framework, baseDir }) {","  const pkgPath = path.join(baseDir, 'package.json');","  assert(fs.existsSync(pkgPath), `${pkgPath} should exist`);","","  const moduleDir = path.join(baseDir, 'node_modules');","  const pkg = require(pkgPath);","","  // 1. pass framework or customEgg","  if (framework) {","    // 1.1 framework is an absolute path","    // framework: path.join(baseDir, 'node_modules/${frameworkName}')","    if (path.isAbsolute(framework)) {","      assert(fs.existsSync(framework), `${framework} should exist`);","      return framework;","    }","    // 1.2 framework is a npm package that required by application","    // framework: 'frameworkName'","    return assertAndReturn(framework, moduleDir);","  }","","  // 2. framework is not specified","  // 2.1 use framework name from pkg.egg.framework","  if (pkg.egg && pkg.egg.framework) {","    return assertAndReturn(pkg.egg.framework, moduleDir);","  }","","  // 2.2 use egg by default","  return assertAndReturn('egg', moduleDir);","}","","function assertAndReturn(frameworkName, moduleDir) {","  const moduleDirs = new Set([","    moduleDir,","    // find framework from process.cwd, especially for test,","    // the application is in test/fixtures/app,","    // and framework is install in ${cwd}/node_modules","    path.join(process.cwd(), 'node_modules'),","    // prevent from mocking process.cwd","    path.join(initCwd, 'node_modules'),","  ]);","  for (const moduleDir of moduleDirs) {","    const frameworkPath = path.join(moduleDir, frameworkName);","    if (fs.existsSync(frameworkPath)) return frameworkPath;","  }","  throw new Error(`${frameworkName} is not found in ${Array.from(moduleDirs)}`);","}",""],"l":{"3":1,"4":1,"5":1,"7":1,"9":1,"21":1,"22":0,"23":0,"25":0,"26":0,"29":0,"32":0,"33":0,"34":0,"38":0,"43":0,"44":0,"48":0,"51":1,"52":0,"61":0,"62":0,"63":0,"65":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cluster/lib/utils/messenger.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cluster/lib/utils/messenger.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"(anonymous_1)","line":56,"loc":{"start":{"line":56,"column":13},"end":{"line":56,"column":22}}},"2":{"name":"(anonymous_2)","line":70,"loc":{"start":{"line":70,"column":6},"end":{"line":70,"column":13}}},"3":{"name":"(anonymous_3)","line":121,"loc":{"start":{"line":121,"column":14},"end":{"line":121,"column":21}}},"4":{"name":"(anonymous_4)","line":129,"loc":{"start":{"line":129,"column":14},"end":{"line":129,"column":21}}},"5":{"name":"(anonymous_5)","line":137,"loc":{"start":{"line":137,"column":17},"end":{"line":137,"column":24}}},"6":{"name":"(anonymous_6)","line":155,"loc":{"start":{"line":155,"column":19},"end":{"line":155,"column":26}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":35}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":43}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":56}},"4":{"start":{"line":57,"column":4},"end":{"line":57,"column":25}},"5":{"start":{"line":58,"column":4},"end":{"line":61,"column":7}},"6":{"start":{"line":59,"column":6},"end":{"line":59,"column":26}},"7":{"start":{"line":60,"column":6},"end":{"line":60,"column":21}},"8":{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},"9":{"start":{"line":72,"column":6},"end":{"line":72,"column":27}},"10":{"start":{"line":76,"column":4},"end":{"line":80,"column":5}},"11":{"start":{"line":77,"column":6},"end":{"line":77,"column":49}},"12":{"start":{"line":77,"column":33},"end":{"line":77,"column":49}},"13":{"start":{"line":78,"column":6},"end":{"line":78,"column":49}},"14":{"start":{"line":78,"column":31},"end":{"line":78,"column":49}},"15":{"start":{"line":79,"column":6},"end":{"line":79,"column":53}},"16":{"start":{"line":79,"column":34},"end":{"line":79,"column":53}},"17":{"start":{"line":84,"column":4},"end":{"line":89,"column":5}},"18":{"start":{"line":85,"column":6},"end":{"line":85,"column":55}},"19":{"start":{"line":87,"column":6},"end":{"line":87,"column":30}},"20":{"start":{"line":88,"column":6},"end":{"line":88,"column":13}},"21":{"start":{"line":94,"column":4},"end":{"line":98,"column":5}},"22":{"start":{"line":95,"column":6},"end":{"line":95,"column":55}},"23":{"start":{"line":96,"column":6},"end":{"line":96,"column":30}},"24":{"start":{"line":97,"column":6},"end":{"line":97,"column":13}},"25":{"start":{"line":102,"column":4},"end":{"line":106,"column":5}},"26":{"start":{"line":103,"column":6},"end":{"line":103,"column":60}},"27":{"start":{"line":104,"column":6},"end":{"line":104,"column":33}},"28":{"start":{"line":105,"column":6},"end":{"line":105,"column":13}},"29":{"start":{"line":110,"column":4},"end":{"line":114,"column":5}},"30":{"start":{"line":111,"column":6},"end":{"line":111,"column":60}},"31":{"start":{"line":112,"column":6},"end":{"line":112,"column":35}},"32":{"start":{"line":113,"column":6},"end":{"line":113,"column":13}},"33":{"start":{"line":122,"column":4},"end":{"line":122,"column":45}},"34":{"start":{"line":130,"column":4},"end":{"line":130,"column":39}},"35":{"start":{"line":138,"column":4},"end":{"line":148,"column":5}},"36":{"start":{"line":139,"column":6},"end":{"line":139,"column":41}},"37":{"start":{"line":140,"column":6},"end":{"line":142,"column":7}},"38":{"start":{"line":141,"column":8},"end":{"line":141,"column":17}},"39":{"start":{"line":144,"column":6},"end":{"line":146,"column":7}},"40":{"start":{"line":145,"column":8},"end":{"line":145,"column":17}},"41":{"start":{"line":147,"column":6},"end":{"line":147,"column":32}},"42":{"start":{"line":156,"column":4},"end":{"line":158,"column":5}},"43":{"start":{"line":157,"column":6},"end":{"line":157,"column":49}},"44":{"start":{"line":163,"column":0},"end":{"line":163,"column":27}}},"branchMap":{"1":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":71,"column":4}},{"start":{"line":71,"column":4},"end":{"line":71,"column":4}}]},"2":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":4},"end":{"line":76,"column":4}},{"start":{"line":76,"column":4},"end":{"line":76,"column":4}}]},"3":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":6},"end":{"line":77,"column":6}},{"start":{"line":77,"column":6},"end":{"line":77,"column":6}}]},"4":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":6},"end":{"line":78,"column":6}},{"start":{"line":78,"column":6},"end":{"line":78,"column":6}}]},"5":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":6},"end":{"line":79,"column":6}},{"start":{"line":79,"column":6},"end":{"line":79,"column":6}}]},"6":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":4},"end":{"line":84,"column":4}},{"start":{"line":84,"column":4},"end":{"line":84,"column":4}}]},"7":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":4},"end":{"line":94,"column":4}},{"start":{"line":94,"column":4},"end":{"line":94,"column":4}}]},"8":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":4},"end":{"line":102,"column":4}},{"start":{"line":102,"column":4},"end":{"line":102,"column":4}}]},"9":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":4},"end":{"line":110,"column":4}},{"start":{"line":110,"column":4},"end":{"line":110,"column":4}}]},"10":{"line":130,"type":"binary-expr","locations":[{"start":{"line":130,"column":4},"end":{"line":130,"column":16}},{"start":{"line":130,"column":20},"end":{"line":130,"column":38}}]},"11":{"line":140,"type":"if","locations":[{"start":{"line":140,"column":6},"end":{"line":140,"column":6}},{"start":{"line":140,"column":6},"end":{"line":140,"column":6}}]},"12":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":6},"end":{"line":144,"column":6}},{"start":{"line":144,"column":6},"end":{"line":144,"column":6}}]},"13":{"line":144,"type":"binary-expr","locations":[{"start":{"line":144,"column":10},"end":{"line":144,"column":26}},{"start":{"line":144,"column":30},"end":{"line":144,"column":77}}]},"14":{"line":156,"type":"if","locations":[{"start":{"line":156,"column":4},"end":{"line":156,"column":4}},{"start":{"line":156,"column":4},"end":{"line":156,"column":4}}]}},"code":["'use strict';","","const cluster = require('cluster');","const sendmessage = require('sendmessage');","const debug = require('debug')('egg-cluster:messenger');","","","/**"," * master messenger,provide communication between parent, master, agent and app."," *"," *             ┌────────┐"," *             │ parent │"," *            /└────────┘\\"," *           /     |      \\"," *          /  ┌────────┐  \\"," *         /   │ master │   \\"," *        /    └────────┘    \\"," *       /     /         \\    \\"," *     ┌───────┐         ┌───────┐"," *     │ agent │ ------- │  app  │"," *     └───────┘         └───────┘"," *"," *"," * in app worker"," *"," * ```js"," * process.send({"," *   action: 'xxx',"," *   data: '',"," *   to: 'agent/master/parent', // default to app"," * });"," * ```"," *"," * in agent worker"," *"," * ```js"," * process.send({"," *   action: 'xxx',"," *   data: '',"," *   to: 'app/master/parent', // default to agent"," * });"," * ```"," *"," * in parent"," *"," * ```js"," * process.send({"," *   action: 'xxx',"," *   data: '',"," *   to: 'app/agent/master', // default to be ignore"," * });"," * ```"," */","class Messenger {","","  constructor(master) {","    this.master = master;","    process.on('message', msg => {","      msg.from = 'parent';","      this.send(msg);","    });","  }","","  /**","   * send message","   * @param {Object} data message body","   *  - {String} from from who","   *  - {String} to to who","   */","  send(data) {","    if (!data.from) {","      data.from = 'master';","    }","","    // default from -> to rules","    if (!data.to) {","      if (data.from === 'agent') data.to = 'app';","      if (data.from === 'app') data.to = 'agent';","      if (data.from === 'parent') data.to = 'master';","    }","","    // app -> master","    // agent -> master","    if (data.to === 'master') {","      debug('%s -> master, data: %j', data.from, data);","      // app/agent to master","      this.sendToMaster(data);","      return;","    }","","    // master -> parent","    // app -> parent","    // agent -> parent","    if (data.to === 'parent') {","      debug('%s -> parent, data: %j', data.from, data);","      this.sendToParent(data);","      return;","    }","","    // parent -> master -> app","    // agent -> master -> app","    if (data.to === 'app') {","      debug('%s -> %s, data: %j', data.from, data.to, data);","      this.sendToAppWorker(data);","      return;","    }","","    // parent -> master -> agent","    // app -> master -> agent，可能不指定 to","    if (data.to === 'agent') {","      debug('%s -> %s, data: %j', data.from, data.to, data);","      this.sendToAgentWorker(data);","      return;","    }","  }","","  /**","   * send message to master self","   * @param {Object} data message body","   */","  sendToMaster(data) {","    this.master.emit(data.action, data.data);","  }","","  /**","   * send message to parent process","   * @param {Object} data message body","   */","  sendToParent(data) {","    process.send && process.send(data);","  }","","  /**","   * send message to app worker","   * @param {Object} data message body","   */","  sendToAppWorker(data) {","    for (const id in cluster.workers) {","      const worker = cluster.workers[id];","      if (worker.state === 'disconnected') {","        continue;","      }","      // check receiverPid","      if (data.receiverPid && data.receiverPid !== String(worker.process.pid)) {","        continue;","      }","      sendmessage(worker, data);","    }","  }","","  /**","   * send message to agent worker","   * @param {Object} data message body","   */","  sendToAgentWorker(data) {","    if (this.master.agentWorker) {","      sendmessage(this.master.agentWorker, data);","    }","  }","","}","","module.exports = Messenger;",""],"l":{"3":1,"4":1,"5":1,"57":0,"58":0,"59":0,"60":0,"71":0,"72":0,"76":0,"77":0,"78":0,"79":0,"84":0,"85":0,"87":0,"88":0,"94":0,"95":0,"96":0,"97":0,"102":0,"103":0,"104":0,"105":0,"110":0,"111":0,"112":0,"113":0,"122":0,"130":0,"138":0,"139":0,"140":0,"141":0,"144":0,"145":0,"147":0,"156":0,"157":0,"163":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/application.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/application.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"(anonymous_1)","line":29,"loc":{"start":{"line":29,"column":13},"end":{"line":29,"column":28}}},"2":{"name":"(anonymous_2)","line":47,"loc":{"start":{"line":47,"column":18},"end":{"line":47,"column":21}}},"3":{"name":"(anonymous_3)","line":51,"loc":{"start":{"line":51,"column":16},"end":{"line":51,"column":19}}},"4":{"name":"(anonymous_4)","line":55,"loc":{"start":{"line":55,"column":10},"end":{"line":55,"column":19}}},"5":{"name":"(anonymous_5)","line":73,"loc":{"start":{"line":73,"column":12},"end":{"line":73,"column":15}}},"6":{"name":"(anonymous_6)","line":84,"loc":{"start":{"line":84,"column":12},"end":{"line":84,"column":18}}},"7":{"name":"(anonymous_7)","line":98,"loc":{"start":{"line":98,"column":15},"end":{"line":98,"column":26}}},"8":{"name":"(anonymous_8)","line":127,"loc":{"start":{"line":127,"column":24},"end":{"line":127,"column":30}}},"9":{"name":"(anonymous_9)","line":164,"loc":{"start":{"line":164,"column":17},"end":{"line":164,"column":25}}},"10":{"name":"(anonymous_10)","line":173,"loc":{"start":{"line":173,"column":10},"end":{"line":173,"column":13}}},"11":{"name":"(anonymous_11)","line":194,"loc":{"start":{"line":194,"column":12},"end":{"line":194,"column":15}}},"12":{"name":"(anonymous_12)","line":206,"loc":{"start":{"line":206,"column":12},"end":{"line":206,"column":15}}},"13":{"name":"(anonymous_13)","line":223,"loc":{"start":{"line":223,"column":20},"end":{"line":223,"column":23}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":37}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":29}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":40}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":60}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":42}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":38}},"8":{"start":{"line":11,"column":0},"end":{"line":11,"column":40}},"9":{"start":{"line":12,"column":0},"end":{"line":12,"column":44}},"10":{"start":{"line":13,"column":0},"end":{"line":13,"column":44}},"11":{"start":{"line":14,"column":0},"end":{"line":14,"column":53}},"12":{"start":{"line":15,"column":0},"end":{"line":15,"column":44}},"13":{"start":{"line":16,"column":0},"end":{"line":16,"column":43}},"14":{"start":{"line":17,"column":0},"end":{"line":17,"column":57}},"15":{"start":{"line":30,"column":4},"end":{"line":30,"column":33}},"16":{"start":{"line":31,"column":4},"end":{"line":31,"column":19}},"17":{"start":{"line":33,"column":4},"end":{"line":39,"column":5}},"18":{"start":{"line":34,"column":6},"end":{"line":34,"column":25}},"19":{"start":{"line":37,"column":6},"end":{"line":37,"column":51}},"20":{"start":{"line":38,"column":6},"end":{"line":38,"column":14}},"21":{"start":{"line":42,"column":4},"end":{"line":42,"column":22}},"22":{"start":{"line":43,"column":4},"end":{"line":43,"column":30}},"23":{"start":{"line":44,"column":4},"end":{"line":44,"column":22}},"24":{"start":{"line":48,"column":4},"end":{"line":48,"column":27}},"25":{"start":{"line":52,"column":4},"end":{"line":52,"column":38}},"26":{"start":{"line":57,"column":4},"end":{"line":65,"column":7},"skip":true},"27":{"start":{"line":60,"column":8},"end":{"line":62,"column":9},"skip":true},"28":{"start":{"line":61,"column":10},"end":{"line":61,"column":111},"skip":true},"29":{"start":{"line":63,"column":8},"end":{"line":63,"column":35},"skip":true},"30":{"start":{"line":74,"column":4},"end":{"line":76,"column":5}},"31":{"start":{"line":75,"column":6},"end":{"line":75,"column":24}},"32":{"start":{"line":77,"column":4},"end":{"line":80,"column":5}},"33":{"start":{"line":78,"column":6},"end":{"line":78,"column":46}},"34":{"start":{"line":79,"column":6},"end":{"line":79,"column":31}},"35":{"start":{"line":81,"column":4},"end":{"line":81,"column":24}},"36":{"start":{"line":85,"column":4},"end":{"line":87,"column":5}},"37":{"start":{"line":86,"column":6},"end":{"line":86,"column":29}},"38":{"start":{"line":88,"column":4},"end":{"line":88,"column":32}},"39":{"start":{"line":99,"column":4},"end":{"line":99,"column":21}},"40":{"start":{"line":100,"column":4},"end":{"line":100,"column":47}},"41":{"start":{"line":101,"column":4},"end":{"line":101,"column":65}},"42":{"start":{"line":102,"column":4},"end":{"line":102,"column":68}},"43":{"start":{"line":103,"column":4},"end":{"line":103,"column":51}},"44":{"start":{"line":104,"column":4},"end":{"line":104,"column":51}},"45":{"start":{"line":105,"column":4},"end":{"line":105,"column":51}},"46":{"start":{"line":106,"column":4},"end":{"line":106,"column":41}},"47":{"start":{"line":107,"column":4},"end":{"line":107,"column":32}},"48":{"start":{"line":108,"column":4},"end":{"line":108,"column":31}},"49":{"start":{"line":109,"column":4},"end":{"line":109,"column":52}},"50":{"start":{"line":110,"column":4},"end":{"line":110,"column":56}},"51":{"start":{"line":116,"column":4},"end":{"line":116,"column":35}},"52":{"start":{"line":117,"column":4},"end":{"line":117,"column":19}},"53":{"start":{"line":128,"column":4},"end":{"line":145,"column":6}},"54":{"start":{"line":146,"column":4},"end":{"line":154,"column":5}},"55":{"start":{"line":147,"column":6},"end":{"line":153,"column":7}},"56":{"start":{"line":148,"column":8},"end":{"line":152,"column":9}},"57":{"start":{"line":149,"column":10},"end":{"line":149,"column":48}},"58":{"start":{"line":151,"column":10},"end":{"line":151,"column":34}},"59":{"start":{"line":155,"column":4},"end":{"line":155,"column":54}},"60":{"start":{"line":156,"column":4},"end":{"line":156,"column":49}},"61":{"start":{"line":165,"column":4},"end":{"line":165,"column":46}},"62":{"start":{"line":166,"column":4},"end":{"line":166,"column":31}},"63":{"start":{"line":174,"column":4},"end":{"line":185,"column":5}},"64":{"start":{"line":175,"column":6},"end":{"line":182,"column":7}},"65":{"start":{"line":176,"column":8},"end":{"line":180,"column":9}},"66":{"start":{"line":177,"column":10},"end":{"line":177,"column":88}},"67":{"start":{"line":178,"column":10},"end":{"line":178,"column":71}},"68":{"start":{"line":179,"column":10},"end":{"line":179,"column":70}},"69":{"start":{"line":181,"column":8},"end":{"line":181,"column":56}},"70":{"start":{"line":184,"column":6},"end":{"line":184,"column":66}},"71":{"start":{"line":184,"column":56},"end":{"line":184,"column":64}},"72":{"start":{"line":186,"column":4},"end":{"line":186,"column":22}},"73":{"start":{"line":195,"column":4},"end":{"line":197,"column":5}},"74":{"start":{"line":196,"column":6},"end":{"line":196,"column":67}},"75":{"start":{"line":198,"column":4},"end":{"line":198,"column":24}},"76":{"start":{"line":208,"column":4},"end":{"line":213,"column":7}},"77":{"start":{"line":209,"column":6},"end":{"line":209,"column":95}},"78":{"start":{"line":210,"column":6},"end":{"line":210,"column":42}},"79":{"start":{"line":211,"column":6},"end":{"line":211,"column":25}},"80":{"start":{"line":212,"column":6},"end":{"line":212,"column":32}},"81":{"start":{"line":215,"column":4},"end":{"line":215,"column":55}},"82":{"start":{"line":215,"column":32},"end":{"line":215,"column":53}},"83":{"start":{"line":224,"column":4},"end":{"line":224,"column":70}},"84":{"start":{"line":225,"column":4},"end":{"line":230,"column":7}},"85":{"start":{"line":226,"column":6},"end":{"line":229,"column":7}},"86":{"start":{"line":227,"column":8},"end":{"line":228,"column":42}},"87":{"start":{"line":234,"column":0},"end":{"line":234,"column":29}}},"branchMap":{"1":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":60,"column":8},"skip":true},{"start":{"line":60,"column":8},"end":{"line":60,"column":8},"skip":true}]},"2":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":4},"end":{"line":74,"column":4}},{"start":{"line":74,"column":4},"end":{"line":74,"column":4}}]},"3":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":4},"end":{"line":77,"column":4}},{"start":{"line":77,"column":4},"end":{"line":77,"column":4}}]},"4":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":8},"end":{"line":77,"column":25}},{"start":{"line":77,"column":29},"end":{"line":77,"column":53}}]},"5":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":4},"end":{"line":85,"column":4}},{"start":{"line":85,"column":4},"end":{"line":85,"column":4}}]},"6":{"line":146,"type":"if","locations":[{"start":{"line":146,"column":4},"end":{"line":146,"column":4}},{"start":{"line":146,"column":4},"end":{"line":146,"column":4}}]},"7":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":8},"end":{"line":148,"column":8}},{"start":{"line":148,"column":8},"end":{"line":148,"column":8}}]},"8":{"line":148,"type":"binary-expr","locations":[{"start":{"line":148,"column":12},"end":{"line":148,"column":29}},{"start":{"line":148,"column":33},"end":{"line":148,"column":48}},{"start":{"line":148,"column":52},"end":{"line":148,"column":68}}]},"9":{"line":174,"type":"if","locations":[{"start":{"line":174,"column":4},"end":{"line":174,"column":4}},{"start":{"line":174,"column":4},"end":{"line":174,"column":4}}]},"10":{"line":175,"type":"if","locations":[{"start":{"line":175,"column":6},"end":{"line":175,"column":6}},{"start":{"line":175,"column":6},"end":{"line":175,"column":6}}]},"11":{"line":176,"type":"if","locations":[{"start":{"line":176,"column":8},"end":{"line":176,"column":8}},{"start":{"line":176,"column":8},"end":{"line":176,"column":8}}]},"12":{"line":176,"type":"binary-expr","locations":[{"start":{"line":176,"column":12},"end":{"line":176,"column":39}},{"start":{"line":176,"column":43},"end":{"line":176,"column":73}}]},"13":{"line":195,"type":"if","locations":[{"start":{"line":195,"column":4},"end":{"line":195,"column":4}},{"start":{"line":195,"column":4},"end":{"line":195,"column":4}}]},"14":{"line":226,"type":"if","locations":[{"start":{"line":226,"column":6},"end":{"line":226,"column":6}},{"start":{"line":226,"column":6},"end":{"line":226,"column":6}}]}},"code":["'use strict';","","const path = require('path');","const graceful = require('graceful');","const http = require('http');","const EggApplication = require('./egg');","const AppWorkerLoader = require('./loader').AppWorkerLoader;","const cluster = require('cluster-client');","const { assign } = require('utility');","","const KEYS = Symbol('Application#keys');","const HELPER = Symbol('Application#Helper');","const LOCALS = Symbol('Application#locals');","const LOCALS_LIST = Symbol('Application#localsList');","const EGG_LOADER = Symbol.for('egg#loader');","const EGG_PATH = Symbol.for('egg#eggPath');","const CLUSTER_CLIENTS = Symbol.for('egg#clusterClients');","","/**"," * Singleton instance in App Worker, extend {@link EggApplication}"," * @extends EggApplication"," */","class Application extends EggApplication {","","  /**","   * @constructor","   * @param {Object} options - see {@link EggApplication}","   */","  constructor(options = {}) {","    options.type = 'application';","    super(options);","","    try {","      this.loader.load();","    } catch (e) {","      // close gracefully","      this[CLUSTER_CLIENTS].forEach(cluster.close);","      throw e;","    }","","    // dump config after loaded, ensure all the dynamic modifications will be recorded","    this.dumpConfig();","    this.warnConfusedConfig();","    this.bindEvents();","  }","","  get [EGG_LOADER]() {","    return AppWorkerLoader;","  }","","  get [EGG_PATH]() {","    return path.join(__dirname, '..');","  }","","  onServer(server) {","    /* istanbul ignore next */","    graceful({","      server: [ server ],","      error: (err, throwErrorCount) => {","        if (err.message) {","          err.message += ' (uncaughtException throw ' + throwErrorCount + ' times on pid:' + process.pid + ')';","        }","        this.coreLogger.error(err);","      },","    });","  }","","  /**","   * global locals for view","   * @member {Object} Application#locals","   * @see Context#locals","   */","  get locals() {","    if (!this[LOCALS]) {","      this[LOCALS] = {};","    }","    if (this[LOCALS_LIST] && this[LOCALS_LIST].length) {","      assign(this[LOCALS], this[LOCALS_LIST]);","      this[LOCALS_LIST] = null;","    }","    return this[LOCALS];","  }","","  set locals(val) {","    if (!this[LOCALS_LIST]) {","      this[LOCALS_LIST] = [];","    }","    this[LOCALS_LIST].push(val);","  }","","  /**","   * Create egg context","   * @method Application#createContext","   * @param  {Req} req - node native Request object","   * @param  {Res} res - node native Response object","   * @return {Context} context object","   */","  createContext(req, res) {","    const app = this;","    const context = Object.create(app.context);","    const request = context.request = Object.create(app.request);","    const response = context.response = Object.create(app.response);","    context.app = request.app = response.app = app;","    context.req = request.req = response.req = req;","    context.res = request.res = response.res = res;","    request.ctx = response.ctx = context;","    request.response = response;","    response.request = request;","    context.onerror = context.onerror.bind(context);","    context.originalUrl = request.originalUrl = req.url;","","    /**","     * Request start time","     * @member {Number} Context#starttime","     */","    context.starttime = Date.now();","    return context;","  }","","  /**","   * Create an anonymouse context, the context isn't request level, so the request is mocked.","   * then you can use context level API like `ctx.service`","   * @member {String} Application#createAnonymousContext","   * @param {Request} req - if you want to mock request like querystring, you can pass an object to this function.","   * @return {Context} context","   */","  createAnonymousContext(req) {","    const request = {","      headers: {","        'x-forwarded-for': '127.0.0.1',","      },","      query: {},","      querystring: '',","      host: '127.0.0.1',","      hostname: '127.0.0.1',","      protocol: 'http',","      secure: 'false',","      method: 'GET',","      url: '/',","      path: '/',","      socket: {","        remoteAddress: '127.0.0.1',","        remotePort: 7001,","      },","    };","    if (req) {","      for (const key in req) {","        if (key === 'headers' || key === 'query' || key === 'socket') {","          Object.assign(request[key], req[key]);","        } else {","          request[key] = req[key];","        }","      }","    }","    const response = new http.ServerResponse(request);","    return this.createContext(request, response);","  }","","  /**","   * Run generator function in the background","   * @see Context#runInBackground","   * @param {Generator} scope - generator function, the first args is an anonymous ctx","   */","  runInBackground(scope) {","    const ctx = this.createAnonymousContext();","    ctx.runInBackground(scope);","  }","","  /**","   * secret key for Application","   * @member {String} Application#keys","   */","  get keys() {","    if (!this[KEYS]) {","      if (!this.config.keys) {","        if (this.config.env === 'local' || this.config.env === 'unittest') {","          const configPath = path.join(this.config.baseDir, 'config/config.default.js');","          console.error('Cookie need secret key to sign and encrypt.');","          console.error('Please add `config.keys` in %s', configPath);","        }","        throw new Error('Please set config.keys first');","      }","","      this[KEYS] = this.config.keys.split(',').map(s => s.trim());","    }","    return this[KEYS];","  }","","  /**","   * The helper class, `app/helper` will be loaded to it's prototype,","   * then you can use all method on `ctx.helper`","   * @member {Helper} Application#Helper","   */","  get Helper() {","    if (!this[HELPER]) {","      this[HELPER] = class Helper extends this.BaseContextClass {};","    }","    return this[HELPER];","  }","","  /**","   * bind app's events","   *","   * @private","   */","  bindEvents() {","    // Browser Cookie Limits: http://browsercookielimits.squawky.net/","    this.on('cookieLimitExceed', ({ name, value, ctx }) => {","      const err = new Error(`cookie ${name}'s length(${value.length}) exceed the limit(4093)`);","      err.name = 'CookieLimitExceedError';","      err.cookie = value;","      ctx.coreLogger.error(err);","    });","    // expose server to support websocket","    this.on('server', server => this.onServer(server));","  }","","  /**","   * warn when confused configurations are present","   *","   * @private","   */","  warnConfusedConfig() {","    const confusedConfigurations = this.config.confusedConfigurations;","    Object.keys(confusedConfigurations).forEach(key => {","      if (this.config[key] !== undefined) {","        this.logger.warn('Unexpected config key `%s` exists, Please use `%s` instead.',","        key, confusedConfigurations[key]);","      }","    });","  }","}","","module.exports = Application;",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"30":0,"31":0,"33":0,"34":0,"37":0,"38":0,"42":0,"43":0,"44":0,"48":0,"52":0,"57":1,"60":1,"61":1,"63":1,"74":0,"75":0,"77":0,"78":0,"79":0,"81":0,"85":0,"86":0,"88":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"116":0,"117":0,"128":0,"146":0,"147":0,"148":0,"149":0,"151":0,"155":0,"156":0,"165":0,"166":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"181":0,"184":0,"186":0,"195":0,"196":0,"198":0,"208":0,"209":0,"210":0,"211":0,"212":0,"215":0,"224":0,"225":0,"226":0,"227":0,"234":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/egg.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/egg.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":1,"48":0,"49":0,"50":0,"51":1,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0},"fnMap":{"1":{"name":"(anonymous_1)","line":37,"loc":{"start":{"line":37,"column":13},"end":{"line":37,"column":23}}},"2":{"name":"(anonymous_2)","line":129,"loc":{"start":{"line":129,"column":9},"end":{"line":129,"column":12}}},"3":{"name":"delegate","line":134,"loc":{"start":{"line":134,"column":4},"end":{"line":134,"column":38}}},"4":{"name":"abbr","line":143,"loc":{"start":{"line":143,"column":4},"end":{"line":143,"column":34}}},"5":{"name":"(anonymous_5)","line":170,"loc":{"start":{"line":170,"column":8},"end":{"line":170,"column":11}}},"6":{"name":"(anonymous_6)","line":210,"loc":{"start":{"line":210,"column":6},"end":{"line":210,"column":18}}},"7":{"name":"(anonymous_7)","line":219,"loc":{"start":{"line":219,"column":16},"end":{"line":219,"column":19}}},"8":{"name":"(anonymous_8)","line":231,"loc":{"start":{"line":231,"column":13},"end":{"line":231,"column":16}}},"9":{"name":"(anonymous_9)","line":244,"loc":{"start":{"line":244,"column":11},"end":{"line":244,"column":18}}},"10":{"name":"(anonymous_10)","line":253,"loc":{"start":{"line":253,"column":12},"end":{"line":253,"column":15}}},"11":{"name":"(anonymous_11)","line":262,"loc":{"start":{"line":262,"column":16},"end":{"line":262,"column":19}}},"12":{"name":"(anonymous_12)","line":266,"loc":{"start":{"line":266,"column":28},"end":{"line":266,"column":34}}},"13":{"name":"(anonymous_13)","line":289,"loc":{"start":{"line":289,"column":12},"end":{"line":289,"column":15}}},"14":{"name":"(anonymous_14)","line":310,"loc":{"start":{"line":310,"column":16},"end":{"line":310,"column":19}}},"15":{"name":"(anonymous_15)","line":314,"loc":{"start":{"line":314,"column":20},"end":{"line":314,"column":23}}},"16":{"name":"(anonymous_16)","line":326,"loc":{"start":{"line":326,"column":9},"end":{"line":326,"column":12}}},"17":{"name":"(anonymous_17)","line":331,"loc":{"start":{"line":331,"column":9},"end":{"line":331,"column":13}}},"18":{"name":"(anonymous_18)","line":337,"loc":{"start":{"line":337,"column":11},"end":{"line":337,"column":14}}},"19":{"name":"(anonymous_19)","line":342,"loc":{"start":{"line":342,"column":11},"end":{"line":342,"column":15}}},"20":{"name":"(anonymous_20)","line":349,"loc":{"start":{"line":349,"column":14},"end":{"line":349,"column":29}}},"21":{"name":"(anonymous_21)","line":358,"loc":{"start":{"line":358,"column":21},"end":{"line":358,"column":30}}},"22":{"name":"(anonymous_22)","line":364,"loc":{"start":{"line":364,"column":23},"end":{"line":364,"column":36}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":25}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":44}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":42}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":34}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":61}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":46}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":63}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":46}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":54}},"11":{"start":{"line":13,"column":0},"end":{"line":13,"column":47}},"12":{"start":{"line":14,"column":0},"end":{"line":14,"column":46}},"13":{"start":{"line":15,"column":0},"end":{"line":15,"column":38}},"14":{"start":{"line":17,"column":0},"end":{"line":17,"column":55}},"15":{"start":{"line":18,"column":0},"end":{"line":18,"column":49}},"16":{"start":{"line":19,"column":0},"end":{"line":19,"column":43}},"17":{"start":{"line":20,"column":0},"end":{"line":20,"column":57}},"18":{"start":{"line":38,"column":4},"end":{"line":38,"column":19}},"19":{"start":{"line":41,"column":4},"end":{"line":41,"column":41}},"20":{"start":{"line":42,"column":4},"end":{"line":42,"column":39}},"21":{"start":{"line":43,"column":4},"end":{"line":43,"column":47}},"22":{"start":{"line":45,"column":4},"end":{"line":45,"column":29}},"23":{"start":{"line":52,"column":4},"end":{"line":52,"column":37}},"24":{"start":{"line":55,"column":4},"end":{"line":55,"column":40}},"25":{"start":{"line":55,"column":21},"end":{"line":55,"column":38}},"26":{"start":{"line":56,"column":4},"end":{"line":56,"column":30}},"27":{"start":{"line":58,"column":4},"end":{"line":58,"column":63}},"28":{"start":{"line":59,"column":4},"end":{"line":59,"column":87}},"29":{"start":{"line":60,"column":4},"end":{"line":60,"column":87}},"30":{"start":{"line":63,"column":4},"end":{"line":63,"column":81}},"31":{"start":{"line":64,"column":4},"end":{"line":64,"column":70}},"32":{"start":{"line":66,"column":4},"end":{"line":66,"column":31}},"33":{"start":{"line":86,"column":4},"end":{"line":96,"column":6}},"34":{"start":{"line":87,"column":6},"end":{"line":87,"column":30}},"35":{"start":{"line":89,"column":6},"end":{"line":89,"column":47}},"36":{"start":{"line":91,"column":6},"end":{"line":91,"column":47}},"37":{"start":{"line":92,"column":6},"end":{"line":92,"column":39}},"38":{"start":{"line":93,"column":6},"end":{"line":93,"column":51}},"39":{"start":{"line":94,"column":6},"end":{"line":94,"column":39}},"40":{"start":{"line":95,"column":6},"end":{"line":95,"column":20}},"41":{"start":{"line":99,"column":4},"end":{"line":105,"column":7}},"42":{"start":{"line":100,"column":6},"end":{"line":102,"column":7}},"43":{"start":{"line":101,"column":8},"end":{"line":101,"column":23}},"44":{"start":{"line":103,"column":6},"end":{"line":103,"column":29}},"45":{"start":{"line":104,"column":6},"end":{"line":104,"column":84}},"46":{"start":{"line":130,"column":4},"end":{"line":132,"column":6}},"47":{"start":{"line":134,"column":4},"end":{"line":141,"column":5}},"48":{"start":{"line":135,"column":6},"end":{"line":140,"column":7}},"49":{"start":{"line":137,"column":8},"end":{"line":139,"column":9}},"50":{"start":{"line":138,"column":10},"end":{"line":138,"column":30}},"51":{"start":{"line":143,"column":4},"end":{"line":150,"column":5}},"52":{"start":{"line":144,"column":6},"end":{"line":149,"column":7}},"53":{"start":{"line":146,"column":8},"end":{"line":148,"column":9}},"54":{"start":{"line":147,"column":10},"end":{"line":147,"column":36}},"55":{"start":{"line":152,"column":4},"end":{"line":156,"column":7}},"56":{"start":{"line":158,"column":4},"end":{"line":165,"column":7}},"57":{"start":{"line":167,"column":4},"end":{"line":167,"column":15}},"58":{"start":{"line":171,"column":4},"end":{"line":171,"column":26}},"59":{"start":{"line":211,"column":4},"end":{"line":211,"column":46}},"60":{"start":{"line":220,"column":4},"end":{"line":222,"column":5}},"61":{"start":{"line":221,"column":6},"end":{"line":221,"column":48}},"62":{"start":{"line":223,"column":4},"end":{"line":223,"column":28}},"63":{"start":{"line":232,"column":4},"end":{"line":234,"column":5}},"64":{"start":{"line":233,"column":6},"end":{"line":233,"column":42}},"65":{"start":{"line":235,"column":4},"end":{"line":235,"column":25}},"66":{"start":{"line":245,"column":4},"end":{"line":245,"column":38}},"67":{"start":{"line":254,"column":4},"end":{"line":254,"column":36}},"68":{"start":{"line":263,"column":4},"end":{"line":263,"column":40}},"69":{"start":{"line":267,"column":4},"end":{"line":277,"column":5}},"70":{"start":{"line":268,"column":6},"end":{"line":268,"column":46}},"71":{"start":{"line":271,"column":6},"end":{"line":275,"column":7}},"72":{"start":{"line":272,"column":8},"end":{"line":272,"column":47}},"73":{"start":{"line":272,"column":22},"end":{"line":272,"column":47}},"74":{"start":{"line":273,"column":8},"end":{"line":273,"column":56}},"75":{"start":{"line":273,"column":25},"end":{"line":273,"column":56}},"76":{"start":{"line":274,"column":8},"end":{"line":274,"column":50}},"77":{"start":{"line":274,"column":23},"end":{"line":274,"column":50}},"78":{"start":{"line":276,"column":6},"end":{"line":276,"column":21}},"79":{"start":{"line":279,"column":4},"end":{"line":281,"column":5}},"80":{"start":{"line":280,"column":6},"end":{"line":280,"column":43}},"81":{"start":{"line":282,"column":4},"end":{"line":282,"column":31}},"82":{"start":{"line":290,"column":4},"end":{"line":290,"column":38}},"83":{"start":{"line":291,"column":4},"end":{"line":291,"column":19}},"84":{"start":{"line":292,"column":4},"end":{"line":297,"column":5}},"85":{"start":{"line":294,"column":6},"end":{"line":294,"column":55}},"86":{"start":{"line":296,"column":6},"end":{"line":296,"column":22}},"87":{"start":{"line":298,"column":4},"end":{"line":298,"column":67}},"88":{"start":{"line":299,"column":4},"end":{"line":307,"column":5}},"89":{"start":{"line":301,"column":6},"end":{"line":301,"column":55}},"90":{"start":{"line":301,"column":34},"end":{"line":301,"column":55},"skip":true},"91":{"start":{"line":302,"column":6},"end":{"line":302,"column":84}},"92":{"start":{"line":303,"column":6},"end":{"line":303,"column":44}},"93":{"start":{"line":304,"column":6},"end":{"line":304,"column":64}},"94":{"start":{"line":306,"column":6},"end":{"line":306,"column":63}},"95":{"start":{"line":311,"column":4},"end":{"line":311,"column":38}},"96":{"start":{"line":315,"column":4},"end":{"line":318,"column":39}},"97":{"start":{"line":316,"column":6},"end":{"line":316,"column":108}},"98":{"start":{"line":317,"column":6},"end":{"line":317,"column":32}},"99":{"start":{"line":319,"column":4},"end":{"line":319,"column":54}},"100":{"start":{"line":319,"column":21},"end":{"line":319,"column":52}},"101":{"start":{"line":327,"column":4},"end":{"line":327,"column":56}},"102":{"start":{"line":328,"column":4},"end":{"line":328,"column":27}},"103":{"start":{"line":338,"column":4},"end":{"line":338,"column":58}},"104":{"start":{"line":339,"column":4},"end":{"line":339,"column":29}},"105":{"start":{"line":350,"column":4},"end":{"line":350,"column":23}},"106":{"start":{"line":351,"column":4},"end":{"line":351,"column":24}},"107":{"start":{"line":352,"column":4},"end":{"line":352,"column":28}},"108":{"start":{"line":353,"column":4},"end":{"line":353,"column":23}},"109":{"start":{"line":354,"column":4},"end":{"line":354,"column":45}},"110":{"start":{"line":355,"column":4},"end":{"line":355,"column":21}},"111":{"start":{"line":359,"column":4},"end":{"line":359,"column":33}},"112":{"start":{"line":360,"column":4},"end":{"line":369,"column":6}},"113":{"start":{"line":361,"column":6},"end":{"line":361,"column":52}},"114":{"start":{"line":362,"column":6},"end":{"line":362,"column":45}},"115":{"start":{"line":364,"column":6},"end":{"line":366,"column":9}},"116":{"start":{"line":365,"column":8},"end":{"line":365,"column":40}},"117":{"start":{"line":368,"column":6},"end":{"line":368,"column":24}},"118":{"start":{"line":373,"column":0},"end":{"line":373,"column":32}}},"branchMap":{"1":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":16},"end":{"line":87,"column":23}},{"start":{"line":87,"column":27},"end":{"line":87,"column":29}}]},"2":{"line":137,"type":"if","locations":[{"start":{"line":137,"column":8},"end":{"line":137,"column":8}},{"start":{"line":137,"column":8},"end":{"line":137,"column":8},"skip":true}]},"3":{"line":146,"type":"if","locations":[{"start":{"line":146,"column":8},"end":{"line":146,"column":8}},{"start":{"line":146,"column":8},"end":{"line":146,"column":8},"skip":true}]},"4":{"line":220,"type":"if","locations":[{"start":{"line":220,"column":4},"end":{"line":220,"column":4}},{"start":{"line":220,"column":4},"end":{"line":220,"column":4}}]},"5":{"line":232,"type":"if","locations":[{"start":{"line":232,"column":4},"end":{"line":232,"column":4}},{"start":{"line":232,"column":4},"end":{"line":232,"column":4}}]},"6":{"line":245,"type":"binary-expr","locations":[{"start":{"line":245,"column":11},"end":{"line":245,"column":29}},{"start":{"line":245,"column":33},"end":{"line":245,"column":37}}]},"7":{"line":267,"type":"if","locations":[{"start":{"line":267,"column":4},"end":{"line":267,"column":4}},{"start":{"line":267,"column":4},"end":{"line":267,"column":4}}]},"8":{"line":271,"type":"if","locations":[{"start":{"line":271,"column":6},"end":{"line":271,"column":6}},{"start":{"line":271,"column":6},"end":{"line":271,"column":6},"skip":true}]},"9":{"line":272,"type":"if","locations":[{"start":{"line":272,"column":8},"end":{"line":272,"column":8}},{"start":{"line":272,"column":8},"end":{"line":272,"column":8}}]},"10":{"line":273,"type":"if","locations":[{"start":{"line":273,"column":8},"end":{"line":273,"column":8}},{"start":{"line":273,"column":8},"end":{"line":273,"column":8}}]},"11":{"line":274,"type":"if","locations":[{"start":{"line":274,"column":8},"end":{"line":274,"column":8}},{"start":{"line":274,"column":8},"end":{"line":274,"column":8}}]},"12":{"line":279,"type":"if","locations":[{"start":{"line":279,"column":4},"end":{"line":279,"column":4}},{"start":{"line":279,"column":4},"end":{"line":279,"column":4},"skip":true}]},"13":{"line":301,"type":"if","locations":[{"start":{"line":301,"column":6},"end":{"line":301,"column":6},"skip":true},{"start":{"line":301,"column":6},"end":{"line":301,"column":6}}]}},"code":["'use strict';","","const path = require('path');","const fs = require('fs');","const EggCore = require('egg-core').EggCore;","const cluster = require('cluster-client');","const extend = require('extend2');","const ContextLogger = require('egg-logger').EggContextLogger;","const ContextCookies = require('egg-cookies');","const ContextHttpClient = require('./core/context_httpclient');","const Messenger = require('./core/messenger');","const createHttpClient = require('./core/httpclient');","const createLoggers = require('./core/logger');","const Singleton = require('./core/singleton');","const utils = require('./core/utils');","","const HTTPCLIENT = Symbol('EggApplication#httpclient');","const LOGGERS = Symbol('EggApplication#loggers');","const EGG_PATH = Symbol.for('egg#eggPath');","const CLUSTER_CLIENTS = Symbol.for('egg#clusterClients');","","/**"," * Base on koa's Application"," * @see https://github.com/eggjs/egg-core"," * @see http://koajs.com/#application"," * @extends EggCore"," */","class EggApplication extends EggCore {","","  /**","   * @constructor","   * @param {Object} options","   *  - {Object} [type] - type of instance, Agent and Application both extend koa, type can determine what it is.","   *  - {String} [baseDir] - app root dir, default is `process.cwd()`","   *  - {Object} [plugins] - custom plugin config, use it in unittest","   */","  constructor(options) {","    super(options);","","    // export context base classes, let framework can impl sub class and over context extend easily.","    this.ContextCookies = ContextCookies;","    this.ContextLogger = ContextLogger;","    this.ContextHttpClient = ContextHttpClient;","","    this.loader.loadConfig();","","    /**","     * messenger instance","     * @member {Messenger}","     * @since 1.0.0","     */","    this.messenger = new Messenger();","","    // dump config after ready, ensure all the modifications during start will be recorded","    this.ready(() => this.dumpConfig());","    this._setupTimeoutTimer();","","    this.console.info('[egg:core] App root: %s', this.baseDir);","    this.console.info('[egg:core] All *.log files save on %j', this.config.logger.dir);","    this.console.info('[egg:core] Loaded enabled plugin %j', this.loader.orderPlugins);","","    // Listen the error that promise had not catch, then log it in common-error","    this._unhandledRejectionHandler = this._unhandledRejectionHandler.bind(this);","    process.on('unhandledRejection', this._unhandledRejectionHandler);","","    this[CLUSTER_CLIENTS] = [];","","    /**","     * Wrap the Client with Leader/Follower Pattern","     *","     * @description almost the same as Agent.cluster API, the only different is that this method create Follower.","     *","     * @see https://github.com/node-modules/cluster-client","     * @param {Function} clientClass - client class function","     * @param {Object} [options]","     *   - {Boolean} [autoGenerate] - whether generate delegate rule automatically, default is true","     *   - {Function} [formatKey] - a method to tranform the subscription info into a string，default is JSON.stringify","     *   - {Object} [transcode|JSON.stringify/parse]","     *     - {Function} encode - custom serialize method","     *     - {Function} decode - custom deserialize method","     *   - {Boolean} [isBroadcast] - whether broadcast subscrption result to all followers or just one, default is true","     *   - {Number} [responseTimeout] - response timeout, default is 3 seconds","     *   - {Number} [maxWaitTime|30000] - leader startup max time, default is 30 seconds","     * @return {ClientWrapper} wrapper","     */","    this.cluster = (clientClass, options) => {","      options = options || {};","      // cluster need a port that can't conflict on the environment","      options.port = this._options.clusterPort;","      // agent worker is leader, app workers are follower","      options.isLeader = this.type === 'agent';","      options.logger = this.coreLogger;","      const client = cluster(clientClass, options);","      this._patchClusterClient(client);","      return client;","    };","","    // register close function","    this.beforeClose(() => {","      for (const logger of this.loggers.values()) {","        logger.close();","      }","      this.messenger.close();","      process.removeListener('unhandledRejection', this._unhandledRejectionHandler);","    });","  }","","  /**","   * print the infomation when console.log(app)","   * @return {Object} inspected app.","   * @since 1.0.0","   * @example","   * ```js","   * console.log(app);","   * =>","   * {","   *   name: 'mockapp',","   *   env: 'test',","   *   subdomainOffset: 2,","   *   config: '<egg config>',","   *   controller: '<egg controller>',","   *   service: '<egg service>',","   *   middlewares: '<egg middlewares>',","   *   urllib: '<egg urllib>',","   *   loggers: '<egg loggers>'","   * }","   * ```","   */","  inspect() {","    const res = {","      env: this.config.env,","    };","","    function delegate(res, app, keys) {","      for (const key of keys) {","        /* istanbul ignore else */","        if (app[key]) {","          res[key] = app[key];","        }","      }","    }","","    function abbr(res, app, keys) {","      for (const key of keys) {","        /* istanbul ignore else */","        if (app[key]) {","          res[key] = `<egg ${key}>`;","        }","      }","    }","","    delegate(res, this, [","      'name',","      'baseDir',","      'subdomainOffset',","    ]);","","    abbr(res, this, [","      'config',","      'controller',","      'serviceClasses',","      'middlewares',","      'httpclient',","      'loggers',","    ]);","","    return res;","  }","","  toJSON() {","    return this.inspect();","  }","","  /**","   * http request helper base on {@link httpclient}, it will auto save httpclient log.","   * Keep the same api with `httpclient.request(url, args)`.","   *","   * See https://github.com/node-modules/urllib#api-doc for more details.","   *","   * @param {String} url request url address.","   * @param {Object} opts","   * - method {String} - Request method, defaults to GET. Could be GET, POST, DELETE or PUT. Alias 'type'.","   * - data {Object} - Data to be sent. Will be stringify automatically.","   * - dataType {String} - String - Type of response data. Could be `text` or `json`.","   *   If it's `text`, the callbacked data would be a String.","   *   If it's `json`, the data of callback would be a parsed JSON Object.","   *   Default callbacked data would be a Buffer.","   * - headers {Object} - Request headers.","   * - timeout {Number} - Request timeout in milliseconds. Defaults to exports.TIMEOUT.","   *   Include remote server connecting timeout and response timeout.","   *   When timeout happen, will return ConnectionTimeout or ResponseTimeout.","   * - auth {String} - `username:password` used in HTTP Basic Authorization.","   * - followRedirect {Boolean} - follow HTTP 3xx responses as redirects. defaults to false.","   * - gzip {Boolean} - let you get the res object when request connected, default false. alias customResponse","   * @return {Object}","   * - status {Number} - HTTP response status","   * - headers {Object} - HTTP response seaders","   * - res {Object} - HTTP response meta","   * - data {Object} - HTTP response body","   *","   * @example","   * ```js","   * const result = yield app.curl('http://example.com/foo.json', {","   *   method: 'GET',","   *   dataType: 'json',","   * });","   * console.log(result.status, result.headers, result.data);","   * ```","   */","  curl(url, opts) {","    return this.httpclient.request(url, opts);","  }","","  /**","   * HttpClient instance","   * @see https://github.com/node-modules/urllib","   * @member {HttpClient}","   */","  get httpclient() {","    if (!this[HTTPCLIENT]) {","      this[HTTPCLIENT] = createHttpClient(this);","    }","    return this[HTTPCLIENT];","  }","","  /**","   *  All loggers contain logger, coreLogger and customLogger","   * @member {Object}","   * @since 1.0.0","   */","  get loggers() {","    if (!this[LOGGERS]) {","      this[LOGGERS] = createLoggers(this);","    }","    return this[LOGGERS];","  }","","  /**","   * Get logger by name, it's equal to app.loggers['name'],","   * but you can extend it with your own logical.","   * @param {String} name - logger name","   * @return {Logger} logger","   */","  getLogger(name) {","    return this.loggers[name] || null;","  }","","  /**","   * application logger, log file is `$HOME/logs/{appname}/{appname}-web`","   * @member {Logger}","   * @since 1.0.0","   */","  get logger() {","    return this.getLogger('logger');","  }","","  /**","   * core logger for framework and plugins, log file is `$HOME/logs/{appname}/egg-web`","   * @member {Logger}","   * @since 1.0.0","   */","  get coreLogger() {","    return this.getLogger('coreLogger');","  }","","  _unhandledRejectionHandler(err) {","    if (!(err instanceof Error)) {","      const newError = new Error(String(err));","      // err maybe an object, try to copy the name, message and stack to the new error instance","      /* istanbul ignore else */","      if (err) {","        if (err.name) newError.name = err.name;","        if (err.message) newError.message = err.message;","        if (err.stack) newError.stack = err.stack;","      }","      err = newError;","    }","    /* istanbul ignore else */","    if (err.name === 'Error') {","      err.name = 'unhandledRejectionError';","    }","    this.coreLogger.error(err);","  }","","  /**","   * save app.config to `run/${type}_config.json`","   * @private","   */","  dumpConfig() {","    const rundir = this.config.rundir;","    let ignoreList;","    try {","      // support array and set","      ignoreList = Array.from(this.config.dump.ignore);","    } catch (_) {","      ignoreList = [];","    }","    const dumpFile = path.join(rundir, `${this.type}_config.json`);","    try {","      /* istanbul ignore if */","      if (!fs.existsSync(rundir)) fs.mkdirSync(rundir);","      const json = extend(true, {}, { config: this.config, plugins: this.plugins });","      utils.convertObject(json, ignoreList);","      fs.writeFileSync(dumpFile, JSON.stringify(json, null, 2));","    } catch (err) {","      this.coreLogger.warn(`dumpConfig error: ${err.message}`);","    }","  }","","  get [EGG_PATH]() {","    return path.join(__dirname, '..');","  }","","  _setupTimeoutTimer() {","    const startTimeoutTimer = setTimeout(() => {","      this.coreLogger.error(`${this.type} still doesn't ready after ${this.config.workerStartTimeout} ms.`);","      this.emit('startTimeout');","    }, this.config.workerStartTimeout);","    this.ready(() => clearTimeout(startTimeoutTimer));","  }","","  /**","   * app.env delegate app.config.env","   * @deprecated","   */","  get env() {","    this.deprecate('please use app.config.env instead');","    return this.config.env;","  }","  /* eslint no-empty-function: off */","  set env(_) {}","","  /**","   * app.proxy delegate app.config.proxy","   * @deprecated","   */","  get proxy() {","    this.deprecate('please use app.config.proxy instead');","    return this.config.proxy;","  }","  /* eslint no-empty-function: off */","  set proxy(_) {}","","  /**","   * create a singleton instance","   * @param {String} name - unique name for singleton","   * @param {Object} create - method will be invoked when singleton instance create","   */","  addSingleton(name, create) {","    const options = {};","    options.name = name;","    options.create = create;","    options.app = this;","    const singleton = new Singleton(options);","    singleton.init();","  }","","  _patchClusterClient(client) {","    const create = client.create;","    client.create = (...args) => {","      const realClient = create.apply(client, args);","      this[CLUSTER_CLIENTS].push(realClient);","","      this.beforeClose(function* () {","        yield cluster.close(realClient);","      });","","      return realClient;","    };","  }","}","","module.exports = EggApplication;",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"17":1,"18":1,"19":1,"20":1,"38":0,"41":0,"42":0,"43":0,"45":0,"52":0,"55":0,"56":0,"58":0,"59":0,"60":0,"63":0,"64":0,"66":0,"86":0,"87":0,"89":0,"91":0,"92":0,"93":0,"94":0,"95":0,"99":0,"100":0,"101":0,"103":0,"104":0,"130":0,"134":1,"135":0,"137":0,"138":0,"143":1,"144":0,"146":0,"147":0,"152":0,"158":0,"167":0,"171":0,"211":0,"220":0,"221":0,"223":0,"232":0,"233":0,"235":0,"245":0,"254":0,"263":0,"267":0,"268":0,"271":0,"272":0,"273":0,"274":0,"276":0,"279":0,"280":0,"282":0,"290":0,"291":0,"292":0,"294":0,"296":0,"298":0,"299":0,"301":1,"302":0,"303":0,"304":0,"306":0,"311":0,"315":0,"316":0,"317":0,"319":0,"327":0,"328":0,"338":0,"339":0,"350":0,"351":0,"352":0,"353":0,"354":0,"355":0,"359":0,"360":0,"361":0,"362":0,"364":0,"365":0,"368":0,"373":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/index.js","s":{"1":1,"2":1,"3":1,"4":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":37}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":53}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":67}},"4":{"start":{"line":7,"column":0},"end":{"line":11,"column":2}}},"branchMap":{},"code":["'use strict';","","const EggCore = require('./lib/egg');","const EggLoader = require('./lib/loader/egg_loader');","const BaseContextClass = require('./lib/utils/base_context_class');","","module.exports = {","  EggCore,","  EggLoader,","  BaseContextClass,","};",""],"l":{"3":1,"4":1,"5":1,"7":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/egg.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/egg.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":1,"90":11,"91":0,"92":0,"93":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},"fnMap":{"1":{"name":"(anonymous_1)","line":32,"loc":{"start":{"line":32,"column":13},"end":{"line":32,"column":23}}},"2":{"name":"(anonymous_2)","line":127,"loc":{"start":{"line":127,"column":5},"end":{"line":127,"column":10}}},"3":{"name":"(anonymous_3)","line":139,"loc":{"start":{"line":139,"column":10},"end":{"line":139,"column":13}}},"4":{"name":"(anonymous_4)","line":149,"loc":{"start":{"line":149,"column":13},"end":{"line":149,"column":16}}},"5":{"name":"(anonymous_5)","line":158,"loc":{"start":{"line":158,"column":15},"end":{"line":158,"column":18}}},"6":{"name":"(anonymous_6)","line":175,"loc":{"start":{"line":175,"column":10},"end":{"line":175,"column":13}}},"7":{"name":"(anonymous_7)","line":184,"loc":{"start":{"line":184,"column":13},"end":{"line":184,"column":16}}},"8":{"name":"(anonymous_8)","line":193,"loc":{"start":{"line":193,"column":12},"end":{"line":193,"column":15}}},"9":{"name":"(anonymous_9)","line":202,"loc":{"start":{"line":202,"column":13},"end":{"line":202,"column":21}}},"10":{"name":"(anonymous_10)","line":213,"loc":{"start":{"line":213,"column":9},"end":{"line":213,"column":22}}},"11":{"name":"(anonymous_11)","line":230,"loc":{"start":{"line":230,"column":7},"end":{"line":230,"column":10}}},"12":{"name":"closeFunction","line":233,"loc":{"start":{"line":233,"column":29},"end":{"line":233,"column":55}}},"13":{"name":"(anonymous_13)","line":253,"loc":{"start":{"line":253,"column":13},"end":{"line":253,"column":18}}},"14":{"name":"(anonymous_14)","line":262,"loc":{"start":{"line":262,"column":12},"end":{"line":262,"column":15}}},"15":{"name":"(anonymous_15)","line":305,"loc":{"start":{"line":305,"column":12},"end":{"line":305,"column":15}}},"16":{"name":"(anonymous_16)","line":321,"loc":{"start":{"line":321,"column":5},"end":{"line":321,"column":20}}},"17":{"name":"(anonymous_17)","line":325,"loc":{"start":{"line":325,"column":5},"end":{"line":325,"column":15}}},"18":{"name":"(anonymous_18)","line":330,"loc":{"start":{"line":330,"column":18},"end":{"line":330,"column":21}}},"19":{"name":"(anonymous_19)","line":337,"loc":{"start":{"line":337,"column":30},"end":{"line":337,"column":48}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":25}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":38}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":64}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":43}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":33}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":25}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":63}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":33}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":41}},"11":{"start":{"line":15,"column":0},"end":{"line":15,"column":46}},"12":{"start":{"line":16,"column":0},"end":{"line":16,"column":44}},"13":{"start":{"line":17,"column":0},"end":{"line":17,"column":42}},"14":{"start":{"line":18,"column":0},"end":{"line":18,"column":53}},"15":{"start":{"line":19,"column":0},"end":{"line":19,"column":40}},"16":{"start":{"line":20,"column":0},"end":{"line":20,"column":44}},"17":{"start":{"line":33,"column":4},"end":{"line":33,"column":28}},"18":{"start":{"line":34,"column":4},"end":{"line":34,"column":55}},"19":{"start":{"line":35,"column":4},"end":{"line":35,"column":49}},"20":{"start":{"line":37,"column":4},"end":{"line":37,"column":98}},"21":{"start":{"line":38,"column":4},"end":{"line":38,"column":86}},"22":{"start":{"line":39,"column":4},"end":{"line":39,"column":106}},"23":{"start":{"line":40,"column":4},"end":{"line":40,"column":118}},"24":{"start":{"line":42,"column":4},"end":{"line":42,"column":12}},"25":{"start":{"line":49,"column":4},"end":{"line":49,"column":28}},"26":{"start":{"line":57,"column":4},"end":{"line":57,"column":42}},"27":{"start":{"line":60,"column":4},"end":{"line":60,"column":31}},"28":{"start":{"line":62,"column":4},"end":{"line":62,"column":32}},"29":{"start":{"line":68,"column":4},"end":{"line":68,"column":45}},"30":{"start":{"line":78,"column":4},"end":{"line":78,"column":45}},"31":{"start":{"line":85,"column":4},"end":{"line":85,"column":33}},"32":{"start":{"line":94,"column":4},"end":{"line":94,"column":42}},"33":{"start":{"line":101,"column":4},"end":{"line":101,"column":27}},"34":{"start":{"line":109,"column":4},"end":{"line":109,"column":36}},"35":{"start":{"line":110,"column":4},"end":{"line":110,"column":61}},"36":{"start":{"line":111,"column":4},"end":{"line":116,"column":7}},"37":{"start":{"line":118,"column":4},"end":{"line":118,"column":22}},"38":{"start":{"line":128,"column":4},"end":{"line":128,"column":61}},"39":{"start":{"line":129,"column":4},"end":{"line":129,"column":48}},"40":{"start":{"line":130,"column":4},"end":{"line":130,"column":47}},"41":{"start":{"line":131,"column":4},"end":{"line":131,"column":16}},"42":{"start":{"line":140,"column":4},"end":{"line":140,"column":30}},"43":{"start":{"line":150,"column":4},"end":{"line":150,"column":33}},"44":{"start":{"line":159,"column":4},"end":{"line":159,"column":46}},"45":{"start":{"line":160,"column":4},"end":{"line":165,"column":5}},"46":{"start":{"line":161,"column":6},"end":{"line":161,"column":47}},"47":{"start":{"line":163,"column":6},"end":{"line":163,"column":31}},"48":{"start":{"line":164,"column":6},"end":{"line":164,"column":45}},"49":{"start":{"line":166,"column":4},"end":{"line":166,"column":39}},"50":{"start":{"line":176,"column":4},"end":{"line":176,"column":32}},"51":{"start":{"line":185,"column":4},"end":{"line":185,"column":31}},"52":{"start":{"line":194,"column":4},"end":{"line":194,"column":30}},"53":{"start":{"line":203,"column":4},"end":{"line":205,"column":5}},"54":{"start":{"line":204,"column":6},"end":{"line":204,"column":59}},"55":{"start":{"line":208,"column":4},"end":{"line":208,"column":48}},"56":{"start":{"line":209,"column":4},"end":{"line":209,"column":42}},"57":{"start":{"line":212,"column":4},"end":{"line":216,"column":7}},"58":{"start":{"line":213,"column":6},"end":{"line":215,"column":34}},"59":{"start":{"line":214,"column":8},"end":{"line":214,"column":34}},"60":{"start":{"line":215,"column":20},"end":{"line":215,"column":26}},"61":{"start":{"line":231,"column":4},"end":{"line":231,"column":56}},"62":{"start":{"line":231,"column":29},"end":{"line":231,"column":56}},"63":{"start":{"line":233,"column":4},"end":{"line":245,"column":18}},"64":{"start":{"line":235,"column":6},"end":{"line":235,"column":50}},"65":{"start":{"line":236,"column":6},"end":{"line":239,"column":7}},"66":{"start":{"line":237,"column":8},"end":{"line":237,"column":31}},"67":{"start":{"line":238,"column":8},"end":{"line":238,"column":34}},"68":{"start":{"line":242,"column":6},"end":{"line":242,"column":25}},"69":{"start":{"line":243,"column":6},"end":{"line":243,"column":32}},"70":{"start":{"line":244,"column":6},"end":{"line":244,"column":27}},"71":{"start":{"line":246,"column":4},"end":{"line":246,"column":31}},"72":{"start":{"line":254,"column":4},"end":{"line":254,"column":59}},"73":{"start":{"line":255,"column":4},"end":{"line":255,"column":27}},"74":{"start":{"line":289,"column":4},"end":{"line":289,"column":62}},"75":{"start":{"line":291,"column":4},"end":{"line":295,"column":7}},"76":{"start":{"line":292,"column":6},"end":{"line":292,"column":100}},"77":{"start":{"line":294,"column":6},"end":{"line":294,"column":104}},"78":{"start":{"line":297,"column":4},"end":{"line":297,"column":67}},"79":{"start":{"line":297,"column":21},"end":{"line":297,"column":65}},"80":{"start":{"line":306,"column":4},"end":{"line":308,"column":5}},"81":{"start":{"line":307,"column":6},"end":{"line":307,"column":26}},"82":{"start":{"line":309,"column":4},"end":{"line":309,"column":72}},"83":{"start":{"line":311,"column":4},"end":{"line":311,"column":34}},"84":{"start":{"line":312,"column":4},"end":{"line":312,"column":18}},"85":{"start":{"line":322,"column":4},"end":{"line":322,"column":41}},"86":{"start":{"line":326,"column":4},"end":{"line":326,"column":32}},"87":{"start":{"line":327,"column":4},"end":{"line":327,"column":16}},"88":{"start":{"line":331,"column":4},"end":{"line":331,"column":42}},"89":{"start":{"line":336,"column":0},"end":{"line":341,"column":3}},"90":{"start":{"line":337,"column":2},"end":{"line":340,"column":4}},"91":{"start":{"line":338,"column":4},"end":{"line":338,"column":33}},"92":{"start":{"line":339,"column":4},"end":{"line":339,"column":16}},"93":{"start":{"line":343,"column":0},"end":{"line":343,"column":25}}},"branchMap":{"1":{"line":33,"type":"binary-expr","locations":[{"start":{"line":33,"column":14},"end":{"line":33,"column":21}},{"start":{"line":33,"column":25},"end":{"line":33,"column":27}}]},"2":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":22},"end":{"line":34,"column":37}},{"start":{"line":34,"column":41},"end":{"line":34,"column":54}}]},"3":{"line":35,"type":"binary-expr","locations":[{"start":{"line":35,"column":19},"end":{"line":35,"column":31}},{"start":{"line":35,"column":35},"end":{"line":35,"column":48}}]},"4":{"line":40,"type":"binary-expr","locations":[{"start":{"line":40,"column":11},"end":{"line":40,"column":41}},{"start":{"line":40,"column":45},"end":{"line":40,"column":69}}]},"5":{"line":129,"type":"binary-expr","locations":[{"start":{"line":129,"column":20},"end":{"line":129,"column":28}},{"start":{"line":129,"column":32},"end":{"line":129,"column":39}},{"start":{"line":129,"column":43},"end":{"line":129,"column":46}}]},"6":{"line":160,"type":"if","locations":[{"start":{"line":160,"column":4},"end":{"line":160,"column":4}},{"start":{"line":160,"column":4},"end":{"line":160,"column":4}}]},"7":{"line":203,"type":"if","locations":[{"start":{"line":203,"column":4},"end":{"line":203,"column":4}},{"start":{"line":203,"column":4},"end":{"line":203,"column":4}}]},"8":{"line":231,"type":"if","locations":[{"start":{"line":231,"column":4},"end":{"line":231,"column":4}},{"start":{"line":231,"column":4},"end":{"line":231,"column":4}}]},"9":{"line":306,"type":"if","locations":[{"start":{"line":306,"column":4},"end":{"line":306,"column":4}},{"start":{"line":306,"column":4},"end":{"line":306,"column":4}}]}},"code":["'use strict';","","const assert = require('assert');","const fs = require('fs');","const KoaApplication = require('koa');","const EggConsoleLogger = require('egg-logger').EggConsoleLogger;","const debug = require('debug')('egg-core');","const is = require('is-type-of');","const co = require('co');","const BaseContextClass = require('./utils/base_context_class');","const utils = require('./utils');","const Router = require('./utils/router');","","","const DEPRECATE = Symbol('EggCore#deprecate');","const CLOSESET = Symbol('EggCore#closeSet');","const ISCLOSE = Symbol('EggCore#isClose');","const CLOSE_PROMISE = Symbol('EggCore#closePromise');","const ROUTER = Symbol('EggCore#router');","const EGG_LOADER = Symbol.for('egg#loader');","","class EggCore extends KoaApplication {","","  /**","   * @constructor","   * @param {Object} options - options","   * @param {String} [options.baseDir=process.cwd()] - the directory of application","   * @param {String} [options.type=application|agent] - wheter it's running in app worker or agent worker","   * @param {Object} [options.plugins] - custom plugins","   * @since 1.0.0","   */","  constructor(options) {","    options = options || {};","    options.baseDir = options.baseDir || process.cwd();","    options.type = options.type || 'application';","","    assert(typeof options.baseDir === 'string', 'options.baseDir required, and must be a string');","    assert(fs.existsSync(options.baseDir), `Directory ${options.baseDir} not exists`);","    assert(fs.statSync(options.baseDir).isDirectory(), `Directory ${options.baseDir} is not a directory`);","    assert(options.type === 'application' || options.type === 'agent', 'options.type should be application or agent');","","    super();","","    /**","     * @member {Object} EggCore#_options","     * @private","     * @since 1.0.0","     */","    this._options = options;","","    /**","     * logging for EggCore, avoid using console directly","     * @member {Logger} EggCore#console","     * @private","     * @since 1.0.0","     */","    this.console = new EggConsoleLogger();","","    // register a close set","    this[CLOSESET] = new Set();","    // cache deprecate object by file","    this[DEPRECATE] = new Map();","","    /**","     * @member {BaseContextClass} EggCore#BaseContextClass","     * @since 1.0.0","     */","    this.BaseContextClass = BaseContextClass;","","","    /**","     * Base controller to be extended by controller in `app.controller`","     * @class Controller","     * @extends BaseContextClass","     * @example","     * class UserController extends app.Controller {}","     */","    const Controller = this.BaseContextClass;","","    /**","     * Retreive base controller","     * @member {Controller} EggCore#Controller","     * @since 1.0.0","     */","    this.Controller = Controller;","","    /**","     * Base service to be extended by services in `app.service`","     * @class Service","     * @extends BaseContextClass","     * @example","     * class UserService extends app.Service {}","     */","    const Service = this.BaseContextClass;","","    /**","     * Retreive base service","     * @member {Service} EggCore#Service","     * @since 1.0.0","     */","    this.Service = Service;","","    /**","     * The loader instance, the default class is {@link EggLoader}.","     * If you want define","     * @member {EggLoader} EggCore#loader","     * @since 1.0.0","     */","    const Loader = this[EGG_LOADER];","    assert(Loader, 'Symbol.for(\\'egg#loader\\') is required');","    this.loader = new Loader({","      baseDir: options.baseDir,","      app: this,","      plugins: options.plugins,","      logger: this.console,","    });","","    this._initReady();","  }","","  /**","   * override koa's app.use, support async function","   * @param {Function} fn - middleware","   * @return {Application} app","   * @since 1.0.0","   */","  use(fn) {","    assert(is.function(fn), 'app.use() requires a function');","    debug('use %s', fn._name || fn.name || '-');","    this.middleware.push(utils.middleware(fn));","    return this;","  }","","  /**","   * Whether `application` or `agent`","   * @member {String}","   * @since 1.0.0","   */","  get type() {","    return this._options.type;","  }","","  /**","   * The current directory of application","   * @member {String}","   * @see {@link AppInfo#baseDir}","   * @since 1.0.0","   */","  get baseDir() {","    return this._options.baseDir;","  }","","  /**","   * Alias to {@link https://npmjs.com/package/depd}","   * @member {Function}","   * @since 1.0.0","   */","  get deprecate() {","    const caller = utils.getCalleeFromStack();","    if (!this[DEPRECATE].has(caller)) {","      const deprecate = require('depd')('egg');","      // dynamic set _file to caller","      deprecate._file = caller;","      this[DEPRECATE].set(caller, deprecate);","    }","    return this[DEPRECATE].get(caller);","  }","","  /**","   * The name of application","   * @member {String}","   * @see {@link AppInfo#name}","   * @since 1.0.0","   */","  get name() {","    return this.loader.pkg.name;","  }","","  /**","   * Retreive enabled plugins","   * @member {Object}","   * @since 1.0.0","   */","  get plugins() {","    return this.loader.plugins;","  }","","  /**","   * The configuration of application","   * @member {Config}","   * @since 1.0.0","   */","  get config() {","    return this.loader.config;","  }","","  /**","   * Excute scope after loaded and before app start","   *","   * @param  {Function|GeneratorFunction|AsyncFunction} scope function will excute before app start","   */","  beforeStart(scope) {","    if (!is.function(scope)) {","      throw new Error('beforeStart only support function');","    }","","    // get filename from stack","    const name = utils.getCalleeFromStack(true);","    const done = this.readyCallback(name);","","    // ensure scope excutes after load completed","    process.nextTick(() => {","      co(function* () {","        yield utils.callFn(scope);","      }).then(() => done(), done);","    });","  }","","  /**","   * Close all, it wil close","   * - callbacks registered by beforeClose","   * - emit `close` event","   * - remove add listeners","   *","   * If error is thrown when it's closing, the promise will reject.","   * It will also reject after following call.","   * @return {Promise} promise","   * @since 1.0.0","   */","  close() {","    if (this[CLOSE_PROMISE]) return this[CLOSE_PROMISE];","","    this[CLOSE_PROMISE] = co(function* closeFunction() {","      // close in reverse order: first created, last closed","      const closeFns = Array.from(this[CLOSESET]);","      for (const fn of closeFns.reverse()) {","        yield utils.callFn(fn);","        this[CLOSESET].delete(fn);","      }","","      // Be called after other close callbacks","      this.emit('close');","      this.removeAllListeners();","      this[ISCLOSE] = true;","    }.bind(this));","    return this[CLOSE_PROMISE];","  }","","  /**","   * Register a function that will be called when app close","   * @param {Function} fn - the function that can be generator function or async function","   */","  beforeClose(fn) {","    assert(is.function(fn), 'argument should be function');","    this[CLOSESET].add(fn);","  }","","  /**","   * @member {Function}","   * @private","   */","  _initReady() {","    /**","     * register an callback function that will be invoked when application is ready.","     * @method {Function} EggCore#ready","     * @see https://github.com/node-modules/ready","     * @since 1.0.0","     * @example","     * const app = new Application(...);","     * app.ready(err => {","     *   if (err) throw err;","     *   console.log('done');","     * });","     */","","    /**","     * If a client starts asynchronously, you can register `readyCallback`,","     * then the application will wait for the callback to ready","     *","     * It will log when the callback is not invoked after 10s","     *","     * Recommend to use {@link EggCore#beforeStart}","     * @method {Function} EggCore#readyCallback","     * @since 1.0.0","     * @example","     * const done = app.readyCallback('mysql');","     * mysql.ready(done);","     */","    require('ready-callback')({ timeout: 10000 }).mixin(this);","","    this.on('ready_stat', data => {","      this.console.info('[egg:core:ready_stat] end ready task %s, remain %j', data.id, data.remain);","    }).on('ready_timeout', id => {","      this.console.warn('[egg:core:ready_timeout] 10 seconds later %s was still unable to finish.', id);","    });","","    this.ready(() => debug('egg emit ready, application started'));","  }","","  /**","   * get router","   * @member {Router} EggCore#router","   * @since 1.0.0","   */","  get router() {","    if (this[ROUTER]) {","      return this[ROUTER];","    }","    const router = this[ROUTER] = new Router({ sensitive: true }, this);","    // register router middleware","    this.use(router.middleware());","    return router;","  }","","  /**","   * Alias to {@link Router#url}","   * @param {String} name - Router name","   * @param {Object} params - more parameters","   * @return {String} url","   */","  url(name, params) {","    return this.router.url(name, params);","  }","","  del(...args) {","    this.router.delete(...args);","    return this;","  }","","  get [EGG_LOADER]() {","    return require('./loader/egg_loader');","  }","}","","// delegate all router method to application","utils.methods.concat([ 'all', 'resources', 'register', 'redirect' ]).forEach(method => {","  EggCore.prototype[method] = function(...args) {","    this.router[method](...args);","    return this;","  };","});","","module.exports = EggCore;",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"33":0,"34":0,"35":0,"37":0,"38":0,"39":0,"40":0,"42":0,"49":0,"57":0,"60":0,"62":0,"68":0,"78":0,"85":0,"94":0,"101":0,"109":0,"110":0,"111":0,"118":0,"128":0,"129":0,"130":0,"131":0,"140":0,"150":0,"159":0,"160":0,"161":0,"163":0,"164":0,"166":0,"176":0,"185":0,"194":0,"203":0,"204":0,"208":0,"209":0,"212":0,"213":0,"214":0,"215":0,"231":0,"233":0,"235":0,"236":0,"237":0,"238":0,"242":0,"243":0,"244":0,"246":0,"254":0,"255":0,"289":0,"291":0,"292":0,"294":0,"297":0,"306":0,"307":0,"309":0,"311":0,"312":0,"322":0,"326":0,"327":0,"331":0,"336":1,"337":11,"338":0,"339":0,"343":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/utils/base_context_class.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/utils/base_context_class.js","s":{"1":0,"2":0,"3":0,"4":0,"5":1},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":15,"loc":{"start":{"line":15,"column":13},"end":{"line":15,"column":19}}}},"statementMap":{"1":{"start":{"line":20,"column":4},"end":{"line":20,"column":19}},"2":{"start":{"line":25,"column":4},"end":{"line":25,"column":23}},"3":{"start":{"line":30,"column":4},"end":{"line":30,"column":33}},"4":{"start":{"line":35,"column":4},"end":{"line":35,"column":31}},"5":{"start":{"line":39,"column":0},"end":{"line":39,"column":34}}},"branchMap":{},"code":["'use strict';","","/**"," * BaseContextClass is a base class that can be extended,"," * it's instantiated in context level,"," * {@link Helper}, {@link Service} is extending it."," */","class BaseContextClass {","","  /**","   * @constructor","   * @param {Context} ctx - context instance","   * @since 1.0.0","   */","  constructor(ctx) {","    /**","     * @member {Context} BaseContextClass#ctx","     * @since 1.0.0","     */","    this.ctx = ctx;","    /**","     * @member {Application} BaseContextClass#app","     * @since 1.0.0","     */","    this.app = ctx.app;","    /**","     * @member {Config} BaseContextClass#config","     * @since 1.0.0","     */","    this.config = ctx.app.config;","    /**","     * @member {Service} BaseContextClass#service","     * @since 1.0.0","     */","    this.service = ctx.service;","  }","}","","module.exports = BaseContextClass;",""],"l":{"20":0,"25":0,"30":0,"35":0,"39":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/utils/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/utils/index.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":1,"51":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":9,"loc":{"start":{"line":9,"column":10},"end":{"line":9,"column":21}}},"2":{"name":"(anonymous_2)","line":22,"loc":{"start":{"line":22,"column":14},"end":{"line":22,"column":25}}},"3":{"name":"(anonymous_3)","line":33,"loc":{"start":{"line":33,"column":10},"end":{"line":33,"column":21}}},"4":{"name":"(anonymous_4)","line":46,"loc":{"start":{"line":46,"column":12},"end":{"line":46,"column":17}}},"5":{"name":"(anonymous_5)","line":50,"loc":{"start":{"line":50,"column":11},"end":{"line":50,"column":28}}},"6":{"name":"(anonymous_6)","line":56,"loc":{"start":{"line":56,"column":20},"end":{"line":56,"column":31}}},"7":{"name":"prepareObjectStackTrace","line":92,"loc":{"start":{"line":92,"column":0},"end":{"line":92,"column":45}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":7,"column":0},"end":{"line":84,"column":2}},"4":{"start":{"line":10,"column":4},"end":{"line":19,"column":5}},"5":{"start":{"line":11,"column":6},"end":{"line":11,"column":36}},"6":{"start":{"line":12,"column":6},"end":{"line":12,"column":27}},"7":{"start":{"line":12,"column":16},"end":{"line":12,"column":27}},"8":{"start":{"line":14,"column":6},"end":{"line":14,"column":70}},"9":{"start":{"line":14,"column":26},"end":{"line":14,"column":70}},"10":{"start":{"line":15,"column":6},"end":{"line":15,"column":17}},"11":{"start":{"line":17,"column":6},"end":{"line":17,"column":84}},"12":{"start":{"line":18,"column":6},"end":{"line":18,"column":16}},"13":{"start":{"line":23,"column":4},"end":{"line":28,"column":5}},"14":{"start":{"line":24,"column":6},"end":{"line":24,"column":32}},"15":{"start":{"line":25,"column":6},"end":{"line":25,"column":18}},"16":{"start":{"line":27,"column":6},"end":{"line":27,"column":19}},"17":{"start":{"line":34,"column":4},"end":{"line":34,"column":22}},"18":{"start":{"line":35,"column":4},"end":{"line":35,"column":33}},"19":{"start":{"line":35,"column":26},"end":{"line":35,"column":33}},"20":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"21":{"start":{"line":37,"column":6},"end":{"line":37,"column":31}},"22":{"start":{"line":39,"column":4},"end":{"line":39,"column":26}},"23":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"24":{"start":{"line":41,"column":6},"end":{"line":41,"column":21}},"25":{"start":{"line":43,"column":4},"end":{"line":43,"column":13}},"26":{"start":{"line":47,"column":4},"end":{"line":47,"column":44}},"27":{"start":{"line":47,"column":34},"end":{"line":47,"column":44}},"28":{"start":{"line":50,"column":4},"end":{"line":53,"column":6}},"29":{"start":{"line":52,"column":6},"end":{"line":52,"column":64}},"30":{"start":{"line":52,"column":52},"end":{"line":52,"column":60}},"31":{"start":{"line":57,"column":4},"end":{"line":57,"column":40}},"32":{"start":{"line":58,"column":4},"end":{"line":58,"column":41}},"33":{"start":{"line":60,"column":4},"end":{"line":60,"column":54}},"34":{"start":{"line":61,"column":4},"end":{"line":61,"column":30}},"35":{"start":{"line":64,"column":4},"end":{"line":64,"column":19}},"36":{"start":{"line":65,"column":4},"end":{"line":65,"column":33}},"37":{"start":{"line":66,"column":4},"end":{"line":66,"column":32}},"38":{"start":{"line":68,"column":4},"end":{"line":73,"column":5},"skip":true},"39":{"start":{"line":71,"column":6},"end":{"line":71,"column":52},"skip":true},"40":{"start":{"line":72,"column":6},"end":{"line":72,"column":76},"skip":true},"41":{"start":{"line":72,"column":52},"end":{"line":72,"column":76},"skip":true},"42":{"start":{"line":75,"column":4},"end":{"line":75,"column":35}},"43":{"start":{"line":76,"column":4},"end":{"line":76,"column":34}},"44":{"start":{"line":79,"column":4},"end":{"line":79,"column":40},"skip":true},"45":{"start":{"line":79,"column":19},"end":{"line":79,"column":40},"skip":true},"46":{"start":{"line":80,"column":4},"end":{"line":80,"column":44}},"47":{"start":{"line":81,"column":4},"end":{"line":81,"column":65}},"48":{"start":{"line":81,"column":32},"end":{"line":81,"column":65}},"49":{"start":{"line":82,"column":4},"end":{"line":82,"column":83}},"50":{"start":{"line":92,"column":0},"end":{"line":94,"column":1}},"51":{"start":{"line":93,"column":2},"end":{"line":93,"column":15}}},"branchMap":{"1":{"line":12,"type":"if","locations":[{"start":{"line":12,"column":6},"end":{"line":12,"column":6}},{"start":{"line":12,"column":6},"end":{"line":12,"column":6}}]},"2":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":6},"end":{"line":14,"column":6}},{"start":{"line":14,"column":6},"end":{"line":14,"column":6}}]},"3":{"line":14,"type":"cond-expr","locations":[{"start":{"line":14,"column":52},"end":{"line":14,"column":63}},{"start":{"line":14,"column":66},"end":{"line":14,"column":69}}]},"4":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":11},"end":{"line":34,"column":15}},{"start":{"line":34,"column":19},"end":{"line":34,"column":21}}]},"5":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":35,"column":4}},{"start":{"line":35,"column":4},"end":{"line":35,"column":4}}]},"6":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":36,"column":4}},{"start":{"line":36,"column":4},"end":{"line":36,"column":4}}]},"7":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":40,"column":4}},{"start":{"line":40,"column":4},"end":{"line":40,"column":4}}]},"8":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":47,"column":4}},{"start":{"line":47,"column":4},"end":{"line":47,"column":4}}]},"9":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":4},"end":{"line":68,"column":4},"skip":true},{"start":{"line":68,"column":4},"end":{"line":68,"column":4},"skip":true}]},"10":{"line":71,"type":"binary-expr","locations":[{"start":{"line":71,"column":23},"end":{"line":71,"column":45},"skip":true},{"start":{"line":71,"column":49},"end":{"line":71,"column":51},"skip":true}]},"11":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":6},"end":{"line":72,"column":6},"skip":true},{"start":{"line":72,"column":6},"end":{"line":72,"column":6},"skip":true}]},"12":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":4},"end":{"line":79,"column":4},"skip":true},{"start":{"line":79,"column":4},"end":{"line":79,"column":4},"skip":true}]},"13":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":4},"end":{"line":81,"column":4}},{"start":{"line":81,"column":4},"end":{"line":81,"column":4}}]},"14":{"line":81,"type":"binary-expr","locations":[{"start":{"line":81,"column":8},"end":{"line":81,"column":17}},{"start":{"line":81,"column":21},"end":{"line":81,"column":30}}]},"15":{"line":81,"type":"binary-expr","locations":[{"start":{"line":81,"column":39},"end":{"line":81,"column":47}},{"start":{"line":81,"column":51},"end":{"line":81,"column":64}}]}},"code":["'use strict';","","const co = require('co');","const is = require('is-type-of');","","","module.exports = {","","  loadFile(filepath) {","    try {","      const obj = require(filepath);","      if (!obj) return obj;","      // it's es module","      if (obj.__esModule) return 'default' in obj ? obj.default : obj;","      return obj;","    } catch (err) {","      err.message = '[egg-core] load file: ' + filepath + ', error: ' + err.message;","      throw err;","    }","  },","","  existsModule(filepath) {","    try {","      require.resolve(filepath);","      return true;","    } catch (e) {","      return false;","    }","  },","","  methods: [ 'head', 'options', 'get', 'put', 'patch', 'post', 'delete' ],","","  * callFn(fn, args) {","    args = args || [];","    if (!is.function(fn)) return;","    if (is.generatorFunction(fn)) {","      return yield fn(...args);","    }","    const r = fn(...args);","    if (is.promise(r)) {","      return yield r;","    }","    return r;","  },","","  middleware(fn) {","    if (is.generatorFunction(fn)) return fn;","","    // support async function","    return function* (next) {","      // next is a generator","      yield module.exports.callFn(fn, [ this, () => co(next) ]);","    };","  },","","  getCalleeFromStack(withLine) {","    const limit = Error.stackTraceLimit;","    const prep = Error.prepareStackTrace;","","    Error.prepareStackTrace = prepareObjectStackTrace;","    Error.stackTraceLimit = 4;","","    // capture the stack","    const obj = {};","    Error.captureStackTrace(obj);","    let callSite = obj.stack[2];","    /* istanbul ignore next */","    if (callSite) {","      // egg-mock will create a proxy","      // https://github.com/eggjs/egg-mock/blob/master/lib/app.js#L167","      const filename = callSite.getFileName() || '';","      if (filename.endsWith('egg-mock/lib/app.js')) callSite = obj.stack[3];","    }","","    Error.prepareStackTrace = prep;","    Error.stackTraceLimit = limit;","","    /* istanbul ignore next */","    if (!callSite) return '<anonymous>';","    const fileName = callSite.getFileName();","    if (!withLine || !fileName) return fileName || '<anonymous>';","    return `${fileName}:${callSite.getLineNumber()}:${callSite.getColumnNumber()}`;","  },","};","","","/**"," * Capture call site stack from v8."," * https://github.com/v8/v8/wiki/Stack-Trace-API"," */","","function prepareObjectStackTrace(obj, stack) {","  return stack;","}",""],"l":{"3":1,"4":1,"7":1,"10":0,"11":0,"12":0,"14":0,"15":0,"17":0,"18":0,"23":0,"24":0,"25":0,"27":0,"34":0,"35":0,"36":0,"37":0,"39":0,"40":0,"41":0,"43":0,"47":0,"50":0,"52":0,"57":0,"58":0,"60":0,"61":0,"64":0,"65":0,"66":0,"68":1,"71":1,"72":1,"75":0,"76":0,"79":1,"80":0,"81":0,"82":0,"92":1,"93":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/utils/router.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/utils/router.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":1,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":1,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0,0],"18":[0,0],"19":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"fnMap":{"1":{"name":"(anonymous_1)","line":61,"loc":{"start":{"line":61,"column":13},"end":{"line":61,"column":25}}},"2":{"name":"(anonymous_2)","line":68,"loc":{"start":{"line":68,"column":19},"end":{"line":68,"column":22}}},"3":{"name":"(anonymous_3)","line":87,"loc":{"start":{"line":87,"column":10},"end":{"line":87,"column":45}}},"4":{"name":"(anonymous_4)","line":138,"loc":{"start":{"line":138,"column":11},"end":{"line":138,"column":21}}},"5":{"name":"(anonymous_5)","line":191,"loc":{"start":{"line":191,"column":5},"end":{"line":191,"column":20}}},"6":{"name":"(anonymous_6)","line":203,"loc":{"start":{"line":203,"column":44},"end":{"line":203,"column":62}}},"7":{"name":"(anonymous_7)","line":241,"loc":{"start":{"line":241,"column":9},"end":{"line":241,"column":24}}},"8":{"name":"splitedRouterParams","line":256,"loc":{"start":{"line":256,"column":0},"end":{"line":256,"column":35}}},"9":{"name":"convertMiddlewares","line":285,"loc":{"start":{"line":285,"column":0},"end":{"line":285,"column":46}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":40}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":41}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":33}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":43}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":33}},"8":{"start":{"line":11,"column":0},"end":{"line":49,"column":2}},"9":{"start":{"line":62,"column":4},"end":{"line":62,"column":16}},"10":{"start":{"line":63,"column":4},"end":{"line":63,"column":19}},"11":{"start":{"line":65,"column":4},"end":{"line":65,"column":29}},"12":{"start":{"line":70,"column":4},"end":{"line":76,"column":7}},"13":{"start":{"line":71,"column":6},"end":{"line":75,"column":8}},"14":{"start":{"line":72,"column":8},"end":{"line":72,"column":50}},"15":{"start":{"line":73,"column":8},"end":{"line":73,"column":88}},"16":{"start":{"line":74,"column":8},"end":{"line":74,"column":38}},"17":{"start":{"line":89,"column":4},"end":{"line":89,"column":77}},"18":{"start":{"line":90,"column":4},"end":{"line":90,"column":60}},"19":{"start":{"line":91,"column":4},"end":{"line":91,"column":60}},"20":{"start":{"line":139,"column":4},"end":{"line":139,"column":46}},"21":{"start":{"line":140,"column":4},"end":{"line":140,"column":73}},"22":{"start":{"line":142,"column":4},"end":{"line":142,"column":18}},"23":{"start":{"line":143,"column":4},"end":{"line":143,"column":20}},"24":{"start":{"line":144,"column":4},"end":{"line":151,"column":5}},"25":{"start":{"line":146,"column":6},"end":{"line":146,"column":31}},"26":{"start":{"line":147,"column":6},"end":{"line":147,"column":33}},"27":{"start":{"line":150,"column":6},"end":{"line":150,"column":33}},"28":{"start":{"line":154,"column":4},"end":{"line":154,"column":40}},"29":{"start":{"line":156,"column":4},"end":{"line":173,"column":5}},"30":{"start":{"line":157,"column":6},"end":{"line":157,"column":37}},"31":{"start":{"line":158,"column":6},"end":{"line":158,"column":28}},"32":{"start":{"line":158,"column":19},"end":{"line":158,"column":28}},"33":{"start":{"line":160,"column":6},"end":{"line":160,"column":33}},"34":{"start":{"line":161,"column":6},"end":{"line":161,"column":23}},"35":{"start":{"line":162,"column":6},"end":{"line":166,"column":7}},"36":{"start":{"line":163,"column":8},"end":{"line":163,"column":52}},"37":{"start":{"line":165,"column":8},"end":{"line":165,"column":50}},"38":{"start":{"line":167,"column":6},"end":{"line":169,"column":7}},"39":{"start":{"line":168,"column":8},"end":{"line":168,"column":54}},"40":{"start":{"line":170,"column":6},"end":{"line":170,"column":41}},"41":{"start":{"line":171,"column":6},"end":{"line":171,"column":69}},"42":{"start":{"line":172,"column":6},"end":{"line":172,"column":94}},"43":{"start":{"line":175,"column":4},"end":{"line":175,"column":16}},"44":{"start":{"line":192,"column":4},"end":{"line":192,"column":35}},"45":{"start":{"line":193,"column":4},"end":{"line":193,"column":26}},"46":{"start":{"line":193,"column":16},"end":{"line":193,"column":26}},"47":{"start":{"line":195,"column":4},"end":{"line":195,"column":24}},"48":{"start":{"line":196,"column":4},"end":{"line":196,"column":25}},"49":{"start":{"line":198,"column":4},"end":{"line":198,"column":89}},"50":{"start":{"line":200,"column":4},"end":{"line":200,"column":23}},"51":{"start":{"line":201,"column":4},"end":{"line":227,"column":5}},"52":{"start":{"line":202,"column":6},"end":{"line":202,"column":32}},"53":{"start":{"line":203,"column":6},"end":{"line":210,"column":9}},"54":{"start":{"line":204,"column":8},"end":{"line":208,"column":9}},"55":{"start":{"line":205,"column":10},"end":{"line":205,"column":35}},"56":{"start":{"line":206,"column":10},"end":{"line":206,"column":35}},"57":{"start":{"line":207,"column":10},"end":{"line":207,"column":88}},"58":{"start":{"line":209,"column":8},"end":{"line":209,"column":18}},"59":{"start":{"line":212,"column":6},"end":{"line":226,"column":7}},"60":{"start":{"line":213,"column":8},"end":{"line":215,"column":9}},"61":{"start":{"line":214,"column":10},"end":{"line":214,"column":19}},"62":{"start":{"line":217,"column":8},"end":{"line":217,"column":33}},"63":{"start":{"line":218,"column":8},"end":{"line":218,"column":59}},"64":{"start":{"line":219,"column":8},"end":{"line":225,"column":9}},"65":{"start":{"line":220,"column":10},"end":{"line":222,"column":11}},"66":{"start":{"line":221,"column":12},"end":{"line":221,"column":77}},"67":{"start":{"line":224,"column":10},"end":{"line":224,"column":78}},"68":{"start":{"line":229,"column":4},"end":{"line":236,"column":5}},"69":{"start":{"line":230,"column":6},"end":{"line":230,"column":41}},"70":{"start":{"line":231,"column":6},"end":{"line":235,"column":7}},"71":{"start":{"line":232,"column":8},"end":{"line":232,"column":35}},"72":{"start":{"line":234,"column":8},"end":{"line":234,"column":35}},"73":{"start":{"line":238,"column":4},"end":{"line":238,"column":15}},"74":{"start":{"line":242,"column":4},"end":{"line":242,"column":34}},"75":{"start":{"line":256,"column":0},"end":{"line":269,"column":1}},"76":{"start":{"line":257,"column":2},"end":{"line":257,"column":13}},"77":{"start":{"line":258,"column":2},"end":{"line":258,"column":18}},"78":{"start":{"line":259,"column":2},"end":{"line":267,"column":3}},"79":{"start":{"line":261,"column":4},"end":{"line":261,"column":30}},"80":{"start":{"line":262,"column":4},"end":{"line":262,"column":32}},"81":{"start":{"line":265,"column":4},"end":{"line":265,"column":30}},"82":{"start":{"line":266,"column":4},"end":{"line":266,"column":32}},"83":{"start":{"line":268,"column":2},"end":{"line":268,"column":33}},"84":{"start":{"line":285,"column":0},"end":{"line":302,"column":1}},"85":{"start":{"line":286,"column":2},"end":{"line":286,"column":37}},"86":{"start":{"line":289,"column":2},"end":{"line":289,"column":50}},"87":{"start":{"line":292,"column":2},"end":{"line":300,"column":3}},"88":{"start":{"line":293,"column":4},"end":{"line":293,"column":42}},"89":{"start":{"line":294,"column":4},"end":{"line":294,"column":29}},"90":{"start":{"line":295,"column":4},"end":{"line":298,"column":7}},"91":{"start":{"line":296,"column":6},"end":{"line":296,"column":21}},"92":{"start":{"line":297,"column":6},"end":{"line":297,"column":73}},"93":{"start":{"line":297,"column":16},"end":{"line":297,"column":73}},"94":{"start":{"line":299,"column":4},"end":{"line":299,"column":21}},"95":{"start":{"line":301,"column":2},"end":{"line":301,"column":44}},"96":{"start":{"line":304,"column":0},"end":{"line":304,"column":24}}},"branchMap":{"1":{"line":89,"type":"cond-expr","locations":[{"start":{"line":89,"column":47},"end":{"line":89,"column":58}},{"start":{"line":89,"column":61},"end":{"line":89,"column":76}}]},"2":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":4},"end":{"line":144,"column":4}},{"start":{"line":144,"column":4},"end":{"line":144,"column":4}}]},"3":{"line":158,"type":"if","locations":[{"start":{"line":158,"column":6},"end":{"line":158,"column":6}},{"start":{"line":158,"column":6},"end":{"line":158,"column":6}}]},"4":{"line":162,"type":"if","locations":[{"start":{"line":162,"column":6},"end":{"line":162,"column":6}},{"start":{"line":162,"column":6},"end":{"line":162,"column":6}}]},"5":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":6},"end":{"line":167,"column":6}},{"start":{"line":167,"column":6},"end":{"line":167,"column":6}}]},"6":{"line":171,"type":"cond-expr","locations":[{"start":{"line":171,"column":33},"end":{"line":171,"column":59}},{"start":{"line":171,"column":62},"end":{"line":171,"column":68}}]},"7":{"line":193,"type":"if","locations":[{"start":{"line":193,"column":4},"end":{"line":193,"column":4}},{"start":{"line":193,"column":4},"end":{"line":193,"column":4}}]},"8":{"line":201,"type":"if","locations":[{"start":{"line":201,"column":4},"end":{"line":201,"column":4}},{"start":{"line":201,"column":4},"end":{"line":201,"column":4}}]},"9":{"line":201,"type":"binary-expr","locations":[{"start":{"line":201,"column":8},"end":{"line":201,"column":32}},{"start":{"line":201,"column":36},"end":{"line":201,"column":49}}]},"10":{"line":204,"type":"if","locations":[{"start":{"line":204,"column":8},"end":{"line":204,"column":8}},{"start":{"line":204,"column":8},"end":{"line":204,"column":8}}]},"11":{"line":207,"type":"cond-expr","locations":[{"start":{"line":207,"column":68},"end":{"line":207,"column":77}},{"start":{"line":207,"column":80},"end":{"line":207,"column":86}}]},"12":{"line":213,"type":"if","locations":[{"start":{"line":213,"column":8},"end":{"line":213,"column":8}},{"start":{"line":213,"column":8},"end":{"line":213,"column":8}}]},"13":{"line":219,"type":"if","locations":[{"start":{"line":219,"column":8},"end":{"line":219,"column":8}},{"start":{"line":219,"column":8},"end":{"line":219,"column":8}}]},"14":{"line":229,"type":"if","locations":[{"start":{"line":229,"column":4},"end":{"line":229,"column":4}},{"start":{"line":229,"column":4},"end":{"line":229,"column":4}}]},"15":{"line":231,"type":"if","locations":[{"start":{"line":231,"column":6},"end":{"line":231,"column":6}},{"start":{"line":231,"column":6},"end":{"line":231,"column":6}}]},"16":{"line":259,"type":"if","locations":[{"start":{"line":259,"column":2},"end":{"line":259,"column":2}},{"start":{"line":259,"column":2},"end":{"line":259,"column":2}}]},"17":{"line":259,"type":"binary-expr","locations":[{"start":{"line":259,"column":6},"end":{"line":259,"column":22}},{"start":{"line":259,"column":27},"end":{"line":259,"column":45}},{"start":{"line":259,"column":49},"end":{"line":259,"column":67}}]},"18":{"line":292,"type":"if","locations":[{"start":{"line":292,"column":2},"end":{"line":292,"column":2}},{"start":{"line":292,"column":2},"end":{"line":292,"column":2}}]},"19":{"line":297,"type":"if","locations":[{"start":{"line":297,"column":6},"end":{"line":297,"column":6}},{"start":{"line":297,"column":6},"end":{"line":297,"column":6}}]}},"code":["'use strict';","","const is = require('is-type-of');","const KoaRouter = require('koa-router');","const utility = require('utility');","const inflection = require('inflection');","const assert = require('assert');","const methods = require('./index').methods;","const utils = require('./index');","","const REST_MAP = {","  index: {","    suffix: '',","    method: 'GET',","  },","  new: {","    namePrefix: 'new_',","    member: true,","    suffix: 'new',","    method: 'GET',","  },","  create: {","    suffix: '',","    method: 'POST',","  },","  show: {","    member: true,","    suffix: ':id',","    method: 'GET',","  },","  edit: {","    member: true,","    namePrefix: 'edit_',","    suffix: ':id/edit',","    method: 'GET',","  },","  update: {","    member: true,","    namePrefix: '',","    suffix: ':id',","    method: 'PUT',","  },","  destroy: {","    member: true,","    namePrefix: 'destroy_',","    suffix: ':id',","    method: 'DELETE',","  },","};","","/**"," * Extend {@link https://github.com/alexmingoia/koa-router}"," */","class Router extends KoaRouter {","","  /**","   * @constructor","   * @param {Object} opts - Router options.","   * @param {Application} app - Application object.","   */","  constructor(opts, app) {","    super(opts);","    this.app = app;","    // patch koa-router@5.x","    this.patchRouterMethod();","  }","","  patchRouterMethod() {","    // patch router methods to support async function middleware and string controller","    methods.concat([ 'all' ]).forEach(method => {","      this[method] = (...args) => {","        const splited = splitedRouterParams(args);","        args = splited.prefix.concat(convertMiddlewares(splited.middlewares, this.app));","        return super[method](...args);","      };","    });","  }","","  /**","   * Create and register a route.","   * @param {String} path - url path","   * @param {Array} methods - Array of HTTP verbs","   * @param {Array} middlewares -","   * @param {Object} opts -","   * @return {Route} this","   */","  register(path, methods, middlewares, opts) {","    // patch register to support async function middleware and string controller","    middlewares = Array.isArray(middlewares) ? middlewares : [ middlewares ];","    middlewares = convertMiddlewares(middlewares, this.app);","    return super.register(path, methods, middlewares, opts);","  }","","  /**","   * restful router api","   * @param {String} name - Router name","   * @param {String} prefix - url prefix","   * @param {Function} middleware - middleware or controller","   * @example","   * ```js","   * app.resources('/posts', 'posts')","   * app.resources('posts', '/posts', 'posts')","   * app.resources('posts', '/posts', app.role.can('user'), app.controller.posts)","   * ```","   *","   * Examples:","   *","   * ```js","   * app.resources('/posts', 'posts')","   * ```","   *","   * yield router mapping","   *","   * Method | Path            | Route Name     | Controller.Action","   * -------|-----------------|----------------|-----------------------------","   * GET    | /posts          | posts          | app.controller.posts.index","   * GET    | /posts/new      | new_post       | app.controller.posts.new","   * GET    | /posts/:id      | post           | app.controller.posts.show","   * GET    | /posts/:id/edit | edit_post      | app.controller.posts.edit","   * POST   | /posts          | posts          | app.controller.posts.create","   * PUT    | /posts/:id      | post           | app.controller.posts.update","   * DELETE | /posts/:id      | post           | app.controller.posts.destroy","   *","   * app.router.url can generate url based on arguments","   * ```js","   * app.router.url('posts')","   * => /posts","   * app.router.url('post', { id: 1 })","   * => /posts/1","   * app.router.url('new_post')","   * => /posts/new","   * app.router.url('edit_post', { id: 1 })","   * => /posts/1/edit","   * ```","   * @return {Router} return route object.","   * @since 1.0.0","   */","  resources(...args) {","    const splited = splitedRouterParams(args);","    const middleware = convertMiddlewares(splited.middlewares, this.app);","","    let name = '';","    let prefix = '';","    if (splited.prefix.length === 2) {","      // router.get('users', '/users')","      name = splited.prefix[0];","      prefix = splited.prefix[1];","    } else {","      // router.get('/users')","      prefix = splited.prefix[0];","    }","","    // last argument is Controller object","    const controller = middleware.pop();","","    for (const key in REST_MAP) {","      const action = controller[key];","      if (!action) continue;","","      const opts = REST_MAP[key];","      let formatedName;","      if (opts.member) {","        formatedName = inflection.singularize(name);","      } else {","        formatedName = inflection.pluralize(name);","      }","      if (opts.namePrefix) {","        formatedName = opts.namePrefix + formatedName;","      }","      prefix = prefix.replace(/\\/$/, '');","      const path = opts.suffix ? `${prefix}/${opts.suffix}` : prefix;","      this.register(path, [ opts.method ], middleware.concat(action), { name: formatedName });","    }","","    return this;","  }","","  /**","   * @param {String} name - Router name","   * @param {Object} params - more parameters","   * @example","   * ```js","   * router.url('edit_post', { id: 1, name: 'foo', page: 2 })","   * => /posts/1/edit?name=foo&page=2","   * router.url('posts', { name: 'foo&1', page: 2 })","   * => /posts?name=foo%261&page=2","   * ```","   * @return {String} url by path name and query params.","   * @since 1.0.0","   */","  url(name, params) {","    const route = this.route(name);","    if (!route) return '';","","    const args = params;","    let url = route.path;","","    assert(!is.regExp(url), `Can't get the url for regExp ${url} for by name '${name}'`);","","    const queries = [];","    if (typeof args === 'object' && args !== null) {","      const replacedParams = [];","      url = url.replace(/:([a-zA-Z_]\\w*)/g, function($0, key) {","        if (utility.has(args, key)) {","          const values = args[key];","          replacedParams.push(key);","          return utility.encodeURIComponent(Array.isArray(values) ? values[0] : values);","        }","        return $0;","      });","","      for (const key in args) {","        if (replacedParams.indexOf(key) !== -1) {","          continue;","        }","","        const values = args[key];","        const encodedKey = utility.encodeURIComponent(key);","        if (Array.isArray(values)) {","          for (const val of values) {","            queries.push(`${encodedKey}=${utility.encodeURIComponent(val)}`);","          }","        } else {","          queries.push(`${encodedKey}=${utility.encodeURIComponent(values)}`);","        }","      }","    }","","    if (queries.length > 0) {","      const queryStr = queries.join('&');","      if (url.indexOf('?') === -1) {","        url = `${url}?${queryStr}`;","      } else {","        url = `${url}&${queryStr}`;","      }","    }","","    return url;","  }","","  pathFor(name, params) {","    return this.url(name, params);","  }","}","","/**"," * split (name, url, ...middleware, controller) to"," * {"," *   prefix: [name, url]"," *   middlewares [...middleware, controller]"," * }"," *"," * @param  {Array} args router params"," * @return {Object} prefix and middlewares"," */","function splitedRouterParams(args) {","  let prefix;","  let middlewares;","  if (args.length >= 3 && (is.string(args[1]) || is.regExp(args[1]))) {","    // app.get(name, url, [...middleware], controller)","    prefix = args.slice(0, 2);","    middlewares = args.slice(2);","  } else {","    // app.get(url, [...middleware], controller)","    prefix = args.slice(0, 1);","    middlewares = args.slice(1);","  }","  return { prefix, middlewares };","}","","/**"," * 1. make controller(last argument) support string"," * - [url, controller]: app.get('/home', 'home');"," * - [name, url, controller(string)]: app.get('posts', '/posts', 'posts.list');"," * - [name, url, controller]: app.get('posts', '/posts', app.controller.posts.list);"," * - [name, url(regexp), controller]: app.get('regRouter', /\\/home\\/index/, 'home.index');"," * - [name, url, middleware, [...], controller]: `app.get(/user/:id', hasLogin, canGetUser, 'user.show');`"," *"," * 2. make middleware support async function"," *"," * @param  {Array} middlewares middlewares and controller(last middleware)"," * @param  {Application} app  egg application instance"," * @return {Array} middlewares"," */","function convertMiddlewares(middlewares, app) {","  let controller = middlewares.pop();","","  // make middleware support async function","  middlewares = middlewares.map(utils.middleware);","","  // make controller(last argument) support string","  if (is.string(controller)) {","    const actions = controller.split('.');","    let obj = app.controller;","    actions.forEach(key => {","      obj = obj[key];","      if (!obj) throw new Error(`controller '${controller}' not exists`);","    });","    controller = obj;","  }","  return middlewares.concat([ controller ]);","}","","module.exports = Router;",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"11":1,"62":0,"63":0,"65":0,"70":0,"71":0,"72":0,"73":0,"74":0,"89":0,"90":0,"91":0,"139":0,"140":0,"142":0,"143":0,"144":0,"146":0,"147":0,"150":0,"154":0,"156":0,"157":0,"158":0,"160":0,"161":0,"162":0,"163":0,"165":0,"167":0,"168":0,"170":0,"171":0,"172":0,"175":0,"192":0,"193":0,"195":0,"196":0,"198":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"209":0,"212":0,"213":0,"214":0,"217":0,"218":0,"219":0,"220":0,"221":0,"224":0,"229":0,"230":0,"231":0,"232":0,"234":0,"238":0,"242":0,"256":1,"257":0,"258":0,"259":0,"261":0,"262":0,"265":0,"266":0,"268":0,"285":1,"286":0,"289":0,"292":0,"293":0,"294":0,"295":0,"296":0,"297":0,"299":0,"301":0,"304":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/egg_loader.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/egg_loader.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":1,"85":1,"86":8,"87":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"fnMap":{"1":{"name":"(anonymous_1)","line":25,"loc":{"start":{"line":25,"column":13},"end":{"line":25,"column":23}}},"2":{"name":"(anonymous_2)","line":91,"loc":{"start":{"line":91,"column":14},"end":{"line":91,"column":17}}},"3":{"name":"(anonymous_3)","line":122,"loc":{"start":{"line":122,"column":12},"end":{"line":122,"column":15}}},"4":{"name":"(anonymous_4)","line":136,"loc":{"start":{"line":136,"column":12},"end":{"line":136,"column":15}}},"5":{"name":"(anonymous_5)","line":146,"loc":{"start":{"line":146,"column":12},"end":{"line":146,"column":15}}},"6":{"name":"(anonymous_6)","line":218,"loc":{"start":{"line":218,"column":13},"end":{"line":218,"column":16}}},"7":{"name":"(anonymous_7)","line":261,"loc":{"start":{"line":261,"column":10},"end":{"line":261,"column":21}}},"8":{"name":"(anonymous_8)","line":288,"loc":{"start":{"line":288,"column":14},"end":{"line":288,"column":17}}},"9":{"name":"(anonymous_9)","line":329,"loc":{"start":{"line":329,"column":11},"end":{"line":329,"column":38}}},"10":{"name":"(anonymous_10)","line":346,"loc":{"start":{"line":346,"column":15},"end":{"line":346,"column":42}}},"11":{"name":"(anonymous_11)","line":359,"loc":{"start":{"line":359,"column":16},"end":{"line":359,"column":19}}},"12":{"name":"(anonymous_12)","line":367,"loc":{"start":{"line":367,"column":19},"end":{"line":367,"column":22}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":33}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":50}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":43}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":40}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":44}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":50}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":34}},"10":{"start":{"line":26,"column":4},"end":{"line":26,"column":27}},"11":{"start":{"line":27,"column":4},"end":{"line":27,"column":86}},"12":{"start":{"line":28,"column":4},"end":{"line":28,"column":56}},"13":{"start":{"line":29,"column":4},"end":{"line":29,"column":62}},"14":{"start":{"line":30,"column":4},"end":{"line":30,"column":43}},"15":{"start":{"line":32,"column":4},"end":{"line":32,"column":32}},"16":{"start":{"line":39,"column":4},"end":{"line":39,"column":72}},"17":{"start":{"line":66,"column":4},"end":{"line":66,"column":39}},"18":{"start":{"line":67,"column":4},"end":{"line":67,"column":47}},"19":{"start":{"line":74,"column":4},"end":{"line":74,"column":41}},"20":{"start":{"line":75,"column":4},"end":{"line":75,"column":49}},"21":{"start":{"line":81,"column":4},"end":{"line":81,"column":37}},"22":{"start":{"line":92,"column":4},"end":{"line":92,"column":18}},"23":{"start":{"line":94,"column":4},"end":{"line":94,"column":66}},"24":{"start":{"line":95,"column":4},"end":{"line":97,"column":5}},"25":{"start":{"line":96,"column":6},"end":{"line":96,"column":58}},"26":{"start":{"line":99,"column":4},"end":{"line":101,"column":5}},"27":{"start":{"line":100,"column":6},"end":{"line":100,"column":45}},"28":{"start":{"line":103,"column":4},"end":{"line":111,"column":5}},"29":{"start":{"line":104,"column":6},"end":{"line":110,"column":7}},"30":{"start":{"line":105,"column":8},"end":{"line":105,"column":31}},"31":{"start":{"line":106,"column":13},"end":{"line":110,"column":7}},"32":{"start":{"line":107,"column":8},"end":{"line":107,"column":27}},"33":{"start":{"line":109,"column":8},"end":{"line":109,"column":28}},"34":{"start":{"line":113,"column":4},"end":{"line":113,"column":21}},"35":{"start":{"line":123,"column":4},"end":{"line":126,"column":5}},"36":{"start":{"line":124,"column":6},"end":{"line":124,"column":67}},"37":{"start":{"line":125,"column":6},"end":{"line":125,"column":27}},"38":{"start":{"line":127,"column":4},"end":{"line":127,"column":64}},"39":{"start":{"line":128,"column":4},"end":{"line":128,"column":52}},"40":{"start":{"line":138,"column":4},"end":{"line":138,"column":62}},"41":{"start":{"line":147,"column":4},"end":{"line":147,"column":31}},"42":{"start":{"line":148,"column":4},"end":{"line":148,"column":35}},"43":{"start":{"line":149,"column":4},"end":{"line":149,"column":41}},"44":{"start":{"line":155,"column":4},"end":{"line":208,"column":6}},"45":{"start":{"line":220,"column":4},"end":{"line":220,"column":38}},"46":{"start":{"line":221,"column":4},"end":{"line":221,"column":24}},"47":{"start":{"line":223,"column":4},"end":{"line":223,"column":25}},"48":{"start":{"line":226,"column":4},"end":{"line":242,"column":5}},"49":{"start":{"line":227,"column":6},"end":{"line":227,"column":43}},"50":{"start":{"line":231,"column":6},"end":{"line":233,"column":7}},"51":{"start":{"line":232,"column":8},"end":{"line":232,"column":14}},"52":{"start":{"line":235,"column":6},"end":{"line":235,"column":120}},"53":{"start":{"line":236,"column":6},"end":{"line":236,"column":55}},"54":{"start":{"line":237,"column":6},"end":{"line":237,"column":101}},"55":{"start":{"line":238,"column":6},"end":{"line":238,"column":48}},"56":{"start":{"line":239,"column":6},"end":{"line":241,"column":7}},"57":{"start":{"line":240,"column":8},"end":{"line":240,"column":35}},"58":{"start":{"line":244,"column":4},"end":{"line":244,"column":20}},"59":{"start":{"line":262,"column":4},"end":{"line":264,"column":5}},"60":{"start":{"line":263,"column":6},"end":{"line":263,"column":18}},"61":{"start":{"line":266,"column":4},"end":{"line":266,"column":41}},"62":{"start":{"line":268,"column":4},"end":{"line":268,"column":58}},"63":{"start":{"line":269,"column":4},"end":{"line":269,"column":51}},"64":{"start":{"line":269,"column":29},"end":{"line":269,"column":51}},"65":{"start":{"line":270,"column":4},"end":{"line":270,"column":59}},"66":{"start":{"line":289,"column":4},"end":{"line":291,"column":5}},"67":{"start":{"line":290,"column":6},"end":{"line":290,"column":23}},"68":{"start":{"line":293,"column":4},"end":{"line":293,"column":32}},"69":{"start":{"line":295,"column":4},"end":{"line":302,"column":5}},"70":{"start":{"line":296,"column":6},"end":{"line":301,"column":7}},"71":{"start":{"line":297,"column":8},"end":{"line":300,"column":11}},"72":{"start":{"line":305,"column":4},"end":{"line":310,"column":5}},"73":{"start":{"line":306,"column":6},"end":{"line":309,"column":9}},"74":{"start":{"line":313,"column":4},"end":{"line":316,"column":7}},"75":{"start":{"line":318,"column":4},"end":{"line":318,"column":34}},"76":{"start":{"line":319,"column":4},"end":{"line":319,"column":16}},"77":{"start":{"line":330,"column":4},"end":{"line":330,"column":43}},"78":{"start":{"line":331,"column":4},"end":{"line":335,"column":12}},"79":{"start":{"line":336,"column":4},"end":{"line":336,"column":31}},"80":{"start":{"line":347,"column":4},"end":{"line":351,"column":12}},"81":{"start":{"line":352,"column":4},"end":{"line":352,"column":34}},"82":{"start":{"line":360,"column":4},"end":{"line":360,"column":22}},"83":{"start":{"line":368,"column":4},"end":{"line":368,"column":25}},"84":{"start":{"line":378,"column":0},"end":{"line":387,"column":2}},"85":{"start":{"line":389,"column":0},"end":{"line":391,"column":1}},"86":{"start":{"line":390,"column":2},"end":{"line":390,"column":45}},"87":{"start":{"line":393,"column":0},"end":{"line":393,"column":27}}},"branchMap":{"1":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":4},"end":{"line":95,"column":4}},{"start":{"line":95,"column":4},"end":{"line":95,"column":4}}]},"2":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":4},"end":{"line":99,"column":4}},{"start":{"line":99,"column":4},"end":{"line":99,"column":4}}]},"3":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":4},"end":{"line":103,"column":4}},{"start":{"line":103,"column":4},"end":{"line":103,"column":4}}]},"4":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":6},"end":{"line":104,"column":6}},{"start":{"line":104,"column":6},"end":{"line":104,"column":6}}]},"5":{"line":106,"type":"if","locations":[{"start":{"line":106,"column":13},"end":{"line":106,"column":13}},{"start":{"line":106,"column":13},"end":{"line":106,"column":13}}]},"6":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":4},"end":{"line":123,"column":4}},{"start":{"line":123,"column":4},"end":{"line":123,"column":4}}]},"7":{"line":138,"type":"binary-expr","locations":[{"start":{"line":138,"column":11},"end":{"line":138,"column":31}},{"start":{"line":138,"column":35},"end":{"line":138,"column":44}},{"start":{"line":138,"column":48},"end":{"line":138,"column":61}}]},"8":{"line":207,"type":"cond-expr","locations":[{"start":{"line":207,"column":52},"end":{"line":207,"column":59}},{"start":{"line":207,"column":62},"end":{"line":207,"column":66}}]},"9":{"line":207,"type":"binary-expr","locations":[{"start":{"line":207,"column":12},"end":{"line":207,"column":27}},{"start":{"line":207,"column":31},"end":{"line":207,"column":49}}]},"10":{"line":231,"type":"if","locations":[{"start":{"line":231,"column":6},"end":{"line":231,"column":6}},{"start":{"line":231,"column":6},"end":{"line":231,"column":6}}]},"11":{"line":231,"type":"binary-expr","locations":[{"start":{"line":231,"column":10},"end":{"line":231,"column":36}},{"start":{"line":231,"column":40},"end":{"line":231,"column":67}}]},"12":{"line":237,"type":"binary-expr","locations":[{"start":{"line":237,"column":13},"end":{"line":237,"column":20}},{"start":{"line":237,"column":24},"end":{"line":237,"column":51}}]},"13":{"line":239,"type":"if","locations":[{"start":{"line":239,"column":6},"end":{"line":239,"column":6}},{"start":{"line":239,"column":6},"end":{"line":239,"column":6}}]},"14":{"line":262,"type":"if","locations":[{"start":{"line":262,"column":4},"end":{"line":262,"column":4}},{"start":{"line":262,"column":4},"end":{"line":262,"column":4}}]},"15":{"line":269,"type":"if","locations":[{"start":{"line":269,"column":4},"end":{"line":269,"column":4}},{"start":{"line":269,"column":4},"end":{"line":269,"column":4}}]},"16":{"line":270,"type":"cond-expr","locations":[{"start":{"line":270,"column":29},"end":{"line":270,"column":52}},{"start":{"line":270,"column":55},"end":{"line":270,"column":58}}]},"17":{"line":289,"type":"if","locations":[{"start":{"line":289,"column":4},"end":{"line":289,"column":4}},{"start":{"line":289,"column":4},"end":{"line":289,"column":4}}]},"18":{"line":295,"type":"if","locations":[{"start":{"line":295,"column":4},"end":{"line":295,"column":4}},{"start":{"line":295,"column":4},"end":{"line":295,"column":4}}]}},"code":["'use strict';","","const fs = require('fs');","const path = require('path');","const assert = require('assert');","const isFunction = require('is-type-of').function;","const debug = require('debug')('egg-core');","const homedir = require('node-homedir');","const FileLoader = require('./file_loader');","const ContextLoader = require('./context_loader');","const utils = require('../utils');","","","class EggLoader {","","  /**","   * @constructor","   * @param {Object} options - options","   * @param {String} options.baseDir - the directory of application","   * @param {EggCore} options.app - Application instance","   * @param {Logger} options.logger - logger","   * @param {Object} [options.plugins] - custom plugins","   * @since 1.0.0","   */","  constructor(options) {","    this.options = options;","    assert(fs.existsSync(this.options.baseDir), `${this.options.baseDir} not exists`);","    assert(this.options.app, 'options.app is required');","    assert(this.options.logger, 'options.logger is required');","    debug('EggLoader options %j', options);","","    this.app = this.options.app;","","    /**","     * @member {Object} EggLoader#pkg","     * @see {@link AppInfo#pkg}","     * @since 1.0.0","     */","    this.pkg = require(path.join(this.options.baseDir, 'package.json'));","","    /**","     * All framework directories.","     *","     * You can extend Application of egg, the entrypoint is options.app,","     *","     * loader will find all directories from the prototype of Application,","     * you should define `Symbol.for('egg#eggPath')` property.","     *","     * ```","     * // lib/example.js","     * const egg = require('egg');","     * class ExampleApplication extends egg.Application {","     *   constructor(options) {","     *     super(options);","     *   }","     *","     *   get [Symbol.for('egg#eggPath')]() {","     *     return path.join(__dirname, '..');","     *   }","     * }","     * ```","     * @member {Array} EggLoader#eggPaths","     * @see EggLoader#getEggPaths","     * @since 1.0.0","     */","    this.eggPaths = this.getEggPaths();","    debug('Loaded eggPaths %j', this.eggPaths);","","    /**","     * @member {String} EggLoader#serverEnv","     * @see AppInfo#env","     * @since 1.0.0","     */","    this.serverEnv = this.getServerEnv();","    debug('Loaded serverEnv %j', this.serverEnv);","","    /**","     * @member {AppInfo} EggLoader#appInfo","     * @since 1.0.0","     */","    this.appInfo = this.getAppInfo();","  }","","  /**","   * Get {@link AppInfo#env}","   * @return {String} env","   * @see AppInfo#env","   * @private","   * @since 1.0.0","   */","  getServerEnv() {","    let serverEnv;","","    const envPath = path.join(this.options.baseDir, 'config/env');","    if (fs.existsSync(envPath)) {","      serverEnv = fs.readFileSync(envPath, 'utf8').trim();","    }","","    if (!serverEnv) {","      serverEnv = process.env.EGG_SERVER_ENV;","    }","","    if (!serverEnv) {","      if (process.env.NODE_ENV === 'test') {","        serverEnv = 'unittest';","      } else if (process.env.NODE_ENV === 'production') {","        serverEnv = 'prod';","      } else {","        serverEnv = 'local';","      }","    }","","    return serverEnv;","  }","","  /**","   * Get {@link AppInfo#name}","   * @return {String} appname","   * @private","   * @since 1.0.0","   */","  getAppname() {","    if (this.pkg.name) {","      debug('Loaded appname(%s) from package.json', this.pkg.name);","      return this.pkg.name;","    }","    const pkg = path.join(this.options.baseDir, 'package.json');","    throw new Error(`name is required from ${pkg}`);","  }","","  /**","   * Get home directory","   * @return {String} home directory","   * @since 3.4.0","   */","  getHomedir() {","    // EGG_HOME for test","    return process.env.EGG_HOME || homedir() || '/home/admin';","  }","","  /**","   * Get app info","   * @return {AppInfo} appInfo","   * @since 1.0.0","   */","  getAppInfo() {","    const env = this.serverEnv;","    const home = this.getHomedir();","    const baseDir = this.options.baseDir;","","    /**","     * Meta infomation of the application","     * @class AppInfo","     */","    return {","      /**","       * The name of the application, retreive from the name property in `package.json`.","       * @member {String} AppInfo#name","       */","      name: this.getAppname(),","","      /**","       * The current directory, where the application code is.","       * @member {String} AppInfo#baseDir","       */","      baseDir,","","      /**","       * The environment of the application, **it's not NODE_ENV**","       *","       * 1. from `$baseDir/config/env`","       * 2. from EGG_SERVER_ENV","       * 3. from NODE_ENV","       *","       * env | description","       * ---       | ---","       * test      | system integration testing","       * prod      | production","       * local     | local on your own computer","       * unittest  | unit test","       *","       * @member {String} AppInfo#env","       * @see https://eggjs.org/zh-cn/basics/env.html","       */","      env,","","      /**","       * The use directory, same as `process.env.HOME`","       * @member {String} AppInfo#HOME","       */","      HOME: home,","","      /**","       * parsed from `package.json`","       * @member {Object} AppInfo#pkg","       */","      pkg: this.pkg,","","      /**","       * The directory whether is baseDir or HOME depend on env.","       * it's good for test when you want to write some file to HOME,","       * but don't want to write to the real directory,","       * so use root to write file to baseDir instead of HOME when unitest.","       * keep root directory in baseDir when local and unittest","       * @member {String} AppInfo#root","       */","      root: env === 'local' || env === 'unittest' ? baseDir : home,","    };","  }","","  /**","   * Get {@link EggLoader#eggPaths}","   * @return {Array} framework directories","   * @see {@link EggLoader#eggPaths}","   * @private","   * @since 1.0.0","   */","  getEggPaths() {","    // avoid require recursively","    const EggCore = require('../egg');","    const eggPaths = [];","","    let proto = this.app;","","    // Loop for the prototype chain","    while (proto) {","      proto = Object.getPrototypeOf(proto);","      // stop the loop if","      // - object extends Object","      // - object extends EggCore","      if (proto === Object.prototype || proto === EggCore.prototype) {","        break;","      }","","      assert(proto.hasOwnProperty(Symbol.for('egg#eggPath')), 'Symbol.for(\\'egg#eggPath\\') is required on Application');","      const eggPath = proto[Symbol.for('egg#eggPath')];","      assert(eggPath && typeof eggPath === 'string', 'Symbol.for(\\'egg#eggPath\\') should be string');","      const realpath = fs.realpathSync(eggPath);","      if (eggPaths.indexOf(realpath) === -1) {","        eggPaths.unshift(realpath);","      }","    }","","    return eggPaths;","  }","","  // Low Level API","","  /**","   * Load single file, will invork when export is function","   *","   * @param {String} filepath - fullpath","   * @param {Array} arguments - pass rest arguments into the function when invork","   * @return {Object} exports","   * @example","   * ```js","   * app.loader.loadFile(path.join(app.options.baseDir, 'config/router.js'));","   * ```","   * @since 1.0.0","   */","  loadFile(filepath) {","    if (!fs.existsSync(filepath)) {","      return null;","    }","","    const ret = utils.loadFile(filepath);","    // function(arg1, args, ...) {}","    let inject = Array.prototype.slice.call(arguments, 1);","    if (inject.length === 0) inject = [ this.app ];","    return isFunction(ret) ? ret.apply(null, inject) : ret;","  }","","  /**","   * Get all loadUnit","   *","   * loadUnit is a directory that can be loaded by EggLoader, it has the same structure.","   * loadUnit has a path and a type(app, framework, plugin).","   *","   * The order of the loadUnits:","   *","   * 1. plugin","   * 2. framework","   * 3. app","   *","   * @return {Array} loadUnits","   * @since 1.0.0","   */","  getLoadUnits() {","    if (this.dirs) {","      return this.dirs;","    }","","    const dirs = this.dirs = [];","","    if (this.orderPlugins) {","      for (const plugin of this.orderPlugins) {","        dirs.push({","          path: plugin.path,","          type: 'plugin',","        });","      }","    }","","    // framework or egg path","    for (const eggPath of this.eggPaths) {","      dirs.push({","        path: eggPath,","        type: 'framework',","      });","    }","","    // application","    dirs.push({","      path: this.options.baseDir,","      type: 'app',","    });","","    debug('Loaded dirs %j', dirs);","    return dirs;","  }","","  /**","   * Load files using {@link FileLoader}, inject to {@link Application}","   * @param {String|Array} directory - see {@link FileLoader}","   * @param {String} property - see {@link FileLoader}","   * @param {Object} opt - see {@link FileLoader}","   * @since 1.0.0","   */","  loadToApp(directory, property, opt) {","    const target = this.app[property] = {};","    opt = Object.assign({}, {","      directory,","      target,","      inject: this.app,","    }, opt);","    new FileLoader(opt).load();","  }","","  /**","   * Load files using {@link ContextLoader}","   * @param {String|Array} directory - see {@link ContextLoader}","   * @param {String} property - see {@link ContextLoader}","   * @param {Object} opt - see {@link ContextLoader}","   * @since 1.0.0","   */","  loadToContext(directory, property, opt) {","    opt = Object.assign({}, {","      directory,","      property,","      inject: this.app,","    }, opt);","    new ContextLoader(opt).load();","  }","","  /**","   * @member {FileLoader} EggLoader#FileLoader","   * @since 1.0.0","   */","  get FileLoader() {","    return FileLoader;","  }","","  /**","   * @member {ContextLoader} EggLoader#ContextLoader","   * @since 1.0.0","   */","  get ContextLoader() {","    return ContextLoader;","  }","","}","","/**"," * Mixin methods to EggLoader"," * // ES6 Multiple Inheritance"," * https://medium.com/@leocavalcante/es6-multiple-inheritance-73a3c66d2b6b"," */","const loaders = [","  require('./mixin/plugin'),","  require('./mixin/config'),","  require('./mixin/extend'),","  require('./mixin/custom'),","  require('./mixin/service'),","  require('./mixin/middleware'),","  require('./mixin/controller'),","  require('./mixin/router'),","];","","for (const loader of loaders) {","  Object.assign(EggLoader.prototype, loader);","}","","module.exports = EggLoader;",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"26":0,"27":0,"28":0,"29":0,"30":0,"32":0,"39":0,"66":0,"67":0,"74":0,"75":0,"81":0,"92":0,"94":0,"95":0,"96":0,"99":0,"100":0,"103":0,"104":0,"105":0,"106":0,"107":0,"109":0,"113":0,"123":0,"124":0,"125":0,"127":0,"128":0,"138":0,"147":0,"148":0,"149":0,"155":0,"220":0,"221":0,"223":0,"226":0,"227":0,"231":0,"232":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":0,"244":0,"262":0,"263":0,"266":0,"268":0,"269":0,"270":0,"289":0,"290":0,"293":0,"295":0,"296":0,"297":0,"305":0,"306":0,"313":0,"318":0,"319":0,"330":0,"331":0,"336":0,"347":0,"352":0,"360":0,"368":0,"378":1,"389":1,"390":8,"393":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/file_loader.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/file_loader.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":1,"63":1,"64":1,"65":1,"66":0,"67":0,"68":0,"69":0,"70":0,"71":1,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":1,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"(anonymous_1)","line":44,"loc":{"start":{"line":44,"column":13},"end":{"line":44,"column":23}}},"2":{"name":"(anonymous_2)","line":62,"loc":{"start":{"line":62,"column":6},"end":{"line":62,"column":9}}},"3":{"name":"(anonymous_3)","line":118,"loc":{"start":{"line":118,"column":7},"end":{"line":118,"column":10}}},"4":{"name":"getProperties","line":162,"loc":{"start":{"line":162,"column":0},"end":{"line":162,"column":48}}},"5":{"name":"getExports","line":175,"loc":{"start":{"line":175,"column":0},"end":{"line":175,"column":71}}},"6":{"name":"defaultCamelize","line":208,"loc":{"start":{"line":208,"column":0},"end":{"line":208,"column":46}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":25}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":50}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":33}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":33}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":41}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":34}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":52}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":50}},"11":{"start":{"line":14,"column":0},"end":{"line":24,"column":2}},"12":{"start":{"line":45,"column":4},"end":{"line":45,"column":63}},"13":{"start":{"line":46,"column":4},"end":{"line":46,"column":57}},"14":{"start":{"line":47,"column":4},"end":{"line":47,"column":56}},"15":{"start":{"line":50,"column":4},"end":{"line":53,"column":5}},"16":{"start":{"line":51,"column":6},"end":{"line":51,"column":71}},"17":{"start":{"line":52,"column":6},"end":{"line":52,"column":39}},"18":{"start":{"line":63,"column":4},"end":{"line":63,"column":31}},"19":{"start":{"line":64,"column":4},"end":{"line":64,"column":39}},"20":{"start":{"line":65,"column":4},"end":{"line":88,"column":5}},"21":{"start":{"line":66,"column":6},"end":{"line":66,"column":37}},"22":{"start":{"line":69,"column":6},"end":{"line":87,"column":17}},"23":{"start":{"line":70,"column":8},"end":{"line":70,"column":16}},"24":{"start":{"line":71,"column":8},"end":{"line":71,"column":73}},"25":{"start":{"line":72,"column":8},"end":{"line":83,"column":9}},"26":{"start":{"line":73,"column":10},"end":{"line":75,"column":11}},"27":{"start":{"line":74,"column":12},"end":{"line":74,"column":155}},"28":{"start":{"line":74,"column":40},"end":{"line":74,"column":155}},"29":{"start":{"line":76,"column":10},"end":{"line":76,"column":29}},"30":{"start":{"line":77,"column":10},"end":{"line":80,"column":11}},"31":{"start":{"line":78,"column":12},"end":{"line":78,"column":42}},"32":{"start":{"line":79,"column":12},"end":{"line":79,"column":32}},"33":{"start":{"line":82,"column":10},"end":{"line":82,"column":39}},"34":{"start":{"line":84,"column":8},"end":{"line":84,"column":31}},"35":{"start":{"line":85,"column":8},"end":{"line":85,"column":39}},"36":{"start":{"line":86,"column":8},"end":{"line":86,"column":19}},"37":{"start":{"line":89,"column":4},"end":{"line":89,"column":18}},"38":{"start":{"line":119,"column":4},"end":{"line":119,"column":32}},"39":{"start":{"line":120,"column":4},"end":{"line":122,"column":5}},"40":{"start":{"line":121,"column":6},"end":{"line":121,"column":44}},"41":{"start":{"line":124,"column":4},"end":{"line":124,"column":45}},"42":{"start":{"line":125,"column":4},"end":{"line":127,"column":5}},"43":{"start":{"line":126,"column":6},"end":{"line":126,"column":36}},"44":{"start":{"line":129,"column":4},"end":{"line":129,"column":21}},"45":{"start":{"line":130,"column":4},"end":{"line":130,"column":37}},"46":{"start":{"line":131,"column":4},"end":{"line":149,"column":5}},"47":{"start":{"line":132,"column":6},"end":{"line":132,"column":63}},"48":{"start":{"line":133,"column":6},"end":{"line":148,"column":7}},"49":{"start":{"line":134,"column":8},"end":{"line":134,"column":56}},"50":{"start":{"line":135,"column":8},"end":{"line":135,"column":54}},"51":{"start":{"line":135,"column":45},"end":{"line":135,"column":54}},"52":{"start":{"line":138,"column":8},"end":{"line":138,"column":65}},"53":{"start":{"line":140,"column":8},"end":{"line":140,"column":89}},"54":{"start":{"line":142,"column":8},"end":{"line":142,"column":69}},"55":{"start":{"line":143,"column":8},"end":{"line":143,"column":38}},"56":{"start":{"line":143,"column":29},"end":{"line":143,"column":38}},"57":{"start":{"line":144,"column":8},"end":{"line":144,"column":69}},"58":{"start":{"line":144,"column":31},"end":{"line":144,"column":69}},"59":{"start":{"line":146,"column":8},"end":{"line":146,"column":54}},"60":{"start":{"line":147,"column":8},"end":{"line":147,"column":83}},"61":{"start":{"line":151,"column":4},"end":{"line":151,"column":17}},"62":{"start":{"line":156,"column":0},"end":{"line":156,"column":28}},"63":{"start":{"line":157,"column":0},"end":{"line":157,"column":33}},"64":{"start":{"line":158,"column":0},"end":{"line":158,"column":35}},"65":{"start":{"line":162,"column":0},"end":{"line":171,"column":1}},"66":{"start":{"line":164,"column":2},"end":{"line":168,"column":3}},"67":{"start":{"line":165,"column":4},"end":{"line":165,"column":39}},"68":{"start":{"line":166,"column":4},"end":{"line":166,"column":77}},"69":{"start":{"line":167,"column":4},"end":{"line":167,"column":18}},"70":{"start":{"line":170,"column":2},"end":{"line":170,"column":46}},"71":{"start":{"line":175,"column":0},"end":{"line":206,"column":1}},"72":{"start":{"line":176,"column":2},"end":{"line":176,"column":41}},"73":{"start":{"line":179,"column":2},"end":{"line":181,"column":3}},"74":{"start":{"line":180,"column":4},"end":{"line":180,"column":65}},"75":{"start":{"line":188,"column":2},"end":{"line":190,"column":3}},"76":{"start":{"line":189,"column":4},"end":{"line":189,"column":19}},"77":{"start":{"line":197,"column":2},"end":{"line":202,"column":3}},"78":{"start":{"line":198,"column":4},"end":{"line":198,"column":30}},"79":{"start":{"line":199,"column":4},"end":{"line":201,"column":5}},"80":{"start":{"line":200,"column":6},"end":{"line":200,"column":21}},"81":{"start":{"line":205,"column":2},"end":{"line":205,"column":17}},"82":{"start":{"line":208,"column":0},"end":{"line":235,"column":1}},"83":{"start":{"line":209,"column":2},"end":{"line":209,"column":62}},"84":{"start":{"line":210,"column":2},"end":{"line":234,"column":5}},"85":{"start":{"line":211,"column":4},"end":{"line":213,"column":5}},"86":{"start":{"line":212,"column":6},"end":{"line":212,"column":76}},"87":{"start":{"line":221,"column":4},"end":{"line":221,"column":82}},"88":{"start":{"line":221,"column":52},"end":{"line":221,"column":80}},"89":{"start":{"line":222,"column":4},"end":{"line":222,"column":28}},"90":{"start":{"line":223,"column":4},"end":{"line":232,"column":5}},"91":{"start":{"line":225,"column":8},"end":{"line":225,"column":36}},"92":{"start":{"line":226,"column":8},"end":{"line":226,"column":14}},"93":{"start":{"line":228,"column":8},"end":{"line":228,"column":36}},"94":{"start":{"line":229,"column":8},"end":{"line":229,"column":14}},"95":{"start":{"line":233,"column":4},"end":{"line":233,"column":41}}},"branchMap":{"1":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":4},"end":{"line":50,"column":4}},{"start":{"line":50,"column":4},"end":{"line":50,"column":4}}]},"2":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":8},"end":{"line":72,"column":8}},{"start":{"line":72,"column":8},"end":{"line":72,"column":8}}]},"3":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":10},"end":{"line":73,"column":10}},{"start":{"line":73,"column":10},"end":{"line":73,"column":10}}]},"4":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":12},"end":{"line":74,"column":12}},{"start":{"line":74,"column":12},"end":{"line":74,"column":12}}]},"5":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":10},"end":{"line":77,"column":10}},{"start":{"line":77,"column":10},"end":{"line":77,"column":10}}]},"6":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":14},"end":{"line":77,"column":17}},{"start":{"line":77,"column":21},"end":{"line":77,"column":39}}]},"7":{"line":82,"type":"binary-expr","locations":[{"start":{"line":82,"column":16},"end":{"line":82,"column":32}},{"start":{"line":82,"column":36},"end":{"line":82,"column":38}}]},"8":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":4},"end":{"line":120,"column":4}},{"start":{"line":120,"column":4},"end":{"line":120,"column":4}}]},"9":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":4},"end":{"line":125,"column":4}},{"start":{"line":125,"column":4},"end":{"line":125,"column":4}}]},"10":{"line":135,"type":"if","locations":[{"start":{"line":135,"column":8},"end":{"line":135,"column":8}},{"start":{"line":135,"column":8},"end":{"line":135,"column":8}}]},"11":{"line":143,"type":"if","locations":[{"start":{"line":143,"column":8},"end":{"line":143,"column":8}},{"start":{"line":143,"column":8},"end":{"line":143,"column":8}}]},"12":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":8},"end":{"line":144,"column":8}},{"start":{"line":144,"column":8},"end":{"line":144,"column":8}}]},"13":{"line":164,"type":"if","locations":[{"start":{"line":164,"column":2},"end":{"line":164,"column":2}},{"start":{"line":164,"column":2},"end":{"line":164,"column":2}}]},"14":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":2},"end":{"line":179,"column":2}},{"start":{"line":179,"column":2},"end":{"line":179,"column":2}}]},"15":{"line":188,"type":"if","locations":[{"start":{"line":188,"column":2},"end":{"line":188,"column":2}},{"start":{"line":188,"column":2},"end":{"line":188,"column":2}}]},"16":{"line":188,"type":"binary-expr","locations":[{"start":{"line":188,"column":6},"end":{"line":188,"column":23}},{"start":{"line":188,"column":27},"end":{"line":188,"column":56}}]},"17":{"line":197,"type":"if","locations":[{"start":{"line":197,"column":2},"end":{"line":197,"column":2}},{"start":{"line":197,"column":2},"end":{"line":197,"column":2}}]},"18":{"line":197,"type":"binary-expr","locations":[{"start":{"line":197,"column":6},"end":{"line":197,"column":10}},{"start":{"line":197,"column":14},"end":{"line":197,"column":34}}]},"19":{"line":199,"type":"if","locations":[{"start":{"line":199,"column":4},"end":{"line":199,"column":4}},{"start":{"line":199,"column":4},"end":{"line":199,"column":4}}]},"20":{"line":211,"type":"if","locations":[{"start":{"line":211,"column":4},"end":{"line":211,"column":4}},{"start":{"line":211,"column":4},"end":{"line":211,"column":4}}]},"21":{"line":223,"type":"switch","locations":[{"start":{"line":224,"column":6},"end":{"line":226,"column":14}},{"start":{"line":227,"column":6},"end":{"line":229,"column":14}},{"start":{"line":230,"column":6},"end":{"line":230,"column":19}},{"start":{"line":231,"column":6},"end":{"line":231,"column":14}}]}},"code":["'use strict';","","const assert = require('assert');","const fs = require('fs');","const debug = require('debug')('egg-core:loader');","const path = require('path');","const globby = require('globby');","const is = require('is-type-of');","const deprecate = require('depd')('egg');","const utils = require('../utils');","const FULLPATH = Symbol('EGG_LOADER_ITEM_FULLPATH');","const EXPORTS = Symbol('EGG_LOADER_ITEM_EXPORTS');","","const defaults = {","  directory: null,","  target: null,","  ignore: undefined,","  lowercaseFirst: false,","  caseStyle: 'camel',","  initializer: null,","  call: true,","  override: false,","  inject: undefined,","};","","/**"," * Load files from directory to target object."," * @since 1.0.0"," */","class FileLoader {","","  /**","   * @constructor","   * @param {Object} options - options","   * @param {String|Array} options.directory - directories to be loaded","   * @param {Object} options.target - attach the target object from loaded files","   * @param {String} options.ignore - ignore the files when load, support glob","   * @param {Function} options.initializer - custom file exports, receive two parameters, first is the inject object, second is an `options` object that contain `path`","   * @param {Boolean} options.call - determine whether invoke when exports is function","   * @param {Boolean} options.override - determine whether override the property when get the same name","   * @param {Object} options.inject - an object that be the argument when invoke the function","   * @param {String|Function} options.caseStyle - set property's case when converting a filepath to property list.","   */","  constructor(options) {","    assert(options.directory, 'options.directory is required');","    assert(options.target, 'options.target is required');","    this.options = Object.assign({}, defaults, options);","","    // compatible old options _lowercaseFirst_","    if (this.options.lowercaseFirst === true) {","      deprecate('lowercaseFirst is deprecated, use caseStyle instead');","      this.options.caseStyle = 'lower';","    }","  }","","  /**","   * attach items to target object. Mapping the directory to properties.","   * `app/controller/group/repository.js` => `target.group.repository`","   * @return {Object} target","   * @since 1.0.0","   */","  load() {","    const items = this.parse();","    const target = this.options.target;","    for (const item of items) {","      debug('loading item %j', item);","      // item { properties: [ 'a', 'b', 'c'], exports }","      // => target.a.b.c = exports","      item.properties.reduce((target, property, index) => {","        let obj;","        const properties = item.properties.slice(0, index + 1).join('.');","        if (index === item.properties.length - 1) {","          if (property in target) {","            if (!this.options.override) throw new Error(`can't overwrite property '${properties}' from ${target[property][FULLPATH]} by ${item.fullpath}`);","          }","          obj = item.exports;","          if (obj && !is.primitive(obj)) {","            obj[FULLPATH] = item.fullpath;","            obj[EXPORTS] = true;","          }","        } else {","          obj = target[property] || {};","        }","        target[property] = obj;","        debug('loaded %s', properties);","        return obj;","      }, target);","    }","    return target;","  }","","  /**","   * Parse files from given directories, then return an items list, each item contains properties and exports.","   *","   * For exmple, parse `app/controller/group/repository.js`","   *","   * ```","   * module.exports = app => {","   *   return class RepositoryController extends app.Controller {};","   * }","   * ```","   *","   * It returns a item","   *","   * ```","   * {","   *   properties: [ 'group', 'repository' ],","   *   exports: app => { ... },","   * }","   * ```","   *","   * `Properties` is an array that contains the directory of a filepath.","   *","   * `Exports` depends on type, if exports is a function, it will be called. if initializer is specified, it will be called with exports for customizing.","   * @return {Array} items","   * @since 1.0.0","   */","  parse() {","    const files = [ '**/*.js' ];","    if (typeof this.options.ignore === 'string') {","      files.push('!' + this.options.ignore);","    }","","    let directories = this.options.directory;","    if (!Array.isArray(directories)) {","      directories = [ directories ];","    }","","    const items = [];","    debug('parsing %j', directories);","    for (const directory of directories) {","      const filepaths = globby.sync(files, { cwd: directory });","      for (const filepath of filepaths) {","        const fullpath = path.join(directory, filepath);","        if (!fs.statSync(fullpath).isFile()) continue;","        // get properties","        // app/service/foo/bar.js => [ 'foo', 'bar' ]","        const properties = getProperties(filepath, this.options);","        // app/service/foo/bar.js => service.foo.bar","        const pathName = directory.split(/\\/|\\\\/).slice(-1) + '.' + properties.join('.');","        // get exports from the file","        const exports = getExports(fullpath, this.options, pathName);","        if (exports == null) continue;","        if (is.class(exports)) exports.prototype.pathName = pathName;","","        items.push({ fullpath, properties, exports });","        debug('parse %s, properties %j, export %j', fullpath, properties, exports);","      }","    }","","    return items;","  }","","}","","module.exports = FileLoader;","module.exports.EXPORTS = EXPORTS;","module.exports.FULLPATH = FULLPATH;","","// convert file path to an array of properties","// a/b/c.js => ['a', 'b', 'c']","function getProperties(filepath, { caseStyle }) {","  // if caseStyle is function, return the result of function","  if (is.function(caseStyle)) {","    const result = caseStyle(filepath);","    assert(is.array(result), `caseStyle expect an array, but got ${result}`);","    return result;","  }","  // use default camelize","  return defaultCamelize(filepath, caseStyle);","}","","// Get exports from filepath","// If exports is null/undefined, it will be ignored","function getExports(fullpath, { initializer, call, inject }, pathName) {","  let exports = utils.loadFile(fullpath);","","  // process exports as you like","  if (initializer) {","    exports = initializer(exports, { path: fullpath, pathName });","  }","","  // return exports when it's a class or generator","  //","  // module.exports = class Service {};","  // or","  // module.exports = function*() {}","  if (is.class(exports) || is.generatorFunction(exports)) {","    return exports;","  }","","  // return exports after call when it's a function","  //","  // module.exports = function(app) {","  //   return {};","  // }","  if (call && is.function(exports)) {","    exports = exports(inject);","    if (exports != null) {","      return exports;","    }","  }","","  // return exports what is","  return exports;","}","","function defaultCamelize(filepath, caseStyle) {","  const properties = filepath.replace(/\\.js$/, '').split('/');","  return properties.map(property => {","    if (!/^[a-z][a-z0-9_-]*$/i.test(property)) {","      throw new Error(`${property} is not match 'a-z0-9_-' in ${filepath}`);","    }","","    // use default camelize, will capitalize the first letter","    // foo_bar.js > FooBar","    // fooBar.js  > FooBar","    // FooBar.js  > FooBar","    // FooBar.js  > FooBar","    // FooBar.js  > fooBar (if lowercaseFirst is true)","    property = property.replace(/[_-][a-z]/ig, s => s.substring(1).toUpperCase());","    let first = property[0];","    switch (caseStyle) {","      case 'lower':","        first = first.toLowerCase();","        break;","      case 'upper':","        first = first.toUpperCase();","        break;","      case 'camel':","      default:","    }","    return first + property.substring(1);","  });","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"14":1,"45":0,"46":0,"47":0,"50":0,"51":0,"52":0,"63":0,"64":0,"65":0,"66":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"76":0,"77":0,"78":0,"79":0,"82":0,"84":0,"85":0,"86":0,"89":0,"119":0,"120":0,"121":0,"124":0,"125":0,"126":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"138":0,"140":0,"142":0,"143":0,"144":0,"146":0,"147":0,"151":0,"156":1,"157":1,"158":1,"162":1,"164":0,"165":0,"166":0,"167":0,"170":0,"175":1,"176":0,"179":0,"180":0,"188":0,"189":0,"197":0,"198":0,"199":0,"200":0,"205":0,"208":1,"209":0,"210":0,"211":0,"212":0,"221":0,"222":0,"223":0,"225":0,"226":0,"228":0,"229":0,"233":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/context_loader.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/context_loader.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":1,"36":1,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"(anonymous_1)","line":11,"loc":{"start":{"line":11,"column":13},"end":{"line":11,"column":23}}},"2":{"name":"(anonymous_2)","line":22,"loc":{"start":{"line":22,"column":16},"end":{"line":22,"column":35}}},"3":{"name":"(anonymous_3)","line":24,"loc":{"start":{"line":24,"column":9},"end":{"line":24,"column":12}}},"4":{"name":"(anonymous_4)","line":48,"loc":{"start":{"line":48,"column":13},"end":{"line":48,"column":23}}},"5":{"name":"(anonymous_5)","line":62,"loc":{"start":{"line":62,"column":9},"end":{"line":62,"column":12}}},"6":{"name":"getInstance","line":85,"loc":{"start":{"line":85,"column":0},"end":{"line":85,"column":34}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":44}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":42}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":35}},"6":{"start":{"line":12,"column":4},"end":{"line":12,"column":51}},"7":{"start":{"line":13,"column":4},"end":{"line":13,"column":42}},"8":{"start":{"line":14,"column":4},"end":{"line":14,"column":28}},"9":{"start":{"line":15,"column":4},"end":{"line":15,"column":28}},"10":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"11":{"start":{"line":18,"column":6},"end":{"line":18,"column":58}},"12":{"start":{"line":23,"column":4},"end":{"line":32,"column":7}},"13":{"start":{"line":25,"column":8},"end":{"line":25,"column":49}},"14":{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},"15":{"start":{"line":27,"column":10},"end":{"line":27,"column":52}},"16":{"start":{"line":28,"column":10},"end":{"line":28,"column":46}},"17":{"start":{"line":30,"column":8},"end":{"line":30,"column":24}},"18":{"start":{"line":49,"column":4},"end":{"line":49,"column":61}},"19":{"start":{"line":50,"column":4},"end":{"line":50,"column":57}},"20":{"start":{"line":51,"column":4},"end":{"line":51,"column":39}},"21":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"22":{"start":{"line":53,"column":6},"end":{"line":53,"column":50}},"23":{"start":{"line":55,"column":4},"end":{"line":55,"column":19}},"24":{"start":{"line":57,"column":4},"end":{"line":57,"column":36}},"25":{"start":{"line":58,"column":4},"end":{"line":58,"column":38}},"26":{"start":{"line":61,"column":4},"end":{"line":78,"column":7}},"27":{"start":{"line":66,"column":8},"end":{"line":68,"column":9}},"28":{"start":{"line":67,"column":10},"end":{"line":67,"column":40}},"29":{"start":{"line":69,"column":8},"end":{"line":69,"column":46}},"30":{"start":{"line":71,"column":8},"end":{"line":71,"column":49}},"31":{"start":{"line":72,"column":8},"end":{"line":75,"column":9}},"32":{"start":{"line":73,"column":10},"end":{"line":73,"column":47}},"33":{"start":{"line":74,"column":10},"end":{"line":74,"column":46}},"34":{"start":{"line":76,"column":8},"end":{"line":76,"column":24}},"35":{"start":{"line":82,"column":0},"end":{"line":82,"column":31}},"36":{"start":{"line":85,"column":0},"end":{"line":105,"column":1}},"37":{"start":{"line":88,"column":2},"end":{"line":88,"column":48}},"38":{"start":{"line":89,"column":2},"end":{"line":89,"column":15}},"39":{"start":{"line":90,"column":2},"end":{"line":103,"column":3}},"40":{"start":{"line":91,"column":4},"end":{"line":96,"column":5}},"41":{"start":{"line":92,"column":6},"end":{"line":92,"column":32}},"42":{"start":{"line":95,"column":6},"end":{"line":95,"column":23}},"43":{"start":{"line":99,"column":9},"end":{"line":103,"column":3}},"44":{"start":{"line":100,"column":4},"end":{"line":100,"column":22}},"45":{"start":{"line":102,"column":4},"end":{"line":102,"column":60}},"46":{"start":{"line":104,"column":2},"end":{"line":104,"column":18}}},"branchMap":{"1":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":26,"column":8}},{"start":{"line":26,"column":8},"end":{"line":26,"column":8}}]},"2":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":4},"end":{"line":52,"column":4}},{"start":{"line":52,"column":4},"end":{"line":52,"column":4}}]},"3":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":8},"end":{"line":66,"column":8}},{"start":{"line":66,"column":8},"end":{"line":66,"column":8}}]},"4":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":8},"end":{"line":72,"column":8}},{"start":{"line":72,"column":8},"end":{"line":72,"column":8}}]},"5":{"line":88,"type":"cond-expr","locations":[{"start":{"line":88,"column":34},"end":{"line":88,"column":40}},{"start":{"line":88,"column":43},"end":{"line":88,"column":47}}]},"6":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":2},"end":{"line":90,"column":2}},{"start":{"line":90,"column":2},"end":{"line":90,"column":2}}]},"7":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":4},"end":{"line":91,"column":4}},{"start":{"line":91,"column":4},"end":{"line":91,"column":4}}]},"8":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":9},"end":{"line":99,"column":9}},{"start":{"line":99,"column":9},"end":{"line":99,"column":9}}]}},"code":["'use strict';","","const assert = require('assert');","const is = require('is-type-of');","const FileLoader = require('./file_loader');","const CLASSLOADER = Symbol('classLoader');","const EXPORTS = FileLoader.EXPORTS;","","class ClassLoader {","","  constructor(options) {","    assert(options.ctx, 'options.ctx is required');","    const properties = options.properties;","    this._cache = new Map();","    this._ctx = options.ctx;","","    for (const property in properties) {","      this.defineProperty(property, properties[property]);","    }","  }","","  defineProperty(property, values) {","    Object.defineProperty(this, property, {","      get() {","        let instance = this._cache.get(property);","        if (!instance) {","          instance = getInstance(values, this._ctx);","          this._cache.set(property, instance);","        }","        return instance;","      },","    });","  }","}","","/**"," * Same as {@link FileLoader}, but it will attach file to `inject[fieldClass]`. The exports will be lazy loaded, such as `ctx.group.repository`."," * @extends FileLoader"," * @since 1.0.0"," */","class ContextLoader extends FileLoader {","","  /**","   * @constructor","   * @param {Object} options - options same as {@link FileLoader}","   * @param {String} options.fieldClass - determine the field name of inject object.","   */","  constructor(options) {","    assert(options.property, 'options.property is required');","    assert(options.inject, 'options.inject is required');","    const target = options.target = {};","    if (options.fieldClass) {","      options.inject[options.fieldClass] = target;","    }","    super(options);","","    const app = this.options.inject;","    const property = options.property;","","    // define ctx.service","    Object.defineProperty(app.context, property, {","      get() {","        // distinguish property cache,","        // cache's lifecycle is the same with this context instance","        // e.x. ctx.service1 and ctx.service2 have different cache","        if (!this[CLASSLOADER]) {","          this[CLASSLOADER] = new Map();","        }","        const classLoader = this[CLASSLOADER];","","        let instance = classLoader.get(property);","        if (!instance) {","          instance = getInstance(target, this);","          classLoader.set(property, instance);","        }","        return instance;","      },","    });","  }","}","","module.exports = ContextLoader;","","","function getInstance(values, ctx) {","  // it's a directory when it has no exports","  // then use ClassLoader","  const Class = values[EXPORTS] ? values : null;","  let instance;","  if (Class) {","    if (is.class(Class)) {","      instance = new Class(ctx);","    } else {","      // it's just an object","      instance = Class;","    }","  // Can't set property to primitive, so check again","  // e.x. module.exports = 1;","  } else if (is.primitive(values)) {","    instance = values;","  } else {","    instance = new ClassLoader({ ctx, properties: values });","  }","  return instance;","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"12":0,"13":0,"14":0,"15":0,"17":0,"18":0,"23":0,"25":0,"26":0,"27":0,"28":0,"30":0,"49":0,"50":0,"51":0,"52":0,"53":0,"55":0,"57":0,"58":0,"61":0,"66":0,"67":0,"69":0,"71":0,"72":0,"73":0,"74":0,"76":0,"82":1,"85":1,"88":0,"89":0,"90":0,"91":0,"92":0,"95":0,"99":0,"100":0,"102":0,"104":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/plugin.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/plugin.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":1,"164":0,"165":0,"166":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0,0],"44":[0,0],"45":[0,0],"46":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"fnMap":{"1":{"name":"(anonymous_1)","line":57,"loc":{"start":{"line":57,"column":12},"end":{"line":57,"column":15}}},"2":{"name":"(anonymous_2)","line":150,"loc":{"start":{"line":150,"column":19},"end":{"line":150,"column":33}}},"3":{"name":"(anonymous_3)","line":186,"loc":{"start":{"line":186,"column":23},"end":{"line":186,"column":51}}},"4":{"name":"(anonymous_4)","line":221,"loc":{"start":{"line":221,"column":19},"end":{"line":221,"column":28}}},"5":{"name":"(anonymous_5)","line":255,"loc":{"start":{"line":255,"column":17},"end":{"line":255,"column":50}}},"6":{"name":"(anonymous_6)","line":310,"loc":{"start":{"line":310,"column":15},"end":{"line":310,"column":24}}},"7":{"name":"(anonymous_7)","line":343,"loc":{"start":{"line":343,"column":16},"end":{"line":343,"column":34}}},"8":{"name":"depCompatible","line":375,"loc":{"start":{"line":375,"column":0},"end":{"line":375,"column":31}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":50}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":53}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":49}},"6":{"start":{"line":9,"column":0},"end":{"line":373,"column":2}},"7":{"start":{"line":59,"column":4},"end":{"line":59,"column":107}},"8":{"start":{"line":60,"column":4},"end":{"line":60,"column":61}},"9":{"start":{"line":63,"column":4},"end":{"line":63,"column":110}},"10":{"start":{"line":63,"column":62},"end":{"line":63,"column":108}},"11":{"start":{"line":64,"column":4},"end":{"line":64,"column":68}},"12":{"start":{"line":65,"column":4},"end":{"line":65,"column":61}},"13":{"start":{"line":68,"column":4},"end":{"line":68,"column":22}},"14":{"start":{"line":69,"column":4},"end":{"line":75,"column":5}},"15":{"start":{"line":70,"column":6},"end":{"line":74,"column":7}},"16":{"start":{"line":71,"column":8},"end":{"line":71,"column":60}},"17":{"start":{"line":73,"column":8},"end":{"line":73,"column":49}},"18":{"start":{"line":78,"column":4},"end":{"line":80,"column":5}},"19":{"start":{"line":79,"column":6},"end":{"line":79,"column":77}},"20":{"start":{"line":82,"column":4},"end":{"line":87,"column":5}},"21":{"start":{"line":83,"column":6},"end":{"line":85,"column":7}},"22":{"start":{"line":84,"column":8},"end":{"line":84,"column":56}},"23":{"start":{"line":86,"column":6},"end":{"line":86,"column":69}},"24":{"start":{"line":89,"column":4},"end":{"line":89,"column":25}},"25":{"start":{"line":90,"column":4},"end":{"line":90,"column":33}},"26":{"start":{"line":91,"column":4},"end":{"line":91,"column":39}},"27":{"start":{"line":92,"column":4},"end":{"line":92,"column":33}},"28":{"start":{"line":94,"column":4},"end":{"line":94,"column":53}},"29":{"start":{"line":95,"column":4},"end":{"line":95,"column":53}},"30":{"start":{"line":96,"column":4},"end":{"line":96,"column":56}},"31":{"start":{"line":98,"column":4},"end":{"line":98,"column":34}},"32":{"start":{"line":99,"column":4},"end":{"line":99,"column":23}},"33":{"start":{"line":100,"column":4},"end":{"line":100,"column":31}},"34":{"start":{"line":101,"column":4},"end":{"line":128,"column":5}},"35":{"start":{"line":102,"column":6},"end":{"line":102,"column":43}},"36":{"start":{"line":105,"column":6},"end":{"line":105,"column":69}},"37":{"start":{"line":108,"column":6},"end":{"line":108,"column":37}},"38":{"start":{"line":111,"column":6},"end":{"line":115,"column":7}},"39":{"start":{"line":112,"column":8},"end":{"line":112,"column":76}},"40":{"start":{"line":113,"column":8},"end":{"line":113,"column":30}},"41":{"start":{"line":114,"column":8},"end":{"line":114,"column":17}},"42":{"start":{"line":118,"column":6},"end":{"line":121,"column":7}},"43":{"start":{"line":119,"column":8},"end":{"line":119,"column":54}},"44":{"start":{"line":120,"column":8},"end":{"line":120,"column":17}},"45":{"start":{"line":123,"column":6},"end":{"line":123,"column":29}},"46":{"start":{"line":125,"column":6},"end":{"line":127,"column":7}},"47":{"start":{"line":126,"column":8},"end":{"line":126,"column":38}},"48":{"start":{"line":131,"column":4},"end":{"line":131,"column":74}},"49":{"start":{"line":133,"column":4},"end":{"line":133,"column":29}},"50":{"start":{"line":134,"column":4},"end":{"line":136,"column":5}},"51":{"start":{"line":135,"column":6},"end":{"line":135,"column":42}},"52":{"start":{"line":137,"column":4},"end":{"line":137,"column":60}},"53":{"start":{"line":144,"column":4},"end":{"line":144,"column":33}},"54":{"start":{"line":151,"column":4},"end":{"line":153,"column":5}},"55":{"start":{"line":152,"column":6},"end":{"line":152,"column":36}},"56":{"start":{"line":157,"column":4},"end":{"line":161,"column":5}},"57":{"start":{"line":158,"column":6},"end":{"line":158,"column":40}},"58":{"start":{"line":159,"column":6},"end":{"line":159,"column":49}},"59":{"start":{"line":159,"column":40},"end":{"line":159,"column":49}},"60":{"start":{"line":160,"column":6},"end":{"line":160,"column":98}},"61":{"start":{"line":163,"column":4},"end":{"line":163,"column":23}},"62":{"start":{"line":164,"column":4},"end":{"line":181,"column":5}},"63":{"start":{"line":166,"column":6},"end":{"line":168,"column":7}},"64":{"start":{"line":167,"column":8},"end":{"line":167,"column":77}},"65":{"start":{"line":170,"column":6},"end":{"line":172,"column":7}},"66":{"start":{"line":171,"column":8},"end":{"line":171,"column":17}},"67":{"start":{"line":174,"column":6},"end":{"line":174,"column":42}},"68":{"start":{"line":176,"column":6},"end":{"line":178,"column":7}},"69":{"start":{"line":177,"column":8},"end":{"line":177,"column":61}},"70":{"start":{"line":180,"column":6},"end":{"line":180,"column":43}},"71":{"start":{"line":183,"column":4},"end":{"line":183,"column":19}},"72":{"start":{"line":187,"column":4},"end":{"line":187,"column":33}},"73":{"start":{"line":190,"column":4},"end":{"line":200,"column":5}},"74":{"start":{"line":191,"column":6},"end":{"line":198,"column":8}},"75":{"start":{"line":199,"column":6},"end":{"line":199,"column":13}},"76":{"start":{"line":202,"column":4},"end":{"line":204,"column":5}},"77":{"start":{"line":203,"column":6},"end":{"line":203,"column":27}},"78":{"start":{"line":205,"column":4},"end":{"line":205,"column":23}},"79":{"start":{"line":206,"column":4},"end":{"line":206,"column":52}},"80":{"start":{"line":207,"column":4},"end":{"line":207,"column":68}},"81":{"start":{"line":208,"column":4},"end":{"line":208,"column":34}},"82":{"start":{"line":209,"column":4},"end":{"line":209,"column":29}},"83":{"start":{"line":210,"column":4},"end":{"line":210,"column":26}},"84":{"start":{"line":222,"column":4},"end":{"line":222,"column":12}},"85":{"start":{"line":223,"column":4},"end":{"line":223,"column":15}},"86":{"start":{"line":224,"column":4},"end":{"line":224,"column":65}},"87":{"start":{"line":225,"column":4},"end":{"line":231,"column":5}},"88":{"start":{"line":226,"column":6},"end":{"line":226,"column":35}},"89":{"start":{"line":227,"column":6},"end":{"line":227,"column":29}},"90":{"start":{"line":228,"column":6},"end":{"line":230,"column":7}},"91":{"start":{"line":229,"column":8},"end":{"line":229,"column":37}},"92":{"start":{"line":233,"column":4},"end":{"line":233,"column":39}},"93":{"start":{"line":234,"column":4},"end":{"line":237,"column":5}},"94":{"start":{"line":235,"column":6},"end":{"line":235,"column":79}},"95":{"start":{"line":236,"column":6},"end":{"line":236,"column":13}},"96":{"start":{"line":239,"column":4},"end":{"line":243,"column":5}},"97":{"start":{"line":242,"column":6},"end":{"line":242,"column":112}},"98":{"start":{"line":246,"column":4},"end":{"line":246,"column":26}},"99":{"start":{"line":248,"column":4},"end":{"line":252,"column":5}},"100":{"start":{"line":249,"column":6},"end":{"line":251,"column":7}},"101":{"start":{"line":250,"column":8},"end":{"line":250,"column":34}},"102":{"start":{"line":257,"column":4},"end":{"line":259,"column":5}},"103":{"start":{"line":258,"column":6},"end":{"line":258,"column":16}},"104":{"start":{"line":261,"column":4},"end":{"line":261,"column":62}},"105":{"start":{"line":262,"column":4},"end":{"line":262,"column":53}},"106":{"start":{"line":265,"column":4},"end":{"line":280,"column":5}},"107":{"start":{"line":266,"column":6},"end":{"line":266,"column":143}},"108":{"start":{"line":268,"column":6},"end":{"line":276,"column":7}},"109":{"start":{"line":269,"column":8},"end":{"line":269,"column":28}},"110":{"start":{"line":270,"column":8},"end":{"line":274,"column":9}},"111":{"start":{"line":271,"column":10},"end":{"line":273,"column":11}},"112":{"start":{"line":272,"column":12},"end":{"line":272,"column":32}},"113":{"start":{"line":275,"column":8},"end":{"line":275,"column":109}},"114":{"start":{"line":278,"column":6},"end":{"line":278,"column":41}},"115":{"start":{"line":279,"column":6},"end":{"line":279,"column":16}},"116":{"start":{"line":283,"column":4},"end":{"line":283,"column":38}},"117":{"start":{"line":284,"column":4},"end":{"line":284,"column":26}},"118":{"start":{"line":285,"column":4},"end":{"line":297,"column":7}},"119":{"start":{"line":286,"column":6},"end":{"line":291,"column":7}},"120":{"start":{"line":287,"column":8},"end":{"line":289,"column":9}},"121":{"start":{"line":288,"column":10},"end":{"line":288,"column":35}},"122":{"start":{"line":290,"column":8},"end":{"line":290,"column":39}},"123":{"start":{"line":293,"column":6},"end":{"line":296,"column":7}},"124":{"start":{"line":294,"column":8},"end":{"line":294,"column":42}},"125":{"start":{"line":295,"column":8},"end":{"line":295,"column":39}},"126":{"start":{"line":298,"column":4},"end":{"line":304,"column":5}},"127":{"start":{"line":303,"column":6},"end":{"line":303,"column":179}},"128":{"start":{"line":303,"column":116},"end":{"line":303,"column":163}},"129":{"start":{"line":306,"column":4},"end":{"line":306,"column":57}},"130":{"start":{"line":306,"column":39},"end":{"line":306,"column":55}},"131":{"start":{"line":311,"column":4},"end":{"line":313,"column":5}},"132":{"start":{"line":312,"column":6},"end":{"line":312,"column":25}},"133":{"start":{"line":315,"column":4},"end":{"line":315,"column":47}},"134":{"start":{"line":316,"column":4},"end":{"line":316,"column":26}},"135":{"start":{"line":322,"column":4},"end":{"line":322,"column":69}},"136":{"start":{"line":325,"column":4},"end":{"line":328,"column":5}},"137":{"start":{"line":326,"column":6},"end":{"line":326,"column":39}},"138":{"start":{"line":327,"column":6},"end":{"line":327,"column":58}},"139":{"start":{"line":331,"column":4},"end":{"line":331,"column":62}},"140":{"start":{"line":333,"column":4},"end":{"line":338,"column":5}},"141":{"start":{"line":334,"column":6},"end":{"line":334,"column":33}},"142":{"start":{"line":335,"column":6},"end":{"line":337,"column":7}},"143":{"start":{"line":336,"column":8},"end":{"line":336,"column":36}},"144":{"start":{"line":340,"column":4},"end":{"line":340,"column":81}},"145":{"start":{"line":344,"column":4},"end":{"line":346,"column":5}},"146":{"start":{"line":345,"column":6},"end":{"line":345,"column":13}},"147":{"start":{"line":347,"column":4},"end":{"line":370,"column":5}},"148":{"start":{"line":348,"column":6},"end":{"line":348,"column":35}},"149":{"start":{"line":349,"column":6},"end":{"line":349,"column":38}},"150":{"start":{"line":350,"column":6},"end":{"line":352,"column":7}},"151":{"start":{"line":351,"column":8},"end":{"line":351,"column":41}},"152":{"start":{"line":353,"column":6},"end":{"line":356,"column":7}},"153":{"start":{"line":354,"column":8},"end":{"line":355,"column":43}},"154":{"start":{"line":357,"column":6},"end":{"line":360,"column":7}},"155":{"start":{"line":358,"column":8},"end":{"line":358,"column":33}},"156":{"start":{"line":359,"column":8},"end":{"line":359,"column":36}},"157":{"start":{"line":361,"column":6},"end":{"line":369,"column":7}},"158":{"start":{"line":362,"column":8},"end":{"line":364,"column":9}},"159":{"start":{"line":363,"column":10},"end":{"line":363,"column":19}},"160":{"start":{"line":365,"column":8},"end":{"line":367,"column":9}},"161":{"start":{"line":366,"column":10},"end":{"line":366,"column":19}},"162":{"start":{"line":368,"column":8},"end":{"line":368,"column":42}},"163":{"start":{"line":375,"column":0},"end":{"line":380,"column":1}},"164":{"start":{"line":376,"column":2},"end":{"line":379,"column":3}},"165":{"start":{"line":377,"column":4},"end":{"line":377,"column":37}},"166":{"start":{"line":378,"column":4},"end":{"line":378,"column":22}}},"branchMap":{"1":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":69,"column":4}},{"start":{"line":69,"column":4},"end":{"line":69,"column":4}}]},"2":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":4},"end":{"line":78,"column":4}},{"start":{"line":78,"column":4},"end":{"line":78,"column":4}}]},"3":{"line":82,"type":"if","locations":[{"start":{"line":82,"column":4},"end":{"line":82,"column":4}},{"start":{"line":82,"column":4},"end":{"line":82,"column":4}}]},"4":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":6},"end":{"line":111,"column":6}},{"start":{"line":111,"column":6},"end":{"line":111,"column":6}}]},"5":{"line":111,"type":"binary-expr","locations":[{"start":{"line":111,"column":10},"end":{"line":111,"column":13}},{"start":{"line":111,"column":17},"end":{"line":111,"column":34}},{"start":{"line":111,"column":38},"end":{"line":111,"column":68}}]},"6":{"line":118,"type":"if","locations":[{"start":{"line":118,"column":6},"end":{"line":118,"column":6}},{"start":{"line":118,"column":6},"end":{"line":118,"column":6}}]},"7":{"line":118,"type":"binary-expr","locations":[{"start":{"line":118,"column":10},"end":{"line":118,"column":26}},{"start":{"line":118,"column":30},"end":{"line":118,"column":54}}]},"8":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":6},"end":{"line":125,"column":6}},{"start":{"line":125,"column":6},"end":{"line":125,"column":6}}]},"9":{"line":151,"type":"if","locations":[{"start":{"line":151,"column":4},"end":{"line":151,"column":4}},{"start":{"line":151,"column":4},"end":{"line":151,"column":4}}]},"10":{"line":159,"type":"if","locations":[{"start":{"line":159,"column":6},"end":{"line":159,"column":6}},{"start":{"line":159,"column":6},"end":{"line":159,"column":6}}]},"11":{"line":166,"type":"if","locations":[{"start":{"line":166,"column":6},"end":{"line":166,"column":6}},{"start":{"line":166,"column":6},"end":{"line":166,"column":6}}]},"12":{"line":166,"type":"binary-expr","locations":[{"start":{"line":166,"column":10},"end":{"line":166,"column":50}},{"start":{"line":166,"column":54},"end":{"line":166,"column":80}}]},"13":{"line":170,"type":"if","locations":[{"start":{"line":170,"column":6},"end":{"line":170,"column":6}},{"start":{"line":170,"column":6},"end":{"line":170,"column":6}}]},"14":{"line":190,"type":"if","locations":[{"start":{"line":190,"column":4},"end":{"line":190,"column":4}},{"start":{"line":190,"column":4},"end":{"line":190,"column":4}}]},"15":{"line":202,"type":"if","locations":[{"start":{"line":202,"column":4},"end":{"line":202,"column":4}},{"start":{"line":202,"column":4},"end":{"line":202,"column":4}}]},"16":{"line":206,"type":"binary-expr","locations":[{"start":{"line":206,"column":26},"end":{"line":206,"column":45}},{"start":{"line":206,"column":49},"end":{"line":206,"column":51}}]},"17":{"line":207,"type":"binary-expr","locations":[{"start":{"line":207,"column":34},"end":{"line":207,"column":61}},{"start":{"line":207,"column":65},"end":{"line":207,"column":67}}]},"18":{"line":208,"type":"binary-expr","locations":[{"start":{"line":208,"column":17},"end":{"line":208,"column":27}},{"start":{"line":208,"column":31},"end":{"line":208,"column":33}}]},"19":{"line":225,"type":"if","locations":[{"start":{"line":225,"column":4},"end":{"line":225,"column":4}},{"start":{"line":225,"column":4},"end":{"line":225,"column":4}}]},"20":{"line":228,"type":"if","locations":[{"start":{"line":228,"column":6},"end":{"line":228,"column":6}},{"start":{"line":228,"column":6},"end":{"line":228,"column":6}}]},"21":{"line":234,"type":"if","locations":[{"start":{"line":234,"column":4},"end":{"line":234,"column":4}},{"start":{"line":234,"column":4},"end":{"line":234,"column":4}}]},"22":{"line":239,"type":"if","locations":[{"start":{"line":239,"column":4},"end":{"line":239,"column":4}},{"start":{"line":239,"column":4},"end":{"line":239,"column":4}}]},"23":{"line":239,"type":"binary-expr","locations":[{"start":{"line":239,"column":8},"end":{"line":239,"column":19}},{"start":{"line":239,"column":23},"end":{"line":239,"column":50}}]},"24":{"line":249,"type":"if","locations":[{"start":{"line":249,"column":6},"end":{"line":249,"column":6}},{"start":{"line":249,"column":6},"end":{"line":249,"column":6}}]},"25":{"line":249,"type":"binary-expr","locations":[{"start":{"line":249,"column":10},"end":{"line":249,"column":29}},{"start":{"line":249,"column":33},"end":{"line":249,"column":59}}]},"26":{"line":257,"type":"if","locations":[{"start":{"line":257,"column":4},"end":{"line":257,"column":4}},{"start":{"line":257,"column":4},"end":{"line":257,"column":4}}]},"27":{"line":265,"type":"if","locations":[{"start":{"line":265,"column":4},"end":{"line":265,"column":4}},{"start":{"line":265,"column":4},"end":{"line":265,"column":4}}]},"28":{"line":271,"type":"if","locations":[{"start":{"line":271,"column":10},"end":{"line":271,"column":10}},{"start":{"line":271,"column":10},"end":{"line":271,"column":10}}]},"29":{"line":287,"type":"if","locations":[{"start":{"line":287,"column":8},"end":{"line":287,"column":8}},{"start":{"line":287,"column":8},"end":{"line":287,"column":8}}]},"30":{"line":293,"type":"if","locations":[{"start":{"line":293,"column":6},"end":{"line":293,"column":6}},{"start":{"line":293,"column":6},"end":{"line":293,"column":6}}]},"31":{"line":298,"type":"if","locations":[{"start":{"line":298,"column":4},"end":{"line":298,"column":4}},{"start":{"line":298,"column":4},"end":{"line":298,"column":4}}]},"32":{"line":311,"type":"if","locations":[{"start":{"line":311,"column":4},"end":{"line":311,"column":4}},{"start":{"line":311,"column":4},"end":{"line":311,"column":4}}]},"33":{"line":315,"type":"binary-expr","locations":[{"start":{"line":315,"column":17},"end":{"line":315,"column":31}},{"start":{"line":315,"column":35},"end":{"line":315,"column":46}}]},"34":{"line":335,"type":"if","locations":[{"start":{"line":335,"column":6},"end":{"line":335,"column":6}},{"start":{"line":335,"column":6},"end":{"line":335,"column":6}}]},"35":{"line":344,"type":"if","locations":[{"start":{"line":344,"column":4},"end":{"line":344,"column":4}},{"start":{"line":344,"column":4},"end":{"line":344,"column":4}}]},"36":{"line":350,"type":"if","locations":[{"start":{"line":350,"column":6},"end":{"line":350,"column":6}},{"start":{"line":350,"column":6},"end":{"line":350,"column":6}}]},"37":{"line":353,"type":"if","locations":[{"start":{"line":353,"column":6},"end":{"line":353,"column":6}},{"start":{"line":353,"column":6},"end":{"line":353,"column":6}}]},"38":{"line":353,"type":"binary-expr","locations":[{"start":{"line":353,"column":10},"end":{"line":353,"column":30}},{"start":{"line":353,"column":34},"end":{"line":353,"column":73}}]},"39":{"line":357,"type":"if","locations":[{"start":{"line":357,"column":6},"end":{"line":357,"column":6}},{"start":{"line":357,"column":6},"end":{"line":357,"column":6}}]},"40":{"line":357,"type":"binary-expr","locations":[{"start":{"line":357,"column":10},"end":{"line":357,"column":21}},{"start":{"line":357,"column":25},"end":{"line":357,"column":39}}]},"41":{"line":362,"type":"if","locations":[{"start":{"line":362,"column":8},"end":{"line":362,"column":8}},{"start":{"line":362,"column":8},"end":{"line":362,"column":8}}]},"42":{"line":365,"type":"if","locations":[{"start":{"line":365,"column":8},"end":{"line":365,"column":8}},{"start":{"line":365,"column":8},"end":{"line":365,"column":8}}]},"43":{"line":365,"type":"binary-expr","locations":[{"start":{"line":365,"column":12},"end":{"line":365,"column":30}},{"start":{"line":365,"column":34},"end":{"line":365,"column":61}},{"start":{"line":365,"column":65},"end":{"line":365,"column":85}}]},"44":{"line":376,"type":"if","locations":[{"start":{"line":376,"column":2},"end":{"line":376,"column":2}},{"start":{"line":376,"column":2},"end":{"line":376,"column":2}}]},"45":{"line":376,"type":"binary-expr","locations":[{"start":{"line":376,"column":6},"end":{"line":376,"column":16}},{"start":{"line":376,"column":20},"end":{"line":376,"column":87}}]},"46":{"line":376,"type":"binary-expr","locations":[{"start":{"line":376,"column":22},"end":{"line":376,"column":56}},{"start":{"line":376,"column":60},"end":{"line":376,"column":86}}]}},"code":["'use strict';","","const fs = require('fs');","const path = require('path');","const debug = require('debug')('egg-core:plugin');","const sequencify = require('../../utils/sequencify');","const loadFile = require('../../utils').loadFile;","","module.exports = {","","  /**","   * Load config/plugin.js from {EggLoader#loadUnits}","   *","   * plugin.js is written below","   *","   * ```js","   * {","   *   'xxx-client': {","   *     enable: true,","   *     package: 'xxx-client',","   *     dep: [],","   *     env: [],","   *   },","   *   // short hand","   *   'rds': false,","   *   'depd': {","   *     enable: true,","   *     path: 'path/to/depd'","   *   }","   * }","   * ```","   *","   * If the plugin has path, Loader will find the module from it.","   *","   * Otherwise Loader will lookup follow the order by packageName","   *","   * 1. $APP_BASE/node_modules/${package}","   * 2. $EGG_BASE/node_modules/${package}","   *","   * You can call `loader.plugins` that retrieve enabled plugins.","   *","   * ```js","   * loader.plugins['xxx-client'] = {","   *   name: 'xxx-client',                 // the plugin name, it can be used in `dep`","   *   package: 'xxx-client',              // the package name of plugin","   *   enable: true,                       // whether enabled","   *   path: 'path/to/xxx-client',         // the directory of the plugin package","   *   dep: [],                            // the dependent plugins, you can use the plugin name","   *   env: [ 'local', 'unittest' ],       // specify the serverEnv that only enable the plugin in it","   * }","   * ```","   *","   * `loader.allPlugins` can be used when retrieve all plugins.","   * @method EggLoader#loadPlugin","   * @since 1.0.0","   */","  loadPlugin() {","    // loader plugins from application","    const appPlugins = this.readPluginConfigs(path.join(this.options.baseDir, 'config/plugin.default.js'));","    debug('Loaded app plugins: %j', Object.keys(appPlugins));","","    // loader plugins from framework","    const eggPluginConfigPaths = this.eggPaths.map(eggPath => path.join(eggPath, 'config/plugin.default.js'));","    const eggPlugins = this.readPluginConfigs(eggPluginConfigPaths);","    debug('Loaded egg plugins: %j', Object.keys(eggPlugins));","","    // loader plugins from process.env.EGG_PLUGINS","    let customPlugins;","    if (process.env.EGG_PLUGINS) {","      try {","        customPlugins = JSON.parse(process.env.EGG_PLUGINS);","      } catch (e) {","        debug('parse EGG_PLUGINS failed, %s', e);","      }","    }","","    // loader plugins from options.plugins","    if (this.options.plugins) {","      customPlugins = Object.assign({}, customPlugins, this.options.plugins);","    }","","    if (customPlugins) {","      for (const name in customPlugins) {","        this.normalizePluginConfig(customPlugins, name);","      }","      debug('Loaded custom plugins: %j', Object.keys(customPlugins));","    }","","    this.allPlugins = {};","    this.appPlugins = appPlugins;","    this.customPlugins = customPlugins;","    this.eggPlugins = eggPlugins;","","    this._extendPlugins(this.allPlugins, eggPlugins);","    this._extendPlugins(this.allPlugins, appPlugins);","    this._extendPlugins(this.allPlugins, customPlugins);","","    const enabledPluginNames = []; // enabled plugins that configured explicitly","    const plugins = {};","    const env = this.serverEnv;","    for (const name in this.allPlugins) {","      const plugin = this.allPlugins[name];","","      // resolve the real plugin.path based on plugin or package","      plugin.path = this.getPluginPath(plugin, this.options.baseDir);","","      // read plugin infomation from ${plugin.path}/package.json","      this.mergePluginConfig(plugin);","","      // disable the plugin that not match the serverEnv","      if (env && plugin.env.length && plugin.env.indexOf(env) === -1) {","        debug('Disable %j, as env is %j but got %j', name, plugin.env, env);","        plugin.enable = false;","        continue;","      }","","      // Can't enable the plugin implicitly when it's disabled by application","      if (appPlugins[name] && !appPlugins[name].enable) {","        debug('Disable %j, as disabled by app', name);","        continue;","      }","","      plugins[name] = plugin;","","      if (plugin.enable) {","        enabledPluginNames.push(name);","      }","    }","","    // retrieve the ordered plugins","    this.orderPlugins = this.getOrderPlugins(plugins, enabledPluginNames);","","    const enablePlugins = {};","    for (const plugin of this.orderPlugins) {","      enablePlugins[plugin.name] = plugin;","    }","    debug('Loaded plugins: %j', Object.keys(enablePlugins));","","    /**","     * Retrieve enabled plugins","     * @member {Object} EggLoader#plugins","     * @since 1.0.0","     */","    this.plugins = enablePlugins;","  },","","  /*","   * Read plugin.js from multiple directory","   */","  readPluginConfigs(configPaths) {","    if (!Array.isArray(configPaths)) {","      configPaths = [ configPaths ];","    }","","    // read plugin.default.js and plugins.${env}.js","    // note: can't use for-of","    for (let i = 0, l = configPaths.length; i < l; i++) {","      const configPath = configPaths[i];","      if (this.serverEnv === 'default') continue;","      configPaths.push(configPath.replace(/plugin\\.default\\.js$/, `plugin.${this.serverEnv}.js`));","    }","","    const plugins = {};","    for (let configPath of configPaths) {","      // let plugin.js compatible","      if (configPath.endsWith('plugin.default.js') && !fs.existsSync(configPath)) {","        configPath = configPath.replace(/plugin\\.default\\.js$/, 'plugin.js');","      }","","      if (!fs.existsSync(configPath)) {","        continue;","      }","","      const config = loadFile(configPath);","","      for (const name in config) {","        this.normalizePluginConfig(config, name, configPath);","      }","","      this._extendPlugins(plugins, config);","    }","","    return plugins;","  },","","  normalizePluginConfig(plugins, name, configPath) {","    const plugin = plugins[name];","","    // plugin_name: false","    if (typeof plugin === 'boolean') {","      plugins[ name ] = {","        name,","        enable: plugin,","        dependencies: [],","        optionalDependencies: [],","        env: [],","        from: configPath,","      };","      return;","    }","","    if (!('enable' in plugin)) {","      plugin.enable = true;","    }","    plugin.name = name;","    plugin.dependencies = plugin.dependencies || [];","    plugin.optionalDependencies = plugin.optionalDependencies || [];","    plugin.env = plugin.env || [];","    plugin.from = configPath;","    depCompatible(plugin);","  },","","  // Read plugin infomation from package.json and merge","  // {","  //   eggPlugin: {","  //     \"name\": \"\",    plugin name, must be same as name in config/plugin.js","  //     \"dep\": [],     dependent plugins","  //     \"env\": \"\"      env","  //   }","  // }","  mergePluginConfig(plugin) {","    let pkg;","    let config;","    const pluginPackage = path.join(plugin.path, 'package.json');","    if (fs.existsSync(pluginPackage)) {","      pkg = require(pluginPackage);","      config = pkg.eggPlugin;","      if (pkg.version) {","        plugin.version = pkg.version;","      }","    }","","    const logger = this.options.logger;","    if (!config) {","      logger.warn(`[egg:loader] pkg.eggPlugin is missing in ${pluginPackage}`);","      return;","    }","","    if (config.name && config.name !== plugin.name) {","      // pluginName is configured in config/plugin.js","      // pluginConfigName is pkg.eggPath.name","      logger.warn(`[egg:loader] pluginName(${plugin.name}) is different from pluginConfigName(${config.name})`);","    }","","    // dep compatible","    depCompatible(config);","","    for (const key of [ 'dependencies', 'optionalDependencies', 'env' ]) {","      if (!plugin[key].length && Array.isArray(config[key])) {","        plugin[key] = config[key];","      }","    }","  },","","  getOrderPlugins(allPlugins, enabledPluginNames) {","    // no plugins enabled","    if (!enabledPluginNames.length) {","      return [];","    }","","    const result = sequencify(allPlugins, enabledPluginNames);","    debug('Got plugins %j after sequencify', result);","","    // catch error when result.sequence is empty","    if (!result.sequence.length) {","      const err = new Error(`sequencify plugins has problem, missing: [${result.missingTasks}], recursive: [${result.recursiveDependencies}]`);","      // find plugins which is required by the missing plugin","      for (const missName of result.missingTasks) {","        const requires = [];","        for (const name in allPlugins) {","          if (allPlugins[name].dependencies.indexOf(missName) >= 0) {","            requires.push(name);","          }","        }","        err.message += `\\n\\t>> Plugin [${missName}] is disabled or missed, but is required by [${requires}]`;","      }","","      err.name = 'PluginSequencifyError';","      throw err;","    }","","    // log the plugins that be enabled implicitly","    const implicitEnabledPlugins = [];","    const requireMap = {};","    result.sequence.forEach(name => {","      for (const depName of allPlugins[name].dependencies) {","        if (!requireMap[depName]) {","          requireMap[depName] = [];","        }","        requireMap[depName].push(name);","      }","","      if (!allPlugins[name].enable) {","        implicitEnabledPlugins.push(name);","        allPlugins[name].enable = true;","      }","    });","    if (implicitEnabledPlugins.length) {","      // Following plugins will be enabled implicitly.","      //   - configclient required by [hsfclient]","      //   - eagleeye required by [hsfclient]","      //   - diamond required by [hsfclient]","      this.options.logger.info(`Following plugins will be enabled implicitly.\\n${implicitEnabledPlugins.map(name => `  - ${name} required by [${requireMap[name]}]`).join('\\n')}`);","    }","","    return result.sequence.map(name => allPlugins[name]);","  },","","  // Get the real plugin path","  getPluginPath(plugin) {","    if (plugin.path) {","      return plugin.path;","    }","","    const name = plugin.package || plugin.name;","    const lookupDirs = [];","","    // 尝试在以下目录找到匹配的插件","    //  -> {APP_PATH}/node_modules","    //    -> {EGG_PATH}/node_modules","    //      -> $CWD/node_modules","    lookupDirs.push(path.join(this.options.baseDir, 'node_modules'));","","    // 到 egg 中查找，优先从外往里查找","    for (let i = this.eggPaths.length - 1; i >= 0; i--) {","      const eggPath = this.eggPaths[i];","      lookupDirs.push(path.join(eggPath, 'node_modules'));","    }","","    // should find the $cwd/node_modules when test the plugins under npm3","    lookupDirs.push(path.join(process.cwd(), 'node_modules'));","","    for (let dir of lookupDirs) {","      dir = path.join(dir, name);","      if (fs.existsSync(dir)) {","        return fs.realpathSync(dir);","      }","    }","","    throw new Error(`Can not find plugin ${name} in \"${lookupDirs.join(', ')}\"`);","  },","","  _extendPlugins(target, plugins) {","    if (!plugins) {","      return;","    }","    for (const name in plugins) {","      const plugin = plugins[name];","      let targetPlugin = target[name];","      if (!targetPlugin) {","        targetPlugin = target[name] = {};","      }","      if (targetPlugin.package && targetPlugin.package === plugin.package) {","        this.options.logger.warn('plugin %s has been defined that is %j, but you define again in %s',","          name, targetPlugin, plugin.from);","      }","      if (plugin.path || plugin.package) {","        delete targetPlugin.path;","        delete targetPlugin.package;","      }","      for (const prop in plugin) {","        if (plugin[prop] === undefined) {","          continue;","        }","        if (targetPlugin[prop] && Array.isArray(plugin[prop]) && !plugin[prop].length) {","          continue;","        }","        targetPlugin[prop] = plugin[prop];","      }","    }","  },","","};","","function depCompatible(plugin) {","  if (plugin.dep && !(Array.isArray(plugin.dependencies) && plugin.dependencies.length)) {","    plugin.dependencies = plugin.dep;","    delete plugin.dep;","  }","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"9":1,"59":0,"60":0,"63":0,"64":0,"65":0,"68":0,"69":0,"70":0,"71":0,"73":0,"78":0,"79":0,"82":0,"83":0,"84":0,"86":0,"89":0,"90":0,"91":0,"92":0,"94":0,"95":0,"96":0,"98":0,"99":0,"100":0,"101":0,"102":0,"105":0,"108":0,"111":0,"112":0,"113":0,"114":0,"118":0,"119":0,"120":0,"123":0,"125":0,"126":0,"131":0,"133":0,"134":0,"135":0,"137":0,"144":0,"151":0,"152":0,"157":0,"158":0,"159":0,"160":0,"163":0,"164":0,"166":0,"167":0,"170":0,"171":0,"174":0,"176":0,"177":0,"180":0,"183":0,"187":0,"190":0,"191":0,"199":0,"202":0,"203":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"233":0,"234":0,"235":0,"236":0,"239":0,"242":0,"246":0,"248":0,"249":0,"250":0,"257":0,"258":0,"261":0,"262":0,"265":0,"266":0,"268":0,"269":0,"270":0,"271":0,"272":0,"275":0,"278":0,"279":0,"283":0,"284":0,"285":0,"286":0,"287":0,"288":0,"290":0,"293":0,"294":0,"295":0,"298":0,"303":0,"306":0,"311":0,"312":0,"315":0,"316":0,"322":0,"325":0,"326":0,"327":0,"331":0,"333":0,"334":0,"335":0,"336":0,"340":0,"344":0,"345":0,"347":0,"348":0,"349":0,"350":0,"351":0,"353":0,"354":0,"357":0,"358":0,"359":0,"361":0,"362":0,"363":0,"365":0,"366":0,"368":0,"375":1,"376":0,"377":0,"378":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/utils/sequencify.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/utils/sequencify.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"sequence","line":3,"loc":{"start":{"line":3,"column":0},"end":{"line":3,"column":77}}},"2":{"name":"(anonymous_2)","line":4,"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":31}}},"3":{"name":"(anonymous_3)","line":35,"loc":{"start":{"line":35,"column":17},"end":{"line":35,"column":40}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":31,"column":1}},"2":{"start":{"line":4,"column":2},"end":{"line":30,"column":5}},"3":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"4":{"start":{"line":6,"column":6},"end":{"line":6,"column":13}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":29}},"6":{"start":{"line":9,"column":4},"end":{"line":27,"column":5}},"7":{"start":{"line":10,"column":6},"end":{"line":12,"column":7}},"8":{"start":{"line":11,"column":8},"end":{"line":11,"column":15}},"9":{"start":{"line":13,"column":6},"end":{"line":13,"column":25}},"10":{"start":{"line":14,"column":11},"end":{"line":27,"column":5}},"11":{"start":{"line":15,"column":6},"end":{"line":15,"column":22}},"12":{"start":{"line":16,"column":6},"end":{"line":16,"column":36}},"13":{"start":{"line":17,"column":6},"end":{"line":17,"column":21}},"14":{"start":{"line":18,"column":11},"end":{"line":27,"column":5}},"15":{"start":{"line":19,"column":6},"end":{"line":19,"column":22}},"16":{"start":{"line":20,"column":6},"end":{"line":22,"column":7}},"17":{"start":{"line":21,"column":8},"end":{"line":21,"column":78}},"18":{"start":{"line":23,"column":6},"end":{"line":25,"column":7}},"19":{"start":{"line":24,"column":8},"end":{"line":24,"column":92}},"20":{"start":{"line":26,"column":6},"end":{"line":26,"column":21}},"21":{"start":{"line":28,"column":4},"end":{"line":28,"column":34}},"22":{"start":{"line":28,"column":27},"end":{"line":28,"column":34}},"23":{"start":{"line":29,"column":4},"end":{"line":29,"column":23}},"24":{"start":{"line":35,"column":0},"end":{"line":51,"column":2}},"25":{"start":{"line":36,"column":2},"end":{"line":36,"column":19}},"26":{"start":{"line":37,"column":2},"end":{"line":37,"column":21}},"27":{"start":{"line":38,"column":2},"end":{"line":38,"column":23}},"28":{"start":{"line":40,"column":2},"end":{"line":40,"column":58}},"29":{"start":{"line":42,"column":2},"end":{"line":44,"column":3}},"30":{"start":{"line":43,"column":4},"end":{"line":43,"column":17}},"31":{"start":{"line":46,"column":2},"end":{"line":50,"column":4}}},"branchMap":{"1":{"line":5,"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":5,"column":4}},{"start":{"line":5,"column":4},"end":{"line":5,"column":4}}]},"2":{"line":9,"type":"if","locations":[{"start":{"line":9,"column":4},"end":{"line":9,"column":4}},{"start":{"line":9,"column":4},"end":{"line":9,"column":4}}]},"3":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":6},"end":{"line":10,"column":6}},{"start":{"line":10,"column":6},"end":{"line":10,"column":6}}]},"4":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":11},"end":{"line":14,"column":11}},{"start":{"line":14,"column":11},"end":{"line":14,"column":11}}]},"5":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":11},"end":{"line":18,"column":11}},{"start":{"line":18,"column":11},"end":{"line":18,"column":11}}]},"6":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":15},"end":{"line":18,"column":39}},{"start":{"line":18,"column":43},"end":{"line":18,"column":75}}]},"7":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":6},"end":{"line":20,"column":6}},{"start":{"line":20,"column":6},"end":{"line":20,"column":6}}]},"8":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":6},"end":{"line":23,"column":6}},{"start":{"line":23,"column":6},"end":{"line":23,"column":6}}]},"9":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":28,"column":4}},{"start":{"line":28,"column":4},"end":{"line":28,"column":4}}]},"10":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":2},"end":{"line":42,"column":2}},{"start":{"line":42,"column":2},"end":{"line":42,"column":2}}]},"11":{"line":42,"type":"binary-expr","locations":[{"start":{"line":42,"column":6},"end":{"line":42,"column":20}},{"start":{"line":42,"column":24},"end":{"line":42,"column":40}}]}},"code":["'use strict';","","function sequence(tasks, names, results, missing, recursive, nest, optional) {","  names.forEach(function(name) {","    if (results.indexOf(name) !== -1) {","      return; // de-dup results","    }","    const node = tasks[name];","    if (!node) {","      if (optional === true) {","        return;","      }","      missing.push(name);","    } else if (nest.indexOf(name) > -1) {","      nest.push(name);","      recursive.push(nest.slice(0));","      nest.pop(name);","    } else if (node.dependencies.length || node.optionalDependencies.length) {","      nest.push(name);","      if (node.dependencies.length) {","        sequence(tasks, node.dependencies, results, missing, recursive, nest);","      }","      if (node.optionalDependencies.length) {","        sequence(tasks, node.optionalDependencies, results, missing, recursive, nest, true);","      }","      nest.pop(name);","    }","    if (optional === true) return;","    results.push(name);","  });","}","","// tasks: object with keys as task names","// names: array of task names","module.exports = function(tasks, names) {","  let results = []; // the final sequence","  const missing = []; // missing tasks","  const recursive = []; // recursive task dependencies","","  sequence(tasks, names, results, missing, recursive, []);","","  if (missing.length || recursive.length) {","    results = []; // results are incomplete at best, completely wrong at worst, remove them to avoid confusion","  }","","  return {","    sequence: results,","    missingTasks: missing,","    recursiveDependencies: recursive,","  };","};",""],"l":{"3":1,"4":0,"5":0,"6":0,"8":0,"9":0,"10":0,"11":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"23":0,"24":0,"26":0,"28":0,"29":0,"35":1,"36":0,"37":0,"38":0,"40":0,"42":0,"43":0,"46":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/config.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/config.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":20,"loc":{"start":{"line":20,"column":12},"end":{"line":20,"column":15}}},"2":{"name":"(anonymous_2)","line":58,"loc":{"start":{"line":58,"column":19},"end":{"line":58,"column":22}}},"3":{"name":"(anonymous_3)","line":71,"loc":{"start":{"line":71,"column":13},"end":{"line":71,"column":52}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":50}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":25}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":29}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":34}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":33}},"6":{"start":{"line":10,"column":0},"end":{"line":96,"column":2}},"7":{"start":{"line":21,"column":4},"end":{"line":21,"column":22}},"8":{"start":{"line":23,"column":4},"end":{"line":26,"column":6}},"9":{"start":{"line":29,"column":4},"end":{"line":29,"column":47}},"10":{"start":{"line":37,"column":4},"end":{"line":49,"column":5}},"11":{"start":{"line":38,"column":6},"end":{"line":48,"column":7}},"12":{"start":{"line":39,"column":8},"end":{"line":39,"column":42}},"13":{"start":{"line":40,"column":8},"end":{"line":40,"column":103}},"14":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"15":{"start":{"line":43,"column":10},"end":{"line":43,"column":19}},"16":{"start":{"line":46,"column":8},"end":{"line":46,"column":70}},"17":{"start":{"line":47,"column":8},"end":{"line":47,"column":37}},"18":{"start":{"line":52,"column":4},"end":{"line":52,"column":81}},"19":{"start":{"line":53,"column":4},"end":{"line":53,"column":75}},"20":{"start":{"line":55,"column":4},"end":{"line":55,"column":25}},"21":{"start":{"line":59,"column":4},"end":{"line":62,"column":6}},"22":{"start":{"line":63,"column":4},"end":{"line":63,"column":22}},"23":{"start":{"line":64,"column":4},"end":{"line":67,"column":5}},"24":{"start":{"line":65,"column":6},"end":{"line":65,"column":88}},"25":{"start":{"line":66,"column":6},"end":{"line":66,"column":35}},"26":{"start":{"line":68,"column":4},"end":{"line":68,"column":18}},"27":{"start":{"line":72,"column":4},"end":{"line":72,"column":39}},"28":{"start":{"line":73,"column":4},"end":{"line":73,"column":33}},"29":{"start":{"line":75,"column":4},"end":{"line":75,"column":58}},"30":{"start":{"line":77,"column":4},"end":{"line":79,"column":5}},"31":{"start":{"line":78,"column":6},"end":{"line":78,"column":56}},"32":{"start":{"line":80,"column":4},"end":{"line":80,"column":70}},"33":{"start":{"line":82,"column":4},"end":{"line":84,"column":5}},"34":{"start":{"line":83,"column":6},"end":{"line":83,"column":18}},"35":{"start":{"line":86,"column":4},"end":{"line":88,"column":5}},"36":{"start":{"line":87,"column":6},"end":{"line":87,"column":87}},"37":{"start":{"line":89,"column":4},"end":{"line":91,"column":5}},"38":{"start":{"line":90,"column":6},"end":{"line":90,"column":77}},"39":{"start":{"line":93,"column":4},"end":{"line":93,"column":18}}},"branchMap":{"1":{"line":40,"type":"cond-expr","locations":[{"start":{"line":40,"column":69},"end":{"line":40,"column":78}},{"start":{"line":40,"column":81},"end":{"line":40,"column":90}}]},"2":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":42,"column":8}},{"start":{"line":42,"column":8},"end":{"line":42,"column":8}}]},"3":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":53},"end":{"line":52,"column":74}},{"start":{"line":52,"column":78},"end":{"line":52,"column":80}}]},"4":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":51},"end":{"line":53,"column":68}},{"start":{"line":53,"column":72},"end":{"line":53,"column":74}}]},"5":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":4},"end":{"line":77,"column":4}},{"start":{"line":77,"column":4},"end":{"line":77,"column":4}}]},"6":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":8},"end":{"line":77,"column":40}},{"start":{"line":77,"column":44},"end":{"line":77,"column":68}}]},"7":{"line":82,"type":"if","locations":[{"start":{"line":82,"column":4},"end":{"line":82,"column":4}},{"start":{"line":82,"column":4},"end":{"line":82,"column":4}}]},"8":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":4},"end":{"line":86,"column":4}},{"start":{"line":86,"column":4},"end":{"line":86,"column":4}}]},"9":{"line":86,"type":"binary-expr","locations":[{"start":{"line":86,"column":8},"end":{"line":86,"column":16}},{"start":{"line":86,"column":20},"end":{"line":86,"column":25}}]},"10":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":4},"end":{"line":89,"column":4}},{"start":{"line":89,"column":4},"end":{"line":89,"column":4}}]}},"code":["'use strict';","","const debug = require('debug')('egg-core:config');","const fs = require('fs');","const path = require('path');","const extend = require('extend2');","const assert = require('assert');","","","module.exports = {","","  /**","   * Load config/config.js","   *","   * Will merge config.default.js 和 config.${env}.js","   *","   * @method EggLoader#loadConfig","   * @since 1.0.0","   */","  loadConfig() {","    const target = {};","","    const names = [","      'config.default.js',","      `config.${this.serverEnv}.js`,","    ];","","    // Load Application config first","    const appConfig = this._preloadAppConfig();","","    //   plugin config.default","    //     framework config.default","    //       app config.default","    //         plugin config.{env}","    //           framework config.{env}","    //             app config.{env}","    for (const filename of names) {","      for (const unit of this.getLoadUnits()) {","        const isApp = unit.type === 'app';","        const config = this._loadConfig(unit.path, filename, isApp ? undefined : appConfig, unit.type);","","        if (!config) {","          continue;","        }","","        debug('Loaded config %s/%s, %j', unit.path, filename, config);","        extend(true, target, config);","      }","    }","","    // You can manipulate the order of app.config.coreMiddleware and app.config.appMiddleware in app.js","    target.coreMiddleware = target.coreMiddlewares = target.coreMiddleware || [];","    target.appMiddleware = target.appMiddlewares = target.middleware || [];","","    this.config = target;","  },","","  _preloadAppConfig() {","    const names = [","      'config.default.js',","      `config.${this.serverEnv}.js`,","    ];","    const target = {};","    for (const filename of names) {","      const config = this._loadConfig(this.options.baseDir, filename, undefined, 'app');","      extend(true, target, config);","    }","    return target;","  },","","  _loadConfig(dirpath, filename, extraInject, type) {","    const isPlugin = type === 'plugin';","    const isApp = type === 'app';","","    let filepath = path.join(dirpath, 'config', filename);","    // let config.js compatible","    if (filename === 'config.default.js' && !fs.existsSync(filepath)) {","      filepath = path.join(dirpath, 'config/config.js');","    }","    const config = this.loadFile(filepath, this.appInfo, extraInject);","","    if (!config) {","      return null;","    }","","    if (isPlugin || isApp) {","      assert(!config.coreMiddleware, 'Can not define coreMiddleware in app or plugin');","    }","    if (!isApp) {","      assert(!config.middleware, 'Can not define middleware in ' + filepath);","    }","","    return config;","  },","","};",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"10":1,"21":0,"23":0,"29":0,"37":0,"38":0,"39":0,"40":0,"42":0,"43":0,"46":0,"47":0,"52":0,"53":0,"55":0,"59":0,"63":0,"64":0,"65":0,"66":0,"68":0,"72":0,"73":0,"75":0,"77":0,"78":0,"80":0,"82":0,"83":0,"86":0,"87":0,"89":0,"90":0,"93":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/extend.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/extend.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":21,"loc":{"start":{"line":21,"column":17},"end":{"line":21,"column":20}}},"2":{"name":"(anonymous_2)","line":30,"loc":{"start":{"line":30,"column":23},"end":{"line":30,"column":26}}},"3":{"name":"(anonymous_3)","line":39,"loc":{"start":{"line":39,"column":19},"end":{"line":39,"column":22}}},"4":{"name":"(anonymous_4)","line":48,"loc":{"start":{"line":48,"column":20},"end":{"line":48,"column":23}}},"5":{"name":"(anonymous_5)","line":57,"loc":{"start":{"line":57,"column":19},"end":{"line":57,"column":22}}},"6":{"name":"(anonymous_6)","line":66,"loc":{"start":{"line":66,"column":18},"end":{"line":66,"column":21}}},"7":{"name":"(anonymous_7)","line":79,"loc":{"start":{"line":79,"column":12},"end":{"line":79,"column":26}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":50}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":37}},"4":{"start":{"line":7,"column":0},"end":{"line":12,"column":2}},"5":{"start":{"line":14,"column":0},"end":{"line":133,"column":2}},"6":{"start":{"line":22,"column":4},"end":{"line":22,"column":39}},"7":{"start":{"line":31,"column":4},"end":{"line":31,"column":45}},"8":{"start":{"line":40,"column":4},"end":{"line":40,"column":49}},"9":{"start":{"line":49,"column":4},"end":{"line":49,"column":51}},"10":{"start":{"line":58,"column":4},"end":{"line":58,"column":49}},"11":{"start":{"line":67,"column":4},"end":{"line":69,"column":5}},"12":{"start":{"line":68,"column":6},"end":{"line":68,"column":59}},"13":{"start":{"line":81,"column":4},"end":{"line":81,"column":96}},"14":{"start":{"line":81,"column":54},"end":{"line":81,"column":94}},"15":{"start":{"line":83,"column":4},"end":{"line":83,"column":96}},"16":{"start":{"line":84,"column":4},"end":{"line":88,"column":5}},"17":{"start":{"line":85,"column":6},"end":{"line":85,"column":36}},"18":{"start":{"line":86,"column":6},"end":{"line":86,"column":54}},"19":{"start":{"line":87,"column":6},"end":{"line":87,"column":64}},"20":{"start":{"line":87,"column":25},"end":{"line":87,"column":64}},"21":{"start":{"line":90,"column":4},"end":{"line":90,"column":34}},"22":{"start":{"line":91,"column":4},"end":{"line":131,"column":5}},"23":{"start":{"line":92,"column":6},"end":{"line":94,"column":7}},"24":{"start":{"line":93,"column":8},"end":{"line":93,"column":17}},"25":{"start":{"line":96,"column":6},"end":{"line":96,"column":43}},"26":{"start":{"line":98,"column":6},"end":{"line":99,"column":51}},"27":{"start":{"line":101,"column":6},"end":{"line":129,"column":7}},"28":{"start":{"line":102,"column":8},"end":{"line":105,"column":9}},"29":{"start":{"line":103,"column":10},"end":{"line":104,"column":59}},"30":{"start":{"line":108,"column":8},"end":{"line":108,"column":72}},"31":{"start":{"line":109,"column":8},"end":{"line":109,"column":81}},"32":{"start":{"line":110,"column":8},"end":{"line":116,"column":9}},"33":{"start":{"line":112,"column":10},"end":{"line":112,"column":55}},"34":{"start":{"line":113,"column":10},"end":{"line":115,"column":11}},"35":{"start":{"line":114,"column":12},"end":{"line":114,"column":88}},"36":{"start":{"line":117,"column":8},"end":{"line":126,"column":9}},"37":{"start":{"line":119,"column":10},"end":{"line":119,"column":53}},"38":{"start":{"line":120,"column":10},"end":{"line":122,"column":11}},"39":{"start":{"line":121,"column":12},"end":{"line":121,"column":51}},"40":{"start":{"line":123,"column":10},"end":{"line":125,"column":11}},"41":{"start":{"line":124,"column":12},"end":{"line":124,"column":51}},"42":{"start":{"line":127,"column":8},"end":{"line":127,"column":59}},"43":{"start":{"line":128,"column":8},"end":{"line":128,"column":44}},"44":{"start":{"line":130,"column":6},"end":{"line":130,"column":72}}},"branchMap":{"1":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":67,"column":4}},{"start":{"line":67,"column":4},"end":{"line":67,"column":4}}]},"2":{"line":67,"type":"binary-expr","locations":[{"start":{"line":67,"column":8},"end":{"line":67,"column":16}},{"start":{"line":67,"column":20},"end":{"line":67,"column":35}}]},"3":{"line":83,"type":"binary-expr","locations":[{"start":{"line":83,"column":26},"end":{"line":83,"column":62}},{"start":{"line":83,"column":66},"end":{"line":83,"column":95}}]},"4":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":6},"end":{"line":87,"column":6}},{"start":{"line":87,"column":6},"end":{"line":87,"column":6}}]},"5":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":6},"end":{"line":92,"column":6}},{"start":{"line":92,"column":6},"end":{"line":92,"column":6}}]},"6":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":8},"end":{"line":102,"column":8}},{"start":{"line":102,"column":8},"end":{"line":102,"column":8}}]},"7":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":8},"end":{"line":110,"column":8}},{"start":{"line":110,"column":8},"end":{"line":110,"column":8}}]},"8":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":10},"end":{"line":113,"column":10}},{"start":{"line":113,"column":10},"end":{"line":113,"column":10}}]},"9":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":8},"end":{"line":117,"column":8}},{"start":{"line":117,"column":8},"end":{"line":117,"column":8}}]},"10":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":10},"end":{"line":120,"column":10}},{"start":{"line":120,"column":10},"end":{"line":120,"column":10}}]},"11":{"line":120,"type":"binary-expr","locations":[{"start":{"line":120,"column":14},"end":{"line":120,"column":29}},{"start":{"line":120,"column":33},"end":{"line":120,"column":54}}]},"12":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":10},"end":{"line":123,"column":10}},{"start":{"line":123,"column":10},"end":{"line":123,"column":10}}]},"13":{"line":123,"type":"binary-expr","locations":[{"start":{"line":123,"column":14},"end":{"line":123,"column":29}},{"start":{"line":123,"column":33},"end":{"line":123,"column":54}}]}},"code":["'use strict';","","const debug = require('debug')('egg-core:extend');","const path = require('path');","const utils = require('../../utils');","","const orginalPrototypes = {","  request: require('koa/lib/request'),","  response: require('koa/lib/response'),","  context: require('koa/lib/context'),","  application: require('koa/lib/application'),","};","","module.exports = {","","  /**","   * mixin Agent.prototype","   * @method EggLoader#loadAgentExtend","   * @since 1.0.0","   */","  loadAgentExtend() {","    this.loadExtend('agent', this.app);","  },","","  /**","   * mixin Application.prototype","   * @method EggLoader#loadApplicationExtend","   * @since 1.0.0","   */","  loadApplicationExtend() {","    this.loadExtend('application', this.app);","  },","","  /**","   * mixin Request.prototype","   * @method EggLoader#loadRequestExtend","   * @since 1.0.0","   */","  loadRequestExtend() {","    this.loadExtend('request', this.app.request);","  },","","  /**","   * mixin Response.prototype","   * @method EggLoader#loadResponseExtend","   * @since 1.0.0","   */","  loadResponseExtend() {","    this.loadExtend('response', this.app.response);","  },","","  /**","   * mixin Context.prototype","   * @method EggLoader#loadContextExtend","   * @since 1.0.0","   */","  loadContextExtend() {","    this.loadExtend('context', this.app.context);","  },","","  /**","   * mixin app.Helper.prototype","   * @method EggLoader#loadHelperExtend","   * @since 1.0.0","   */","  loadHelperExtend() {","    if (this.app && this.app.Helper) {","      this.loadExtend('helper', this.app.Helper.prototype);","    }","  },","","  /**","   * Loader app/extend/xx.js to `prototype`,","   * @method loadExtend","   * @param {String} name - filename which may be `app/extend/{name}.js`","   * @param {Object} proto - prototype that mixed","   * @since 1.0.0","   */","  loadExtend(name, proto) {","    // All extend files","    const filepaths = this.getLoadUnits().map(unit => path.join(unit.path, 'app/extend', name));","    // if use mm.env and serverEnv is not unittest","    const isAddUnittest = 'EGG_MOCK_SERVER_ENV' in process.env && this.serverEnv !== 'unittest';","    for (let i = 0, l = filepaths.length; i < l; i++) {","      const filepath = filepaths[i];","      filepaths.push(filepath + `.${this.serverEnv}`);","      if (isAddUnittest) filepaths.push(filepath + '.unittest');","    }","","    const mergeRecord = new Map();","    for (const filepath of filepaths) {","      if (!utils.existsModule(filepath)) {","        continue;","      }","","      const ext = utils.loadFile(filepath);","","      const properties = Object.getOwnPropertyNames(ext)","        .concat(Object.getOwnPropertySymbols(ext));","","      for (const property of properties) {","        if (mergeRecord.has(property)) {","          debug('Property: \"%s\" already exists in \"%s\"，it will be redefined by \"%s\"',","            property, mergeRecord.get(property), filepath);","        }","","        // Copy descriptor","        let descriptor = Object.getOwnPropertyDescriptor(ext, property);","        let orginalDescriptor = Object.getOwnPropertyDescriptor(proto, property);","        if (!orginalDescriptor) {","          // try to get descriptor from orginalPrototypes","          const orginalProto = orginalPrototypes[name];","          if (orginalProto) {","            orginalDescriptor = Object.getOwnPropertyDescriptor(orginalProto, property);","          }","        }","        if (orginalDescriptor) {","          // don't override descriptor","          descriptor = Object.assign({}, descriptor);","          if (!descriptor.set && orginalDescriptor.set) {","            descriptor.set = orginalDescriptor.set;","          }","          if (!descriptor.get && orginalDescriptor.get) {","            descriptor.get = orginalDescriptor.get;","          }","        }","        Object.defineProperty(proto, property, descriptor);","        mergeRecord.set(property, filepath);","      }","      debug('merge %j to %s from %s', Object.keys(ext), name, filepath);","    }","  },","};",""],"l":{"3":1,"4":1,"5":1,"7":1,"14":1,"22":0,"31":0,"40":0,"49":0,"58":0,"67":0,"68":0,"81":0,"83":0,"84":0,"85":0,"86":0,"87":0,"90":0,"91":0,"92":0,"93":0,"96":0,"98":0,"101":0,"102":0,"103":0,"108":0,"109":0,"110":0,"112":0,"113":0,"114":0,"117":0,"119":0,"120":0,"121":0,"123":0,"124":0,"127":0,"128":0,"130":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/custom.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/custom.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":23,"loc":{"start":{"line":23,"column":15},"end":{"line":23,"column":18}}},"2":{"name":"(anonymous_2)","line":31,"loc":{"start":{"line":31,"column":17},"end":{"line":31,"column":20}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":5,"column":0},"end":{"line":36,"column":2}},"3":{"start":{"line":24,"column":4},"end":{"line":25,"column":70}},"4":{"start":{"line":25,"column":23},"end":{"line":25,"column":68}},"5":{"start":{"line":32,"column":4},"end":{"line":33,"column":72}},"6":{"start":{"line":33,"column":23},"end":{"line":33,"column":70}}},"branchMap":{},"code":["'use strict';","","const path = require('path');","","module.exports = {","","  /**","   * load app.js","   *","   * @example","   * ```js","   * module.exports = function(app) {","   *   // can do everything","   *   do();","   *","   *   // if you will invork asynchronous, you can use readyCallback","   *   const done = app.readyCallback();","   *   doAsync(done);","   * }","   * ```","   * @since 1.0.0","   */","  loadCustomApp() {","    this.getLoadUnits()","      .forEach(unit => this.loadFile(path.join(unit.path, 'app.js')));","  },","","  /**","   * Load agent.js, same as {@link EggLoader#loadCustomApp}","   */","  loadCustomAgent() {","    this.getLoadUnits()","      .forEach(unit => this.loadFile(path.join(unit.path, 'agent.js')));","  },","","};",""],"l":{"3":1,"5":1,"24":0,"25":0,"32":0,"33":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/service.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/service.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":13,"loc":{"start":{"line":13,"column":13},"end":{"line":13,"column":19}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":5,"column":0},"end":{"line":27,"column":2}},"3":{"start":{"line":14,"column":4},"end":{"line":16,"column":7}},"4":{"start":{"line":15,"column":6},"end":{"line":15,"column":49}},"5":{"start":{"line":19,"column":4},"end":{"line":23,"column":12}},"6":{"start":{"line":24,"column":4},"end":{"line":24,"column":53}}},"branchMap":{},"code":["'use strict';","","const path = require('path');","","module.exports = {","","  /**","   * Load app/service","   * @method EggLoader#loadService","   * @param {Object} opt - LoaderOptions","   * @since 1.0.0","   */","  loadService(opt) {","    const servicePaths = this.getLoadUnits().map(unit => {","      return path.join(unit.path, 'app/service');","    });","","    // 载入到 app.serviceClasses","    opt = Object.assign({","      call: true,","      caseStyle: 'lower',","      fieldClass: 'serviceClasses',","    }, opt);","    this.loadToContext(servicePaths, 'service', opt);","  },","","};",""],"l":{"3":1,"5":1,"14":0,"15":0,"19":0,"24":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/middleware.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/middleware.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":1,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":32,"loc":{"start":{"line":32,"column":16},"end":{"line":32,"column":22}}},"2":{"name":"wrapMiddleware","line":81,"loc":{"start":{"line":81,"column":0},"end":{"line":81,"column":37}}},"3":{"name":"(anonymous_3)","line":92,"loc":{"start":{"line":92,"column":13},"end":{"line":92,"column":30}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":34}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":40}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":33}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":54}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":50}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":37}},"8":{"start":{"line":11,"column":0},"end":{"line":79,"column":2}},"9":{"start":{"line":33,"column":4},"end":{"line":33,"column":25}},"10":{"start":{"line":36,"column":4},"end":{"line":40,"column":12}},"11":{"start":{"line":41,"column":4},"end":{"line":41,"column":95}},"12":{"start":{"line":41,"column":60},"end":{"line":41,"column":93}},"13":{"start":{"line":42,"column":4},"end":{"line":42,"column":56}},"14":{"start":{"line":44,"column":4},"end":{"line":44,"column":89}},"15":{"start":{"line":45,"column":4},"end":{"line":45,"column":87}},"16":{"start":{"line":48,"column":4},"end":{"line":48,"column":89}},"17":{"start":{"line":49,"column":4},"end":{"line":49,"column":50}},"18":{"start":{"line":50,"column":4},"end":{"line":50,"column":37}},"19":{"start":{"line":51,"column":4},"end":{"line":74,"column":5}},"20":{"start":{"line":52,"column":6},"end":{"line":54,"column":7}},"21":{"start":{"line":53,"column":8},"end":{"line":53,"column":60}},"22":{"start":{"line":55,"column":6},"end":{"line":57,"column":7}},"23":{"start":{"line":56,"column":8},"end":{"line":56,"column":60}},"24":{"start":{"line":58,"column":6},"end":{"line":58,"column":37}},"25":{"start":{"line":60,"column":6},"end":{"line":60,"column":46}},"26":{"start":{"line":61,"column":6},"end":{"line":61,"column":37}},"27":{"start":{"line":62,"column":6},"end":{"line":62,"column":28}},"28":{"start":{"line":63,"column":6},"end":{"line":63,"column":101}},"29":{"start":{"line":64,"column":6},"end":{"line":64,"column":22}},"30":{"start":{"line":66,"column":6},"end":{"line":66,"column":39}},"31":{"start":{"line":67,"column":6},"end":{"line":73,"column":7}},"32":{"start":{"line":68,"column":8},"end":{"line":68,"column":20}},"33":{"start":{"line":69,"column":8},"end":{"line":69,"column":68}},"34":{"start":{"line":70,"column":8},"end":{"line":70,"column":74}},"35":{"start":{"line":72,"column":8},"end":{"line":72,"column":78}},"36":{"start":{"line":76,"column":4},"end":{"line":76,"column":88}},"37":{"start":{"line":81,"column":0},"end":{"line":98,"column":1}},"38":{"start":{"line":83,"column":2},"end":{"line":83,"column":44}},"39":{"start":{"line":83,"column":32},"end":{"line":83,"column":44}},"40":{"start":{"line":86,"column":2},"end":{"line":86,"column":28}},"41":{"start":{"line":89,"column":2},"end":{"line":89,"column":51}},"42":{"start":{"line":89,"column":41},"end":{"line":89,"column":51}},"43":{"start":{"line":90,"column":2},"end":{"line":90,"column":38}},"44":{"start":{"line":92,"column":2},"end":{"line":95,"column":4}},"45":{"start":{"line":93,"column":4},"end":{"line":93,"column":40}},"46":{"start":{"line":93,"column":22},"end":{"line":93,"column":40}},"47":{"start":{"line":94,"column":4},"end":{"line":94,"column":30}},"48":{"start":{"line":96,"column":2},"end":{"line":96,"column":44}},"49":{"start":{"line":97,"column":2},"end":{"line":97,"column":12}}},"branchMap":{"1":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":6},"end":{"line":52,"column":6}},{"start":{"line":52,"column":6},"end":{"line":52,"column":6}}]},"2":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":6},"end":{"line":55,"column":6}},{"start":{"line":55,"column":6},"end":{"line":55,"column":6}}]},"3":{"line":60,"type":"binary-expr","locations":[{"start":{"line":60,"column":22},"end":{"line":60,"column":39}},{"start":{"line":60,"column":43},"end":{"line":60,"column":45}}]},"4":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":6},"end":{"line":67,"column":6}},{"start":{"line":67,"column":6},"end":{"line":67,"column":6}}]},"5":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":2},"end":{"line":83,"column":2}},{"start":{"line":83,"column":2},"end":{"line":83,"column":2}}]},"6":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":2},"end":{"line":89,"column":2}},{"start":{"line":89,"column":2},"end":{"line":89,"column":2}}]},"7":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":6},"end":{"line":89,"column":20}},{"start":{"line":89,"column":24},"end":{"line":89,"column":39}}]},"8":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":4},"end":{"line":93,"column":4}},{"start":{"line":93,"column":4},"end":{"line":93,"column":4}}]}},"code":["'use strict';","","const join = require('path').join;","const is = require('is-type-of');","const inspect = require('util').inspect;","const assert = require('assert');","const debug = require('debug')('egg-core:middleware');","const pathMatching = require('egg-path-matching');","const utils = require('../../utils');","","module.exports = {","","  /**","   * Load app/middleware","   *","   * app.config.xx is the options of the middleware xx that has same name as config","   *","   * @method EggLoader#loadMiddleware","   * @param {Object} opt - LoaderOptions","   * @example","   * ```js","   * // app/middleware/status.js","   * module.exports = function(options, app) {","   *   // options == app.config.status","   *   return function*(next) {","   *     yield next;","   *   }","   * }","   * ```","   * @since 1.0.0","   */","  loadMiddleware(opt) {","    const app = this.app;","","    // load middleware to app.middleware","    opt = Object.assign({","      call: false,","      override: true,","      caseStyle: 'lower',","    }, opt);","    const middlewarePaths = this.getLoadUnits().map(unit => join(unit.path, 'app/middleware'));","    this.loadToApp(middlewarePaths, 'middlewares', opt);","","    this.options.logger.info('Use coreMiddleware order: %j', this.config.coreMiddleware);","    this.options.logger.info('Use appMiddleware order: %j', this.config.appMiddleware);","","    // use middleware ordered by app.config.coreMiddleware and app.config.appMiddleware","    const middlewareNames = this.config.coreMiddleware.concat(this.config.appMiddleware);","    debug('middlewareNames: %j', middlewareNames);","    const middlewaresMap = new Map();","    for (const name of middlewareNames) {","      if (!app.middlewares[name]) {","        throw new TypeError(`Middleware ${name} not found`);","      }","      if (middlewaresMap.has(name)) {","        throw new TypeError(`Middleware ${name} redefined`);","      }","      middlewaresMap.set(name, true);","","      const options = this.config[name] || {};","      let mw = app.middlewares[name];","      mw = mw(options, app);","      assert(is.function(mw), `Middleware ${name} must be a function, but actual is ${inspect(mw)}`);","      mw._name = name;","      // middlewares support options.enable, options.ignore and options.match","      mw = wrapMiddleware(mw, options);","      if (mw) {","        app.use(mw);","        debug('Use middleware: %s with options: %j', name, options);","        this.options.logger.info('[egg:loader] Use middleware: %s', name);","      } else {","        this.options.logger.info('[egg:loader] Disable middleware: %s', name);","      }","    }","","    this.options.logger.info('[egg:loader] Loaded middleware from %j', middlewarePaths);","  },","","};","","function wrapMiddleware(mw, options) {","  // support options.enable","  if (options.enable === false) return null;","","  // support async function","  mw = utils.middleware(mw);","","  // support options.match and options.ignore","  if (!options.match && !options.ignore) return mw;","  const match = pathMatching(options);","","  const fn = function* (next) {","    if (!match(this)) return yield next;","    yield mw.call(this, next);","  };","  fn._name = mw._name + 'middlewareWrapper';","  return fn;","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"11":1,"33":0,"36":0,"41":0,"42":0,"44":0,"45":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"55":0,"56":0,"58":0,"60":0,"61":0,"62":0,"63":0,"64":0,"66":0,"67":0,"68":0,"69":0,"70":0,"72":0,"76":0,"81":1,"83":0,"86":0,"89":0,"90":0,"92":0,"93":0,"94":0,"96":0,"97":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-path-matching/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-path-matching/index.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":5,"loc":{"start":{"line":5,"column":17},"end":{"line":5,"column":35}}},"2":{"name":"pathMatch","line":12,"loc":{"start":{"line":12,"column":9},"end":{"line":12,"column":33}}},"3":{"name":"toPathMatch","line":18,"loc":{"start":{"line":18,"column":0},"end":{"line":18,"column":30}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":47}},"2":{"start":{"line":5,"column":0},"end":{"line":16,"column":2}},"3":{"start":{"line":6,"column":2},"end":{"line":6,"column":26}},"4":{"start":{"line":7,"column":2},"end":{"line":7,"column":112}},"5":{"start":{"line":7,"column":39},"end":{"line":7,"column":112}},"6":{"start":{"line":8,"column":2},"end":{"line":8,"column":59}},"7":{"start":{"line":8,"column":41},"end":{"line":8,"column":59}},"8":{"start":{"line":8,"column":54},"end":{"line":8,"column":58}},"9":{"start":{"line":10,"column":2},"end":{"line":10,"column":91}},"10":{"start":{"line":12,"column":2},"end":{"line":15,"column":4}},"11":{"start":{"line":13,"column":4},"end":{"line":13,"column":33}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":46}},"13":{"start":{"line":18,"column":0},"end":{"line":30,"column":1}},"14":{"start":{"line":19,"column":2},"end":{"line":22,"column":3}},"15":{"start":{"line":20,"column":4},"end":{"line":20,"column":58}},"16":{"start":{"line":21,"column":4},"end":{"line":21,"column":37}},"17":{"start":{"line":21,"column":18},"end":{"line":21,"column":36}},"18":{"start":{"line":23,"column":2},"end":{"line":23,"column":70}},"19":{"start":{"line":23,"column":33},"end":{"line":23,"column":70}},"20":{"start":{"line":23,"column":47},"end":{"line":23,"column":69}},"21":{"start":{"line":24,"column":2},"end":{"line":24,"column":52}},"22":{"start":{"line":24,"column":37},"end":{"line":24,"column":52}},"23":{"start":{"line":25,"column":2},"end":{"line":28,"column":3}},"24":{"start":{"line":26,"column":4},"end":{"line":26,"column":58}},"25":{"start":{"line":26,"column":39},"end":{"line":26,"column":56}},"26":{"start":{"line":27,"column":4},"end":{"line":27,"column":51}},"27":{"start":{"line":27,"column":18},"end":{"line":27,"column":50}},"28":{"start":{"line":27,"column":39},"end":{"line":27,"column":49}},"29":{"start":{"line":29,"column":2},"end":{"line":29,"column":94}}},"branchMap":{"1":{"line":6,"type":"binary-expr","locations":[{"start":{"line":6,"column":12},"end":{"line":6,"column":19}},{"start":{"line":6,"column":23},"end":{"line":6,"column":25}}]},"2":{"line":7,"type":"if","locations":[{"start":{"line":7,"column":2},"end":{"line":7,"column":2}},{"start":{"line":7,"column":2},"end":{"line":7,"column":2}}]},"3":{"line":7,"type":"binary-expr","locations":[{"start":{"line":7,"column":6},"end":{"line":7,"column":19}},{"start":{"line":7,"column":23},"end":{"line":7,"column":37}}]},"4":{"line":8,"type":"if","locations":[{"start":{"line":8,"column":2},"end":{"line":8,"column":2}},{"start":{"line":8,"column":2},"end":{"line":8,"column":2}}]},"5":{"line":8,"type":"binary-expr","locations":[{"start":{"line":8,"column":6},"end":{"line":8,"column":20}},{"start":{"line":8,"column":24},"end":{"line":8,"column":39}}]},"6":{"line":10,"type":"cond-expr","locations":[{"start":{"line":10,"column":34},"end":{"line":10,"column":60}},{"start":{"line":10,"column":63},"end":{"line":10,"column":90}}]},"7":{"line":14,"type":"cond-expr","locations":[{"start":{"line":14,"column":27},"end":{"line":14,"column":34}},{"start":{"line":14,"column":37},"end":{"line":14,"column":45}}]},"8":{"line":19,"type":"if","locations":[{"start":{"line":19,"column":2},"end":{"line":19,"column":2}},{"start":{"line":19,"column":2},"end":{"line":19,"column":2}}]},"9":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"10":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":24,"column":2}},{"start":{"line":24,"column":2},"end":{"line":24,"column":2}}]},"11":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":25,"column":2}},{"start":{"line":25,"column":2},"end":{"line":25,"column":2}}]}},"code":["'use strict';","","const pathToRegexp = require('path-to-regexp');","","module.exports = function(options) {","  options = options || {};","  if (options.match && options.ignore) throw new Error('options.match and options.ignore can not both present');","  if (!options.match && !options.ignore) return () => true;","","  const matchFn = options.match ? toPathMatch(options.match) : toPathMatch(options.ignore);","","  return function pathMatch(ctx) {","    const matched = matchFn(ctx);","    return options.match ? matched : !matched;","  };","};","","function toPathMatch(pattern) {","  if (typeof pattern === 'string') {","    const reg = pathToRegexp(pattern, [], { end: false });","    return ctx => reg.test(ctx.path);","  }","  if (pattern instanceof RegExp) return ctx => pattern.test(ctx.path);","  if (typeof pattern === 'function') return pattern;","  if (Array.isArray(pattern)) {","    const matchs = pattern.map(item => toPathMatch(item));","    return ctx => matchs.some(match => match(ctx));","  }","  throw new Error('match/ignore pattern must be RegExp, Array or String, but got ' + pattern);","}",""],"l":{"3":1,"5":1,"6":0,"7":0,"8":0,"10":0,"12":0,"13":0,"14":0,"18":1,"19":0,"20":0,"21":0,"23":0,"24":0,"25":0,"26":0,"27":0,"29":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/controller.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/controller.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":1,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":1,"32":0,"33":0,"34":0,"35":0,"36":0,"37":1,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":1,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0},"b":{"1":[0,0],"2":[0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":14,"loc":{"start":{"line":14,"column":16},"end":{"line":14,"column":22}}},"2":{"name":"wrapClass","line":54,"loc":{"start":{"line":54,"column":0},"end":{"line":54,"column":31}}},"3":{"name":"methodToMiddleware","line":69,"loc":{"start":{"line":69,"column":2},"end":{"line":69,"column":47}}},"4":{"name":"classControllerMiddleware","line":70,"loc":{"start":{"line":70,"column":11},"end":{"line":70,"column":49}}},"5":{"name":"wrapObject","line":82,"loc":{"start":{"line":82,"column":0},"end":{"line":82,"column":31}}},"6":{"name":"functionToMiddleware","line":98,"loc":{"start":{"line":98,"column":2},"end":{"line":98,"column":38}}},"7":{"name":"(anonymous_7)","line":99,"loc":{"start":{"line":99,"column":39},"end":{"line":99,"column":52}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"4":{"start":{"line":7,"column":0},"end":{"line":51,"column":2}},"5":{"start":{"line":15,"column":4},"end":{"line":44,"column":12}},"6":{"start":{"line":24,"column":8},"end":{"line":26,"column":9}},"7":{"start":{"line":25,"column":10},"end":{"line":25,"column":30}},"8":{"start":{"line":27,"column":8},"end":{"line":31,"column":9}},"9":{"start":{"line":29,"column":10},"end":{"line":29,"column":72}},"10":{"start":{"line":30,"column":10},"end":{"line":30,"column":69}},"11":{"start":{"line":32,"column":8},"end":{"line":35,"column":9}},"12":{"start":{"line":33,"column":10},"end":{"line":33,"column":48}},"13":{"start":{"line":34,"column":10},"end":{"line":34,"column":32}},"14":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"15":{"start":{"line":37,"column":10},"end":{"line":37,"column":43}},"16":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"17":{"start":{"line":40,"column":10},"end":{"line":40,"column":83}},"18":{"start":{"line":42,"column":8},"end":{"line":42,"column":19}},"19":{"start":{"line":45,"column":4},"end":{"line":45,"column":77}},"20":{"start":{"line":47,"column":4},"end":{"line":47,"column":54}},"21":{"start":{"line":48,"column":4},"end":{"line":48,"column":83}},"22":{"start":{"line":54,"column":0},"end":{"line":79,"column":1}},"23":{"start":{"line":55,"column":2},"end":{"line":55,"column":64}},"24":{"start":{"line":56,"column":2},"end":{"line":56,"column":17}},"25":{"start":{"line":57,"column":2},"end":{"line":66,"column":3}},"26":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"27":{"start":{"line":61,"column":6},"end":{"line":61,"column":15}},"28":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"29":{"start":{"line":64,"column":6},"end":{"line":64,"column":53}},"30":{"start":{"line":67,"column":2},"end":{"line":67,"column":13}},"31":{"start":{"line":69,"column":2},"end":{"line":78,"column":3}},"32":{"start":{"line":70,"column":4},"end":{"line":77,"column":6}},"33":{"start":{"line":71,"column":6},"end":{"line":71,"column":46}},"34":{"start":{"line":72,"column":6},"end":{"line":72,"column":38}},"35":{"start":{"line":74,"column":6},"end":{"line":76,"column":7}},"36":{"start":{"line":75,"column":8},"end":{"line":75,"column":16}},"37":{"start":{"line":82,"column":0},"end":{"line":112,"column":1}},"38":{"start":{"line":83,"column":2},"end":{"line":83,"column":32}},"39":{"start":{"line":84,"column":2},"end":{"line":84,"column":17}},"40":{"start":{"line":85,"column":2},"end":{"line":95,"column":3}},"41":{"start":{"line":86,"column":4},"end":{"line":94,"column":5}},"42":{"start":{"line":87,"column":6},"end":{"line":87,"column":52}},"43":{"start":{"line":88,"column":6},"end":{"line":90,"column":7}},"44":{"start":{"line":89,"column":8},"end":{"line":89,"column":99}},"45":{"start":{"line":91,"column":6},"end":{"line":91,"column":48}},"46":{"start":{"line":92,"column":11},"end":{"line":94,"column":5}},"47":{"start":{"line":93,"column":6},"end":{"line":93,"column":44}},"48":{"start":{"line":96,"column":2},"end":{"line":96,"column":13}},"49":{"start":{"line":98,"column":2},"end":{"line":111,"column":3}},"50":{"start":{"line":99,"column":4},"end":{"line":104,"column":6}},"51":{"start":{"line":100,"column":6},"end":{"line":100,"column":38}},"52":{"start":{"line":101,"column":6},"end":{"line":103,"column":7}},"53":{"start":{"line":102,"column":8},"end":{"line":102,"column":16}},"54":{"start":{"line":105,"column":4},"end":{"line":109,"column":5}},"55":{"start":{"line":106,"column":6},"end":{"line":108,"column":7}},"56":{"start":{"line":107,"column":8},"end":{"line":107,"column":52}},"57":{"start":{"line":110,"column":4},"end":{"line":110,"column":38}}},"branchMap":{"1":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":8},"end":{"line":24,"column":8}},{"start":{"line":24,"column":8},"end":{"line":24,"column":8}}]},"2":{"line":24,"type":"binary-expr","locations":[{"start":{"line":24,"column":12},"end":{"line":24,"column":28}},{"start":{"line":24,"column":32},"end":{"line":24,"column":58}},{"start":{"line":24,"column":62},"end":{"line":24,"column":76}}]},"3":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":8},"end":{"line":27,"column":8}},{"start":{"line":27,"column":8},"end":{"line":27,"column":8}}]},"4":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":8},"end":{"line":32,"column":8}},{"start":{"line":32,"column":8},"end":{"line":32,"column":8}}]},"5":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":8},"end":{"line":36,"column":8}},{"start":{"line":36,"column":8},"end":{"line":36,"column":8}}]},"6":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":8},"end":{"line":39,"column":8}},{"start":{"line":39,"column":8},"end":{"line":39,"column":8}}]},"7":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":60,"column":4}},{"start":{"line":60,"column":4},"end":{"line":60,"column":4}}]},"8":{"line":63,"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":63,"column":4}},{"start":{"line":63,"column":4},"end":{"line":63,"column":4}}]},"9":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":6},"end":{"line":74,"column":6}},{"start":{"line":74,"column":6},"end":{"line":74,"column":6}}]},"10":{"line":74,"type":"binary-expr","locations":[{"start":{"line":74,"column":10},"end":{"line":74,"column":25}},{"start":{"line":74,"column":29},"end":{"line":74,"column":42}}]},"11":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":4},"end":{"line":86,"column":4}},{"start":{"line":86,"column":4},"end":{"line":86,"column":4}}]},"12":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":6},"end":{"line":88,"column":6}},{"start":{"line":88,"column":6},"end":{"line":88,"column":6}}]},"13":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":11},"end":{"line":92,"column":11}},{"start":{"line":92,"column":11},"end":{"line":92,"column":11}}]},"14":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":6},"end":{"line":101,"column":6}},{"start":{"line":101,"column":6},"end":{"line":101,"column":6}}]},"15":{"line":101,"type":"binary-expr","locations":[{"start":{"line":101,"column":10},"end":{"line":101,"column":25}},{"start":{"line":101,"column":29},"end":{"line":101,"column":42}}]},"16":{"line":106,"type":"if","locations":[{"start":{"line":106,"column":6},"end":{"line":106,"column":6}},{"start":{"line":106,"column":6},"end":{"line":106,"column":6}}]}},"code":["'use strict';","","const path = require('path');","const is = require('is-type-of');","const utility = require('utility');","","module.exports = {","","  /**","   * Load app/controller","   * @param {Object} opt - LoaderOptions","   * @since 1.0.0","   */","  loadController(opt) {","    opt = Object.assign({","      caseStyle: 'lower',","      initializer: (obj, opt) => {","        // return class if it exports a function","        // ```js","        // module.exports = app => {","        //   return class HomeController extends app.Controller {};","        // }","        // ```","        if (is.function(obj) && !is.generatorFunction(obj) && !is.class(obj)) {","          obj = obj(this.app);","        }","        if (is.promise(obj)) {","          // module.exports = async ctx => ctx.body = 'hello';","          const displayPath = path.relative(this.app.baseDir, opt.path);","          throw new Error(`${displayPath} cannot be async function`);","        }","        if (is.class(obj)) {","          obj.prototype.pathName = opt.pathName;","          return wrapClass(obj);","        }","        if (is.object(obj)) {","          return wrapObject(obj, opt.path);","        }","        if (is.generatorFunction(obj)) {","          return wrapObject({ 'module.exports': obj }, opt.path)['module.exports'];","        }","        return obj;","      },","    }, opt);","    const controllerBase = path.join(this.options.baseDir, 'app/controller');","","    this.loadToApp(controllerBase, 'controller', opt);","    this.options.logger.info('[egg:loader] Controller loaded: %s', controllerBase);","  },","","};","","// wrap the class, yield a object with middlewares","function wrapClass(Controller) {","  const keys = Object.getOwnPropertyNames(Controller.prototype);","  const ret = {};","  for (const key of keys) {","    // getOwnPropertyNames will return constructor","    // that should be ignored","    if (key === 'constructor') {","      continue;","    }","    if (is.function(Controller.prototype[key])) {","      ret[key] = methodToMiddleware(Controller, key);","    }","  }","  return ret;","","  function methodToMiddleware(Controller, key) {","    return function* classControllerMiddleware() {","      const controller = new Controller(this);","      const r = controller[key](this);","      // TODO: if we can check async function, then we can check it out of the middleware","      if (is.generator(r) || is.promise(r)) {","        yield r;","      }","    };","  }","}","","// wrap the method of the object, method can recieve ctx as it's first argument","function wrapObject(obj, path) {","  const keys = Object.keys(obj);","  const ret = {};","  for (const key of keys) {","    if (is.function(obj[key])) {","      const names = utility.getParamNames(obj[key]);","      if (names[0] === 'next') {","        throw new Error(`controller \\`${key}\\` should not use next as argument from file ${path}`);","      }","      ret[key] = functionToMiddleware(obj[key]);","    } else if (is.object(obj[key])) {","      ret[key] = wrapObject(obj[key], path);","    }","  }","  return ret;","","  function functionToMiddleware(func) {","    const objectControllerMiddleware = function* () {","      const r = func.call(this, this);","      if (is.generator(r) || is.promise(r)) {","        yield r;","      }","    };","    for (const key in func) {","      if (utility.has(func, key)) {","        objectControllerMiddleware[key] = func[key];","      }","    }","    return objectControllerMiddleware;","  }","}",""],"l":{"3":1,"4":1,"5":1,"7":1,"15":0,"24":0,"25":0,"27":0,"29":0,"30":0,"32":0,"33":0,"34":0,"36":0,"37":0,"39":0,"40":0,"42":0,"45":0,"47":0,"48":0,"54":1,"55":0,"56":0,"57":0,"60":0,"61":0,"63":0,"64":0,"67":0,"69":1,"70":0,"71":0,"72":0,"74":0,"75":0,"82":1,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"91":0,"92":0,"93":0,"96":0,"98":1,"99":0,"100":0,"101":0,"102":0,"105":0,"106":0,"107":0,"110":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/router.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-core/lib/loader/mixin/router.js","s":{"1":1,"2":1,"3":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":13,"loc":{"start":{"line":13,"column":12},"end":{"line":13,"column":15}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":5,"column":0},"end":{"line":17,"column":2}},"3":{"start":{"line":15,"column":4},"end":{"line":15,"column":68}}},"branchMap":{},"code":["'use strict';","","const path = require('path');","","module.exports = {","","  /**","   * Load app/router.js","   * @method EggLoader#loadRouter","   * @param {Object} opt - LoaderOptions","   * @since 1.0.0","   */","  loadRouter() {","    // 加载 router.js","    this.loadFile(path.join(this.options.baseDir, 'app/router.js'));","  },","};",""],"l":{"3":1,"5":1,"15":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cookies/lib/cookies.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cookies/lib/cookies.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":1,"70":1,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":1,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":1,"85":0,"86":0,"87":0,"88":0,"89":0,"90":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":18,"loc":{"start":{"line":18,"column":13},"end":{"line":18,"column":25}}},"2":{"name":"(anonymous_2)","line":26,"loc":{"start":{"line":26,"column":10},"end":{"line":26,"column":13}}},"3":{"name":"(anonymous_3)","line":50,"loc":{"start":{"line":50,"column":5},"end":{"line":50,"column":18}}},"4":{"name":"(anonymous_4)","line":88,"loc":{"start":{"line":88,"column":5},"end":{"line":88,"column":25}}},"5":{"name":"getPattern","line":125,"loc":{"start":{"line":125,"column":0},"end":{"line":125,"column":26}}},"6":{"name":"encryptOrSigned","line":137,"loc":{"start":{"line":137,"column":0},"end":{"line":137,"column":31}}},"7":{"name":"pushCookie","line":146,"loc":{"start":{"line":146,"column":0},"end":{"line":146,"column":37}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":35}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":37}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"5":{"start":{"line":8,"column":0},"end":{"line":8,"column":50}},"6":{"start":{"line":9,"column":0},"end":{"line":9,"column":39}},"7":{"start":{"line":10,"column":0},"end":{"line":10,"column":27}},"8":{"start":{"line":19,"column":4},"end":{"line":19,"column":28}},"9":{"start":{"line":20,"column":4},"end":{"line":20,"column":22}},"10":{"start":{"line":21,"column":4},"end":{"line":21,"column":19}},"11":{"start":{"line":22,"column":4},"end":{"line":22,"column":34}},"12":{"start":{"line":23,"column":4},"end":{"line":23,"column":23}},"13":{"start":{"line":27,"column":4},"end":{"line":37,"column":5}},"14":{"start":{"line":28,"column":6},"end":{"line":28,"column":41}},"15":{"start":{"line":29,"column":6},"end":{"line":29,"column":82}},"16":{"start":{"line":30,"column":6},"end":{"line":30,"column":44}},"17":{"start":{"line":31,"column":6},"end":{"line":36,"column":7}},"18":{"start":{"line":32,"column":8},"end":{"line":32,"column":27}},"19":{"start":{"line":34,"column":8},"end":{"line":34,"column":51}},"20":{"start":{"line":35,"column":8},"end":{"line":35,"column":44}},"21":{"start":{"line":39,"column":4},"end":{"line":39,"column":22}},"22":{"start":{"line":51,"column":4},"end":{"line":51,"column":33}},"23":{"start":{"line":53,"column":4},"end":{"line":53,"column":42}},"24":{"start":{"line":54,"column":4},"end":{"line":54,"column":24}},"25":{"start":{"line":54,"column":17},"end":{"line":54,"column":24}},"26":{"start":{"line":56,"column":4},"end":{"line":56,"column":49}},"27":{"start":{"line":57,"column":4},"end":{"line":57,"column":23}},"28":{"start":{"line":57,"column":16},"end":{"line":57,"column":23}},"29":{"start":{"line":59,"column":4},"end":{"line":59,"column":25}},"30":{"start":{"line":60,"column":4},"end":{"line":60,"column":52}},"31":{"start":{"line":60,"column":39},"end":{"line":60,"column":52}},"32":{"start":{"line":63,"column":4},"end":{"line":80,"column":5}},"33":{"start":{"line":64,"column":6},"end":{"line":64,"column":36}},"34":{"start":{"line":65,"column":6},"end":{"line":65,"column":60}},"35":{"start":{"line":66,"column":6},"end":{"line":66,"column":28}},"36":{"start":{"line":66,"column":21},"end":{"line":66,"column":28}},"37":{"start":{"line":68,"column":6},"end":{"line":68,"column":37}},"38":{"start":{"line":69,"column":6},"end":{"line":69,"column":52}},"39":{"start":{"line":70,"column":6},"end":{"line":74,"column":7}},"40":{"start":{"line":72,"column":8},"end":{"line":72,"column":62}},"41":{"start":{"line":73,"column":8},"end":{"line":73,"column":15}},"42":{"start":{"line":75,"column":6},"end":{"line":78,"column":7}},"43":{"start":{"line":77,"column":8},"end":{"line":77,"column":66}},"44":{"start":{"line":79,"column":6},"end":{"line":79,"column":19}},"45":{"start":{"line":83,"column":4},"end":{"line":83,"column":56}},"46":{"start":{"line":84,"column":4},"end":{"line":84,"column":41}},"47":{"start":{"line":85,"column":4},"end":{"line":85,"column":50}},"48":{"start":{"line":89,"column":4},"end":{"line":89,"column":33}},"49":{"start":{"line":90,"column":4},"end":{"line":90,"column":24}},"50":{"start":{"line":91,"column":4},"end":{"line":93,"column":5}},"51":{"start":{"line":92,"column":6},"end":{"line":92,"column":79}},"52":{"start":{"line":94,"column":4},"end":{"line":94,"column":61}},"53":{"start":{"line":94,"column":35},"end":{"line":94,"column":61}},"54":{"start":{"line":96,"column":4},"end":{"line":96,"column":60}},"55":{"start":{"line":97,"column":4},"end":{"line":97,"column":55}},"56":{"start":{"line":97,"column":33},"end":{"line":97,"column":55}},"57":{"start":{"line":100,"column":4},"end":{"line":102,"column":5}},"58":{"start":{"line":101,"column":6},"end":{"line":101,"column":76}},"59":{"start":{"line":105,"column":4},"end":{"line":107,"column":5}},"60":{"start":{"line":106,"column":6},"end":{"line":106,"column":73}},"61":{"start":{"line":109,"column":4},"end":{"line":109,"column":49}},"62":{"start":{"line":110,"column":4},"end":{"line":110,"column":42}},"63":{"start":{"line":113,"column":4},"end":{"line":117,"column":5}},"64":{"start":{"line":114,"column":6},"end":{"line":114,"column":64}},"65":{"start":{"line":115,"column":6},"end":{"line":115,"column":28}},"66":{"start":{"line":116,"column":6},"end":{"line":116,"column":44}},"67":{"start":{"line":119,"column":4},"end":{"line":119,"column":40}},"68":{"start":{"line":120,"column":4},"end":{"line":120,"column":16}},"69":{"start":{"line":124,"column":0},"end":{"line":124,"column":32}},"70":{"start":{"line":125,"column":0},"end":{"line":135,"column":1}},"71":{"start":{"line":126,"column":2},"end":{"line":126,"column":40}},"72":{"start":{"line":127,"column":2},"end":{"line":127,"column":26}},"73":{"start":{"line":127,"column":13},"end":{"line":127,"column":26}},"74":{"start":{"line":128,"column":2},"end":{"line":132,"column":4}},"75":{"start":{"line":133,"column":2},"end":{"line":133,"column":31}},"76":{"start":{"line":134,"column":2},"end":{"line":134,"column":13}},"77":{"start":{"line":137,"column":0},"end":{"line":144,"column":1}},"78":{"start":{"line":138,"column":2},"end":{"line":138,"column":20}},"79":{"start":{"line":141,"column":2},"end":{"line":141,"column":40}},"80":{"start":{"line":141,"column":20},"end":{"line":141,"column":40}},"81":{"start":{"line":142,"column":2},"end":{"line":142,"column":48}},"82":{"start":{"line":142,"column":29},"end":{"line":142,"column":48}},"83":{"start":{"line":143,"column":2},"end":{"line":143,"column":14}},"84":{"start":{"line":146,"column":0},"end":{"line":152,"column":1}},"85":{"start":{"line":147,"column":2},"end":{"line":149,"column":3}},"86":{"start":{"line":148,"column":4},"end":{"line":148,"column":68}},"87":{"start":{"line":148,"column":34},"end":{"line":148,"column":66}},"88":{"start":{"line":150,"column":2},"end":{"line":150,"column":34}},"89":{"start":{"line":151,"column":2},"end":{"line":151,"column":17}},"90":{"start":{"line":154,"column":0},"end":{"line":154,"column":25}}},"branchMap":{"1":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":4},"end":{"line":27,"column":4}},{"start":{"line":27,"column":4},"end":{"line":27,"column":4}}]},"2":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":6},"end":{"line":31,"column":6}},{"start":{"line":31,"column":6},"end":{"line":31,"column":6}}]},"3":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":54,"column":4}},{"start":{"line":54,"column":4},"end":{"line":54,"column":4}}]},"4":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":4},"end":{"line":57,"column":4}},{"start":{"line":57,"column":4},"end":{"line":57,"column":4}}]},"5":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":60,"column":4}},{"start":{"line":60,"column":4},"end":{"line":60,"column":4}}]},"6":{"line":60,"type":"binary-expr","locations":[{"start":{"line":60,"column":8},"end":{"line":60,"column":21}},{"start":{"line":60,"column":25},"end":{"line":60,"column":37}}]},"7":{"line":63,"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":63,"column":4}},{"start":{"line":63,"column":4},"end":{"line":63,"column":4}}]},"8":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":6},"end":{"line":66,"column":6}},{"start":{"line":66,"column":6},"end":{"line":66,"column":6}}]},"9":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":6},"end":{"line":70,"column":6}},{"start":{"line":70,"column":6},"end":{"line":70,"column":6}}]},"10":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":6},"end":{"line":75,"column":6}},{"start":{"line":75,"column":6},"end":{"line":75,"column":6}}]},"11":{"line":85,"type":"cond-expr","locations":[{"start":{"line":85,"column":17},"end":{"line":85,"column":37}},{"start":{"line":85,"column":40},"end":{"line":85,"column":49}}]},"12":{"line":90,"type":"binary-expr","locations":[{"start":{"line":90,"column":12},"end":{"line":90,"column":17}},{"start":{"line":90,"column":21},"end":{"line":90,"column":23}}]},"13":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":4},"end":{"line":91,"column":4}},{"start":{"line":91,"column":4},"end":{"line":91,"column":4}}]},"14":{"line":91,"type":"binary-expr","locations":[{"start":{"line":91,"column":8},"end":{"line":91,"column":20}},{"start":{"line":91,"column":24},"end":{"line":91,"column":35}}]},"15":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":4},"end":{"line":94,"column":4}},{"start":{"line":94,"column":4},"end":{"line":94,"column":4}}]},"16":{"line":96,"type":"binary-expr","locations":[{"start":{"line":96,"column":18},"end":{"line":96,"column":53}},{"start":{"line":96,"column":57},"end":{"line":96,"column":59}}]},"17":{"line":97,"type":"if","locations":[{"start":{"line":97,"column":4},"end":{"line":97,"column":4}},{"start":{"line":97,"column":4},"end":{"line":97,"column":4}}]},"18":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":4},"end":{"line":100,"column":4}},{"start":{"line":100,"column":4},"end":{"line":100,"column":4}}]},"19":{"line":101,"type":"binary-expr","locations":[{"start":{"line":101,"column":14},"end":{"line":101,"column":19}},{"start":{"line":101,"column":23},"end":{"line":101,"column":75}}]},"20":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":4},"end":{"line":105,"column":4}},{"start":{"line":105,"column":4},"end":{"line":105,"column":4}}]},"21":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":4},"end":{"line":113,"column":4}},{"start":{"line":113,"column":4},"end":{"line":113,"column":4}}]},"22":{"line":114,"type":"binary-expr","locations":[{"start":{"line":114,"column":21},"end":{"line":114,"column":26}},{"start":{"line":114,"column":30},"end":{"line":114,"column":63}}]},"23":{"line":127,"type":"if","locations":[{"start":{"line":127,"column":2},"end":{"line":127,"column":2}},{"start":{"line":127,"column":2},"end":{"line":127,"column":2}}]},"24":{"line":138,"type":"binary-expr","locations":[{"start":{"line":138,"column":9},"end":{"line":138,"column":13}},{"start":{"line":138,"column":17},"end":{"line":138,"column":19}}]},"25":{"line":141,"type":"if","locations":[{"start":{"line":141,"column":2},"end":{"line":141,"column":2}},{"start":{"line":141,"column":2},"end":{"line":141,"column":2}}]},"26":{"line":142,"type":"if","locations":[{"start":{"line":142,"column":2},"end":{"line":142,"column":2}},{"start":{"line":142,"column":2},"end":{"line":142,"column":2}}]},"27":{"line":147,"type":"if","locations":[{"start":{"line":147,"column":2},"end":{"line":147,"column":2}},{"start":{"line":147,"column":2},"end":{"line":147,"column":2}}]}},"code":["'use strict';","","const assert = require('assert');","const utility = require('utility');","const Keygrip = require('./keygrip');","const Cookie = require('./cookie');","","const KEYS_ARRAY = Symbol('eggCookies:keysArray');","const KEYS = Symbol('eggCookies:keys');","const keyCache = new Map();","","/**"," * cookies for egg"," * extend pillarjs/cookies, add encrypt and decrypt"," */","","class Cookies {","  constructor(ctx, keys) {","    this[KEYS_ARRAY] = keys;","    this._keys = keys;","    this.ctx = ctx;","    this.secure = this.ctx.secure;","    this.app = ctx.app;","  }","","  get keys() {","    if (!this[KEYS]) {","      const keysArray = this[KEYS_ARRAY];","      assert(Array.isArray(keysArray), '.keys required for encrypt/sign cookies');","      const cache = keyCache.get(keysArray);","      if (cache) {","        this[KEYS] = cache;","      } else {","        this[KEYS] = new Keygrip(this[KEYS_ARRAY]);","        keyCache.set(keysArray, this[KEYS]);","      }","    }","","    return this[KEYS];","  }","","  /**","   * get cookie value by name","   * @param  {String} name - cookie's name","   * @param  {Object} opts - cookies' options","   *            - {Boolean} signed - defualt to true","   *            - {Boolean} encrypt - defualt to false","   * @return {String} value - cookie's value","   */","  get(name, opts) {","    opts = encryptOrSigned(opts);","","    const header = this.ctx.get('cookie');","    if (!header) return;","","    const match = header.match(getPattern(name));","    if (!match) return;","","    let value = match[1];","    if (!opts.encrypt && !opts.signed) return value;","","    // signed","    if (opts.signed) {","      const sigName = name + '.sig';","      const sigValue = this.get(sigName, { signed: false });","      if (!sigValue) return;","","      const raw = name + '=' + value;","      const index = this.keys.verify(raw, sigValue);","      if (index < 0) {","        // can not match any key, remove ${name}.sig","        this.set(sigName, null, { path: '/', signed: false });","        return;","      }","      if (index > 0) {","        // not signed by the first key, update sigValue","        this.set(sigName, this.keys.sign(raw), { signed: false });","      }","      return value;","    }","","    // encrypt","    value = utility.base64decode(value, true, 'buffer');","    const res = this.keys.decrypt(value);","    return res ? res.value.toString() : undefined;","  }","","  set(name, value, opts) {","    opts = encryptOrSigned(opts);","    value = value || '';","    if (!this.secure && opts.secure) {","      throw new Error('Cannot send secure cookie over unencrypted connection');","    }","    if (opts.secure === undefined) opts.secure = this.secure;","","    let headers = this.ctx.response.get('set-cookie') || [];","    if (!Array.isArray(headers)) headers = [ headers ];","","    // encrypt","    if (opts.encrypt) {","      value = value && utility.base64encode(this.keys.encrypt(value), true);","    }","","    // http://browsercookielimits.squawky.net/","    if (value.length > 4093) {","      this.app.emit('cookieLimitExceed', { name, value, ctx: this.ctx });","    }","","    const cookie = new Cookie(name, value, opts);","    headers = pushCookie(headers, cookie);","","    // signed","    if (opts.signed) {","      cookie.value = value && this.keys.sign(cookie.toString());","      cookie.name += '.sig';","      headers = pushCookie(headers, cookie);","    }","","    this.ctx.set('set-cookie', headers);","    return this;","  }","}","","const partternCache = new Map();","function getPattern(name) {","  const cache = partternCache.get(name);","  if (cache) return cache;","  const reg = new RegExp(","    '(?:^|;) *' +","    name.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&') +","    '=([^;]*)'","  );","  partternCache.set(name, reg);","  return reg;","}","","function encryptOrSigned(opts) {","  opts = opts || {};","  // encrypt default to false, signed default to true.","  // disable singed when encrypt is true.","  if (opts.encrypt) opts.signed = false;","  if (opts.signed !== false) opts.signed = true;","  return opts;","}","","function pushCookie(cookies, cookie) {","  if (cookie.attrs.overwrite) {","    cookies = cookies.filter(c => !c.startsWith(cookie.name + '='));","  }","  cookies.push(cookie.toHeader());","  return cookies;","}","","module.exports = Cookies;",""],"l":{"3":1,"4":1,"5":1,"6":1,"8":1,"9":1,"10":1,"19":0,"20":0,"21":0,"22":0,"23":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"34":0,"35":0,"39":0,"51":0,"53":0,"54":0,"56":0,"57":0,"59":0,"60":0,"63":0,"64":0,"65":0,"66":0,"68":0,"69":0,"70":0,"72":0,"73":0,"75":0,"77":0,"79":0,"83":0,"84":0,"85":0,"89":0,"90":0,"91":0,"92":0,"94":0,"96":0,"97":0,"100":0,"101":0,"105":0,"106":0,"109":0,"110":0,"113":0,"114":0,"115":0,"116":0,"119":0,"120":0,"124":1,"125":1,"126":0,"127":0,"128":0,"133":0,"134":0,"137":1,"138":0,"141":0,"142":0,"143":0,"146":1,"147":0,"148":0,"150":0,"151":0,"154":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cookies/lib/keygrip.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cookies/lib/keygrip.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":1,"35":0,"36":0,"37":0,"38":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"(anonymous_1)","line":17,"loc":{"start":{"line":17,"column":13},"end":{"line":17,"column":20}}},"2":{"name":"(anonymous_2)","line":26,"loc":{"start":{"line":26,"column":9},"end":{"line":26,"column":21}}},"3":{"name":"(anonymous_3)","line":34,"loc":{"start":{"line":34,"column":9},"end":{"line":34,"column":21}}},"4":{"name":"(anonymous_4)","line":54,"loc":{"start":{"line":54,"column":6},"end":{"line":54,"column":18}}},"5":{"name":"(anonymous_5)","line":65,"loc":{"start":{"line":65,"column":8},"end":{"line":65,"column":23}}},"6":{"name":"crypt","line":77,"loc":{"start":{"line":77,"column":0},"end":{"line":77,"column":29}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":54}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":33}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":44}},"5":{"start":{"line":8,"column":0},"end":{"line":12,"column":2}},"6":{"start":{"line":18,"column":4},"end":{"line":18,"column":95}},"7":{"start":{"line":20,"column":4},"end":{"line":20,"column":21}},"8":{"start":{"line":21,"column":4},"end":{"line":21,"column":25}},"9":{"start":{"line":22,"column":4},"end":{"line":22,"column":32}},"10":{"start":{"line":27,"column":4},"end":{"line":27,"column":30}},"11":{"start":{"line":28,"column":4},"end":{"line":28,"column":57}},"12":{"start":{"line":29,"column":4},"end":{"line":29,"column":31}},"13":{"start":{"line":35,"column":4},"end":{"line":43,"column":5}},"14":{"start":{"line":37,"column":6},"end":{"line":37,"column":29}},"15":{"start":{"line":38,"column":6},"end":{"line":41,"column":7}},"16":{"start":{"line":39,"column":8},"end":{"line":39,"column":50}},"17":{"start":{"line":40,"column":8},"end":{"line":40,"column":56}},"18":{"start":{"line":40,"column":29},"end":{"line":40,"column":56}},"19":{"start":{"line":42,"column":6},"end":{"line":42,"column":19}},"20":{"start":{"line":45,"column":4},"end":{"line":51,"column":5}},"21":{"start":{"line":46,"column":6},"end":{"line":46,"column":61}},"22":{"start":{"line":47,"column":6},"end":{"line":47,"column":33}},"23":{"start":{"line":49,"column":6},"end":{"line":49,"column":38}},"24":{"start":{"line":50,"column":6},"end":{"line":50,"column":19}},"25":{"start":{"line":56,"column":4},"end":{"line":56,"column":30}},"26":{"start":{"line":58,"column":4},"end":{"line":62,"column":45}},"27":{"start":{"line":62,"column":32},"end":{"line":62,"column":43}},"28":{"start":{"line":66,"column":4},"end":{"line":66,"column":27}},"29":{"start":{"line":67,"column":4},"end":{"line":72,"column":5}},"30":{"start":{"line":68,"column":6},"end":{"line":71,"column":7}},"31":{"start":{"line":69,"column":8},"end":{"line":69,"column":53}},"32":{"start":{"line":70,"column":8},"end":{"line":70,"column":17}},"33":{"start":{"line":73,"column":4},"end":{"line":73,"column":14}},"34":{"start":{"line":77,"column":0},"end":{"line":81,"column":1}},"35":{"start":{"line":78,"column":2},"end":{"line":78,"column":43}},"36":{"start":{"line":79,"column":2},"end":{"line":79,"column":29}},"37":{"start":{"line":80,"column":2},"end":{"line":80,"column":38}},"38":{"start":{"line":83,"column":0},"end":{"line":83,"column":25}}},"branchMap":{"1":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":11},"end":{"line":18,"column":30}},{"start":{"line":18,"column":34},"end":{"line":18,"column":45}}]},"2":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":10},"end":{"line":27,"column":13}},{"start":{"line":27,"column":17},"end":{"line":27,"column":29}}]},"3":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":35,"column":4}},{"start":{"line":35,"column":4},"end":{"line":35,"column":4}}]},"4":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":40,"column":8}},{"start":{"line":40,"column":8},"end":{"line":40,"column":8}}]},"5":{"line":56,"type":"binary-expr","locations":[{"start":{"line":56,"column":10},"end":{"line":56,"column":13}},{"start":{"line":56,"column":17},"end":{"line":56,"column":29}}]},"6":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":6},"end":{"line":68,"column":6}},{"start":{"line":68,"column":6},"end":{"line":68,"column":6}}]}},"code":["'use strict';","","const debug = require('debug')('egg-cookies:keygrip');","const crypto = require('crypto');","const assert = require('assert');","const constantTimeCompare = require('scmp');","","const replacer = {","  '/': '_',","  '+': '-',","  '=': '',","};","","// patch from https://github.com/crypto-utils/keygrip","","class Keygrip {","  constructor(keys) {","    assert(Array.isArray(keys) && keys.length, 'keys must be provided and should be an array');","","    this.keys = keys;","    this.hash = 'sha256';","    this.cipher = 'aes-256-cbc';","  }","","  // encrypt a message","  encrypt(data, key) {","    key = key || this.keys[0];","    const cipher = crypto.createCipher(this.cipher, key);","    return crypt(cipher, data);","  }","","  // decrypt a single message","  // returns false on bad decrypts","  decrypt(data, key) {","    if (!key) {","      // decrypt every key","      const keys = this.keys;","      for (let i = 0; i < keys.length; i++) {","        const value = this.decrypt(data, keys[i]);","        if (value !== false) return { value, index: i };","      }","      return false;","    }","","    try {","      const cipher = crypto.createDecipher(this.cipher, key);","      return crypt(cipher, data);","    } catch (err) {","      debug('crypt error', err.stack);","      return false;","    }","  }","","  sign(data, key) {","    // default to the first key","    key = key || this.keys[0];","","    return crypto","      .createHmac(this.hash, key)","      .update(data)","      .digest('base64')","      .replace(/\\/|\\+|=/g, x => replacer[x]);","  }","","  verify(data, digest) {","    const keys = this.keys;","    for (let i = 0; i < keys.length; i++) {","      if (constantTimeCompare(new Buffer(digest), new Buffer(this.sign(data, keys[i])))) {","        debug('data %s match key %s', data, keys[i]);","        return i;","      }","    }","    return -1;","  }","}","","function crypt(cipher, data) {","  const text = cipher.update(data, 'utf8');","  const pad = cipher.final();","  return Buffer.concat([ text, pad ]);","}","","module.exports = Keygrip;",""],"l":{"3":1,"4":1,"5":1,"6":1,"8":1,"18":0,"20":0,"21":0,"22":0,"27":0,"28":0,"29":0,"35":0,"37":0,"38":0,"39":0,"40":0,"42":0,"45":0,"46":0,"47":0,"49":0,"50":0,"56":0,"58":0,"62":0,"66":0,"67":0,"68":0,"69":0,"70":0,"73":0,"77":1,"78":0,"79":0,"80":0,"83":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cookies/lib/cookie.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg-cookies/lib/cookie.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":1,"33":1,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"(anonymous_1)","line":23,"loc":{"start":{"line":23,"column":13},"end":{"line":23,"column":34}}},"2":{"name":"(anonymous_2)","line":36,"loc":{"start":{"line":36,"column":10},"end":{"line":36,"column":13}}},"3":{"name":"(anonymous_3)","line":40,"loc":{"start":{"line":40,"column":10},"end":{"line":40,"column":13}}},"4":{"name":"mergeDefaultAttrs","line":56,"loc":{"start":{"line":56,"column":0},"end":{"line":56,"column":34}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":13,"column":0},"end":{"line":13,"column":67}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":43}},"4":{"start":{"line":24,"column":4},"end":{"line":24,"column":70}},"5":{"start":{"line":25,"column":4},"end":{"line":25,"column":82}},"6":{"start":{"line":27,"column":4},"end":{"line":27,"column":21}},"7":{"start":{"line":28,"column":4},"end":{"line":28,"column":29}},"8":{"start":{"line":29,"column":4},"end":{"line":29,"column":42}},"9":{"start":{"line":30,"column":4},"end":{"line":30,"column":108}},"10":{"start":{"line":31,"column":4},"end":{"line":31,"column":114}},"11":{"start":{"line":32,"column":4},"end":{"line":32,"column":148}},"12":{"start":{"line":33,"column":4},"end":{"line":33,"column":49}},"13":{"start":{"line":33,"column":16},"end":{"line":33,"column":49}},"14":{"start":{"line":37,"column":4},"end":{"line":37,"column":40}},"15":{"start":{"line":41,"column":4},"end":{"line":41,"column":33}},"16":{"start":{"line":42,"column":4},"end":{"line":42,"column":29}},"17":{"start":{"line":43,"column":4},"end":{"line":43,"column":74}},"18":{"start":{"line":43,"column":22},"end":{"line":43,"column":74}},"19":{"start":{"line":44,"column":4},"end":{"line":44,"column":53}},"20":{"start":{"line":44,"column":20},"end":{"line":44,"column":53}},"21":{"start":{"line":45,"column":4},"end":{"line":45,"column":76}},"22":{"start":{"line":45,"column":23},"end":{"line":45,"column":76}},"23":{"start":{"line":46,"column":4},"end":{"line":46,"column":59}},"24":{"start":{"line":46,"column":22},"end":{"line":46,"column":59}},"25":{"start":{"line":47,"column":4},"end":{"line":47,"column":118}},"26":{"start":{"line":47,"column":24},"end":{"line":47,"column":118}},"27":{"start":{"line":48,"column":4},"end":{"line":48,"column":43}},"28":{"start":{"line":48,"column":22},"end":{"line":48,"column":43}},"29":{"start":{"line":49,"column":4},"end":{"line":49,"column":47}},"30":{"start":{"line":49,"column":24},"end":{"line":49,"column":47}},"31":{"start":{"line":51,"column":4},"end":{"line":51,"column":18}},"32":{"start":{"line":55,"column":0},"end":{"line":55,"column":103}},"33":{"start":{"line":56,"column":0},"end":{"line":71,"column":1}},"34":{"start":{"line":57,"column":2},"end":{"line":63,"column":4}},"35":{"start":{"line":64,"column":2},"end":{"line":64,"column":28}},"36":{"start":{"line":64,"column":14},"end":{"line":64,"column":28}},"37":{"start":{"line":66,"column":2},"end":{"line":69,"column":3}},"38":{"start":{"line":67,"column":4},"end":{"line":67,"column":25}},"39":{"start":{"line":68,"column":4},"end":{"line":68,"column":47}},"40":{"start":{"line":68,"column":22},"end":{"line":68,"column":47}},"41":{"start":{"line":70,"column":2},"end":{"line":70,"column":16}},"42":{"start":{"line":73,"column":0},"end":{"line":73,"column":24}}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":11},"end":{"line":25,"column":17}},{"start":{"line":25,"column":21},"end":{"line":25,"column":51}}]},"2":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":17},"end":{"line":28,"column":22}},{"start":{"line":28,"column":26},"end":{"line":28,"column":28}}]},"3":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":11},"end":{"line":30,"column":27}},{"start":{"line":30,"column":31},"end":{"line":30,"column":71}}]},"4":{"line":31,"type":"binary-expr","locations":[{"start":{"line":31,"column":11},"end":{"line":31,"column":29}},{"start":{"line":31,"column":33},"end":{"line":31,"column":75}}]},"5":{"line":32,"type":"binary-expr","locations":[{"start":{"line":32,"column":11},"end":{"line":32,"column":31}},{"start":{"line":32,"column":35},"end":{"line":32,"column":63}},{"start":{"line":32,"column":67},"end":{"line":32,"column":107}}]},"6":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":33,"column":4}},{"start":{"line":33,"column":4},"end":{"line":33,"column":4}}]},"7":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":4}},{"start":{"line":43,"column":4},"end":{"line":43,"column":4}}]},"8":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":44,"column":4}},{"start":{"line":44,"column":4},"end":{"line":44,"column":4}}]},"9":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":45,"column":4}},{"start":{"line":45,"column":4},"end":{"line":45,"column":4}}]},"10":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":46,"column":4}},{"start":{"line":46,"column":4},"end":{"line":46,"column":4}}]},"11":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":47,"column":4}},{"start":{"line":47,"column":4},"end":{"line":47,"column":4}}]},"12":{"line":47,"type":"cond-expr","locations":[{"start":{"line":47,"column":77},"end":{"line":47,"column":85}},{"start":{"line":47,"column":88},"end":{"line":47,"column":116}}]},"13":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":48,"column":4}},{"start":{"line":48,"column":4},"end":{"line":48,"column":4}}]},"14":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":49,"column":4}},{"start":{"line":49,"column":4},"end":{"line":49,"column":4}}]},"15":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":2},"end":{"line":64,"column":2}},{"start":{"line":64,"column":2},"end":{"line":64,"column":2}}]},"16":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":4},"end":{"line":68,"column":4}},{"start":{"line":68,"column":4},"end":{"line":68,"column":4}}]}},"code":["'use strict';","","const assert = require('assert');","","/**"," * RegExp to match field-content in RFC 7230 sec 3.2"," *"," * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]"," * field-vchar   = VCHAR / obs-text"," * obs-text      = %x80-FF"," */","","const fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;","","/**","* RegExp to match Same-Site cookie attribute value.","* https://en.wikipedia.org/wiki/HTTP_cookie#SameSite_cookie","*/","","const sameSiteRegExp = /^(?:lax|strict)$/i;","","class Cookie {","  constructor(name, value, attrs) {","    assert(fieldContentRegExp.test(name), 'argument name is invalid');","    assert(!value || fieldContentRegExp.test(value), 'argument value is invalid');","","    this.name = name;","    this.value = value || '';","    this.attrs = mergeDefaultAttrs(attrs);","    assert(!this.attrs.path || fieldContentRegExp.test(this.attrs.path), 'argument option path is invalid');","    assert(!this.attrs.domain || fieldContentRegExp.test(this.attrs.domain), 'argument option domain is invalid');","    assert(!this.attrs.sameSite || this.attrs.sameSite === true || sameSiteRegExp.test(this.attrs.sameSite), 'argument option sameSite is invalid');","    if (!value) this.attrs.expires = new Date(0);","  }","","  toString() {","    return this.name + '=' + this.value;","  }","","  toHeader() {","    let header = this.toString();","    const attrs = this.attrs;","    if (attrs.maxAge) attrs.expires = new Date(Date.now() + attrs.maxAge);","    if (attrs.path) header += '; path=' + attrs.path;","    if (attrs.expires) header += '; expires=' + attrs.expires.toUTCString();","    if (attrs.domain) header += '; domain=' + attrs.domain;","    if (attrs.sameSite) header += '; samesite=' + (attrs.sameSite === true ? 'strict' : attrs.sameSite.toLowerCase());","    if (attrs.secure) header += '; secure';","    if (attrs.httpOnly) header += '; httponly';","","    return header;","  }","}","","const ATTRS = [ 'path', 'expires', 'domain', 'httpOnly', 'secure', 'maxAge', 'overwrite', 'sameSite' ];","function mergeDefaultAttrs(attrs) {","  const merged = {","    path: '/',","    httpOnly: true,","    secure: false,","    overwrite: false,","    sameSite: false,","  };","  if (!attrs) return merged;","","  for (let i = 0; i < ATTRS.length; i++) {","    const key = ATTRS[i];","    if (key in attrs) merged[key] = attrs[key];","  }","  return merged;","}","","module.exports = Cookie;",""],"l":{"3":1,"13":1,"20":1,"24":0,"25":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"37":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"51":0,"55":1,"56":1,"57":0,"64":0,"66":0,"67":0,"68":0,"70":0,"73":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/context_httpclient.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/context_httpclient.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1},"b":{"1":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":4,"loc":{"start":{"line":4,"column":13},"end":{"line":4,"column":19}}},"2":{"name":"(anonymous_2)","line":17,"loc":{"start":{"line":17,"column":6},"end":{"line":17,"column":21}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":9},"end":{"line":23,"column":24}}}},"statementMap":{"1":{"start":{"line":5,"column":4},"end":{"line":5,"column":19}},"2":{"start":{"line":6,"column":4},"end":{"line":6,"column":23}},"3":{"start":{"line":18,"column":4},"end":{"line":18,"column":28}},"4":{"start":{"line":19,"column":4},"end":{"line":19,"column":27}},"5":{"start":{"line":20,"column":4},"end":{"line":20,"column":39}},"6":{"start":{"line":24,"column":4},"end":{"line":24,"column":35}},"7":{"start":{"line":28,"column":0},"end":{"line":28,"column":35}}},"branchMap":{"1":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":14},"end":{"line":18,"column":21}},{"start":{"line":18,"column":25},"end":{"line":18,"column":27}}]}},"code":["'use strict';","","class ContextHttpClient {","  constructor(ctx) {","    this.ctx = ctx;","    this.app = ctx.app;","  }","","  /**","   * http request helper base on {@link HttpClient}, it will auto save httpclient log.","   * Keep the same api with {@link Application#curl}.","   *","   * @param {String|Object} url - request url address.","   * @param {Object} [options] - options for request.","   * @return {Object} see {@link Application#curl}","   */","  curl(url, options) {","    options = options || {};","    options.ctx = this.ctx;","    return this.app.curl(url, options);","  }","","  request(url, options) {","    return this.curl(url, options);","  }","}","","module.exports = ContextHttpClient;",""],"l":{"5":0,"6":0,"18":0,"19":0,"20":0,"24":0,"28":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/messenger.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/messenger.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":1,"38":1,"39":0,"40":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"(anonymous_1)","line":10,"loc":{"start":{"line":10,"column":13},"end":{"line":10,"column":16}}},"2":{"name":"(anonymous_2)","line":30,"loc":{"start":{"line":30,"column":11},"end":{"line":30,"column":26}}},"3":{"name":"(anonymous_3)","line":44,"loc":{"start":{"line":44,"column":8},"end":{"line":44,"column":28}}},"4":{"name":"(anonymous_4)","line":62,"loc":{"start":{"line":62,"column":12},"end":{"line":62,"column":27}}},"5":{"name":"(anonymous_5)","line":76,"loc":{"start":{"line":76,"column":11},"end":{"line":76,"column":26}}},"6":{"name":"(anonymous_6)","line":88,"loc":{"start":{"line":88,"column":13},"end":{"line":88,"column":28}}},"7":{"name":"(anonymous_7)","line":100,"loc":{"start":{"line":100,"column":6},"end":{"line":100,"column":25}}},"8":{"name":"(anonymous_8)","line":109,"loc":{"start":{"line":109,"column":12},"end":{"line":109,"column":22}}},"9":{"name":"(anonymous_9)","line":117,"loc":{"start":{"line":117,"column":7},"end":{"line":117,"column":10}}},"10":{"name":"random","line":131,"loc":{"start":{"line":131,"column":0},"end":{"line":131,"column":21}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":53}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":43}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":39}},"5":{"start":{"line":11,"column":4},"end":{"line":11,"column":12}},"6":{"start":{"line":12,"column":4},"end":{"line":12,"column":35}},"7":{"start":{"line":16,"column":4},"end":{"line":16,"column":20}},"8":{"start":{"line":17,"column":4},"end":{"line":19,"column":7}},"9":{"start":{"line":18,"column":6},"end":{"line":18,"column":24}},"10":{"start":{"line":20,"column":4},"end":{"line":20,"column":49}},"11":{"start":{"line":21,"column":4},"end":{"line":21,"column":43}},"12":{"start":{"line":31,"column":4},"end":{"line":31,"column":63}},"13":{"start":{"line":32,"column":4},"end":{"line":32,"column":35}},"14":{"start":{"line":33,"column":4},"end":{"line":33,"column":37}},"15":{"start":{"line":34,"column":4},"end":{"line":34,"column":16}},"16":{"start":{"line":45,"column":4},"end":{"line":45,"column":69}},"17":{"start":{"line":46,"column":4},"end":{"line":50,"column":7}},"18":{"start":{"line":51,"column":4},"end":{"line":51,"column":16}},"19":{"start":{"line":64,"column":4},"end":{"line":64,"column":40}},"20":{"start":{"line":64,"column":28},"end":{"line":64,"column":40},"skip":true},"21":{"start":{"line":65,"column":4},"end":{"line":65,"column":35}},"22":{"start":{"line":66,"column":4},"end":{"line":66,"column":43}},"23":{"start":{"line":67,"column":4},"end":{"line":67,"column":16}},"24":{"start":{"line":77,"column":4},"end":{"line":77,"column":69}},"25":{"start":{"line":78,"column":4},"end":{"line":78,"column":35}},"26":{"start":{"line":79,"column":4},"end":{"line":79,"column":16}},"27":{"start":{"line":89,"column":4},"end":{"line":89,"column":71}},"28":{"start":{"line":90,"column":4},"end":{"line":90,"column":37}},"29":{"start":{"line":91,"column":4},"end":{"line":91,"column":16}},"30":{"start":{"line":101,"column":4},"end":{"line":105,"column":7}},"31":{"start":{"line":106,"column":4},"end":{"line":106,"column":16}},"32":{"start":{"line":110,"column":4},"end":{"line":114,"column":5}},"33":{"start":{"line":111,"column":6},"end":{"line":112,"column":69}},"34":{"start":{"line":113,"column":6},"end":{"line":113,"column":46}},"35":{"start":{"line":118,"column":4},"end":{"line":118,"column":55}},"36":{"start":{"line":119,"column":4},"end":{"line":119,"column":30}},"37":{"start":{"line":129,"column":0},"end":{"line":129,"column":27}},"38":{"start":{"line":131,"column":0},"end":{"line":134,"column":1}},"39":{"start":{"line":132,"column":2},"end":{"line":132,"column":55}},"40":{"start":{"line":133,"column":2},"end":{"line":133,"column":20}}},"branchMap":{"1":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":4},"end":{"line":64,"column":4},"skip":true},{"start":{"line":64,"column":4},"end":{"line":64,"column":4}}]},"2":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":4},"end":{"line":110,"column":4}},{"start":{"line":110,"column":4},"end":{"line":110,"column":4}}]},"3":{"line":110,"type":"binary-expr","locations":[{"start":{"line":110,"column":8},"end":{"line":110,"column":15}},{"start":{"line":110,"column":19},"end":{"line":110,"column":44}}]}},"code":["'use strict';","","const debug = require('debug')('egg:util:messenger');","const is = require('is-type-of');","const sendmessage = require('sendmessage');","const EventEmitter = require('events');","","class Messenger extends EventEmitter {","","  constructor() {","    super();","    this.pid = String(process.pid);","    // pids of agent or app maneged by master","    // - retrieve app worker pids when it's an agent worker","    // - retrieve agent worker pids when it's an app worker","    this.opids = [];","    this.on('egg-pids', pids => {","      this.opids = pids;","    });","    this._onMessage = this._onMessage.bind(this);","    process.on('message', this._onMessage);","  }","","  /**","   * Send message to all agent and app","   * @param {String} action - message key","   * @param {Object} data - message value","   * @return {Messenger} this","   */","  broadcast(action, data) {","    debug('[%s] broadcast %s with %j', this.pid, action, data);","    this.send(action, data, 'app');","    this.send(action, data, 'agent');","    return this;","  }","","  /**","   * send message to the specified process","   * @param {String} pid - the process id of the receiver","   * @param {String} action - message key","   * @param {Object} data - message value","   * @return {Messenger} this","   */","  sendTo(pid, action, data) {","    debug('[%s] send %s with %j to %s', this.pid, action, data, pid);","    sendmessage(process, {","      action,","      data,","      receiverPid: String(pid),","    });","    return this;","  }","","  /**","   * send message to one app worker by random","   * - if it's running in agent, it will send to one of app workers","   * - if it's running in app, it will send to agent","   * @param {String} action - message key","   * @param {Object} data - message value","   * @return {Messenger} this","   */","  sendRandom(action, data) {","    /* istanbul ignore if */","    if (!this.opids.length) return this;","    const pid = random(this.opids);","    this.sendTo(String(pid), action, data);","    return this;","  }","","  /**","   * send message to app","   * @param {String} action - message key","   * @param {Object} data - message value","   * @return {Messenger} this","   */","  sendToApp(action, data) {","    debug('[%s] send %s with %j to all app', this.pid, action, data);","    this.send(action, data, 'app');","    return this;","  }","","  /**","   * send message to agent","   * @param {String} action - message key","   * @param {Object} data - message value","   * @return {Messenger} this","   */","  sendToAgent(action, data) {","    debug('[%s] send %s with %j to all agent', this.pid, action, data);","    this.send(action, data, 'agent');","    return this;","  }","","  /**","   * @param {String} action - message key","   * @param {Object} data - message value","   * @param {String} to - let master know how to send message","   * @return {Messenger} this","   */","  send(action, data, to) {","    sendmessage(process, {","      action,","      data,","      to,","    });","    return this;","  }","","  _onMessage(message) {","    if (message && is.string(message.action)) {","      debug('[%s] got message %s with %j, receiverPid: %s',","        this.pid, message.action, message.data, message.receiverPid);","      this.emit(message.action, message.data);","    }","  }","","  close() {","    process.removeListener('message', this._onMessage);","    this.removeAllListeners();","  }","","  /**","   * @method Messenger#on","   * @param {String} action - message key","   * @param {Object} data - message value","   */","}","","module.exports = Messenger;","","function random(arr) {","  const index = Math.floor(Math.random() * arr.length);","  return arr[index];","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"11":0,"12":0,"16":0,"17":0,"18":0,"20":0,"21":0,"31":0,"32":0,"33":0,"34":0,"45":0,"46":0,"51":0,"64":1,"65":0,"66":0,"67":0,"77":0,"78":0,"79":0,"89":0,"90":0,"91":0,"101":0,"106":0,"110":0,"111":0,"113":0,"118":0,"119":0,"129":1,"131":1,"132":0,"133":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/httpclient.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/httpclient.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0},"b":{"1":[0,0]},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":40}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":56}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":33}},"4":{"start":{"line":7,"column":0},"end":{"line":18,"column":2}},"5":{"start":{"line":8,"column":2},"end":{"line":9,"column":57}},"6":{"start":{"line":11,"column":2},"end":{"line":11,"column":39}},"7":{"start":{"line":13,"column":2},"end":{"line":17,"column":5}}},"branchMap":{"1":{"line":8,"type":"cond-expr","locations":[{"start":{"line":9,"column":4},"end":{"line":9,"column":36}},{"start":{"line":9,"column":39},"end":{"line":9,"column":56}}]}},"code":["'use strict';","","const Agent = require('agentkeepalive');","const HttpsAgent = require('agentkeepalive').HttpsAgent;","const urllib = require('urllib');","","module.exports = app => {","  const HttpClient = app.config.httpclient.enableDNSCache ?","    require('./dnscache_httpclient') : urllib.HttpClient;","","  const config = app.config.httpclient;","","  return new HttpClient({","    app,","    agent: new Agent(config),","    httpsAgent: new HttpsAgent(config),","  });","};",""],"l":{"3":1,"4":1,"5":1,"7":1,"8":0,"11":0,"13":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/logger.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/logger.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"createLoggers","line":5,"loc":{"start":{"line":5,"column":17},"end":{"line":5,"column":45}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":49}},"2":{"start":{"line":5,"column":0},"end":{"line":24,"column":2}},"3":{"start":{"line":6,"column":2},"end":{"line":6,"column":41}},"4":{"start":{"line":7,"column":2},"end":{"line":7,"column":31}},"5":{"start":{"line":9,"column":2},"end":{"line":11,"column":3}},"6":{"start":{"line":10,"column":4},"end":{"line":10,"column":32}},"7":{"start":{"line":13,"column":2},"end":{"line":13,"column":42}},"8":{"start":{"line":16,"column":2},"end":{"line":20,"column":5}},"9":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"10":{"start":{"line":18,"column":6},"end":{"line":18,"column":31}},"11":{"start":{"line":21,"column":2},"end":{"line":21,"column":90}},"12":{"start":{"line":23,"column":2},"end":{"line":23,"column":17}}},"branchMap":{"1":{"line":9,"type":"if","locations":[{"start":{"line":9,"column":2},"end":{"line":9,"column":2}},{"start":{"line":9,"column":2},"end":{"line":9,"column":2}}]},"2":{"line":9,"type":"binary-expr","locations":[{"start":{"line":9,"column":6},"end":{"line":9,"column":31}},{"start":{"line":9,"column":35},"end":{"line":9,"column":65}}]},"3":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":17,"column":4}},{"start":{"line":17,"column":4},"end":{"line":17,"column":4}}]},"4":{"line":17,"type":"binary-expr","locations":[{"start":{"line":17,"column":8},"end":{"line":17,"column":34}},{"start":{"line":17,"column":38},"end":{"line":17,"column":67}}]}},"code":["'use strict';","","const Loggers = require('egg-logger').EggLoggers;","","module.exports = function createLoggers(app) {","  const loggerConfig = app.config.logger;","  loggerConfig.type = app.type;","","  if (app.config.env === 'prod' && loggerConfig.level === 'DEBUG') {","    loggerConfig.level = 'INFO';","  }","","  const loggers = new Loggers(app.config);","","  // won't print to console after started, except for local and unittest","  app.ready(() => {","    if (app.config.env !== 'local' && app.config.env !== 'unittest') {","      loggers.disableConsole();","    }","  });","  loggers.coreLogger.info('[egg:logger] init all loggers with options: %j', loggerConfig);","","  return loggers;","};",""],"l":{"3":1,"5":1,"6":0,"7":0,"9":0,"10":0,"13":0,"16":0,"17":0,"18":0,"21":0,"23":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/singleton.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/singleton.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"(anonymous_1)","line":6,"loc":{"start":{"line":6,"column":13},"end":{"line":6,"column":28}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":6},"end":{"line":19,"column":9}}},"3":{"name":"(anonymous_3)","line":46,"loc":{"start":{"line":46,"column":5},"end":{"line":46,"column":10}}},"4":{"name":"(anonymous_4)","line":50,"loc":{"start":{"line":50,"column":16},"end":{"line":50,"column":25}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":7,"column":4},"end":{"line":7,"column":91}},"3":{"start":{"line":8,"column":4},"end":{"line":8,"column":89}},"4":{"start":{"line":9,"column":4},"end":{"line":9,"column":95}},"5":{"start":{"line":10,"column":4},"end":{"line":10,"column":83}},"6":{"start":{"line":11,"column":4},"end":{"line":11,"column":29}},"7":{"start":{"line":12,"column":4},"end":{"line":12,"column":27}},"8":{"start":{"line":13,"column":4},"end":{"line":13,"column":29}},"9":{"start":{"line":14,"column":4},"end":{"line":14,"column":33}},"10":{"start":{"line":16,"column":4},"end":{"line":16,"column":55},"skip":true},"11":{"start":{"line":20,"column":4},"end":{"line":20,"column":33}},"12":{"start":{"line":21,"column":4},"end":{"line":22,"column":89}},"13":{"start":{"line":25,"column":4},"end":{"line":31,"column":5}},"14":{"start":{"line":26,"column":6},"end":{"line":26,"column":57}},"15":{"start":{"line":27,"column":6},"end":{"line":27,"column":35}},"16":{"start":{"line":28,"column":6},"end":{"line":28,"column":97}},"17":{"start":{"line":29,"column":6},"end":{"line":29,"column":61}},"18":{"start":{"line":30,"column":6},"end":{"line":30,"column":13}},"19":{"start":{"line":34,"column":4},"end":{"line":40,"column":5}},"20":{"start":{"line":35,"column":6},"end":{"line":37,"column":7}},"21":{"start":{"line":36,"column":8},"end":{"line":36,"column":71}},"22":{"start":{"line":38,"column":6},"end":{"line":38,"column":33}},"23":{"start":{"line":39,"column":6},"end":{"line":39,"column":13}},"24":{"start":{"line":43,"column":4},"end":{"line":43,"column":31}},"25":{"start":{"line":47,"column":4},"end":{"line":47,"column":32}},"26":{"start":{"line":52,"column":4},"end":{"line":52,"column":61}},"27":{"start":{"line":53,"column":4},"end":{"line":53,"column":41}},"28":{"start":{"line":57,"column":0},"end":{"line":57,"column":27}}},"branchMap":{"1":{"line":16,"type":"binary-expr","locations":[{"start":{"line":16,"column":19},"end":{"line":16,"column":48},"skip":true},{"start":{"line":16,"column":52},"end":{"line":16,"column":54},"skip":true}]},"2":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":13},"end":{"line":21,"column":27}},{"start":{"line":21,"column":31},"end":{"line":21,"column":46}}]},"3":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":25,"column":4}},{"start":{"line":25,"column":4},"end":{"line":25,"column":4}}]},"4":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":34,"column":4}},{"start":{"line":34,"column":4},"end":{"line":34,"column":4}}]}},"code":["'use strict';","","const assert = require('assert');","","class Singleton {","  constructor(options = {}) {","    assert(options.name, '[egg:singleton] Singleton#constructor options.name is required');","    assert(options.app, '[egg:singleton] Singleton#constructor options.app is required');","    assert(options.create, '[egg:singleton] Singleton#constructor options.create is required');","    assert(!options.app[options.name], `${options.name} is already exists in app`);","    this.clients = new Map();","    this.app = options.app;","    this.name = options.name;","    this.create = options.create;","    /* istanbul ignore next */","    this.options = options.app.config[this.name] || {};","  }","","  init() {","    const options = this.options;","    assert(!(options.client && options.clients),","      `eggg:singleton ${this.name} can not set options.client and options.clients both`);","","    // alias app[name] as client, but still support createInstance method","    if (options.client) {","      const client = this.createInstance(options.client);","      this.app[this.name] = client;","      assert(!client.createInstance, 'singleton instance should not have createInstance method');","      client.createInstance = this.createInstance.bind(this);","      return;","    }","","    // multi clent, use app[name].getInstance(id)","    if (options.clients) {","      for (const id in options.clients) {","        this.clients.set(id, this.createInstance(options.clients[id]));","      }","      this.app[this.name] = this;","      return;","    }","","    // no config.clients and config.client","    this.app[this.name] = this;","  }","","  get(id) {","    return this.clients.get(id);","  }","","  createInstance(config) {","    // options.default will be merge in to options.clients[id]","    config = Object.assign({}, this.options.default, config);","    return this.create(config, this.app);","  }","}","","module.exports = Singleton;",""],"l":{"3":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"16":1,"20":0,"21":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"34":0,"35":0,"36":0,"38":0,"39":0,"43":0,"47":0,"52":0,"53":0,"57":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/utils.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/utils.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"convertObject","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":36}}},"2":{"name":"convertValue","line":18,"loc":{"start":{"line":18,"column":0},"end":{"line":18,"column":42}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":6,"column":0},"end":{"line":8,"column":2}},"4":{"start":{"line":10,"column":0},"end":{"line":16,"column":1}},"5":{"start":{"line":11,"column":2},"end":{"line":11,"column":45}},"6":{"start":{"line":11,"column":25},"end":{"line":11,"column":45}},"7":{"start":{"line":12,"column":2},"end":{"line":14,"column":3}},"8":{"start":{"line":13,"column":4},"end":{"line":13,"column":51}},"9":{"start":{"line":15,"column":2},"end":{"line":15,"column":13}},"10":{"start":{"line":18,"column":0},"end":{"line":52,"column":1}},"11":{"start":{"line":19,"column":2},"end":{"line":19,"column":46}},"12":{"start":{"line":19,"column":33},"end":{"line":19,"column":46}},"13":{"start":{"line":21,"column":2},"end":{"line":25,"column":3}},"14":{"start":{"line":22,"column":4},"end":{"line":22,"column":70}},"15":{"start":{"line":22,"column":46},"end":{"line":22,"column":70}},"16":{"start":{"line":23,"column":4},"end":{"line":23,"column":42}},"17":{"start":{"line":23,"column":29},"end":{"line":23,"column":42}},"18":{"start":{"line":24,"column":4},"end":{"line":24,"column":38}},"19":{"start":{"line":24,"column":25},"end":{"line":24,"column":38}},"20":{"start":{"line":29,"column":2},"end":{"line":31,"column":3}},"21":{"start":{"line":30,"column":4},"end":{"line":30,"column":40}},"22":{"start":{"line":34,"column":2},"end":{"line":34,"column":41}},"23":{"start":{"line":35,"column":2},"end":{"line":37,"column":3}},"24":{"start":{"line":36,"column":4},"end":{"line":36,"column":29}},"25":{"start":{"line":40,"column":2},"end":{"line":42,"column":3}},"26":{"start":{"line":41,"column":4},"end":{"line":41,"column":94}},"27":{"start":{"line":44,"column":2},"end":{"line":44,"column":42}},"28":{"start":{"line":45,"column":2},"end":{"line":48,"column":3}},"29":{"start":{"line":46,"column":4},"end":{"line":46,"column":90}},"30":{"start":{"line":46,"column":46},"end":{"line":46,"column":90}},"31":{"start":{"line":47,"column":4},"end":{"line":47,"column":27}},"32":{"start":{"line":51,"column":2},"end":{"line":51,"column":28},"skip":true}},"branchMap":{"1":{"line":11,"type":"if","locations":[{"start":{"line":11,"column":2},"end":{"line":11,"column":2}},{"start":{"line":11,"column":2},"end":{"line":11,"column":2}}]},"2":{"line":19,"type":"if","locations":[{"start":{"line":19,"column":2},"end":{"line":19,"column":2}},{"start":{"line":19,"column":2},"end":{"line":19,"column":2}}]},"3":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":2},"end":{"line":21,"column":2}},{"start":{"line":21,"column":2},"end":{"line":21,"column":2}}]},"4":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":4},"end":{"line":22,"column":4}},{"start":{"line":22,"column":4},"end":{"line":22,"column":4}}]},"5":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":8},"end":{"line":22,"column":24}},{"start":{"line":22,"column":28},"end":{"line":22,"column":44}}]},"6":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":23,"column":4}},{"start":{"line":23,"column":4},"end":{"line":23,"column":4}}]},"7":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":4},"end":{"line":24,"column":4}},{"start":{"line":24,"column":4},"end":{"line":24,"column":4}}]},"8":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":2},"end":{"line":29,"column":2}},{"start":{"line":29,"column":2},"end":{"line":29,"column":2}}]},"9":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":15},"end":{"line":34,"column":25}},{"start":{"line":34,"column":29},"end":{"line":34,"column":40}}]},"10":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":2},"end":{"line":35,"column":2}},{"start":{"line":35,"column":2},"end":{"line":35,"column":2}}]},"11":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":2},"end":{"line":40,"column":2}},{"start":{"line":40,"column":2},"end":{"line":40,"column":2}}]},"12":{"line":41,"type":"cond-expr","locations":[{"start":{"line":41,"column":41},"end":{"line":41,"column":70}},{"start":{"line":41,"column":73},"end":{"line":41,"column":93}}]},"13":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":2},"end":{"line":45,"column":2}},{"start":{"line":45,"column":2},"end":{"line":45,"column":2}}]},"14":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":46,"column":4}},{"start":{"line":46,"column":4},"end":{"line":46,"column":4}}]},"15":{"line":46,"type":"binary-expr","locations":[{"start":{"line":46,"column":8},"end":{"line":46,"column":24}},{"start":{"line":46,"column":28},"end":{"line":46,"column":44}}]}},"code":["'use strict';","","const util = require('util');","const is = require('is-type-of');","","module.exports = {","  convertObject,","};","","function convertObject(obj, ignore) {","  if (!is.array(ignore)) ignore = [ ignore ];","  for (const key of Object.keys(obj)) {","    obj[key] = convertValue(key, obj[key], ignore);","  }","  return obj;","}","","function convertValue(key, value, ignore) {","  if (is.nullOrUndefined(value)) return value;","","  if (!ignore.includes(key)) {","    if (is.symbol(value) || is.regExp(value)) return value.toString();","    if (is.primitive(value)) return value;","    if (is.array(value)) return value;","  }","","  // only convert recursively when it's a plain object,","  // o = {}","  if (Object.getPrototypeOf(value) === Object.prototype) {","    return convertObject(value, ignore);","  }","","  // support class","  const name = value.name || 'anonymous';","  if (is.class(value)) {","    return `<Class ${name}>`;","  }","","  // support generator function","  if (is.function(value)) {","    return is.generatorFunction(value) ? `<GeneratorFunction ${name}>` : `<Function ${name}>`;","  }","","  const typeName = value.constructor.name;","  if (typeName) {","    if (is.buffer(value) || is.string(value)) return `<${typeName} len: ${value.length}>`;","    return `<${typeName}>`;","  }","","  /* istanbul ignore next */","  return util.format(value);","}",""],"l":{"3":1,"4":1,"6":1,"10":1,"11":0,"12":0,"13":0,"15":0,"18":1,"19":0,"21":0,"22":0,"23":0,"24":0,"29":0,"30":0,"34":0,"35":0,"36":0,"40":0,"41":0,"44":0,"45":0,"46":0,"47":0,"51":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/loader/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/loader/index.js","s":{"1":1,"2":1,"3":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":50}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":57}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":61}}},"branchMap":{},"code":["'use strict';","","exports.EggLoader = require('egg-core').EggLoader;","exports.AppWorkerLoader = require('./app_worker_loader');","exports.AgentWorkerLoader = require('./agent_worker_loader');",""],"l":{"3":1,"4":1,"5":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/loader/app_worker_loader.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/loader/app_worker_loader.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":1},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":15,"loc":{"start":{"line":15,"column":12},"end":{"line":15,"column":15}}},"2":{"name":"(anonymous_2)","line":24,"loc":{"start":{"line":24,"column":6},"end":{"line":24,"column":9}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":48}},"2":{"start":{"line":16,"column":4},"end":{"line":16,"column":23}},"3":{"start":{"line":17,"column":4},"end":{"line":17,"column":23}},"4":{"start":{"line":26,"column":4},"end":{"line":26,"column":33}},"5":{"start":{"line":27,"column":4},"end":{"line":27,"column":29}},"6":{"start":{"line":28,"column":4},"end":{"line":28,"column":30}},"7":{"start":{"line":29,"column":4},"end":{"line":29,"column":29}},"8":{"start":{"line":30,"column":4},"end":{"line":30,"column":28}},"9":{"start":{"line":33,"column":4},"end":{"line":33,"column":25}},"10":{"start":{"line":35,"column":4},"end":{"line":35,"column":23}},"11":{"start":{"line":37,"column":4},"end":{"line":37,"column":26}},"12":{"start":{"line":39,"column":4},"end":{"line":39,"column":26}},"13":{"start":{"line":41,"column":4},"end":{"line":41,"column":22}},"14":{"start":{"line":46,"column":0},"end":{"line":46,"column":33}}},"branchMap":{},"code":["'use strict';","","const EggLoader = require('egg-core').EggLoader;","","/**"," * App Worker process Loader, will load plugins"," * @see https://github.com/eggjs/egg-loader"," */","class AppWorkerLoader extends EggLoader {","","  /**","   * loadPlugin first, then loadConfig","   * @since 1.0.0","   */","  loadConfig() {","    super.loadPlugin();","    super.loadConfig();","  }","","  /**","   * 开始加载所有约定目录","   * @since 1.0.0","   */","  load() {","    // app > plugin > core","    this.loadApplicationExtend();","    this.loadRequestExtend();","    this.loadResponseExtend();","    this.loadContextExtend();","    this.loadHelperExtend();","","    // app > plugin","    this.loadCustomApp();","    // app > plugin","    this.loadService();","    // app > plugin > core","    this.loadMiddleware();","    // app","    this.loadController();","    // app","    this.loadRouter(); // 依赖 controller","  }","","}","","module.exports = AppWorkerLoader;",""],"l":{"3":1,"16":0,"17":0,"26":0,"27":0,"28":0,"29":0,"30":0,"33":0,"35":0,"37":0,"39":0,"41":0,"46":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/loader/agent_worker_loader.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/loader/agent_worker_loader.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":1},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":18,"loc":{"start":{"line":18,"column":12},"end":{"line":18,"column":15}}},"2":{"name":"(anonymous_2)","line":23,"loc":{"start":{"line":23,"column":6},"end":{"line":23,"column":9}}}},"statementMap":{"1":{"start":{"line":7,"column":0},"end":{"line":7,"column":48}},"2":{"start":{"line":19,"column":4},"end":{"line":19,"column":23}},"3":{"start":{"line":20,"column":4},"end":{"line":20,"column":23}},"4":{"start":{"line":24,"column":4},"end":{"line":24,"column":27}},"5":{"start":{"line":25,"column":4},"end":{"line":25,"column":27}},"6":{"start":{"line":29,"column":0},"end":{"line":29,"column":35}}},"branchMap":{},"code":["/**"," * AgentWorkerLoader 类，继承 BaseLoader，实现整个应用的加载机制"," */","","'use strict';","","const EggLoader = require('egg-core').EggLoader;","","/**"," * Agent Worker 进程的 Loader，继承 egg-loader"," * @see https://github.com/eggjs/egg-loader"," */","class AgentWorkerLoader extends EggLoader {","","  /**","   * loadPlugin first, then loadConfig","   */","  loadConfig() {","    super.loadPlugin();","    super.loadConfig();","  }","","  load() {","    this.loadAgentExtend();","    this.loadCustomAgent();","  }","}","","module.exports = AgentWorkerLoader;",""],"l":{"7":1,"19":0,"20":0,"24":0,"25":0,"29":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/agent.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/agent.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":1,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":1},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"fnMap":{"1":{"name":"(anonymous_1)","line":19,"loc":{"start":{"line":19,"column":13},"end":{"line":19,"column":28}}},"2":{"name":"(anonymous_2)","line":37,"loc":{"start":{"line":37,"column":27},"end":{"line":37,"column":33}}},"3":{"name":"(anonymous_3)","line":48,"loc":{"start":{"line":48,"column":18},"end":{"line":48,"column":21}}},"4":{"name":"(anonymous_4)","line":52,"loc":{"start":{"line":52,"column":16},"end":{"line":52,"column":19}}},"5":{"name":"(anonymous_5)","line":56,"loc":{"start":{"line":56,"column":16},"end":{"line":56,"column":19}}},"6":{"name":"wrapMethod","line":61,"loc":{"start":{"line":61,"column":4},"end":{"line":61,"column":55}}},"7":{"name":"(anonymous_7)","line":63,"loc":{"start":{"line":63,"column":30},"end":{"line":63,"column":41}}},"8":{"name":"(anonymous_8)","line":75,"loc":{"start":{"line":75,"column":7},"end":{"line":75,"column":10}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":40}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":64}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":44}},"5":{"start":{"line":8,"column":0},"end":{"line":8,"column":43}},"6":{"start":{"line":20,"column":4},"end":{"line":20,"column":27}},"7":{"start":{"line":21,"column":4},"end":{"line":21,"column":19}},"8":{"start":{"line":23,"column":4},"end":{"line":23,"column":26}},"9":{"start":{"line":25,"column":4},"end":{"line":25,"column":23}},"10":{"start":{"line":28,"column":4},"end":{"line":28,"column":22}},"11":{"start":{"line":31,"column":4},"end":{"line":31,"column":47}},"12":{"start":{"line":33,"column":4},"end":{"line":33,"column":79}},"13":{"start":{"line":34,"column":4},"end":{"line":34,"column":68}},"14":{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},"15":{"start":{"line":39,"column":6},"end":{"line":39,"column":35}},"16":{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},"17":{"start":{"line":43,"column":6},"end":{"line":43,"column":43}},"18":{"start":{"line":45,"column":4},"end":{"line":45,"column":31}},"19":{"start":{"line":49,"column":4},"end":{"line":49,"column":29}},"20":{"start":{"line":53,"column":4},"end":{"line":53,"column":38}},"21":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"22":{"start":{"line":58,"column":6},"end":{"line":58,"column":62}},"23":{"start":{"line":61,"column":4},"end":{"line":72,"column":5}},"24":{"start":{"line":62,"column":6},"end":{"line":62,"column":49}},"25":{"start":{"line":63,"column":6},"end":{"line":68,"column":8}},"26":{"start":{"line":64,"column":8},"end":{"line":64,"column":72}},"27":{"start":{"line":65,"column":8},"end":{"line":66,"column":29}},"28":{"start":{"line":67,"column":8},"end":{"line":67,"column":44}},"29":{"start":{"line":69,"column":6},"end":{"line":71,"column":9}},"30":{"start":{"line":70,"column":8},"end":{"line":70,"column":45}},"31":{"start":{"line":76,"column":4},"end":{"line":76,"column":80}},"32":{"start":{"line":77,"column":4},"end":{"line":77,"column":25}},"33":{"start":{"line":82,"column":0},"end":{"line":82,"column":23}}},"branchMap":{"1":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":4},"end":{"line":38,"column":4}},{"start":{"line":38,"column":4},"end":{"line":38,"column":4}}]},"2":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":4},"end":{"line":42,"column":4}},{"start":{"line":42,"column":4},"end":{"line":42,"column":4},"skip":true}]}},"code":["'use strict';","","const path = require('path');","const EggApplication = require('./egg');","const AgentWorkerLoader = require('./loader').AgentWorkerLoader;","","const EGG_LOADER = Symbol.for('egg#loader');","const EGG_PATH = Symbol.for('egg#eggPath');","","/**"," * Singleton instance in Agent Worker, extend {@link EggApplication}"," * @extends EggApplication"," */","class Agent extends EggApplication {","  /**","   * @constructor","   * @param {Object} options - see {@link EggApplication}","   */","  constructor(options = {}) {","    options.type = 'agent';","    super(options);","","    this._wrapMessenger();","","    this.loader.load();","","    // dump config after loaded, ensure all the dynamic modifications will be recorded","    this.dumpConfig();","","    // keep agent alive even it don't have any io tasks","    setInterval(() => {}, 24 * 60 * 60 * 1000);","","    this._uncaughtExceptionHandler = this._uncaughtExceptionHandler.bind(this);","    process.on('uncaughtException', this._uncaughtExceptionHandler);","  }","","  _uncaughtExceptionHandler(err) {","    if (!(err instanceof Error)) {","      err = new Error(String(err));","    }","    /* istanbul ignore else */","    if (err.name === 'Error') {","      err.name = 'unhandledExceptionError';","    }","    this.coreLogger.error(err);","  }","","  get [EGG_LOADER]() {","    return AgentWorkerLoader;","  }","","  get [EGG_PATH]() {","    return path.join(__dirname, '..');","  }","","  _wrapMessenger() {","    for (const methodName of [ 'broadcast', 'sendTo', 'sendToApp', 'sendToAgent', 'sendRandom' ]) {","      wrapMethod(methodName, this.messenger, this.coreLogger);","    }","","    function wrapMethod(methodName, messenger, logger) {","      const originMethod = messenger[methodName];","      messenger[methodName] = function() {","        const stack = new Error().stack.split('\\n').slice(1).join('\\n');","        logger.warn('agent can\\'t call %s before server started\\n%s',","          methodName, stack);","        originMethod.apply(this, arguments);","      };","      messenger.once('egg-ready', () => {","        messenger[methodName] = originMethod;","      });","    }","  }","","  close() {","    process.removeListener('uncaughtException', this._uncaughtExceptionHandler);","    return super.close();","  }","","}","","module.exports = Agent;",""],"l":{"3":1,"4":1,"5":1,"7":1,"8":1,"20":0,"21":0,"23":0,"25":0,"28":0,"31":0,"33":0,"34":0,"38":0,"39":0,"42":0,"43":0,"45":0,"49":0,"53":0,"57":0,"58":0,"61":1,"62":0,"63":0,"64":0,"65":0,"67":0,"69":0,"70":0,"76":0,"77":0,"82":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/config/config.default.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/config/config.default.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":12,"column":0},"end":{"line":262,"column":2}},"4":{"start":{"line":14,"column":2},"end":{"line":136,"column":4}},"5":{"start":{"line":147,"column":2},"end":{"line":149,"column":4}},"6":{"start":{"line":163,"column":2},"end":{"line":165,"column":4}},"7":{"start":{"line":182,"column":2},"end":{"line":194,"column":4}},"8":{"start":{"line":210,"column":2},"end":{"line":223,"column":4}},"9":{"start":{"line":235,"column":2},"end":{"line":242,"column":4}},"10":{"start":{"line":248,"column":2},"end":{"line":253,"column":4}},"11":{"start":{"line":259,"column":2},"end":{"line":259,"column":45}},"12":{"start":{"line":261,"column":2},"end":{"line":261,"column":16}}},"branchMap":{},"code":["'use strict';","","const fs = require('fs');","const path = require('path');","","/**"," * The configuration of egg application, can be access by `app.config`"," * @class Config"," * @since 1.0.0"," */","","module.exports = appInfo => {","","  const config = {","","    /**","     * The environment of egg","     * @member {String} Config#env","     * @see {appInfo#env}","     * @since 1.0.0","     */","    env: appInfo.env,","","    /**","     * The name of the application","     * @member {String} Config#name","     * @see {appInfo#name}","     * @since 1.0.0","     */","    name: appInfo.name,","","    /**","     * The key that signing cookies. It can contain multiple keys seperated by `,`.","     * @member {String} Config#keys","     * @see https://eggjs.org/zh-cn/basics/controller.html#cookie-秘钥","     * @default","     * @since 1.0.0","     */","    keys: '',","","    /**","     * Whether application deployed after a reverse proxy,","     * when true proxy header fields will be trusted","     * @member {Boolean} Config#proxy","     * @default","     * @since 1.0.0","     */","    proxy: false,","","    /**","     * Detect request's protocol from specified headers, not case-sensitive.","     * Only worked when config.proxy set to true.","     * @member {String} Config#protocolHeaders","     * @default","     * @since 1.0.0","     */","    protocolHeaders: 'x-forwarded-proto',","","    /**","     * Detect request' ip from specified headers, not case-sensitive.","     * Only worked when config.proxy set to true.","     * @member {String} Config#ipHeaders","     * @default","     * @since 1.0.0","     */","    ipHeaders: 'x-forwarded-for',","","    /**","     * Detect request' host from specified headers, not case-sensitive.","     * Only worked when config.proxy set to true.","     * @member {String} Config#hostHeaders","     * @default","     * @since 1.0.0","     */","    hostHeaders: 'x-forwarded-host',","","    /**","     * package.json","     * @member {Object} Config#pkg","     * @see {appInfo#pkg}","     * @since 1.0.0","     */","    pkg: appInfo.pkg,","","    /**","     * The current directory of the application","     * @member {String} Config#baseDir","     * @see {appInfo#baseDir}","     * @since 1.0.0","     */","    baseDir: appInfo.baseDir,","","    /**","     * The current HOME directory","     * @member {String} Config#HOME","     * @see {appInfo#HOME}","     * @since 1.0.0","     */","    HOME: appInfo.HOME,","","    /**","     * The directory of server running. You can find `application_config.json` under it that is dumpped from `app.config`.","     * @member {String} Config#rundir","     * @default","     * @since 1.0.0","     */","    rundir: path.join(appInfo.baseDir, 'run'),","","    /**","     * dump config","     *","     * It will ignore special keys when dumpConfig","     *","     * @member Config#dump","     * @property {Set} ignore - keys to ignore","     */","    dump: {","      ignore: new Set([ 'pass', 'pwd', 'passd', 'passwd', 'password', 'keys', 'secret' ]),","    },","","    /**","     * configurations are confused to users","     * {","     *   [unexpectedKey]: [expectedKey],","     * }","     * @member Config#confusedConfigurations","     * @type {Object}","     */","    confusedConfigurations: {","      bodyparser: 'bodyParser',","      notFound: 'notfound',","      sitefile: 'siteFile',","      middlewares: 'middleware',","      httpClient: 'httpclient',","    },","  };","","  /**","   * The option of `notfound` middleware","   *","   * It will return page or json depend on negotiation when 404,","   * If pageUrl is set, it will redirect to the page.","   *","   * @member Config#notfound","   * @property {String} pageUrl - the 404 page url","   */","  config.notfound = {","    pageUrl: '',","  };","","  /**","   * The option of `siteFile` middleware","   *","   * You can map some files using this options, it will response immdiately when matching.","   *","   * @member {Object} Config#siteFile - key is path, and value is url or buffer.","   * @example","   * // 指定应用 favicon, => '/favicon.ico': 'https://eggjs.org/favicon.ico',","   * config.siteFile = {","   *   '/favicon.ico': 'https://eggjs.org/favicon.ico',","   * };","   */","  config.siteFile = {","    '/favicon.ico': fs.readFileSync(path.join(__dirname, 'favicon.png')),","  };","","  /**","   * The option of `bodyParser` middleware","   *","   * @member Config#bodyParser","   * @property {Boolean} enable - enable bodyParser or not, default to true","   * @property {String | RegExp | Function | Array} ignore - won't parse request body when url path hit ignore pattern, can not set `ignore` when `match` presented","   * @property {String | RegExp | Function | Array} match - will parse request body only when url path hit match pattern","   * @property {String} encoding - body 的编码格式，默认为 utf8","   * @property {String} formLimit - form body 的大小限制，默认为 100kb","   * @property {String} jsonLimit - json body 的大小限制，默认为 100kb","   * @property {Boolean} strict - json body 解析是否为严格模式，如果为严格模式则只接受 object 和 array","   * @property {Number} queryString.arrayLimit - 表单元素数组长度限制，默认 100，否则会转换为 json 格式","   * @property {Number} queryString.depth - json 数值深度限制，默认 5","   * @property {Number} queryString.parameterLimit - 参数个数限制，默认 1000","   */","  config.bodyParser = {","    enable: true,","    encoding: 'utf8',","    formLimit: '100kb',","    jsonLimit: '100kb',","    strict: true,","    // @see https://github.com/hapijs/qs/blob/master/lib/parse.js#L8 for more options","    queryString: {","      arrayLimit: 100,","      depth: 5,","      parameterLimit: 1000,","    },","  };","","  /**","   * logger options","   * @member Config#logger","   * @property {String} dir - directory of log files","   * @property {String} encoding - log file encloding, defaults to utf8","   * @property {String} level - default log level, could be: DEBUG, INFO, WARN, ERROR or NONE, defaults to INFO in production","   * @property {String} consoleLevel - log level of stdout, defaults to INFO in local serverEnv, defaults to WARN in unittest, defaults to NONE elsewise","   * @property {Boolean} outputJSON - log as JSON or not, defaults to false","   * @property {Boolean} buffer - if enabled, flush logs to disk at a certain frequency to improve performance, defaults to true","   * @property {String} errorLogName - file name of errorLogger","   * @property {String} coreLogName - file name of coreLogger","   * @property {String} agentLogName - file name of agent worker log","   * @property {Object} coreLogger - custom config of coreLogger","   */","  config.logger = {","    dir: path.join(appInfo.root, 'logs', appInfo.name),","    encoding: 'utf8',","    env: appInfo.env,","    level: 'INFO',","    consoleLevel: 'INFO',","    outputJSON: false,","    buffer: true,","    appLogName: `${appInfo.name}-web.log`,","    coreLogName: 'egg-web.log',","    agentLogName: 'egg-agent.log',","    errorLogName: 'common-error.log',","    coreLogger: {},","  };","","  /**","   * The option for httpclient","   * @member Config#httpclient","   * @property {Boolean} keepAlive - Enable http keepalive or not, default is true","   * @property {Number} freeSocketKeepAliveTimeout - socket keepalive max free time, default is 4000 ms.","   * @property {Number} timeout - socket max unative time, default is 30000 ms.","   * @property {Number} maxSockets - max socket number of one host, default is Infinity.","   * @property {Number} maxFreeSockets - max free socket number of one host, default is 256.","   * @property {Boolean} enableDNSCache - Enable DNS lookup from local cache or not, default is false.","   */","  config.httpclient = {","    keepAlive: true,","    freeSocketKeepAliveTimeout: 4000,","    timeout: 30000,","    maxSockets: Infinity,","    maxFreeSockets: 256,","    enableDNSCache: false,","  };","","  /**","   * core enable middlewares","   * @member {Array} Config#middleware","   */","  config.coreMiddleware = [","    'meta',","    'siteFile',","    'notfound',","    'bodyParser',","  ];","","  /**","   * emit `startTimeout` if worker don't ready after `workerStartTimeout` ms","   * @member {Number} Config.workerStartTimeout","   */","  config.workerStartTimeout = 10 * 60 * 1000;","","  return config;","};",""],"l":{"3":1,"4":1,"12":1,"14":0,"147":0,"163":0,"182":0,"210":0,"235":0,"248":0,"259":0,"261":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/config/config.local.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/config/config.local.js","s":{"1":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":12,"column":2}}},"branchMap":{},"code":["'use strict';","","module.exports = {","  logger: {","    level: 'DEBUG',","    consoleLevel: 'INFO',","    coreLogger: {","      consoleLevel: 'WARN',","    },","    buffer: false,","  },","};",""],"l":{"3":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/config/config.unittest.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/config/config.unittest.js","s":{"1":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":8,"column":2}}},"branchMap":{},"code":["'use strict';","","module.exports = {","  logger: {","    consoleLevel: 'WARN',","    buffer: false,","  },","};",""],"l":{"3":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/config/plugin.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/config/plugin.js","s":{"1":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":136,"column":2}}},"branchMap":{},"code":["'use strict';","","module.exports = {","  // enable plugins","","  /**","   * app global Error Handling","   * @member {Object} Plugin#onerror","   * @property {Boolean} enable - `true` by default","   */","  onerror: {","    enable: true,","    package: 'egg-onerror',","  },","","  /**","   * session","   * @member {Object} Plugin#session","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  session: {","    enable: true,","    package: 'egg-session',","  },","","  /**","   * i18n","   * @member {Object} Plugin#i18n","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  i18n: {","    enable: true,","    package: 'egg-i18n',","  },","","  /**","   * file and dir watcher","   * @member {Object} Plugin#watcher","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  watcher: {","    enable: true,","    package: 'egg-watcher',","  },","","  /**","   * multipart","   * @member {Object} Plugin#multipart","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  multipart: {","    enable: true,","    package: 'egg-multipart',","  },","","  /**","   * security middlewares and extends","   * @member {Object} Plugin#security","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  security: {","    enable: true,","    package: 'egg-security',","  },","","  /**","   * local development helper","   * @member {Object} Plugin#development","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  development: {","    enable: true,","    package: 'egg-development',","  },","","  /**","   * logger file rotater","   * @member {Object} Plugin#logrotator","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  logrotator: {","    enable: true,","    package: 'egg-logrotator',","  },","","  /**","   * schedule tasks","   * @member {Object} Plugin#schedule","   * @property {Boolean} enable - `true` by default","   * @since 2.7.0","   */","  schedule: {","    enable: true,","    package: 'egg-schedule',","  },","","  /**","   * `app/public` dir static serve","   * @member {Object} Plugin#static","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  static: {","    enable: true,","    package: 'egg-static',","  },","","  /**","   * jsonp support for egg","   * @member {Function} Plugin#jsonp","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  jsonp: {","    enable: true,","    package: 'egg-jsonp',","  },","","  /**","   * view plugin","   * @member {Function} Plugin#view","   * @property {Boolean} enable - `true` by default","   * @since 1.0.0","   */","  view: {","    enable: true,","    package: 'egg-view',","  },","};",""],"l":{"3":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/extend/context.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/extend/context.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":4,"12":4,"13":0,"14":4,"15":4,"16":0,"17":0,"18":2,"19":2,"20":2,"21":0,"22":4,"23":4,"24":1,"25":4,"26":0,"27":4,"28":0,"29":0,"30":0,"31":0,"32":2,"33":2,"34":4,"35":4,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":2,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":1,"54":1},"b":{"1":[4,0],"2":[4,0],"3":[2,0],"4":[1,3],"5":[0,4],"6":[0,0],"7":[4,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":4,"2":4,"3":0,"4":2,"5":2,"6":4,"7":2,"8":2,"9":4,"10":0,"11":2,"12":0,"13":0,"14":0},"fnMap":{"1":{"name":"(anonymous_1)","line":15,"loc":{"start":{"line":15,"column":13},"end":{"line":15,"column":16}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":16},"end":{"line":27,"column":19}}},"3":{"name":"(anonymous_3)","line":42,"loc":{"start":{"line":42,"column":6},"end":{"line":42,"column":21}}},"4":{"name":"(anonymous_4)","line":56,"loc":{"start":{"line":56,"column":12},"end":{"line":56,"column":15}}},"5":{"name":"(anonymous_5)","line":67,"loc":{"start":{"line":67,"column":12},"end":{"line":67,"column":15}}},"6":{"name":"(anonymous_6)","line":81,"loc":{"start":{"line":81,"column":11},"end":{"line":81,"column":18}}},"7":{"name":"(anonymous_7)","line":110,"loc":{"start":{"line":110,"column":12},"end":{"line":110,"column":15}}},"8":{"name":"(anonymous_8)","line":121,"loc":{"start":{"line":121,"column":16},"end":{"line":121,"column":19}}},"9":{"name":"(anonymous_9)","line":152,"loc":{"start":{"line":152,"column":12},"end":{"line":152,"column":15}}},"10":{"name":"(anonymous_10)","line":163,"loc":{"start":{"line":163,"column":12},"end":{"line":163,"column":18}}},"11":{"name":"(anonymous_11)","line":175,"loc":{"start":{"line":175,"column":11},"end":{"line":175,"column":14}}},"12":{"name":"(anonymous_12)","line":179,"loc":{"start":{"line":179,"column":11},"end":{"line":179,"column":17}}},"13":{"name":"(anonymous_13)","line":195,"loc":{"start":{"line":195,"column":17},"end":{"line":195,"column":25}}},"14":{"name":"(anonymous_14)","line":200,"loc":{"start":{"line":200,"column":7},"end":{"line":200,"column":20}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":25}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":38}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":40}},"5":{"start":{"line":8,"column":0},"end":{"line":8,"column":40}},"6":{"start":{"line":9,"column":0},"end":{"line":9,"column":49}},"7":{"start":{"line":10,"column":0},"end":{"line":10,"column":42}},"8":{"start":{"line":11,"column":0},"end":{"line":11,"column":49}},"9":{"start":{"line":12,"column":0},"end":{"line":12,"column":56}},"10":{"start":{"line":14,"column":0},"end":{"line":208,"column":2}},"11":{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},"12":{"start":{"line":17,"column":6},"end":{"line":17,"column":71}},"13":{"start":{"line":19,"column":4},"end":{"line":19,"column":25}},"14":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"15":{"start":{"line":29,"column":6},"end":{"line":29,"column":70}},"16":{"start":{"line":31,"column":4},"end":{"line":31,"column":36}},"17":{"start":{"line":43,"column":4},"end":{"line":43,"column":46}},"18":{"start":{"line":57,"column":4},"end":{"line":57,"column":27}},"19":{"start":{"line":68,"column":4},"end":{"line":70,"column":5}},"20":{"start":{"line":69,"column":6},"end":{"line":69,"column":47}},"21":{"start":{"line":71,"column":4},"end":{"line":71,"column":24}},"22":{"start":{"line":82,"column":4},"end":{"line":82,"column":38}},"23":{"start":{"line":83,"column":4},"end":{"line":85,"column":5}},"24":{"start":{"line":84,"column":6},"end":{"line":84,"column":41}},"25":{"start":{"line":88,"column":4},"end":{"line":88,"column":40}},"26":{"start":{"line":88,"column":21},"end":{"line":88,"column":40}},"27":{"start":{"line":91,"column":4},"end":{"line":91,"column":47}},"28":{"start":{"line":92,"column":4},"end":{"line":92,"column":32}},"29":{"start":{"line":92,"column":20},"end":{"line":92,"column":32}},"30":{"start":{"line":95,"column":4},"end":{"line":95,"column":62}},"31":{"start":{"line":96,"column":4},"end":{"line":96,"column":23}},"32":{"start":{"line":111,"column":4},"end":{"line":111,"column":36}},"33":{"start":{"line":122,"column":4},"end":{"line":122,"column":40}},"34":{"start":{"line":153,"column":4},"end":{"line":155,"column":5}},"35":{"start":{"line":154,"column":6},"end":{"line":154,"column":49}},"36":{"start":{"line":156,"column":4},"end":{"line":159,"column":5}},"37":{"start":{"line":157,"column":6},"end":{"line":157,"column":46}},"38":{"start":{"line":158,"column":6},"end":{"line":158,"column":31}},"39":{"start":{"line":160,"column":4},"end":{"line":160,"column":24}},"40":{"start":{"line":164,"column":4},"end":{"line":166,"column":5}},"41":{"start":{"line":165,"column":6},"end":{"line":165,"column":29}},"42":{"start":{"line":167,"column":4},"end":{"line":167,"column":32}},"43":{"start":{"line":176,"column":4},"end":{"line":176,"column":23}},"44":{"start":{"line":180,"column":4},"end":{"line":180,"column":22}},"45":{"start":{"line":196,"column":4},"end":{"line":196,"column":21}},"46":{"start":{"line":197,"column":4},"end":{"line":197,"column":29}},"47":{"start":{"line":199,"column":4},"end":{"line":199,"column":39},"skip":true},"48":{"start":{"line":200,"column":4},"end":{"line":206,"column":7}},"49":{"start":{"line":201,"column":6},"end":{"line":201,"column":23}},"50":{"start":{"line":202,"column":6},"end":{"line":202,"column":99}},"51":{"start":{"line":204,"column":6},"end":{"line":204,"column":96}},"52":{"start":{"line":205,"column":6},"end":{"line":205,"column":32}},"53":{"start":{"line":214,"column":0},"end":{"line":238,"column":16}},"54":{"start":{"line":240,"column":0},"end":{"line":246,"column":24}}},"branchMap":{"1":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":4},"end":{"line":16,"column":4}},{"start":{"line":16,"column":4},"end":{"line":16,"column":4}}]},"2":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":28,"column":4}},{"start":{"line":28,"column":4},"end":{"line":28,"column":4}}]},"3":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":4},"end":{"line":68,"column":4}},{"start":{"line":68,"column":4},"end":{"line":68,"column":4}}]},"4":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":4},"end":{"line":83,"column":4}},{"start":{"line":83,"column":4},"end":{"line":83,"column":4}}]},"5":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":4},"end":{"line":88,"column":4}},{"start":{"line":88,"column":4},"end":{"line":88,"column":4}}]},"6":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":4},"end":{"line":92,"column":4}},{"start":{"line":92,"column":4},"end":{"line":92,"column":4}}]},"7":{"line":153,"type":"if","locations":[{"start":{"line":153,"column":4},"end":{"line":153,"column":4}},{"start":{"line":153,"column":4},"end":{"line":153,"column":4}}]},"8":{"line":156,"type":"if","locations":[{"start":{"line":156,"column":4},"end":{"line":156,"column":4}},{"start":{"line":156,"column":4},"end":{"line":156,"column":4}}]},"9":{"line":156,"type":"binary-expr","locations":[{"start":{"line":156,"column":8},"end":{"line":156,"column":25}},{"start":{"line":156,"column":29},"end":{"line":156,"column":53}}]},"10":{"line":164,"type":"if","locations":[{"start":{"line":164,"column":4},"end":{"line":164,"column":4}},{"start":{"line":164,"column":4},"end":{"line":164,"column":4}}]},"11":{"line":199,"type":"binary-expr","locations":[{"start":{"line":199,"column":21},"end":{"line":199,"column":31},"skip":true},{"start":{"line":199,"column":35},"end":{"line":199,"column":38},"skip":true}]}},"code":["'use strict';","","const delegate = require('delegates');","const co = require('co');","const { assign } = require('utility');","","const HELPER = Symbol('Context#helper');","const LOCALS = Symbol('Context#locals');","const LOCALS_LIST = Symbol('Context#localsList');","const COOKIES = Symbol('Context#cookies');","const CONTEXT_LOGGERS = Symbol('Context#logger');","const CONTEXT_HTTPCLIENT = Symbol('Context#httpclient');","","const proto = module.exports = {","  get cookies() {","    if (!this[COOKIES]) {","      this[COOKIES] = new this.app.ContextCookies(this, this.app.keys);","    }","    return this[COOKIES];","  },","","  /**","   * Get a wrapper httpclient instance contain ctx in the hold request process","   *","   * @return {ContextHttpClient} the wrapper httpclient instance","   */","  get httpclient() {","    if (!this[CONTEXT_HTTPCLIENT]) {","      this[CONTEXT_HTTPCLIENT] = new this.app.ContextHttpClient(this);","    }","    return this[CONTEXT_HTTPCLIENT];","  },","","  /**","   * Shortcut for httpclient.curl","   *","   * @method Context#curl","   * @param {String|Object} url - request url address.","   * @param {Object} [options] - options for request.","   * @return {Object} see {@link ContextHttpClient#curl}","   */","  curl(url, options) {","    return this.httpclient.curl(url, options);","  },","","  /**","   * Alias to {@link Application#router}","   *","   * @member {Router} Context#router","   * @since 1.0.0","   * @example","   * ```js","   * this.router.pathFor('post', { id: 12 });","   * ```","   */","  get router() {","    return this.app.router;","  },","","","  /**","   * Get helper instance from {@link Application#Helper}","   *","   * @member {Helper} Context#helper","   * @since 1.0.0","   */","  get helper() {","    if (!this[HELPER]) {","      this[HELPER] = new this.app.Helper(this);","    }","    return this[HELPER];","  },","","  /**","   * Wrap app.loggers with context infomation,","   * if a custom logger is defined by naming aLogger, then you can `ctx.getLogger('aLogger')`","   *","   * @param {String} name - logger name","   * @return {Logger} logger","   */","  getLogger(name) {","    let cache = this[CONTEXT_LOGGERS];","    if (!cache) {","      cache = this[CONTEXT_LOGGERS] = {};","    }","","    // read from cache","    if (cache[name]) return cache[name];","","    // get no exist logger","    const appLogger = this.app.getLogger(name);","    if (!appLogger) return null;","","    // write to cache","    cache[name] = new this.app.ContextLogger(this, appLogger);","    return cache[name];","  },","","  /**","   * Logger for Application, wrapping app.coreLogger with context infomation","   *","   * @member {ContextLogger} Context#logger","   * @since 1.0.0","   * @example","   * ```js","   * this.logger.info('some request data: %j', this.request.body);","   * this.logger.warn('WARNING!!!!');","   * ```","   */","  get logger() {","    return this.getLogger('logger');","  },","","  /**","   * Logger for frameworks and plugins,","   * wrapping app.coreLogger with context infomation","   *","   * @member {ContextLogger} Context#coreLogger","   * @since 1.0.0","   */","  get coreLogger() {","    return this.getLogger('coreLogger');","  },","","  /**","   * locals is an object for view, you can use `app.locals` and `ctx.locals` to set variables,","   * which will be used as data when view is rendering.","   * The difference between `app.locals` and `ctx.locals` is the context level, `app.locals` is global level, and `ctx.locals` is request level. when you get `ctx.locals`, it will merge `app.locals`.","   *","   * when you set locals, only object is available","   *","   * ```js","   * this.locals = {","   *   a: 1","   * };","   * this.locals = {","   *   b: 1","   * };","   * this.locals.c = 1;","   * console.log(this.locals);","   * {","   *   a: 1,","   *   b: 1,","   *   c: 1,","   * };","   * ```","   *","   * `ctx.locals` has cache, it only merges `app.locals` once in one request.","   *","   * @member {Object} Context#locals","   */","  get locals() {","    if (!this[LOCALS]) {","      this[LOCALS] = assign({}, this.app.locals);","    }","    if (this[LOCALS_LIST] && this[LOCALS_LIST].length) {","      assign(this[LOCALS], this[LOCALS_LIST]);","      this[LOCALS_LIST] = null;","    }","    return this[LOCALS];","  },","","  set locals(val) {","    if (!this[LOCALS_LIST]) {","      this[LOCALS_LIST] = [];","    }","    this[LOCALS_LIST].push(val);","  },","","  /**","   * alias to {@link Context#locals}, compatible with koa that use this variable","   * @member {Object} state","   * @see Context#locals","   */","  get state() {","    return this.locals;","  },","","  set state(val) {","    this.locals = val;","  },","","  /**","   * Run generator function in the background","   * @param {Generator} scope - generator function, the first args is ctx","   * ```js","   * this.body = 'hi';","   *","   * this.runInBackground(function* saveUserInfo(ctx) {","   *   yield ctx.mysql.query(sql);","   *   yield ctx.curl(url);","   * });","   * ```","   */","  runInBackground(scope) {","    const ctx = this;","    const start = Date.now();","    /* istanbul ignore next */","    const taskName = scope.name || '-';","    co(function* () {","      yield scope(ctx);","      ctx.coreLogger.info('[egg:background] task:%s success (%dms)', taskName, Date.now() - start);","    }).catch(err => {","      ctx.coreLogger.info('[egg:background] task:%s fail (%dms)', taskName, Date.now() - start);","      ctx.coreLogger.error(err);","    });","  },","};","","/**"," * Context delegation."," */","","delegate(proto, 'request')","  /**","   * @member {Boolean} Context#acceptJSON","   * @see Request#acceptJSON","   * @since 1.0.0","   */","  .getter('acceptJSON')","  /**","   * @member {Array} Context#queries","   * @see Request#queries","   * @since 1.0.0","   */","  .getter('queries')","  /**","   * @member {Boolean} Context#accept","   * @see Request#accept","   * @since 1.0.0","   */","  .getter('accept')","  /**","   * @member {string} Context#ip","   * @see Request#ip","   * @since 1.0.0","   */","  .access('ip');","","delegate(proto, 'response')","  /**","   * @member {Number} Context#realStatus","   * @see Response#realStatus","   * @since 1.0.0","   */","  .access('realStatus');",""],"l":{"3":1,"4":1,"5":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"14":1,"16":4,"17":4,"19":0,"28":4,"29":4,"31":0,"43":0,"57":2,"68":2,"69":2,"71":0,"82":4,"83":4,"84":1,"88":4,"91":4,"92":0,"95":0,"96":0,"111":2,"122":2,"153":4,"154":4,"156":0,"157":0,"158":0,"160":0,"164":0,"165":0,"167":0,"176":2,"180":0,"196":0,"197":0,"199":1,"200":0,"201":0,"202":0,"204":0,"205":0,"214":1,"240":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/extend/helper.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/extend/helper.js","s":{"1":1,"2":1,"3":0,"4":0},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":22,"loc":{"start":{"line":22,"column":9},"end":{"line":22,"column":24}}},"2":{"name":"(anonymous_2)","line":39,"loc":{"start":{"line":39,"column":8},"end":{"line":39,"column":23}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"2":{"start":{"line":6,"column":0},"end":{"line":43,"column":2}},"3":{"start":{"line":23,"column":4},"end":{"line":23,"column":45}},"4":{"start":{"line":40,"column":4},"end":{"line":40,"column":107}}},"branchMap":{},"code":["'use strict';","","const url = require('url');","","","module.exports = {","","  /**","   * Generate URL path(withoud host) for route. Takes the route name and a map of named params.","   * @method Helper#pathFor","   * @param {String} name - Router Name","   * @param {Object} params - Other params","   *","   * @example","   * ```js","   * app.get('home', '/index.htm', 'home.index');","   * helper.pathFor('home', { by: 'recent', limit: 20 })","   * => /index.htm?by=recent&limit=20","   * ```","   * @return {String} url path(without host)","   */","  pathFor(name, params) {","    return this.app.router.url(name, params);","  },","","  /**","   * Generate full URL(with host) for route. Takes the route name and a map of named params.","   * @method Helper#urlFor","   * @param {String} name - Router name","   * @param {Object} params - Other params","   * @example","   * ```js","   * app.get('home', '/index.htm', 'home.index');","   * helper.urlFor('home', { by: 'recent', limit: 20 })","   * => http://127.0.0.1:7001/index.htm?by=recent&limit=20","   * ```","   * @return {String} full url(with host)","   */","  urlFor(name, params) {","    return this.ctx.protocol + '://' + this.ctx.host + url.resolve('/', this.app.router.url(name, params));","  },","","};",""],"l":{"3":1,"6":1,"23":0,"40":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/extend/request.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/extend/request.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":4,"12":0,"13":4,"14":4,"15":0,"16":0,"17":0,"18":0,"19":4,"20":0,"21":4,"22":0,"23":0,"24":4,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":8,"32":0,"33":8,"34":0,"35":0,"36":0,"37":0,"38":0,"39":4,"40":0,"41":4,"42":0,"43":0,"44":0,"45":4,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":4,"53":4,"54":4,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":2,"74":2,"75":2,"76":2,"77":0,"78":2,"79":0,"80":0,"81":1,"82":0,"83":0,"84":0,"85":1,"86":0,"87":0,"88":0,"89":1,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0},"b":{"1":[0,4],"2":[0,0],"3":[0,0,0],"4":[0,4],"5":[0,4],"6":[4,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,8],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,4],"15":[4,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[4,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,2],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0]},"f":{"1":4,"2":4,"3":8,"4":4,"5":0,"6":4,"7":4,"8":2,"9":2,"10":2,"11":0,"12":0,"13":0,"14":0},"fnMap":{"1":{"name":"(anonymous_1)","line":32,"loc":{"start":{"line":32,"column":10},"end":{"line":32,"column":13}}},"2":{"name":"(anonymous_2)","line":52,"loc":{"start":{"line":52,"column":14},"end":{"line":52,"column":17}}},"3":{"name":"(anonymous_3)","line":83,"loc":{"start":{"line":83,"column":9},"end":{"line":83,"column":12}}},"4":{"name":"(anonymous_4)","line":107,"loc":{"start":{"line":107,"column":8},"end":{"line":107,"column":11}}},"5":{"name":"(anonymous_5)","line":122,"loc":{"start":{"line":122,"column":8},"end":{"line":122,"column":13}}},"6":{"name":"(anonymous_6)","line":135,"loc":{"start":{"line":135,"column":16},"end":{"line":135,"column":19}}},"7":{"name":"(anonymous_7)","line":144,"loc":{"start":{"line":144,"column":14},"end":{"line":144,"column":34}}},"8":{"name":"(anonymous_8)","line":200,"loc":{"start":{"line":200,"column":11},"end":{"line":200,"column":14}}},"9":{"name":"(anonymous_9)","line":220,"loc":{"start":{"line":220,"column":13},"end":{"line":220,"column":16}}},"10":{"name":"(anonymous_10)","line":224,"loc":{"start":{"line":224,"column":12},"end":{"line":224,"column":15}}},"11":{"name":"(anonymous_11)","line":241,"loc":{"start":{"line":241,"column":11},"end":{"line":241,"column":17}}},"12":{"name":"firstValue","line":247,"loc":{"start":{"line":247,"column":0},"end":{"line":247,"column":27}}},"13":{"name":"arrayValue","line":254,"loc":{"start":{"line":254,"column":0},"end":{"line":254,"column":27}}},"14":{"name":"getFromHeaders","line":261,"loc":{"start":{"line":261,"column":0},"end":{"line":261,"column":36}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":43}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":35}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":42}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":46}},"5":{"start":{"line":8,"column":0},"end":{"line":8,"column":36}},"6":{"start":{"line":9,"column":0},"end":{"line":9,"column":28}},"7":{"start":{"line":10,"column":0},"end":{"line":10,"column":34}},"8":{"start":{"line":11,"column":0},"end":{"line":11,"column":26}},"9":{"start":{"line":12,"column":0},"end":{"line":12,"column":37}},"10":{"start":{"line":14,"column":0},"end":{"line":244,"column":2}},"11":{"start":{"line":33,"column":4},"end":{"line":33,"column":38}},"12":{"start":{"line":33,"column":20},"end":{"line":33,"column":38}},"13":{"start":{"line":35,"column":4},"end":{"line":35,"column":13}},"14":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"15":{"start":{"line":37,"column":6},"end":{"line":37,"column":63}},"16":{"start":{"line":39,"column":4},"end":{"line":39,"column":42}},"17":{"start":{"line":40,"column":4},"end":{"line":40,"column":42}},"18":{"start":{"line":41,"column":4},"end":{"line":41,"column":22}},"19":{"start":{"line":53,"column":4},"end":{"line":53,"column":46}},"20":{"start":{"line":53,"column":24},"end":{"line":53,"column":46}},"21":{"start":{"line":55,"column":4},"end":{"line":58,"column":5}},"22":{"start":{"line":56,"column":6},"end":{"line":56,"column":31}},"23":{"start":{"line":57,"column":6},"end":{"line":57,"column":28}},"24":{"start":{"line":60,"column":4},"end":{"line":66,"column":5}},"25":{"start":{"line":61,"column":6},"end":{"line":61,"column":74}},"26":{"start":{"line":62,"column":6},"end":{"line":65,"column":7}},"27":{"start":{"line":63,"column":8},"end":{"line":63,"column":51}},"28":{"start":{"line":64,"column":8},"end":{"line":64,"column":30}},"29":{"start":{"line":68,"column":4},"end":{"line":68,"column":56}},"30":{"start":{"line":69,"column":4},"end":{"line":69,"column":26}},"31":{"start":{"line":84,"column":4},"end":{"line":84,"column":36}},"32":{"start":{"line":84,"column":19},"end":{"line":84,"column":36}},"33":{"start":{"line":87,"column":4},"end":{"line":90,"column":5}},"34":{"start":{"line":88,"column":6},"end":{"line":88,"column":21}},"35":{"start":{"line":89,"column":6},"end":{"line":89,"column":23}},"36":{"start":{"line":92,"column":4},"end":{"line":92,"column":70}},"37":{"start":{"line":93,"column":4},"end":{"line":93,"column":48}},"38":{"start":{"line":94,"column":4},"end":{"line":94,"column":21}},"39":{"start":{"line":108,"column":4},"end":{"line":110,"column":5}},"40":{"start":{"line":109,"column":6},"end":{"line":109,"column":22}},"41":{"start":{"line":111,"column":4},"end":{"line":111,"column":56}},"42":{"start":{"line":114,"column":4},"end":{"line":114,"column":71}},"43":{"start":{"line":115,"column":4},"end":{"line":115,"column":20}},"44":{"start":{"line":123,"column":4},"end":{"line":123,"column":18}},"45":{"start":{"line":136,"column":4},"end":{"line":136,"column":49}},"46":{"start":{"line":136,"column":37},"end":{"line":136,"column":49}},"47":{"start":{"line":137,"column":4},"end":{"line":137,"column":83}},"48":{"start":{"line":137,"column":71},"end":{"line":137,"column":83}},"49":{"start":{"line":138,"column":4},"end":{"line":138,"column":69}},"50":{"start":{"line":138,"column":57},"end":{"line":138,"column":69}},"51":{"start":{"line":139,"column":4},"end":{"line":139,"column":17}},"52":{"start":{"line":145,"column":4},"end":{"line":145,"column":33}},"53":{"start":{"line":146,"column":4},"end":{"line":148,"column":5}},"54":{"start":{"line":147,"column":6},"end":{"line":147,"column":16}},"55":{"start":{"line":150,"column":4},"end":{"line":150,"column":28}},"56":{"start":{"line":151,"column":4},"end":{"line":153,"column":5}},"57":{"start":{"line":152,"column":6},"end":{"line":152,"column":31}},"58":{"start":{"line":154,"column":4},"end":{"line":154,"column":28}},"59":{"start":{"line":155,"column":4},"end":{"line":176,"column":5}},"60":{"start":{"line":156,"column":6},"end":{"line":156,"column":31}},"61":{"start":{"line":157,"column":6},"end":{"line":157,"column":52}},"62":{"start":{"line":159,"column":6},"end":{"line":159,"column":43}},"63":{"start":{"line":160,"column":6},"end":{"line":175,"column":7}},"64":{"start":{"line":161,"column":8},"end":{"line":164,"column":9}},"65":{"start":{"line":163,"column":10},"end":{"line":163,"column":19}},"66":{"start":{"line":165,"column":8},"end":{"line":165,"column":41}},"67":{"start":{"line":166,"column":8},"end":{"line":166,"column":32}},"68":{"start":{"line":167,"column":8},"end":{"line":174,"column":9}},"69":{"start":{"line":169,"column":10},"end":{"line":169,"column":58}},"70":{"start":{"line":171,"column":10},"end":{"line":173,"column":11}},"71":{"start":{"line":172,"column":12},"end":{"line":172,"column":39}},"72":{"start":{"line":177,"column":4},"end":{"line":177,"column":22}},"73":{"start":{"line":201,"column":4},"end":{"line":201,"column":54}},"74":{"start":{"line":221,"column":4},"end":{"line":221,"column":56}},"75":{"start":{"line":225,"column":4},"end":{"line":225,"column":31}},"76":{"start":{"line":226,"column":4},"end":{"line":228,"column":5}},"77":{"start":{"line":227,"column":6},"end":{"line":227,"column":20}},"78":{"start":{"line":229,"column":4},"end":{"line":229,"column":47}},"79":{"start":{"line":230,"column":4},"end":{"line":230,"column":18}},"80":{"start":{"line":242,"column":4},"end":{"line":242,"column":50}},"81":{"start":{"line":247,"column":0},"end":{"line":252,"column":1}},"82":{"start":{"line":248,"column":2},"end":{"line":250,"column":3}},"83":{"start":{"line":249,"column":4},"end":{"line":249,"column":21}},"84":{"start":{"line":251,"column":2},"end":{"line":251,"column":15}},"85":{"start":{"line":254,"column":0},"end":{"line":259,"column":1}},"86":{"start":{"line":255,"column":2},"end":{"line":257,"column":3}},"87":{"start":{"line":256,"column":4},"end":{"line":256,"column":22}},"88":{"start":{"line":258,"column":2},"end":{"line":258,"column":15}},"89":{"start":{"line":261,"column":0},"end":{"line":269,"column":1}},"90":{"start":{"line":262,"column":2},"end":{"line":262,"column":24}},"91":{"start":{"line":262,"column":14},"end":{"line":262,"column":24}},"92":{"start":{"line":263,"column":2},"end":{"line":263,"column":33}},"93":{"start":{"line":264,"column":2},"end":{"line":267,"column":3}},"94":{"start":{"line":265,"column":4},"end":{"line":265,"column":32}},"95":{"start":{"line":266,"column":4},"end":{"line":266,"column":28}},"96":{"start":{"line":266,"column":15},"end":{"line":266,"column":28}},"97":{"start":{"line":268,"column":2},"end":{"line":268,"column":12}}},"branchMap":{"1":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":33,"column":4}},{"start":{"line":33,"column":4},"end":{"line":33,"column":4}}]},"2":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":36,"column":4}},{"start":{"line":36,"column":4},"end":{"line":36,"column":4}}]},"3":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":11},"end":{"line":39,"column":15}},{"start":{"line":39,"column":19},"end":{"line":39,"column":35}},{"start":{"line":39,"column":39},"end":{"line":39,"column":41}}]},"4":{"line":53,"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":53,"column":4}},{"start":{"line":53,"column":4},"end":{"line":53,"column":4}}]},"5":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":55,"column":4}},{"start":{"line":55,"column":4},"end":{"line":55,"column":4}}]},"6":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":8},"end":{"line":55,"column":19}},{"start":{"line":55,"column":23},"end":{"line":55,"column":44}}]},"7":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":60,"column":4}},{"start":{"line":60,"column":4},"end":{"line":60,"column":4}}]},"8":{"line":62,"type":"if","locations":[{"start":{"line":62,"column":6},"end":{"line":62,"column":6}},{"start":{"line":62,"column":6},"end":{"line":62,"column":6}}]},"9":{"line":68,"type":"binary-expr","locations":[{"start":{"line":68,"column":21},"end":{"line":68,"column":45}},{"start":{"line":68,"column":49},"end":{"line":68,"column":55}}]},"10":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":4},"end":{"line":84,"column":4}},{"start":{"line":84,"column":4},"end":{"line":84,"column":4}}]},"11":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":4},"end":{"line":87,"column":4}},{"start":{"line":87,"column":4},"end":{"line":87,"column":4}}]},"12":{"line":92,"type":"binary-expr","locations":[{"start":{"line":92,"column":16},"end":{"line":92,"column":63}},{"start":{"line":92,"column":67},"end":{"line":92,"column":69}}]},"13":{"line":93,"type":"cond-expr","locations":[{"start":{"line":93,"column":22},"end":{"line":93,"column":42}},{"start":{"line":93,"column":45},"end":{"line":93,"column":47}}]},"14":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":4},"end":{"line":108,"column":4}},{"start":{"line":108,"column":4},"end":{"line":108,"column":4}}]},"15":{"line":111,"type":"binary-expr","locations":[{"start":{"line":111,"column":15},"end":{"line":111,"column":26}},{"start":{"line":111,"column":30},"end":{"line":111,"column":55}}]},"16":{"line":114,"type":"cond-expr","locations":[{"start":{"line":114,"column":50},"end":{"line":114,"column":65}},{"start":{"line":114,"column":68},"end":{"line":114,"column":70}}]},"17":{"line":114,"type":"binary-expr","locations":[{"start":{"line":114,"column":15},"end":{"line":114,"column":17}},{"start":{"line":114,"column":21},"end":{"line":114,"column":47}}]},"18":{"line":136,"type":"if","locations":[{"start":{"line":136,"column":4},"end":{"line":136,"column":4}},{"start":{"line":136,"column":4},"end":{"line":136,"column":4}}]},"19":{"line":137,"type":"if","locations":[{"start":{"line":137,"column":4},"end":{"line":137,"column":4}},{"start":{"line":137,"column":4},"end":{"line":137,"column":4}}]},"20":{"line":137,"type":"binary-expr","locations":[{"start":{"line":137,"column":8},"end":{"line":137,"column":26}},{"start":{"line":137,"column":30},"end":{"line":137,"column":69}}]},"21":{"line":138,"type":"if","locations":[{"start":{"line":138,"column":4},"end":{"line":138,"column":4}},{"start":{"line":138,"column":4},"end":{"line":138,"column":4}}]},"22":{"line":146,"type":"if","locations":[{"start":{"line":146,"column":4},"end":{"line":146,"column":4}},{"start":{"line":146,"column":4},"end":{"line":146,"column":4}}]},"23":{"line":151,"type":"if","locations":[{"start":{"line":151,"column":4},"end":{"line":151,"column":4}},{"start":{"line":151,"column":4},"end":{"line":151,"column":4}}]},"24":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":4},"end":{"line":155,"column":4}},{"start":{"line":155,"column":4},"end":{"line":155,"column":4}}]},"25":{"line":161,"type":"if","locations":[{"start":{"line":161,"column":8},"end":{"line":161,"column":8}},{"start":{"line":161,"column":8},"end":{"line":161,"column":8}}]},"26":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":8},"end":{"line":167,"column":8}},{"start":{"line":167,"column":8},"end":{"line":167,"column":8}}]},"27":{"line":167,"type":"binary-expr","locations":[{"start":{"line":167,"column":12},"end":{"line":167,"column":21}},{"start":{"line":167,"column":25},"end":{"line":167,"column":47}}]},"28":{"line":171,"type":"if","locations":[{"start":{"line":171,"column":10},"end":{"line":171,"column":10}},{"start":{"line":171,"column":10},"end":{"line":171,"column":10}}]},"29":{"line":226,"type":"if","locations":[{"start":{"line":226,"column":4},"end":{"line":226,"column":4}},{"start":{"line":226,"column":4},"end":{"line":226,"column":4}}]},"30":{"line":248,"type":"if","locations":[{"start":{"line":248,"column":2},"end":{"line":248,"column":2}},{"start":{"line":248,"column":2},"end":{"line":248,"column":2}}]},"31":{"line":255,"type":"if","locations":[{"start":{"line":255,"column":2},"end":{"line":255,"column":2}},{"start":{"line":255,"column":2},"end":{"line":255,"column":2}}]},"32":{"line":262,"type":"if","locations":[{"start":{"line":262,"column":2},"end":{"line":262,"column":2}},{"start":{"line":262,"column":2},"end":{"line":262,"column":2}}]},"33":{"line":266,"type":"if","locations":[{"start":{"line":266,"column":4},"end":{"line":266,"column":4}},{"start":{"line":266,"column":4},"end":{"line":266,"column":4}}]}},"code":["'use strict';","","const querystring = require('querystring');","const accepts = require('accepts');","","const _querycache = Symbol('_querycache');","const _queriesCache = Symbol('_queriesCache');","const PROTOCOL = Symbol('PROTOCOL');","const HOST = Symbol('HOST');","const ACCEPTS = Symbol('ACCEPTS');","const IPS = Symbol('IPS');","const RE_ARRAY_KEY = /[^\\[\\]]+\\[\\]$/;","","module.exports = {","  /**","   * Parse the \"Host\" header field host","   * and support X-Forwarded-Host when a","   * proxy is enabled.","   * @member {String} Request#host","   * @example","   * ip + port","   * ```js","   * this.request.host","   * => '127.0.0.1:7001'","   * ```","   * or domain","   * ```js","   * this.request.host","   * => 'demo.eggjs.org'","   * ```","   */","  get host() {","    if (this[HOST]) return this[HOST];","","    let host;","    if (this.app.config.proxy) {","      host = getFromHeaders(this, this.app.config.hostHeaders);","    }","    host = host || this.get('host') || '';","    this[HOST] = host.split(/\\s*,\\s*/)[0];","    return this[HOST];","  },","","  /**","   * @member {String} Request#protocol","   * @example","   * ```js","   * this.request.protocol","   * => 'https'","   * ```","   */","  get protocol() {","    if (this[PROTOCOL]) return this[PROTOCOL];","    // detect encrypted socket","    if (this.socket && this.socket.encrypted) {","      this[PROTOCOL] = 'https';","      return this[PROTOCOL];","    }","    // get from headers specified in `app.config.protocolHeaders`","    if (this.app.config.proxy) {","      const proto = getFromHeaders(this, this.app.config.protocolHeaders);","      if (proto) {","        this[PROTOCOL] = proto.split(/\\s*,\\s*/)[0];","        return this[PROTOCOL];","      }","    }","    // use protocol specified in `app.conig.protocol`","    this[PROTOCOL] = this.app.config.protocol || 'http';","    return this[PROTOCOL];","  },","","  /**","   * Get all pass through ip addresses from the request.","   * Enable only on `app.config.proxy = true`","   *","   * @member {Array} Request#ips","   * @example","   * ```js","   * this.request.ips","   * => ['100.23.1.2', '201.10.10.2']","   * ```","   */","  get ips() {","    if (this[IPS]) return this[IPS];","","    // return empty array when proxy=false","    if (!this.app.config.proxy) {","      this[IPS] = [];","      return this[IPS];","    }","","    const val = getFromHeaders(this, this.app.config.ipHeaders) || '';","    this[IPS] = val ? val.split(/\\s*,\\s*/) : [];","    return this[IPS];","  },","","  /**","   * Request remote IPv4 address","   * @member {String} Request#ip","   * @example","   * ```js","   * this.request.ip","   * => '127.0.0.1'","   * => '111.10.2.1'","   * ```","   */","  get ip() {","    if (this._ip) {","      return this._ip;","    }","    const ip = this.ips[0] || this.socket.remoteAddress;","    // will be '::ffff:x.x.x.x', should conver to standard IPv4 format","    // https://zh.wikipedia.org/wiki/IPv6","    this._ip = ip && ip.indexOf('::ffff:') > -1 ? ip.substring(7) : ip;","    return this._ip;","  },","","  /**","   * Set the remote address","   * @param {String} ip - IPv4 address","   */","  set ip(ip) {","    this._ip = ip;","  },","","  /**","   * detect if response should be json","   * 1. url path ends with `.json`","   * 2. response type is set to json","   * 3. detect by request accept header","   *","   * @member {Boolean} Request#acceptJSON","   * @since 1.0.0","   */","  get acceptJSON() {","    if (this.path.endsWith('.json')) return true;","    if (this.response.type && this.response.type.indexOf('json') >= 0) return true;","    if (this.accepts('html', 'text', 'json') === 'json') return true;","    return false;","  },","","  // 关于如何安全地读取 query 参数的讨论","  // https://github.com/koajs/qs/issues/5","  _customQuery(cacheName, filter) {","    const str = this.querystring;","    if (!str) {","      return {};","    }","","    let c = this[cacheName];","    if (!c) {","      c = this[cacheName] = {};","    }","    let cacheQuery = c[str];","    if (!cacheQuery) {","      cacheQuery = c[str] = {};","      const isQueries = cacheName === _queriesCache;","      // querystring.parse 不会解析 a[foo]=1&a[bar]=2 的情况","      const query = querystring.parse(str);","      for (const key in query) {","        if (!key) {","          // key is '', like `a=b&`","          continue;","        }","        const value = filter(query[key]);","        cacheQuery[key] = value;","        if (isQueries && RE_ARRAY_KEY.test(key)) {","          // 支持兼容 this.queries['key'] => this.queries['key[]']","          const subkey = key.substring(0, key.length - 2);","","          if (!cacheQuery[subkey]) {","            cacheQuery[subkey] = value;","          }","        }","      }","    }","    return cacheQuery;","  },","","  /**","   * 获取当前请求以 querystring 传递的参数，所有参数值都以 String 类型返回","   * @member {Object} Request#query","   * @example","   * ```js","   * GET http://127.0.0.1:7001?name=Foo&age=20&age=21","   * this.query","   * => { 'name': 'Foo', 'age': 20 }","   *","   * GET http://127.0.0.1:7001?a=b&a=c&o[foo]=bar&b[]=1&b[]=2&e=val","   * this.query","   * =>","   * {","   *   \"a\": \"b\",","   *   \"o[foo]\": \"bar\",","   *   \"b[]\": \"1\",","   *   \"e\": \"val\"","   * }","   * ```","   */","  get query() {","    return this._customQuery(_querycache, firstValue);","  },","","  /**","   * 获取当前请求以 querystring 传递的参数，所有参数值都以 Array 类型返回，类似 {@link Request#query}","   * @member {Array} Request#queries","   * @example","   * ```js","   * GET http://127.0.0.1:7001?a=b&a=c&o[foo]=bar&b[]=1&b[]=2&e=val","   * this.queries","   * =>","   * {","   *   \"a\": [\"b\", \"c\"],","   *   \"o[foo]\": [\"bar\"],","   *   \"b[]\": [\"1\", \"2\"],","   *   \"e\": [\"val\"]","   * }","   * ```","   */","  get queries() {","    return this._customQuery(_queriesCache, arrayValue);","  },","","  get accept() {","    let accept = this[ACCEPTS];","    if (accept) {","      return accept;","    }","    accept = this[ACCEPTS] = accepts(this.req);","    return accept;","  },","","  /**","   * Set query-string as an object.","   *","   * @method Request#query","   * @param {Object} obj set querystring and query object for request.","   * @return {void}","   * @api public","   */","  set query(obj) {","    this.querystring = querystring.stringify(obj);","  },","};","","","function firstValue(value) {","  if (Array.isArray(value)) {","    value = value[0];","  }","  return value;","}","","function arrayValue(value) {","  if (!Array.isArray(value)) {","    value = [ value ];","  }","  return value;","}","","function getFromHeaders(ctx, names) {","  if (!names) return '';","  names = names.split(/\\s*,\\s*/);","  for (const name of names) {","    const value = ctx.get(name);","    if (value) return value;","  }","  return '';","}",""],"l":{"3":1,"4":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"14":1,"33":4,"35":4,"36":4,"37":0,"39":0,"40":0,"41":0,"53":4,"55":4,"56":0,"57":0,"60":4,"61":0,"62":0,"63":0,"64":0,"68":0,"69":0,"84":8,"87":8,"88":0,"89":0,"92":0,"93":0,"94":0,"108":4,"109":0,"111":4,"114":0,"115":0,"123":0,"136":4,"137":0,"138":0,"139":0,"145":4,"146":4,"147":4,"150":0,"151":0,"152":0,"154":0,"155":0,"156":0,"157":0,"159":0,"160":0,"161":0,"163":0,"165":0,"166":0,"167":0,"169":0,"171":0,"172":0,"177":0,"201":2,"221":2,"225":2,"226":2,"227":0,"229":2,"230":0,"242":0,"247":1,"248":0,"249":0,"251":0,"254":1,"255":0,"256":0,"258":0,"261":1,"262":0,"263":0,"264":0,"265":0,"266":0,"268":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/extend/response.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/extend/response.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":4,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":4,"24":0,"25":0,"26":0,"27":4,"28":0,"29":4,"30":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,4]},"f":{"1":0,"2":4,"3":0,"4":4,"5":4,"6":0},"fnMap":{"1":{"name":"(anonymous_1)","line":8,"loc":{"start":{"line":8,"column":12},"end":{"line":8,"column":16}}},"2":{"name":"(anonymous_2)","line":14,"loc":{"start":{"line":14,"column":12},"end":{"line":14,"column":15}}},"3":{"name":"(anonymous_3)","line":30,"loc":{"start":{"line":30,"column":10},"end":{"line":30,"column":17}}},"4":{"name":"(anonymous_4)","line":41,"loc":{"start":{"line":41,"column":10},"end":{"line":41,"column":13}}},"5":{"name":"(anonymous_5)","line":57,"loc":{"start":{"line":57,"column":16},"end":{"line":57,"column":19}}},"6":{"name":"(anonymous_6)","line":70,"loc":{"start":{"line":70,"column":16},"end":{"line":70,"column":25}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":50}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":38}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":49}},"4":{"start":{"line":7,"column":0},"end":{"line":73,"column":2}},"5":{"start":{"line":11,"column":4},"end":{"line":11,"column":34}},"6":{"start":{"line":16,"column":4},"end":{"line":16,"column":46}},"7":{"start":{"line":17,"column":4},"end":{"line":17,"column":27}},"8":{"start":{"line":19,"column":4},"end":{"line":25,"column":5}},"9":{"start":{"line":20,"column":6},"end":{"line":20,"column":24}},"10":{"start":{"line":20,"column":17},"end":{"line":20,"column":24}},"11":{"start":{"line":21,"column":6},"end":{"line":21,"column":67}},"12":{"start":{"line":21,"column":36},"end":{"line":21,"column":67}},"13":{"start":{"line":22,"column":6},"end":{"line":22,"column":52}},"14":{"start":{"line":22,"column":33},"end":{"line":22,"column":52}},"15":{"start":{"line":23,"column":6},"end":{"line":23,"column":71}},"16":{"start":{"line":23,"column":24},"end":{"line":23,"column":71}},"17":{"start":{"line":24,"column":6},"end":{"line":24,"column":13}},"18":{"start":{"line":27,"column":4},"end":{"line":27,"column":29}},"19":{"start":{"line":33,"column":4},"end":{"line":33,"column":25}},"20":{"start":{"line":34,"column":4},"end":{"line":38,"column":5}},"21":{"start":{"line":35,"column":6},"end":{"line":35,"column":37}},"22":{"start":{"line":37,"column":6},"end":{"line":37,"column":34}},"23":{"start":{"line":43,"column":4},"end":{"line":43,"column":42}},"24":{"start":{"line":44,"column":4},"end":{"line":44,"column":25}},"25":{"start":{"line":44,"column":15},"end":{"line":44,"column":25}},"26":{"start":{"line":45,"column":4},"end":{"line":45,"column":30}},"27":{"start":{"line":58,"column":4},"end":{"line":60,"column":5}},"28":{"start":{"line":59,"column":6},"end":{"line":59,"column":31}},"29":{"start":{"line":61,"column":4},"end":{"line":61,"column":23}},"30":{"start":{"line":71,"column":4},"end":{"line":71,"column":31}}},"branchMap":{"1":{"line":19,"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":4}},{"start":{"line":19,"column":4},"end":{"line":19,"column":4}}]},"2":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":6},"end":{"line":20,"column":6}},{"start":{"line":20,"column":6},"end":{"line":20,"column":6}}]},"3":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":6},"end":{"line":21,"column":6}},{"start":{"line":21,"column":6},"end":{"line":21,"column":6}}]},"4":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":6},"end":{"line":22,"column":6}},{"start":{"line":22,"column":6},"end":{"line":22,"column":6}}]},"5":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":6},"end":{"line":23,"column":6}},{"start":{"line":23,"column":6},"end":{"line":23,"column":6}}]},"6":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":34,"column":4}},{"start":{"line":34,"column":4},"end":{"line":34,"column":4}}]},"7":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":44,"column":4}},{"start":{"line":44,"column":4},"end":{"line":44,"column":4}}]},"8":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":4},"end":{"line":58,"column":4}},{"start":{"line":58,"column":4},"end":{"line":58,"column":4}}]}},"code":["'use strict';","","const getType = require('mime-types').contentType;","const isJSON = require('koa-is-json');","const REAL_STATUS = Symbol('Context#realStatus');","","module.exports = {","  set length(n) {","    // copy from koa","    // change header name to lower case","    this.set('content-length', n);","  },","","  get length() {","    // copy from koa","    const len = this.header['content-length'];","    const body = this.body;","","    if (len == null) {","      if (!body) return;","      if (typeof body === 'string') return Buffer.byteLength(body);","      if (Buffer.isBuffer(body)) return body.length;","      if (isJSON(body)) return Buffer.byteLength(JSON.stringify(body));","      return;","    }","","    return parseInt(len, 10);","  },","","  set type(type) {","    // copy from koa","    // change header name to lower case","    type = getType(type);","    if (type) {","      this.set('content-type', type);","    } else {","      this.remove('content-type');","    }","  },","","  get type() {","    // copy from koa","    const type = this.get('content-type');","    if (!type) return '';","    return type.split(';')[0];","  },","","  /**","   * read response real status code.","   *","   * e.g.: Using 302 status redirect to the global error page","   * instead of show current 500 status page.","   * And access log should save 500 not 302,","   * then the `realStatus` can help us find out the real status code.","   * @member {Number} Context#realStatus","   */","  get realStatus() {","    if (this[REAL_STATUS]) {","      return this[REAL_STATUS];","    }","    return this.status;","  },","","  /**","   * set response real status code.","   *","   * @member {Void} Response#realStatus","   * @param {Number} status the real status code","   */","  set realStatus(status) {","    this[REAL_STATUS] = status;","  },","};",""],"l":{"3":1,"4":1,"5":1,"7":1,"11":0,"16":4,"17":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"27":0,"33":0,"34":0,"35":0,"37":0,"43":4,"44":0,"45":0,"58":4,"59":0,"61":4,"71":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/middleware/body_parser.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/middleware/body_parser.js","s":{"1":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":43}}},"branchMap":{},"code":["'use strict';","","module.exports = require('koa-bodyparser');",""],"l":{"3":1}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/middleware/meta.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/middleware/meta.js","s":{"1":1,"2":0,"3":0,"4":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"meta","line":8,"loc":{"start":{"line":8,"column":9},"end":{"line":8,"column":30}}}},"statementMap":{"1":{"start":{"line":7,"column":0},"end":{"line":13,"column":2}},"2":{"start":{"line":8,"column":2},"end":{"line":12,"column":4}},"3":{"start":{"line":9,"column":4},"end":{"line":9,"column":15}},"4":{"start":{"line":11,"column":4},"end":{"line":11,"column":56}}},"branchMap":{},"code":["/**"," * meta middleware, should be the first middleware"," */","","'use strict';","","module.exports = () => {","  return function* meta(next) {","    yield next;","    // total response time header","    this.set('x-readtime', Date.now() - this.starttime);","  };","};",""],"l":{"7":1,"8":0,"9":0,"11":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/middleware/notfound.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/middleware/notfound.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"notfound","line":4,"loc":{"start":{"line":4,"column":9},"end":{"line":4,"column":34}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":36,"column":2}},"2":{"start":{"line":4,"column":2},"end":{"line":35,"column":4}},"3":{"start":{"line":5,"column":4},"end":{"line":5,"column":15}},"4":{"start":{"line":7,"column":4},"end":{"line":9,"column":5}},"5":{"start":{"line":8,"column":6},"end":{"line":8,"column":13}},"6":{"start":{"line":12,"column":4},"end":{"line":12,"column":22}},"7":{"start":{"line":14,"column":4},"end":{"line":19,"column":5}},"8":{"start":{"line":15,"column":6},"end":{"line":17,"column":8}},"9":{"start":{"line":18,"column":6},"end":{"line":18,"column":13}},"10":{"start":{"line":21,"column":4},"end":{"line":21,"column":50}},"11":{"start":{"line":24,"column":4},"end":{"line":27,"column":5}},"12":{"start":{"line":25,"column":6},"end":{"line":25,"column":127}},"13":{"start":{"line":26,"column":6},"end":{"line":26,"column":13}},"14":{"start":{"line":29,"column":4},"end":{"line":33,"column":5}},"15":{"start":{"line":30,"column":6},"end":{"line":30,"column":28}},"16":{"start":{"line":31,"column":6},"end":{"line":31,"column":37}},"17":{"start":{"line":32,"column":6},"end":{"line":32,"column":13}},"18":{"start":{"line":34,"column":4},"end":{"line":34,"column":29}}},"branchMap":{"1":{"line":7,"type":"if","locations":[{"start":{"line":7,"column":4},"end":{"line":7,"column":4}},{"start":{"line":7,"column":4},"end":{"line":7,"column":4}}]},"2":{"line":7,"type":"binary-expr","locations":[{"start":{"line":7,"column":8},"end":{"line":7,"column":27}},{"start":{"line":7,"column":31},"end":{"line":7,"column":40}}]},"3":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":4},"end":{"line":14,"column":4}},{"start":{"line":14,"column":4},"end":{"line":14,"column":4}}]},"4":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":4},"end":{"line":24,"column":4}},{"start":{"line":24,"column":4},"end":{"line":24,"column":4}}]},"5":{"line":24,"type":"binary-expr","locations":[{"start":{"line":24,"column":8},"end":{"line":24,"column":23}},{"start":{"line":24,"column":27},"end":{"line":24,"column":56}}]},"6":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":29,"column":4}},{"start":{"line":29,"column":4},"end":{"line":29,"column":4}}]}},"code":["'use strict';","","module.exports = options => {","  return function* notfound(next) {","    yield next;","","    if (this.status !== 404 || this.body) {","      return;","    }","","    // set status first, make sure set body not set status","    this.status = 404;","","    if (this.acceptJSON) {","      this.body = {","        message: 'Not Found',","      };","      return;","    }","","    const notFoundHtml = '<h1>404 Not Found</h1>';","","    // notfound handler is unimplemented","    if (options.pageUrl && this.path === options.pageUrl) {","      this.body = `${notFoundHtml}<p><pre><code>config.notfound.pageUrl(${options.pageUrl})</code></pre> is unimplemented</p>`;","      return;","    }","","    if (options.pageUrl) {","      this.realStatus = 404;","      this.redirect(options.pageUrl);","      return;","    }","    this.body = notFoundHtml;","  };","};",""],"l":{"3":1,"4":0,"5":0,"7":0,"8":0,"12":0,"14":0,"15":0,"18":0,"21":0,"24":0,"25":0,"26":0,"29":0,"30":0,"31":0,"32":0,"34":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/middleware/site_file.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/app/middleware/site_file.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"siteFile","line":7,"loc":{"start":{"line":7,"column":9},"end":{"line":7,"column":34}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":42}},"3":{"start":{"line":6,"column":0},"end":{"line":30,"column":2}},"4":{"start":{"line":7,"column":2},"end":{"line":29,"column":4}},"5":{"start":{"line":8,"column":4},"end":{"line":8,"column":75}},"6":{"start":{"line":8,"column":57},"end":{"line":8,"column":75}},"7":{"start":{"line":10,"column":4},"end":{"line":10,"column":48}},"8":{"start":{"line":10,"column":30},"end":{"line":10,"column":48},"skip":true},"9":{"start":{"line":12,"column":4},"end":{"line":12,"column":39}},"10":{"start":{"line":13,"column":4},"end":{"line":13,"column":36}},"11":{"start":{"line":13,"column":18},"end":{"line":13,"column":36}},"12":{"start":{"line":17,"column":4},"end":{"line":17,"column":67}},"13":{"start":{"line":17,"column":37},"end":{"line":17,"column":67}},"14":{"start":{"line":21,"column":4},"end":{"line":26,"column":5}},"15":{"start":{"line":22,"column":6},"end":{"line":22,"column":41}},"16":{"start":{"line":23,"column":6},"end":{"line":23,"column":26}},"17":{"start":{"line":24,"column":6},"end":{"line":24,"column":42}},"18":{"start":{"line":25,"column":6},"end":{"line":25,"column":13}},"19":{"start":{"line":28,"column":4},"end":{"line":28,"column":15}}},"branchMap":{"1":{"line":8,"type":"if","locations":[{"start":{"line":8,"column":4},"end":{"line":8,"column":4}},{"start":{"line":8,"column":4},"end":{"line":8,"column":4}}]},"2":{"line":8,"type":"binary-expr","locations":[{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},{"start":{"line":8,"column":34},"end":{"line":8,"column":55}}]},"3":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":4},"skip":true},{"start":{"line":10,"column":4},"end":{"line":10,"column":4}}]},"4":{"line":13,"type":"if","locations":[{"start":{"line":13,"column":4},"end":{"line":13,"column":4}},{"start":{"line":13,"column":4},"end":{"line":13,"column":4}}]},"5":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":17,"column":4}},{"start":{"line":17,"column":4},"end":{"line":17,"column":4}}]},"6":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":4}},{"start":{"line":21,"column":4},"end":{"line":21,"column":4}}]}},"code":["'use strict';","","const path = require('path');","const MAX_AGE = 'public, max-age=2592000'; // 30 days","","module.exports = options => {","  return function* siteFile(next) {","    if (this.method !== 'HEAD' && this.method !== 'GET') return yield next;","    /* istanbul ignore if */","    if (this.path[0] !== '/') return yield next;","","    const content = options[this.path];","    if (!content) return yield next;","","    // '/favicon.ico': 'https://eggjs.org/favicon.ico',","    // content is url","    if (typeof content === 'string') return this.redirect(content);","","    // '/robots.txt': Buffer <xx..","    // content is buffer","    if (Buffer.isBuffer(content)) {","      this.set('cache-control', MAX_AGE);","      this.body = content;","      this.type = path.extname(this.path);","      return;","    }","","    yield next;","  };","};",""],"l":{"3":1,"4":1,"6":1,"7":0,"8":0,"10":1,"12":0,"13":0,"17":0,"21":0,"22":0,"23":0,"24":0,"25":0,"28":0}},"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/dnscache_httpclient.js":{"path":"/home/travis/build/npmtest/node-npmtest-egg/node_modules/egg/lib/core/dnscache_httpclient.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"(anonymous_1)","line":8,"loc":{"start":{"line":8,"column":13},"end":{"line":8,"column":23}}},"2":{"name":"(anonymous_2)","line":16,"loc":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}}},"3":{"name":"(anonymous_3)","line":41,"loc":{"start":{"line":41,"column":6},"end":{"line":41,"column":28}}},"4":{"name":"(anonymous_4)","line":45,"loc":{"start":{"line":45,"column":14},"end":{"line":45,"column":26}}},"5":{"name":"(anonymous_5)","line":62,"loc":{"start":{"line":62,"column":12},"end":{"line":62,"column":34}}},"6":{"name":"(anonymous_6)","line":114,"loc":{"start":{"line":114,"column":21},"end":{"line":114,"column":42}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":38}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":33}},"4":{"start":{"line":9,"column":4},"end":{"line":9,"column":19}},"5":{"start":{"line":11,"column":4},"end":{"line":11,"column":27}},"6":{"start":{"line":12,"column":4},"end":{"line":12,"column":32}},"7":{"start":{"line":13,"column":4},"end":{"line":13,"column":30}},"8":{"start":{"line":18,"column":4},"end":{"line":21,"column":5}},"9":{"start":{"line":19,"column":6},"end":{"line":19,"column":22}},"10":{"start":{"line":20,"column":6},"end":{"line":20,"column":18}},"11":{"start":{"line":24,"column":4},"end":{"line":30,"column":5}},"12":{"start":{"line":25,"column":6},"end":{"line":28,"column":9}},"13":{"start":{"line":26,"column":8},"end":{"line":26,"column":38}},"14":{"start":{"line":26,"column":17},"end":{"line":26,"column":38}},"15":{"start":{"line":27,"column":8},"end":{"line":27,"column":57}},"16":{"start":{"line":29,"column":6},"end":{"line":29,"column":13}},"17":{"start":{"line":33,"column":4},"end":{"line":38,"column":62}},"18":{"start":{"line":34,"column":6},"end":{"line":37,"column":9}},"19":{"start":{"line":35,"column":8},"end":{"line":35,"column":36}},"20":{"start":{"line":35,"column":17},"end":{"line":35,"column":36}},"21":{"start":{"line":36,"column":8},"end":{"line":36,"column":24}},"22":{"start":{"line":38,"column":22},"end":{"line":38,"column":60}},"23":{"start":{"line":42,"column":4},"end":{"line":42,"column":45}},"24":{"start":{"line":46,"column":4},"end":{"line":46,"column":99}},"25":{"start":{"line":47,"column":4},"end":{"line":59,"column":6}},"26":{"start":{"line":48,"column":6},"end":{"line":58,"column":9}},"27":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"28":{"start":{"line":50,"column":10},"end":{"line":50,"column":31}},"29":{"start":{"line":52,"column":8},"end":{"line":57,"column":11}},"30":{"start":{"line":63,"column":4},"end":{"line":63,"column":65}},"31":{"start":{"line":65,"column":4},"end":{"line":65,"column":33}},"32":{"start":{"line":66,"column":4},"end":{"line":66,"column":22}},"33":{"start":{"line":67,"column":4},"end":{"line":67,"column":38}},"34":{"start":{"line":69,"column":4},"end":{"line":71,"column":5}},"35":{"start":{"line":70,"column":6},"end":{"line":70,"column":31}},"36":{"start":{"line":73,"column":4},"end":{"line":73,"column":43}},"37":{"start":{"line":74,"column":4},"end":{"line":74,"column":27}},"38":{"start":{"line":75,"column":4},"end":{"line":91,"column":5}},"39":{"start":{"line":76,"column":6},"end":{"line":76,"column":71}},"40":{"start":{"line":77,"column":6},"end":{"line":80,"column":7}},"41":{"start":{"line":79,"column":8},"end":{"line":79,"column":31}},"42":{"start":{"line":81,"column":6},"end":{"line":84,"column":9}},"43":{"start":{"line":85,"column":6},"end":{"line":88,"column":7}},"44":{"start":{"line":87,"column":8},"end":{"line":87,"column":15}},"45":{"start":{"line":90,"column":6},"end":{"line":90,"column":22}},"46":{"start":{"line":93,"column":4},"end":{"line":111,"column":7}},"47":{"start":{"line":94,"column":6},"end":{"line":94,"column":74}},"48":{"start":{"line":95,"column":6},"end":{"line":99,"column":7}},"49":{"start":{"line":96,"column":8},"end":{"line":96,"column":92}},"50":{"start":{"line":98,"column":8},"end":{"line":98,"column":41}},"51":{"start":{"line":101,"column":6},"end":{"line":101,"column":96}},"52":{"start":{"line":102,"column":6},"end":{"line":105,"column":9}},"53":{"start":{"line":107,"column":6},"end":{"line":110,"column":9}},"54":{"start":{"line":115,"column":4},"end":{"line":122,"column":5}},"55":{"start":{"line":116,"column":6},"end":{"line":116,"column":39}},"56":{"start":{"line":118,"column":6},"end":{"line":118,"column":57}},"57":{"start":{"line":119,"column":6},"end":{"line":121,"column":7}},"58":{"start":{"line":120,"column":8},"end":{"line":120,"column":51}},"59":{"start":{"line":123,"column":4},"end":{"line":123,"column":15}},"60":{"start":{"line":127,"column":0},"end":{"line":127,"column":36}}},"branchMap":{"1":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":18,"column":4}},{"start":{"line":18,"column":4},"end":{"line":18,"column":4}}]},"2":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":4},"end":{"line":24,"column":4}},{"start":{"line":24,"column":4},"end":{"line":24,"column":4}}]},"3":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":26,"column":8}},{"start":{"line":26,"column":8},"end":{"line":26,"column":8}}]},"4":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":8},"end":{"line":35,"column":8}},{"start":{"line":35,"column":8},"end":{"line":35,"column":8}}]},"5":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":8}},{"start":{"line":49,"column":8},"end":{"line":49,"column":8}}]},"6":{"line":63,"type":"cond-expr","locations":[{"start":{"line":63,"column":45},"end":{"line":63,"column":58}},{"start":{"line":63,"column":61},"end":{"line":63,"column":64}}]},"7":{"line":66,"type":"binary-expr","locations":[{"start":{"line":66,"column":11},"end":{"line":66,"column":15}},{"start":{"line":66,"column":19},"end":{"line":66,"column":21}}]},"8":{"line":67,"type":"binary-expr","locations":[{"start":{"line":67,"column":19},"end":{"line":67,"column":31}},{"start":{"line":67,"column":35},"end":{"line":67,"column":37}}]},"9":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":69,"column":4}},{"start":{"line":69,"column":4},"end":{"line":69,"column":4}}]},"10":{"line":69,"type":"binary-expr","locations":[{"start":{"line":69,"column":8},"end":{"line":69,"column":26}},{"start":{"line":69,"column":30},"end":{"line":69,"column":48}}]},"11":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":4},"end":{"line":75,"column":4}},{"start":{"line":75,"column":4},"end":{"line":75,"column":4}}]},"12":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":6},"end":{"line":77,"column":6}},{"start":{"line":77,"column":6},"end":{"line":77,"column":6}}]},"13":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":6},"end":{"line":85,"column":6}},{"start":{"line":85,"column":6},"end":{"line":85,"column":6}}]},"14":{"line":94,"type":"cond-expr","locations":[{"start":{"line":94,"column":32},"end":{"line":94,"column":51}},{"start":{"line":94,"column":54},"end":{"line":94,"column":73}}]},"15":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":6},"end":{"line":95,"column":6}},{"start":{"line":95,"column":6},"end":{"line":95,"column":6}}]},"16":{"line":98,"type":"binary-expr","locations":[{"start":{"line":98,"column":15},"end":{"line":98,"column":23}},{"start":{"line":98,"column":27},"end":{"line":98,"column":40}}]},"17":{"line":107,"type":"binary-expr","locations":[{"start":{"line":107,"column":6},"end":{"line":107,"column":14}},{"start":{"line":107,"column":18},"end":{"line":110,"column":8}}]},"18":{"line":115,"type":"if","locations":[{"start":{"line":115,"column":4},"end":{"line":115,"column":4}},{"start":{"line":115,"column":4},"end":{"line":115,"column":4}}]},"19":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":6},"end":{"line":119,"column":6}},{"start":{"line":119,"column":6},"end":{"line":119,"column":6}}]}},"code":["'use strict';","","const dns = require('dns');","const urlparse = require('url').parse;","const urllib = require('urllib');","","class DNSCacheHttpClient extends urllib.HttpClient {","  constructor(options) {","    super(options);","","    this.app = options.app;","    this.dnsCacheMaxAge = 10000;","    this.dnsCache = new Map();","  }","","  request(url, args, callback) {","    // request(url, callback)","    if (typeof args === 'function') {","      callback = args;","      args = null;","    }","","    // the callback style","    if (callback) {","      this._dnsLookup(url, args, (err, result) => {","        if (err) return callback(err);","        super.request(result.url, result.args, callback);","      });","      return;","    }","","    // the Promise style","    return new Promise((resolve, reject) => {","      this._dnsLookup(url, args, (err, result) => {","        if (err) return reject(err);","        resolve(result);","      });","    }).then(result => super.request(result.url, result.args));","  }","","  curl(url, args, callback) {","    return this.request(url, args, callback);","  }","","  requestThunk(url, args) {","    this.app.deprecate('[dnscache_httpclient] Please use `request()` instead of `requestThunk()`');","    return callback => {","      this.request(url, args, (err, data, res) => {","        if (err) {","          return callback(err);","        }","        callback(null, {","          data,","          status: res.status,","          headers: res.headers,","          res,","        });","      });","    };","  }","","  _dnsLookup(url, args, callback) {","    const parsed = typeof url === 'string' ? urlparse(url) : url;","    // hostname must exists","    const host = parsed.hostname;","    args = args || {};","    args.headers = args.headers || {};","    // set host header is not exists","    if (!args.headers.host && !args.headers.Host) {","      args.headers.host = host;","    }","","    const record = this.dnsCache.get(host);","    const now = Date.now();","    if (record) {","      const needUpdate = now - record.timestamp >= this.dnsCacheMaxAge;","      if (needUpdate) {","        // make sure next request don't refresh dns query","        record.timestamp = now;","      }","      callback(null, {","        url: this._formatDnsLookupUrl(host, url, record.ip),","        args,","      });","      if (!needUpdate) {","        // no need to refresh dns record","        return;","      }","      // make sure not callback twice","      callback = null;","    }","","    dns.lookup(host, { family: 4 }, (err, address) => {","      const logger = args.ctx ? args.ctx.coreLogger : this.app.coreLogger;","      if (err) {","        logger.warn('[dnscache_httpclient] dns lookup error: %s(%s) => %s', host, url, err);","        // no cache, return error","        return callback && callback(err);","      }","","      logger.info('[dnscache_httpclient] dns lookup success: %s(%s) => %s', host, url, address);","      this.dnsCache.set(host, {","        timestamp: Date.now(),","        ip: address,","      });","","      callback && callback(null, {","        url: this._formatDnsLookupUrl(host, url, address),","        args,","      });","    });","  }","","  _formatDnsLookupUrl(host, url, address) {","    if (typeof url === 'string') {","      url = url.replace(host, address);","    } else {","      url.hostname = url.hostname.replace(host, address);","      if (url.host) {","        url.host = url.host.replace(host, address);","      }","    }","    return url;","  }","}","","module.exports = DNSCacheHttpClient;",""],"l":{"3":1,"4":1,"5":1,"9":0,"11":0,"12":0,"13":0,"18":0,"19":0,"20":0,"24":0,"25":0,"26":0,"27":0,"29":0,"33":0,"34":0,"35":0,"36":0,"38":0,"42":0,"46":0,"47":0,"48":0,"49":0,"50":0,"52":0,"63":0,"65":0,"66":0,"67":0,"69":0,"70":0,"73":0,"74":0,"75":0,"76":0,"77":0,"79":0,"81":0,"85":0,"87":0,"90":0,"93":0,"94":0,"95":0,"96":0,"98":0,"101":0,"102":0,"107":0,"115":0,"116":0,"118":0,"119":0,"120":0,"123":0,"127":1}}}